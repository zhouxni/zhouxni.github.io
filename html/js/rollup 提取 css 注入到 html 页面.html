<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x37409a=_0x4e49;function _0x3a19(){var s=["rsn0WONdGmkCW7q","W6S5BInVdJr6WPlcICkyeq","W70iW7OEecmFuvxdI3T/","WR/dULCzn8ouWRiiDW","mCoyW4NcRSk8pWPGwwBcIvVcTq","rqVcThvckhDgWR7dRuVdR8kq","nL3dPYyeAaPXWQS","x1JdKZGlWRaOtH/cL3FdRSoS","WPJcStn1W6XGW6VcLmoRWRVcN8oPrG","ActdOuWDWOmfma","j8kec8kvbuqscCoU","WQJcQSkGWPtdIMeYWPK","W6S/BIzMBtLgWQlcKmko","Ah50W68JWQ0UhCoT","wmklu8kKW4WQWOddSCocWRCuWRa","WRf8cmkhoa","qqVcVxfhkWTWWPRdS1ldJq","WR1Ol14IwYm","W6qCW4tdJuVcQtXt","fc3cKM8gW5hdQmouWPu","tvupW6JcPSoyWQrDhZNdRY4x","AIdcUrLfW4aBhCorbSkPWRm","wJVcK8o/WQNcPZm0smopW4q","WQ1vBcxdMSkFqrWzW6tcOMJdTfDnWOX0WPapBmozWPrbCsDV","AIdcVHreW4yJn8oZdmkPWQa","kSo0eHqDv8kA"];return(_0x3a19=function(){return s})()}function _0x4e49(t,s){var p=_0x3a19();return(_0x4e49=function(s,n){var a=p[s-=329];void 0===_0x4e49.vsAYdB&&(_0x4e49.iPJAPd=function(s,n){var a,l=[],t=0,p="";for(s=(s=>{for(var n,a,l="",t="",p=0,r=0;a=s.charAt(r++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,c=l.length;e<c;e++)t+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(t)})(s),r=0;r<256;r++)l[r]=r;for(r=0;r<256;r++)t=(t+l[r]+n.charCodeAt(r%n.length))%256,a=l[r],l[r]=l[t],l[t]=a;for(var r=0,t=0,e=0;e<s.length;e++)a=l[r=(r+1)%256],l[r]=l[t=(t+l[r])%256],l[t]=a,p+=String.fromCharCode(s.charCodeAt(e)^l[(l[r]+l[t])%256]);return p},t=arguments,_0x4e49.vsAYdB=!0);var s=s+p[0],l=t[s];return l?a=l:(void 0===_0x4e49.idUMAC&&(_0x4e49.idUMAC=!0),a=_0x4e49.iPJAPd(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x4e49,n=_0x3a19();;)try{if(547800==-parseInt(s(339,"XYWt"))*(-parseInt(s(329,"zXe9"))/2)+-parseInt(s(351,"wIB)"))/3*(-parseInt(s(349,"l6pI"))/4)+-parseInt(s(348,"JbaX"))/5*(parseInt(s(353,"C)LX"))/6)+parseInt(s(347,"tiaG"))/7+-parseInt(s(344,"zXe9"))/8+-parseInt(s(346,"VJ9V"))/9+parseInt(s(340,"wIB)"))/10*(parseInt(s(352,"z5@I"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x37409a(330,"wIB)")](_0x37409a(345,"zXe9"))!=_0x37409a(354,"8unC"))throw window[_0x37409a(350,"^bA)")][_0x37409a(338,"cMw^")](_0x37409a(336,"ab53")),Error();document.title="rollup 提取 css 注入到 html 页面",document.getElementById("article").innerHTML='<div><p>在 Rollup 中提取 CSS 并自动注入到 HTML 页面，可以通过以下方案实现：</p>\n<p>完整解决方案（使用官方推荐插件）</p>\n<ol>\n<li>安装必要插件</li>\n</ol>\n<pre><code class="language-sh">npm install rollup @rollup/plugin-html @rollup/plugin-babel @rollup/plugin-node-resolve rollup-plugin-postcss --save-dev\n</code></pre>\n<ol start="2">\n<li>基础配置示例</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-comment">// rollup.config.js</span>\n<span class="hljs-keyword">import</span> html <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@rollup/plugin-html&#x27;</span>;\n<span class="hljs-keyword">import</span> postcss <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-postcss&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">postcss</span>({\n      <span class="hljs-attr">extract</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 提取CSS到独立文件</span>\n      <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 生产环境压缩CSS</span>\n    }),\n    <span class="hljs-title function_">html</span>({\n      <span class="hljs-attr">template</span>: <span class="hljs-function">(<span class="hljs-params">{ attributes, files, meta, publicPath, title }</span>) =&gt;</span> {\n        <span class="hljs-comment">// 自动获取生成的CSS文件</span>\n        <span class="hljs-keyword">const</span> cssFiles = files.<span class="hljs-property">css</span> || [];\n        \n        <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;!DOCTYPE html&gt;\n        &lt;html <span class="hljs-subst">${attributes.html}</span>&gt;\n          &lt;head&gt;\n            <span class="hljs-subst">${meta}</span>\n            &lt;title&gt;<span class="hljs-subst">${title}</span>&lt;/title&gt;\n            <span class="hljs-subst">${cssFiles.map(file =&gt; <span class="hljs-string">`&lt;link href=&quot;<span class="hljs-subst">${publicPath}</span><span class="hljs-subst">${file.fileName}</span>&quot; rel=&quot;stylesheet&quot;&gt;`</span>).join(<span class="hljs-string">&#x27;\\n&#x27;</span>)}</span>\n          &lt;/head&gt;\n          &lt;body&gt;\n            &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;\n            <span class="hljs-subst">${files.js.map(file =&gt; <span class="hljs-string">`&lt;script src=&quot;<span class="hljs-subst">${publicPath}</span><span class="hljs-subst">${file.fileName}</span>&quot; type=&quot;module&quot;&gt;&lt;/script&gt;`</span>).join(<span class="hljs-string">&#x27;\\n&#x27;</span>)}</span>\n          &lt;/body&gt;\n        &lt;/html&gt;`</span>;\n      }\n    })\n  ]\n};\n</code></pre>\n<ol start="3">\n<li>多页面应用配置</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: {\n    <span class="hljs-attr">main</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n    <span class="hljs-attr">about</span>: <span class="hljs-string">&#x27;src/about.js&#x27;</span>\n  },\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">postcss</span>({\n      <span class="hljs-attr">extract</span>: <span class="hljs-literal">true</span>\n    }),\n    <span class="hljs-title function_">html</span>({\n      <span class="hljs-attr">fileName</span>: <span class="hljs-string">&#x27;[name].html&#x27;</span>,\n      <span class="hljs-attr">template</span>: <span class="hljs-function">(<span class="hljs-params">{ attributes, files, meta, publicPath, title }</span>) =&gt;</span> {\n        <span class="hljs-keyword">const</span> currentCss = files.<span class="hljs-property">css</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-property">name</span> === attributes.<span class="hljs-property">bundle</span>);\n        \n        <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;!DOCTYPE html&gt;\n        &lt;html&gt;\n          &lt;head&gt;\n            <span class="hljs-subst">${currentCss ? <span class="hljs-string">`&lt;link href=&quot;<span class="hljs-subst">${publicPath}</span><span class="hljs-subst">${currentCss.fileName}</span>&quot; rel=&quot;stylesheet&quot;&gt;`</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span>\n          &lt;/head&gt;\n          &lt;body&gt;\n            <span class="hljs-subst">${files.js.map(f =&gt; <span class="hljs-string">`&lt;script src=&quot;<span class="hljs-subst">${publicPath}</span><span class="hljs-subst">${f.fileName}</span>&quot; type=&quot;module&quot;&gt;&lt;/script&gt;`</span>).join(<span class="hljs-string">&#x27;\\n&#x27;</span>)}</span>\n          &lt;/body&gt;\n        &lt;/html&gt;`</span>;\n      }\n    })\n  ]\n};\n</code></pre>\n<p>关键插件说明</p>\n<ol>\n<li>@rollup/plugin-html (官方维护)</li>\n</ol>\n<ul>\n<li>\n<p>自动生成HTML文件</p>\n<ul>\n<li>\n<p>支持模板自定义</p>\n</li>\n<li>\n<p>自动注入资源标签</p>\n</li>\n</ul>\n</li>\n</ul>\n<ol start="2">\n<li>rollup-plugin-postcss</li>\n</ol>\n<ul>\n<li>\n<p>支持CSS提取(<code>extract: true</code>)</p>\n<ul>\n<li>\n<p>自动处理Sass/Less</p>\n</li>\n<li>\n<p>支持CSS模块化</p>\n</li>\n</ul>\n</li>\n</ul>\n<ol start="3">\n<li>开发服务器配置</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> serve <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-serve&#x27;</span>;\n<span class="hljs-keyword">import</span> livereload <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-livereload&#x27;</span>;\n\n<span class="hljs-comment">// 添加到plugins数组</span>\n<span class="hljs-title function_">serve</span>({\n  <span class="hljs-attr">contentBase</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,\n  <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,\n  <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>\n}),\n<span class="hljs-title function_">livereload</span>(<span class="hljs-string">&#x27;dist&#x27;</span>)\n</code></pre>\n<p>不同构建方案对比</p>\n<table>\n<thead>\n<tr>\n<th>方案</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>@rollup/plugin-html</td>\n<td>官方维护，API稳定</td>\n<td>配置稍复杂</td>\n</tr>\n<tr>\n<td>rollup-plugin-html</td>\n<td>简单易用</td>\n<td>已停止维护</td>\n</tr>\n<tr>\n<td>手动模板替换</td>\n<td>完全可控</td>\n<td>维护成本高</td>\n</tr>\n</tbody>\n</table>\n<p>最佳实践建议</p>\n<ol>\n<li>CSS处理优化</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-title function_">postcss</span>({\n  <span class="hljs-attr">extract</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;autoprefixer&#x27;</span>),\n    <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cssnano&#x27;</span>)\n  ]\n})\n</code></pre>\n<ol start="2">\n<li>HTML模板增强</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-attr">template</span>: <span class="hljs-function">(<span class="hljs-params">{ attributes, files }</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> scripts = files.<span class="hljs-property">js</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ fileName }</span>) =&gt;</span> \n    <span class="hljs-string">`&lt;script src=&quot;<span class="hljs-subst">${fileName}</span>&quot; <span class="hljs-subst">${attributes.script}</span>&gt;&lt;/script&gt;`</span>\n  );\n  \n  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;!DOCTYPE html&gt;\n  &lt;html&gt;\n    &lt;head&gt;\n      <span class="hljs-subst">${files.css.map(({ fileName }) =&gt; <span class="hljs-string">`&lt;link href=&quot;<span class="hljs-subst">${fileName}</span>&quot; rel=&quot;stylesheet&quot;&gt;`</span>)}</span>\n    &lt;/head&gt;\n    &lt;body&gt;\n      <span class="hljs-subst">${scripts.join(<span class="hljs-string">&#x27;\\n&#x27;</span>)}</span>\n    &lt;/body&gt;\n  &lt;/html&gt;`</span>;\n}\n</code></pre>\n<ol start="3">\n<li>生产环境优化</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { terser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-terser&#x27;</span>;\n\n<span class="hljs-comment">// 添加到plugins</span>\n<span class="hljs-title function_">terser</span>(),\n</code></pre>\n<p>常见问题解决</p>\n<ol>\n<li>CSS文件未生成</li>\n</ol>\n<ul>\n<li>\n<p>确保<code>postcss</code>配置了<code>extract: true</code></p>\n</li>\n<li>\n<p>检查JS代码中是否确实导入了CSS</p>\n</li>\n</ul>\n<ol start="2">\n<li>资源路径错误</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-title function_">html</span>({\n  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/assets/&#x27;</span> <span class="hljs-comment">// 设置资源基础路径</span>\n})\n</code></pre>\n<ol start="3">\n<li>开发环境HMR不工作</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-title function_">serve</span>({\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>\n  }\n})\n</code></pre>\n<p>这种配置方式既保持了Rollup的轻量级特性，又提供了现代化的前端开发体验，特别适合需要精细控制构建流程的项目。</p>\n</div>'</script></body></html>