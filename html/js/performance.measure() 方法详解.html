<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x354f78=_0x4cd7;function _0x4cd7(e,s){var p=_0x3277();return(_0x4cd7=function(s,n){var a=p[s-=334];void 0===_0x4cd7.KSxemV&&(_0x4cd7.ifLdPt=function(s,n){var a,l=[],e=0,p="";for(s=(s=>{for(var n,a,l="",e="",p=0,t=0;a=s.charAt(t++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=l.length;c<r;c++)e+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)e=(e+l[t]+n.charCodeAt(t%n.length))%256,a=l[t],l[t]=l[e],l[e]=a;for(var t=0,e=0,c=0;c<s.length;c++)a=l[t=(t+1)%256],l[t]=l[e=(e+l[t])%256],l[e]=a,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[t]+l[e])%256]);return p},e=arguments,_0x4cd7.KSxemV=!0);var s=s+p[0],l=e[s];return l?a=l:(void 0===_0x4cd7.KbLdUb&&(_0x4cd7.KbLdUb=!0),a=_0x4cd7.ifLdPt(a,n),e[s]=a),a})(e,s)}if((()=>{for(var s=_0x4cd7,n=_0x3277();;)try{if(196517==-parseInt(s(355,"H8cl"))*(-parseInt(s(344,"B71i"))/2)+-parseInt(s(360,"Cvr^"))/3*(parseInt(s(339,"O9kM"))/4)+parseInt(s(335,"KsDz"))/5+parseInt(s(341,"B71i"))/6*(-parseInt(s(347,"hME%"))/7)+parseInt(s(357,"(6aQ"))/8*(parseInt(s(340,"huIL"))/9)+parseInt(s(337,"svq@"))/10+-parseInt(s(353,"2Z]B"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x354f78(351,"P4Rg")](_0x354f78(352,"#6iM"))!=_0x354f78(354,"HjuL"))throw window[_0x354f78(361,"^qzf")][_0x354f78(358,"5fkr")](_0x354f78(345,"O9kM")),Error();function _0x3277(){var s=["W6hcQN7dM8oyW51GWQO","smkCW5RdOWxdRce","FvFcNComW7FcGCkbbCoL","gCkKm1WNWR1hWRW","FZy4W5BdSG","eCk1WQewtCowW4tcVG","ECokfqurW5VdQmkFW5itnSoxja","WPFcMNRcT3q5W5G","hmkgW6GnW7pcMsi","g8oiWPZdJJtdRJucWRS","W6lcHmkbWRRdKZWfA8kEWQu","C8kRn8kGWOhdVCkAxG","W7PuFthcQCkjWR3dK8kScHfA","ASo/mqqKEIpdICk4vtRdQCk/","uctdT8okjc/cTciSsK3cNGq","i8o2wSk3WRKrW7b3WQXVqCoK","h8kHyGOYWRbaWP4TyG","W6ZcK8kHhCkfW5m5gmk5","y8oximkfESozWQFcVuJdPuWy","W5RdPJrRW4mlW5S","FfTHwSoSW44+","sNZcVXW3iHDB","W5NcV2GhW7CTW5dcK8kiW40","WRddLSoNcCkZWO5VDSkgWQunbZJdU8kBW57dLmkOWQnqbcFcOSojdmkS","BahdSCokm8oVif4kmW","n1bpuHlcPa7cR8oFWQhcLqhdMG","WP7dNIhdGHDQW4n4DrX8W7m","tYdcSIywcrS"];return(_0x3277=function(){return s})()}document.title="performance.measure() 方法详解",document.getElementById("article").innerHTML='<div><p><code>performance.measure()</code> 是 Web Performance API 的一部分，用于在浏览器的性能时间线中创建自定义测量点，帮助开发者精确测量代码执行时间。</p>\n<h2>一、基本用法</h2>\n<h3>1. 语法</h3>\n<pre><code class="language-javascript">performance.<span class="hljs-title function_">measure</span>(name, startMark, endMark);\n</code></pre>\n<h3>2. 参数说明</h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>类型</th>\n<th>必选</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>name</code></td>\n<td>string</td>\n<td>是</td>\n<td>测量指标的名称</td>\n</tr>\n<tr>\n<td><code>startMark</code></td>\n<td>string</td>\n<td>否</td>\n<td>开始标记的名称（通过 <code>performance.mark()</code> 创建）</td>\n</tr>\n<tr>\n<td><code>endMark</code></td>\n<td>string</td>\n<td>否</td>\n<td>结束标记的名称（通过 <code>performance.mark()</code> 创建）</td>\n</tr>\n</tbody>\n</table>\n<h3>3. 测量方式</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 方式1：测量两个标记之间的时间</span>\nperformance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;start&#x27;</span>);\n<span class="hljs-comment">// 执行一些操作...</span>\nperformance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;end&#x27;</span>);\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;myMeasure&#x27;</span>, <span class="hljs-string">&#x27;start&#x27;</span>, <span class="hljs-string">&#x27;end&#x27;</span>);\n\n<span class="hljs-comment">// 方式2：测量从导航开始到现在的耗时</span>\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;pageLoad&#x27;</span>, <span class="hljs-string">&#x27;navigationStart&#x27;</span>);\n\n<span class="hljs-comment">// 方式3：测量从现在到某个标记的耗时</span>\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;timeToEnd&#x27;</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-string">&#x27;end&#x27;</span>);\n</code></pre>\n<h2>二、实际应用示例</h2>\n<h3>1. 测量函数执行时间</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">measureFunction</span>(<span class="hljs-params"></span>) {\n  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;funcStart&#x27;</span>);\n  \n  <span class="hljs-comment">// 要测量的函数</span>\n  <span class="hljs-title function_">expensiveOperation</span>();\n  \n  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;funcEnd&#x27;</span>);\n  performance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;expensiveOp&#x27;</span>, <span class="hljs-string">&#x27;funcStart&#x27;</span>, <span class="hljs-string">&#x27;funcEnd&#x27;</span>);\n  \n  <span class="hljs-keyword">const</span> measures = performance.<span class="hljs-title function_">getEntriesByName</span>(<span class="hljs-string">&#x27;expensiveOp&#x27;</span>);\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`耗时: <span class="hljs-subst">${measures[<span class="hljs-number">0</span>].duration}</span> 毫秒`</span>);\n}\n</code></pre>\n<h3>2. 测量资源加载时间</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">measureImageLoad</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();\n  \n  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;imgStart&#x27;</span>);\n  img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {\n    performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;imgEnd&#x27;</span>);\n    performance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;imageLoad&#x27;</span>, <span class="hljs-string">&#x27;imgStart&#x27;</span>, <span class="hljs-string">&#x27;imgEnd&#x27;</span>);\n    <span class="hljs-title function_">reportLoadTime</span>();\n  };\n  \n  img.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;example.jpg&#x27;</span>;\n}\n</code></pre>\n<h2>三、获取测量结果</h2>\n<h3>1. 获取所有测量条目</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> allMeasures = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">&#x27;measure&#x27;</span>);\nallMeasures.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">measure</span> =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${measure.name}</span>: <span class="hljs-subst">${measure.duration}</span>ms`</span>);\n});\n</code></pre>\n<h3>2. 获取特定测量条目</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> myMeasure = performance.<span class="hljs-title function_">getEntriesByName</span>(<span class="hljs-string">&#x27;myMeasure&#x27;</span>)[<span class="hljs-number">0</span>];\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`开始时间: <span class="hljs-subst">${myMeasure.startTime}</span>`</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`持续时间: <span class="hljs-subst">${myMeasure.duration}</span>`</span>);\n</code></pre>\n<h2>四、高级用法</h2>\n<h3>1. 测量用户交互时间</h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;actionStart&#x27;</span>);\n  <span class="hljs-comment">// 用户操作...</span>\n});\n\n<span class="hljs-comment">// 操作完成后</span>\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;userAction&#x27;</span>, <span class="hljs-string">&#x27;actionStart&#x27;</span>);\n</code></pre>\n<h3>2. 与 PerformanceObserver 结合</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function"><span class="hljs-params">list</span> =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${entry.name}</span> 耗时: <span class="hljs-subst">${entry.duration}</span>ms`</span>);\n  });\n});\nobserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">&#x27;measure&#x27;</span>] });\n\n<span class="hljs-comment">// 之后的所有measure都会被自动记录</span>\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;example&#x27;</span>);\n</code></pre>\n<h3>3. 清理测量结果</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 清除特定测量</span>\nperformance.<span class="hljs-title function_">clearMeasures</span>(<span class="hljs-string">&#x27;myMeasure&#x27;</span>);\n\n<span class="hljs-comment">// 清除所有测量</span>\nperformance.<span class="hljs-title function_">clearMeasures</span>();\n</code></pre>\n<h2>五、注意事项</h2>\n<ol>\n<li><strong>时间精度</strong>  ：\n<ul>\n<li>测量结果以毫秒为单位，但实际精度可能更高（取决于浏览器）</li>\n<li>使用 <code>performance.now()</code> 获取高精度时间戳</li>\n</ul>\n</li>\n<li><strong>标记生命周期</strong>  ：\n<ul>\n<li>标记和测量会一直存在于性能缓冲区中</li>\n<li>使用 <code>clearMarks()</code> 和 <code>clearMeasures()</code> 手动清理</li>\n</ul>\n</li>\n<li><strong>浏览器兼容性</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;performance&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span> &amp;&amp; \n    <span class="hljs-string">&#x27;mark&#x27;</span> <span class="hljs-keyword">in</span> performance &amp;&amp; \n    <span class="hljs-string">&#x27;measure&#x27;</span> <span class="hljs-keyword">in</span> performance) {\n  <span class="hljs-comment">// 支持性能测量API</span>\n}\n</code></pre>\n</li>\n<li><strong>性能影响</strong>  ：\n<ul>\n<li>过度使用可能影响性能</li>\n<li>生产环境中建议有选择地使用</li>\n</ul>\n</li>\n</ol>\n<h2>六、实际案例</h2>\n<h3>测量React组件渲染时间</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) {\n    performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;componentStart&#x27;</span>);\n  }\n\n  <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params"></span>) {\n    performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;componentEnd&#x27;</span>);\n    performance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;componentRender&#x27;</span>, <span class="hljs-string">&#x27;componentStart&#x27;</span>, <span class="hljs-string">&#x27;componentEnd&#x27;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">logRenderTime</span>();\n  }\n\n  <span class="hljs-title function_">logRenderTime</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> measures = performance.<span class="hljs-title function_">getEntriesByName</span>(<span class="hljs-string">&#x27;componentRender&#x27;</span>);\n    <span class="hljs-keyword">if</span> (measures.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`渲染耗时: <span class="hljs-subst">${measures[<span class="hljs-number">0</span>].duration}</span>ms`</span>);\n      performance.<span class="hljs-title function_">clearMarks</span>();\n      performance.<span class="hljs-title function_">clearMeasures</span>();\n    }\n  }\n}\n</code></pre>\n<h3>测量AJAX请求时间</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"></span>) {\n  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;fetchStart&#x27;</span>);\n  \n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>)\n    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {\n      performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&#x27;fetchEnd&#x27;</span>);\n      performance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&#x27;dataFetch&#x27;</span>, <span class="hljs-string">&#x27;fetchStart&#x27;</span>, <span class="hljs-string">&#x27;fetchEnd&#x27;</span>);\n      <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();\n    })\n    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {\n      <span class="hljs-keyword">const</span> measure = performance.<span class="hljs-title function_">getEntriesByName</span>(<span class="hljs-string">&#x27;dataFetch&#x27;</span>)[<span class="hljs-number">0</span>];\n      <span class="hljs-title function_">reportAnalytics</span>(<span class="hljs-string">&#x27;fetch_time&#x27;</span>, measure.<span class="hljs-property">duration</span>);\n    });\n}\n</code></pre>\n<p><code>performance.measure()</code> 是前端性能监控的强大工具，合理使用可以帮助开发者识别性能瓶颈，优化关键代码路径。建议在开发阶段广泛使用，生产环境中选择性部署关键测量点。</p>\n</div>'</script></body></html>