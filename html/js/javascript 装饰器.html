<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1eaff4=_0x2655;function _0x2559(){var s=["AqfGCJ97mCka","W7O0W7/dJSkFWPiRBa","B8oEW6NcOWpcNSon","BMa2BCkCW4ba","vhPjoSowDLykvgZcIMi","emkvE8oYWODYwmoAemk/","iwaxW4vmb1migmodxqb9","p8ojWQqPWP3dO8oSWOnJoeu","oCojWQaOW4pdQSoiWPzpla","iNzHdmoIW5ZcP8kWW40BuCoHAa","WRmYWRTcW7eprSkDWPy","dCkRW6eSW6hcVCktWRBdUYKkyG","fCo8vNq7W74VWRtdP8kH","vfCFWQVdUwyRc8k6aY8OWRO","ymoGBvtdHX/dK8ohWOqB","vv4FWQ3dSwmMkmkrjaa9WPW","AConiWldU8o7W5P/oaf8tW","W4BdQmkdW73dPG","WQfOWQ7dJmkhWQSQD8oV","W7C9jd0xzcyk","ctRdLCo7W6OkFmohua","utBdQ8o8ySk9E8kq","W7pcJwTbzI/dMSoAW5C","B2JcVHFcG8kdquG","W7lcRG3dG8kGW6tcLNDXgCougs8","uguTpCknAg1nEq","cSkiFmogWOOMWPxcR3tcSSkmDsG","j1WRbWG1WRZdGapdJmk7zG","W6BcHSkuEuSidJFcS1FdTq","umofo8kcW4aSWOpdJxZcMCkBtqxcS2alW4avv8olq8kfCrFcLmoQ"];return(_0x2559=function(){return s})()}function _0x2655(p,s){var e=_0x2559();return(_0x2655=function(s,a){var n=e[s-=210];void 0===_0x2655.bKiXBh&&(_0x2655.NlpTZQ=function(s,a){var n,l=[],p=0,e="";for(s=(s=>{for(var a,n,l="",p="",e=0,t=0;n=s.charAt(t++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var r=0,c=l.length;r<c;r++)p+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)p=(p+l[t]+a.charCodeAt(t%a.length))%256,n=l[t],l[t]=l[p],l[p]=n;for(var t=0,p=0,r=0;r<s.length;r++)n=l[t=(t+1)%256],l[t]=l[p=(p+l[t])%256],l[p]=n,e+=String.fromCharCode(s.charCodeAt(r)^l[(l[t]+l[p])%256]);return e},p=arguments,_0x2655.bKiXBh=!0);var s=s+e[0],l=p[s];return l?n=l:(void 0===_0x2655.xxaSap&&(_0x2655.xxaSap=!0),n=_0x2655.NlpTZQ(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x2655,a=_0x2559();;)try{if(997592==-parseInt(s(237,"1u3O"))*(-parseInt(s(234,"4kAU"))/2)+parseInt(s(220,"TyP%"))/3+parseInt(s(229,"1SS1"))/4*(-parseInt(s(235,"C&BK"))/5)+-parseInt(s(215,"Cl*%"))/6*(parseInt(s(221,"%LD8"))/7)+parseInt(s(228,"k*8j"))/8*(-parseInt(s(233,"k!U%"))/9)+parseInt(s(213,"fAtg"))/10+parseInt(s(218,"NgDd"))/11*(parseInt(s(217,"p1yV"))/12))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1eaff4(239,"lLJ1")](_0x1eaff4(227,"V#k)"))!=_0x1eaff4(224,"Jd[2"))throw window[_0x1eaff4(238,"0rQC")][_0x1eaff4(210,"[iO(")](_0x1eaff4(236,"k!U%")),Error();document.title="javascript 装饰器",document.getElementById("article").innerHTML='<div><p><strong>JavaScript 装饰器详解</strong></p>\n<h3>一、装饰器概述</h3>\n<p>装饰器（Decorator）是一种特殊的语法提议，它允许你在类声明或成员方法上使用注解和元编程。装饰器可以用来观察、修改或替换类定义，而不需要直接改变其源代码。装饰器是 ES7 的一个特性提案，并且已经被 TypeScript 完全支持。</p>\n<h3>二、装饰器的类型</h3>\n<p>在 JavaScript 中，装饰器可以应用于类、方法、属性甚至参数。以下是常见的装饰器类型：</p>\n<ol>\n<li><strong>类装饰器</strong>   ：应用于类构造函数，用于观察、修改或替换类定义。</li>\n<li><strong>方法装饰器</strong>   ：应用于类的方法，可以用来监视、修改或替换方法定义。</li>\n<li><strong>属性装饰器</strong>   ：应用于类的原型属性，可以用来验证或修饰属性。</li>\n<li><strong>访问器装饰器</strong>   ：应用于类的访问器（getter/setter），可以用来监控对属性的读取或赋值操作。</li>\n<li><strong>参数装饰器</strong>   ：用于为方法参数添加元数据。</li>\n</ol>\n<h3>三、装饰器的实现原理</h3>\n<p>装饰器本质上是一个函数，它被用作一个高阶函数来包裹另一个函数或类的方法，从而可以在不改变原始逻辑的情况下添加新的功能。装饰器可以接收目标对象（类或属性）、名称和描述符作为参数。</p>\n<h3>四、装饰器的使用示例</h3>\n<h4>1. 类装饰器</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">classDecorator</span>(<span class="hljs-params">target</span>) {\n  target.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">newMethod</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Added by decorator&quot;</span>;\n  };\n  target.<span class="hljs-property">staticProperty</span> = <span class="hljs-string">&quot;Static Property&quot;</span>;\n  <span class="hljs-keyword">return</span> target;\n}\n\n@classDecorator\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">property</span> = <span class="hljs-string">&quot;Original Property&quot;</span>;\n  }\n}\n\n<span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Example</span>();\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance.<span class="hljs-title function_">newMethod</span>()); <span class="hljs-comment">// 输出: Added by decorator</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Example</span>.<span class="hljs-property">staticProperty</span>); <span class="hljs-comment">// 输出: Static Property</span>\n</code></pre>\n<h4>2. 方法装饰器</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">methodDecorator</span>(<span class="hljs-params">target, propertyKey, descriptor</span>) {\n  <span class="hljs-keyword">const</span> originalMethod = descriptor.<span class="hljs-property">value</span>;\n  descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Calling method <span class="hljs-subst">${propertyKey}</span>`</span>);\n    <span class="hljs-keyword">const</span> result = originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Method <span class="hljs-subst">${propertyKey}</span> returned <span class="hljs-subst">${result}</span>`</span>);\n    <span class="hljs-keyword">return</span> result;\n  };\n  <span class="hljs-keyword">return</span> descriptor;\n}\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {\n  @methodDecorator\n  <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {\n    <span class="hljs-keyword">return</span> a + b;\n  }\n}\n\n<span class="hljs-keyword">const</span> calc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(calc.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 控制台输出调用和返回日志</span>\n</code></pre>\n<h4>3. 属性装饰器</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">propertyDecorator</span>(<span class="hljs-params">target, propertyKey</span>) {\n  <span class="hljs-keyword">let</span> value;\n  <span class="hljs-keyword">const</span> getter = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Getting <span class="hljs-subst">${propertyKey}</span>`</span>);\n    <span class="hljs-keyword">return</span> value;\n  };\n  <span class="hljs-keyword">const</span> setter = <span class="hljs-keyword">function</span> (<span class="hljs-params">newValue</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Setting <span class="hljs-subst">${propertyKey}</span> = <span class="hljs-subst">${newValue}</span>`</span>);\n    value = newValue;\n  };\n  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyKey, {\n    <span class="hljs-attr">get</span>: getter,\n    <span class="hljs-attr">set</span>: setter,\n    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,\n  });\n}\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {\n  @propertyDecorator\n  name = <span class="hljs-string">&quot;Default Name&quot;</span>;\n}\n\n<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出: Getting name, Default Name</span>\nuser.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;New Name&quot;</span>; <span class="hljs-comment">// 输出: Setting name = New Name</span>\n</code></pre>\n<h4>4. 访问器装饰器</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 访问器装饰器示例 - 验证属性值</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateRange</span>(<span class="hljs-params">min, max</span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target, name, descriptor</span>) {\n    <span class="hljs-keyword">const</span> originalGet = descriptor.<span class="hljs-property">get</span>;\n    <span class="hljs-keyword">const</span> originalSet = descriptor.<span class="hljs-property">set</span>;\n\n    descriptor.<span class="hljs-property">set</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {\n      <span class="hljs-keyword">if</span> (value &lt; min || value &gt; max) {\n        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RangeError</span>(\n          <span class="hljs-string">`Value <span class="hljs-subst">${value}</span> is not within range <span class="hljs-subst">${min}</span>-<span class="hljs-subst">${max}</span>`</span>,\n        );\n      }\n      originalSet.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, value);\n    };\n\n    <span class="hljs-keyword">return</span> descriptor;\n  };\n}\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">Temperature</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span> = <span class="hljs-number">0</span>;\n  }\n\n  @<span class="hljs-title function_">validateRange</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)\n  <span class="hljs-keyword">get</span> <span class="hljs-title function_">celsius</span>() {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span>;\n  }\n\n  @<span class="hljs-title function_">validateRange</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)\n  <span class="hljs-keyword">set</span> <span class="hljs-title function_">celsius</span>(<span class="hljs-params">value</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span> = value;\n  }\n}\n\n<span class="hljs-comment">// 测试代码</span>\n<span class="hljs-keyword">const</span> temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temperature</span>();\ntemp.<span class="hljs-property">celsius</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 正常设置</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(temp.<span class="hljs-property">celsius</span>); <span class="hljs-comment">// 输出: 25</span>\n\n<span class="hljs-keyword">try</span> {\n  temp.<span class="hljs-property">celsius</span> = <span class="hljs-number">150</span>; <span class="hljs-comment">// 抛出 RangeError</span>\n} <span class="hljs-keyword">catch</span> (e) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e.<span class="hljs-property">message</span>); <span class="hljs-comment">// 输出: Value 150 is not within range 0-100</span>\n}\n</code></pre>\n<h4>5. 参数装饰器</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 参数装饰器示例 - 类型验证</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateType</span>(<span class="hljs-params">target, propertyKey, parameterIndex</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(\n    <span class="hljs-string">`参数装饰器：方法名 = <span class="hljs-subst">${propertyKey}</span>, 参数索引 = <span class="hljs-subst">${parameterIndex}</span>`</span>,\n  );\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target, name, descriptor</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`方法装饰器：方法名 = <span class="hljs-subst">${name}</span>`</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`propertyKey === name ? <span class="hljs-subst">${propertyKey === name}</span>`</span>); <span class="hljs-comment">// 输出 true</span>\n    <span class="hljs-keyword">const</span> originalMethod = descriptor.<span class="hljs-property">value</span>;\n    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {\n      <span class="hljs-keyword">const</span> paramType = <span class="hljs-keyword">typeof</span> args[parameterIndex];\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(\n        <span class="hljs-string">`校验 <span class="hljs-subst">${name}</span> 方法的第 <span class="hljs-subst">${parameterIndex}</span> 个参数：<span class="hljs-subst">${paramValue}</span>`</span>,\n      );\n      <span class="hljs-comment">// 假设我们期望这个参数是字符串类型</span>\n      <span class="hljs-keyword">if</span> (paramType !== <span class="hljs-string">&quot;string&quot;</span>) {\n        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(\n          <span class="hljs-string">`Parameter at index <span class="hljs-subst">${parameterIndex}</span> must be a string`</span>,\n        );\n      }\n      <span class="hljs-keyword">return</span> originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);\n    };\n    <span class="hljs-keyword">return</span> descriptor;\n  };\n}\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {\n  <span class="hljs-title function_">greet</span>(<span class="hljs-params">@validateType message</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${message}</span>`</span>;\n  }\n}\n\n<span class="hljs-comment">// 测试代码</span>\n<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-title function_">greet</span>(<span class="hljs-string">&quot;World&quot;</span>)); <span class="hljs-comment">// 正常输出</span>\n<span class="hljs-keyword">try</span> {\n  obj.<span class="hljs-title function_">greet</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// 抛出错误：Parameter at index 0 must be a string</span>\n} <span class="hljs-keyword">catch</span> (e) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e.<span class="hljs-property">message</span>);\n}\n</code></pre>\n<h3>五、装饰器的应用场景</h3>\n<ol>\n<li><strong>扩展对象功能</strong>   ：如添加日志、缓存等。</li>\n<li><strong>动态添加属性或方法</strong>   ：在运行时为对象添加新的属性或方法。</li>\n<li><strong>代码复用</strong>   ：通过装饰器封装通用功能，避免重复代码。</li>\n<li><strong>面向切面编程（AOP）</strong>   ：实现日志记录、性能测量、权限检查等横切关注点。</li>\n</ol>\n<h3>六、注意事项</h3>\n<ol>\n<li><strong>兼容性</strong>   ：装饰器并非所有浏览器都原生支持，因此在使用时应该考虑使用 Babel 等工具进行转译。</li>\n<li><strong>性能影响</strong>   ：装饰器通常会在运行时引入额外的开销，因此应该谨慎评估其对性能的影响。</li>\n<li><strong>可读性</strong>   ：过度使用装饰器可能会使代码变得难以理解和调试，因此应合理使用。</li>\n</ol>\n</div>'</script></body></html>