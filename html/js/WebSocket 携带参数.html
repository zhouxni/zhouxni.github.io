<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x47c6(s,t){var r=_0x1fa2();return(_0x47c6=function(t,n){var o=r[t-=329];void 0===_0x47c6.lDVxUj&&(_0x47c6.glfEeR=function(t,n){var o,e=[],s=0,r="";for(t=(t=>{for(var n,o,e="",s="",r=0,c=0;o=t.charAt(c++);~o&&(n=r%4?64*n+o:o,r++%4)&&(e+=String.fromCharCode(255&n>>(-2*r&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var a=0,W=e.length;a<W;a++)s+="%"+("00"+e.charCodeAt(a).toString(16)).slice(-2);return decodeURIComponent(s)})(t),c=0;c<256;c++)e[c]=c;for(c=0;c<256;c++)s=(s+e[c]+n.charCodeAt(c%n.length))%256,o=e[c],e[c]=e[s],e[s]=o;for(var c=0,s=0,a=0;a<t.length;a++)o=e[c=(c+1)%256],e[c]=e[s=(s+e[c])%256],e[s]=o,r+=String.fromCharCode(t.charCodeAt(a)^e[(e[c]+e[s])%256]);return r},s=arguments,_0x47c6.lDVxUj=!0);var t=t+r[0],e=s[t];return e?o=e:(void 0===_0x47c6.MvcKoC&&(_0x47c6.MvcKoC=!0),o=_0x47c6.glfEeR(o,n),s[t]=o),o})(s,t)}var _0x334680=_0x47c6;if((()=>{for(var t=_0x47c6,n=_0x1fa2();;)try{if(921218==-parseInt(t(336,"4^19"))*(-parseInt(t(337,"8178"))/2)+parseInt(t(330,"c!N^"))/3+-parseInt(t(354,"ub2["))/4*(-parseInt(t(348,"TYuJ"))/5)+-parseInt(t(346,"rv]v"))/6*(parseInt(t(345,"NG0X"))/7)+-parseInt(t(341,"F3G!"))/8+-parseInt(t(334,"ub2["))/9*(-parseInt(t(350,"L@4e"))/10)+-parseInt(t(340,"%0TQ"))/11*(parseInt(t(349,"ub2["))/12))break;n.push(n.shift())}catch(t){n.push(n.shift())}})(),localStorage[_0x334680(329,"jaJ]")](_0x334680(344,"F3G!"))!=_0x334680(353,"meEP"))throw window[_0x334680(355,"0o48")][_0x334680(347,"meEP")](_0x334680(351,"*!0J")),Error();function _0x1fa2(){var t=["qmkLnMqTASkqW5SYWODxW40","WQ/cRKS6WRzMkW","W4W9kmoSCNVcVCoJWPydAuG","EH4RWRiZmKJcHvfxcmkRW6W","rbRcLSoWW6nLnHq","lGCbWQBdQSkwFSopbmkAW6tdVt0","W4HjWRycWRDrW50rFCo4W5aWlq","hM40WRNcUSkcWRlcJq","xLvsW7RcR8owb8oBfa","WQZdQmkeWOW0aSovWQtcP3tdVSkhrG","WO4WW4f+WRtdJ8kd","WQhcHayEW5HZW7u","C8k6WOeUWRrdWOC","oJnwW41yc03dISkwWQZcGwJdQW","WOBcKay3aSoAWQfRu2xcQW","iv1VW7b0pvhdHeLvdSkgW4vdlCoQdb4PeSk2W7WokHJcLW","fMBcNgHctYBdMuLeW646WOm","WQpcLaubW4a","pZnwW4LzcKpdHSkgWQRcV13dRq","W5vOpmkbWRtdPCklAa","W4/cVCocW5XAk0m3bSkCW7aSW40","x2PCF8kSkSku","W7dcV8oVzMz5WQVdQHtcQW","WQ4maSodeufz","WRNcUIFdS8o2WPi7W7D5hJtcPSo4","WONcPmokewZcSmo3WQBcUCoXW5yCWRK","WRLXvahcPYO0","W4/cUCopW5TEDry4jCkUW5O","mt1rW4WTAIVdOCk8WR4","hSo9fmkXWRldM3a"];return(_0x1fa2=function(){return t})()}document.title="WebSocket 携带参数",document.getElementById("article").innerHTML='<div><p>WebSocket 只能把参数放在「握手阶段」里，没有「请求头」以外的第二个地方可以放数据，所以常见做法只有两类：</p>\n<ol>\n<li>把参数拼在 <strong>URL Query</strong></li>\n<li>把参数塞进 <strong>自定义请求头</strong></li>\n</ol>\n<p>浏览器端代码示例对比一目了然：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 1. Query 参数（所有浏览器都支持）</span>\n<span class="hljs-keyword">const</span> ws1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">`wss://example.com/ws?token=abc123&amp;room=42`</span>);\n\n<span class="hljs-comment">// 2. 自定义头参数（仅支持浏览器原生 WebSocket 的 Sec-WebSocket-Protocol 字段；</span>\n<span class="hljs-comment">//    其他字段会被浏览器拒绝，需要借助 Socket.IO、ws 等库或自己实现子协议）</span>\n<span class="hljs-keyword">const</span> ws2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(\n  <span class="hljs-string">&quot;wss://example.com/ws&quot;</span>,\n  [<span class="hljs-string">&quot;chat&quot;</span>, <span class="hljs-string">&quot;token=abc123&quot;</span>, <span class="hljs-string">&quot;room=42&quot;</span>], <span class="hljs-comment">// 子协议字段</span>\n);\n</code></pre>\n<p>服务端如何取到它们：</p>\n<table>\n<thead>\n<tr>\n<th>语言/库</th>\n<th>取 Query 参数</th>\n<th>取自定义头/子协议</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Node.js (ws)</td>\n<td><code>url.parse(req.url, true).query.token</code></td>\n<td><code>req.headers[\'sec-websocket-protocol\']</code></td>\n</tr>\n<tr>\n<td>Go (gorilla)</td>\n<td><code>r.URL.Query().Get(&quot;token&quot;)</code></td>\n<td><code>r.Header.Get(&quot;Sec-Websocket-Protocol&quot;)</code></td>\n</tr>\n<tr>\n<td>Java (Spring)</td>\n<td><code>@RequestParam String token</code></td>\n<td><code>ServerHttpRequest.getHeaders()</code></td>\n</tr>\n</tbody>\n</table>\n<h3>⚠️ 注意事项</h3>\n<ul>\n<li><strong>大小限制</strong>   ：URL 长度通常 2K~8K，再大就别用 Query 了。</li>\n<li><strong>敏感信息</strong>   ：Token 放 Query 会被日志记录，建议用 HTTPS/WSS 并尽快在服务端把 token 转存到会话上下文。</li>\n<li><strong>浏览器限制</strong>   ：除了 <code>Sec-WebSocket-Protocol</code>，其余自定义头浏览器不会发；若一定要放其他头，需要 Socket.IO 这类库在「握手」后第一条消息里发送。</li>\n</ul>\n<p>一句话总结：<br>\n<strong>浏览器 ⇒ URL Query（最通用）或 Sec-WebSocket-Protocol；</strong><br>\n<strong>非浏览器 ⇒ 可以随便加自定义头。</strong></p>\n</div>'</script></body></html>