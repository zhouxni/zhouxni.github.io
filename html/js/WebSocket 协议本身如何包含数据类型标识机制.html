<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2aa0(){var s=["svrqW7LHtJi","zCkEwmoAW4WnW54","WQ4XW7tcVSkdWQJdGmkmWRtdGbpcGCoK","BYe0WPLcW7dcVmkCqa0","A1RdSsBdN8kaW5zMWQRcLW","W6aNaf/cOCopAwxdNa7cHq","WQTPW6BcGmkS","cmonpCkuW5pdRSoDr1lcGq","q8o9W4yDWOVcNSo5dGG","nmkUW7RcPCkVWQhdJmoGuZOqW5/cGG","f8kbW6iLtIdcMseNW5q9WPBcQa","emk5WQ/dHCooW5pcHWSDsmkk","zKBdQmonW5DVa0m","W7RdJmk9WO7cJSowW5dcNIC2","iZRcRJBdLN3dKHpdO8oMWPNcGLy","iudcKSoQW5tcVColWQFcOCk0WRjNsq","wmkHwK3cNSoNEmkbgG","Bv7dTshdMCkvW5v8WRJcHW","nfLWWRX8W7uuW7rcwq","AwXIp8kkFInoWPdcVSolWQlcOSkZo1mrWQJcHmovlCkWgsNdTZi","wcZcH3pcNvJcGW","m8kUWPeDWRBcJmoiosu","nLP2WRCtWPLBW45FyJhcHuq","w8kLoIOeWQiiW4yYW7O","f8koW6CSleNdMGCrW48","WQL5W6xcN8k0nSo9","WR7dGHvihCkDW64uWQ7cTWK8ca","nL11WRysWPHtW7nrrrZcHwW"];return(_0x2aa0=function(){return s})()}var _0x5eee4d=_0x4344;function _0x4344(t,s){var p=_0x2aa0();return(_0x4344=function(s,n){var a=p[s-=393];void 0===_0x4344.iSDxro&&(_0x4344.NnVNca=function(s,n){var a,l=[],t=0,p="";for(s=(s=>{for(var n,a,l="",t="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=l.length;c<r;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)t=(t+l[e]+n.charCodeAt(e%n.length))%256,a=l[e],l[e]=l[t],l[t]=a;for(var e=0,t=0,c=0;c<s.length;c++)a=l[e=(e+1)%256],l[e]=l[t=(t+l[e])%256],l[t]=a,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[t])%256]);return p},t=arguments,_0x4344.iSDxro=!0);var s=s+p[0],l=t[s];return l?a=l:(void 0===_0x4344.EHmOay&&(_0x4344.EHmOay=!0),a=_0x4344.NnVNca(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x4344,n=_0x2aa0();;)try{if(659754==+parseInt(s(412,"P!UH"))*(-parseInt(s(409,"p@%@"))/2)+parseInt(s(396,"TXNX"))/3*(parseInt(s(410,"DMaP"))/4)+parseInt(s(399,"KPki"))/5*(-parseInt(s(419,"Cr[y"))/6)+-parseInt(s(405,"0NA3"))/7+-parseInt(s(401,"usd("))/8*(-parseInt(s(414,"doHj"))/9)+-parseInt(s(395,"doHj"))/10+parseInt(s(394,"4rya"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x5eee4d(397,"Xk)P")](_0x5eee4d(404,"YvqC"))!=_0x5eee4d(402,"Fjk("))throw window[_0x5eee4d(408,"9Z!x")][_0x5eee4d(393,"Fjk(")](_0x5eee4d(415,"DSDA")),Error();document.title="WebSocket åè®®æœ¬èº«å¦‚ä½•åŒ…å«æ•°æ®ç±»å‹æ ‡è¯†æœºåˆ¶",document.getElementById("article").innerHTML='<div><h3>æ ¸å¿ƒç»“è®ºï¼š</h3>\n<p><strong>WebSocket åè®®æœ¬èº«ä¸åŒ…å«æ•°æ®ç±»å‹æ ‡è¯†æœºåˆ¶</strong>   ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ¡ˆå®ç°ç±»å‹è¯†åˆ«ï¼š</p>\n<ol>\n<li><strong>åè®®å±‚æ–¹æ¡ˆ</strong>   ï¼ˆæ¨èï¼‰ï¼šåœ¨åº”ç”¨å±‚åè®®ä¸­è®¾è®¡ç±»å‹æ ‡è¯†å­—æ®µ</li>\n<li><strong>æ•°æ®è‡ªæè¿°æ–¹æ¡ˆ</strong>   ï¼šåœ¨äºŒè¿›åˆ¶æ•°æ®å‰æ·»åŠ ç±»å‹å¤´</li>\n<li><strong>å¤šé€šé“æ–¹æ¡ˆ</strong>   ï¼šä½¿ç”¨ä¸åŒWebSocketè¿æ¥ä¼ è¾“ä¸åŒç±»å‹æ•°æ®</li>\n</ol>\n<hr>\n<h3>ä¸€ã€ä¸“ä¸šè§£å†³æ–¹æ¡ˆè¯¦è§£</h3>\n<h4>æ–¹æ¡ˆ1ï¼šåè®®å±‚ç±»å‹æ ‡è¯†ï¼ˆæœ€è§„èŒƒï¼‰</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// å®¢æˆ·ç«¯å‘é€ç»“æ„</span>\n<span class="hljs-keyword">const</span> message = {\n  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;image/png&quot;</span>, <span class="hljs-comment">// æ˜¾å¼å£°æ˜æ•°æ®ç±»å‹</span>\n  <span class="hljs-attr">data</span>: binaryData, <span class="hljs-comment">// å®é™…äºŒè¿›åˆ¶æ•°æ®</span>\n};\n\n<span class="hljs-comment">// è½¬æ¢ä¸ºArrayBufferå‘é€</span>\n<span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();\n<span class="hljs-keyword">const</span> meta = encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">type</span>: message.<span class="hljs-property">type</span> }));\n<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(meta.<span class="hljs-property">length</span> + message.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>);\nbuffer.<span class="hljs-title function_">set</span>(meta, <span class="hljs-number">0</span>);\nbuffer.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(message.<span class="hljs-property">data</span>), meta.<span class="hljs-property">length</span>);\nws.<span class="hljs-title function_">send</span>(buffer);\n</code></pre>\n<p><strong>æœåŠ¡ç«¯è§£æï¼š</strong></p>\n<pre><code class="language-javascript">ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {\n  <span class="hljs-comment">// 1. è¯»å–å‰Nå­—èŠ‚ä½œä¸ºå…ƒæ•°æ®</span>\n  <span class="hljs-keyword">const</span> metaLength = message.<span class="hljs-title function_">indexOf</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// å‡è®¾ç”¨0x00åˆ†éš”</span>\n  <span class="hljs-keyword">const</span> meta = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>().<span class="hljs-title function_">decode</span>(message.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, metaLength)),\n  );\n\n  <span class="hljs-comment">// 2. è·å–å®é™…æ•°æ®</span>\n  <span class="hljs-keyword">const</span> binaryData = message.<span class="hljs-title function_">slice</span>(metaLength + <span class="hljs-number">1</span>);\n\n  <span class="hljs-comment">// 3. æ ¹æ®ç±»å‹å¤„ç†</span>\n  <span class="hljs-keyword">switch</span> (meta.<span class="hljs-property">type</span>) {\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/png&quot;</span>:\n      fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">&quot;output.png&quot;</span>, binaryData);\n      <span class="hljs-keyword">break</span>;\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;text/plain&quot;</span>:\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>().<span class="hljs-title function_">decode</span>(binaryData));\n      <span class="hljs-keyword">break</span>;\n  }\n});\n</code></pre>\n<h4>æ–¹æ¡ˆ2ï¼šæ•°æ®å¤´æ ‡è¯†ï¼ˆé«˜æ•ˆç´§å‡‘ï¼‰</h4>\n<table>\n<thead>\n<tr>\n<th>å­—èŠ‚ä½ç½®</th>\n<th>é•¿åº¦</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0-3</td>\n<td>4</td>\n<td>é­”æ•°å¤´ 0x89 0x42 0x49 0x4E</td>\n</tr>\n<tr>\n<td>4</td>\n<td>1</td>\n<td>ç‰ˆæœ¬å·</td>\n</tr>\n<tr>\n<td>5</td>\n<td>1</td>\n<td>æ•°æ®ç±»å‹ (0=æ–‡æœ¬,1=å›¾åƒ,...)</td>\n</tr>\n<tr>\n<td>6-9</td>\n<td>4</td>\n<td>æ•°æ®é•¿åº¦ï¼ˆå¤§ç«¯åºï¼‰</td>\n</tr>\n<tr>\n<td>10+</td>\n<td>N</td>\n<td>å®é™…æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<p><strong>å®¢æˆ·ç«¯å®ç°ï¼š</strong></p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createBinaryMessage</span>(<span class="hljs-params">type, data</span>) {\n  <span class="hljs-keyword">const</span> header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">10</span>);\n  <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(header);\n  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0x8942494e</span>); <span class="hljs-comment">// é­”æ•°</span>\n  view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// åè®®ç‰ˆæœ¬</span>\n  view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">5</span>, typeCode); <span class="hljs-comment">// è‡ªå®šä¹‰ç±»å‹ç¼–ç </span>\n  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">6</span>, data.<span class="hljs-property">byteLength</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// æ•°æ®é•¿åº¦</span>\n\n  <span class="hljs-comment">// åˆå¹¶å¤´å’Œæ•°æ®</span>\n  <span class="hljs-keyword">const</span> combined = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">10</span> + data.<span class="hljs-property">byteLength</span>);\n  combined.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(header), <span class="hljs-number">0</span>);\n  combined.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(data), <span class="hljs-number">10</span>);\n  <span class="hljs-keyword">return</span> combined;\n}\n</code></pre>\n<h4>æ–¹æ¡ˆ3ï¼šå¤šWebSocketè¿æ¥</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// æ–‡æœ¬é€šé“</span>\n<span class="hljs-keyword">const</span> textSocket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">&quot;ws://example.com/text&quot;</span>);\n<span class="hljs-comment">// äºŒè¿›åˆ¶é€šé“</span>\n<span class="hljs-keyword">const</span> binarySocket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">&quot;ws://example.com/binary&quot;</span>);\n\n<span class="hljs-comment">// æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©é€šé“</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendData</span>(<span class="hljs-params">data</span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">&quot;string&quot;</span>) {\n    textSocket.<span class="hljs-title function_">send</span>(data);\n  } <span class="hljs-keyword">else</span> {\n    binarySocket.<span class="hljs-title function_">send</span>(data);\n  }\n}\n</code></pre>\n<hr>\n<h3>äºŒã€å„æ–¹æ¡ˆå¯¹æ¯”åˆ†æ</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ¡ˆ</th>\n<th>ä¼˜ç‚¹</th>\n<th>ç¼ºç‚¹</th>\n<th>é€‚ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>åè®®å±‚æ ‡è¯†</strong></td>\n<td>çµæ´»å¯æ‰©å±•ï¼Œå…¼å®¹JSON</td>\n<td>æœ‰å…ƒæ•°æ®å¼€é”€</td>\n<td>é€šç”¨åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®å¤´æ ‡è¯†</strong></td>\n<td>é«˜æ•ˆç´§å‡‘ï¼Œè§£æå¿«</td>\n<td>éœ€é¢„å…ˆå®šä¹‰ç±»å‹ç </td>\n<td>é«˜æ€§èƒ½ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong>å¤šé€šé“</strong></td>\n<td>å®Œå…¨éš”ç¦»ï¼Œç®€å•</td>\n<td>éœ€ç»´æŠ¤å¤šä¸ªè¿æ¥</td>\n<td>ç±»å‹ç®€å•çš„åœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>ä¸‰ã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</h3>\n<h4>1. ç±»å‹ç³»ç»Ÿè®¾è®¡å»ºè®®</h4>\n<pre><code class="language-typescript"><span class="hljs-comment">// TypeScript ç±»å‹å®šä¹‰</span>\n<span class="hljs-keyword">enum</span> <span class="hljs-title class_">MessageType</span> {\n  <span class="hljs-title class_">Text</span> = <span class="hljs-number">0x01</span>,\n  <span class="hljs-title class_">Image</span> = <span class="hljs-number">0x02</span>,\n  <span class="hljs-title class_">Audio</span> = <span class="hljs-number">0x03</span>,\n  <span class="hljs-title class_">Binary</span> = <span class="hljs-number">0xff</span>,\n}\n\n<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MessageHeader</span> {\n  <span class="hljs-attr">version</span>: <span class="hljs-built_in">number</span>;\n  <span class="hljs-attr">type</span>: <span class="hljs-title class_">MessageType</span>;\n  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">bigint</span>; <span class="hljs-comment">// ä½¿ç”¨BigIntè¡¨ç¤ºçº³ç§’æ—¶é—´æˆ³</span>\n  <span class="hljs-attr">payloadSize</span>: <span class="hljs-built_in">number</span>;\n}\n</code></pre>\n<h4>2. é”™è¯¯å¤„ç†æœºåˆ¶</h4>\n<pre><code class="language-javascript">ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">if</span> (message.<span class="hljs-property">byteLength</span> &lt; <span class="hljs-variable constant_">MIN_HEADER_SIZE</span>) {\n      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;æ¶ˆæ¯å¤´ä¸å®Œæ•´&quot;</span>);\n    }\n\n    <span class="hljs-keyword">const</span> header = <span class="hljs-title function_">parseHeader</span>(message);\n    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">validateChecksum</span>(header)) {\n      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;æ ¡éªŒå¤±è´¥&quot;</span>);\n    }\n\n    <span class="hljs-title function_">processMessage</span>(header, message.<span class="hljs-title function_">slice</span>(<span class="hljs-variable constant_">HEADER_SIZE</span>));\n  } <span class="hljs-keyword">catch</span> (err) {\n    ws.<span class="hljs-title function_">send</span>(<span class="hljs-title function_">createErrorMessage</span>(err));\n  }\n});\n</code></pre>\n<h4>3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// é‡ç”¨ArrayBufferå‡å°‘å†…å­˜åˆ†é…</span>\n<span class="hljs-keyword">const</span> headerBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>);\n<span class="hljs-keyword">const</span> headerView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(headerBuffer);\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">createMessage</span>(<span class="hljs-params">type, data</span>) {\n  headerView.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">0</span>, type);\n  headerView.<span class="hljs-title function_">setBigUint64</span>(<span class="hljs-number">4</span>, <span class="hljs-title class_">BigInt</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()));\n  headerView.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">12</span>, data.<span class="hljs-property">length</span>);\n\n  <span class="hljs-comment">// é›¶æ‹·è´åˆå¹¶</span>\n  <span class="hljs-keyword">return</span> [headerBuffer, data.<span class="hljs-property">buffer</span>];\n}\n</code></pre>\n<hr>\n<h3>å››ã€WebSocketåè®®æ·±åº¦è§£æ</h3>\n<h4>åè®®å¸§æ ¼å¼ï¼ˆRFC6455ï¼‰</h4>\n<pre><code>0                   1                   2                   3\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-------+-+-------------+-------------------------------+\n|F|R|R|R| opcode|M| Payload len |    Extended payload length    |\n|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |\n|N|V|V|V|       |S|             |   (if payload len==126/127)   |\n| |1|2|3|       |K|             |                               |\n+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +\n|     Extended payload length continued, if payload len == 127  |\n+ - - - - - - - - - - - - - - - +-------------------------------+\n|                               |Masking-key, if MASK set to 1  |\n+-------------------------------+-------------------------------+\n| Masking-key (continued)       |          Payload Data         |\n+-------------------------------- - - - - - - - - - - - - - - - +\n:                     Payload Data continued ...                :\n+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n|                     Payload Data continued ...                |\n+---------------------------------------------------------------+\n</code></pre>\n<p>ğŸ‘‰ <strong>å…³é”®ç‚¹</strong>   ï¼šWebSocketå¸§å¤´ä»…åŒ…å«<code>opcode</code>åŒºåˆ†æ–‡æœ¬/äºŒè¿›åˆ¶å¸§ï¼Œä¸åŒ…å«åº”ç”¨å±‚ç±»å‹ä¿¡æ¯</p>\n<hr>\n<h3>äº”ã€ç»ˆæè§£å†³æ–¹æ¡ˆæ¨è</h3>\n<h4>æ··åˆæ¨¡å¼åè®®è®¾è®¡</h4>\n<ol>\n<li><strong>è¿æ¥åˆå§‹åŒ–</strong>   ï¼šé¦–æ¬¡æ¡æ‰‹æ—¶åå•†åè®®ç‰ˆæœ¬å’Œç±»å‹ç³»ç»Ÿ<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;binary-v2&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;supportedTypes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;customData&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">127</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li><strong>æ•°æ®ä¼ è¾“</strong>   ï¼šä½¿ç”¨ç´§å‡‘äºŒè¿›åˆ¶å¤´+æ•°æ®ä½“</li>\n<li><strong>æ‰©å±•æ€§</strong>   ï¼šé€šè¿‡å¿ƒè·³åŒ…åŠ¨æ€æ›´æ–°ç±»å‹ç³»ç»Ÿ</li>\n</ol>\n<h4>ç¤ºä¾‹å®ç°ï¼š</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// é«˜çº§APIå°è£…</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">BinaryWebSocket</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">url, protocols</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">typeRegistry</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(protocols);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(url);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">binaryType</span> = <span class="hljs-string">&quot;arraybuffer&quot;</span>;\n  }\n\n  <span class="hljs-title function_">send</span>(<span class="hljs-params">typeName, data</span>) {\n    <span class="hljs-keyword">const</span> typeCode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">typeRegistry</span>.<span class="hljs-title function_">get</span>(typeName);\n    <span class="hljs-keyword">const</span> header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">2</span>));\n    header.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">0</span>, typeCode);\n    header.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">1</span>, data <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ArrayBuffer</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>(<span class="hljs-title function_">concatBuffers</span>(header.<span class="hljs-property">buffer</span>, data));\n  }\n}\n</code></pre>\n<hr>\n<h3>æ€»ç»“ï¼š</h3>\n<p>WebSocketçš„äºŒè¿›åˆ¶ä¼ è¾“éœ€è¦<strong>ä¸šåŠ¡å±‚è‡ªè¡Œå®ç°ç±»å‹ç³»ç»Ÿ</strong>   ã€‚æ¨èé‡‡ç”¨ï¼š</p>\n<ol>\n<li><strong>åè®®å¤´+æ•°æ®ä½“</strong>   çš„æ··åˆç»“æ„</li>\n<li><strong>ç±»å‹æ³¨å†Œæœºåˆ¶</strong>   ä¿è¯å¯æ‰©å±•æ€§</li>\n<li><strong>é›¶æ‹·è´ä¼˜åŒ–</strong>   æå‡æ€§èƒ½</li>\n</ol>\n<p>å®é™…å¼€å‘ä¸­å»ºè®®ä½¿ç”¨ç°æˆåè®®åº“å¦‚ï¼š</p>\n<ul>\n<li><strong>MsgPack-RPC</strong>   ï¼šæ”¯æŒå¤šæ•°æ®ç±»å‹</li>\n<li><strong>gRPC-Web</strong>   ï¼šåŸºäºHTTP/2çš„å¼ºç±»å‹åè®®</li>\n<li><strong>è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®</strong>   ï¼šå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯</li>\n</ul>\n</div>'</script></body></html>