<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x5d6cf3=_0x1f6b;function _0x3041(){var n=["WOZcKsSvhaz1DHDCaCkV","nCkmx8kbtcfV","WOTvWR7cMgyZW5NdIg9MxN82","W6xdQCoNaczjWOtcS0egFSk8","W6hdQ8kNxvG9WORcSG","A8k/WQPIWPFdS8oeW5lcVbVcTSkcW4G","dSoYb8oqo14n","W5eqW7RdNYmWW4tcSg9aq0G9W5lcUXdcJmoDAmk3W5npW5ikW67dHG","k8kTW7xdIH3cRSkXsCoHjsWlCG","welcVmotWONcJCkGWOq","WPnEW7JdSCk8W4RdIaH/W61Cm1e","W4j5W64wymoGddPfeCkakW","WPPxl8kkW6BcNSo4y8olESkIWOtdSq","kmk1vq15WObyvSozFSkxnSki","ksOwW6DHbmkJD8o8oCo0aJ0","WRHVWQtdQZSbdmkAW74FlCo6xW","fmkXWRhdPmkge8k9WOv9WORcNu4","W4KrW73dNcK","lXi5cmoLtNWs","W6pdQmoRcIvcW7RcO3O5wmkKW4y","iCovW6RdKMxcJmk7WRvGCbaxWQu","xSo6WQxcN1BdQSoprSoc"];return(_0x3041=function(){return n})()}function _0x1f6b(e,n){var t=_0x3041();return(_0x1f6b=function(n,s){var a=t[n-=302];void 0===_0x1f6b.PYiYXU&&(_0x1f6b.jhmIZg=function(n,s){var a,p=[],e=0,t="";for(n=(n=>{for(var s,a,p="",e="",t=0,c=0;a=n.charAt(c++);~a&&(s=t%4?64*s+a:a,t++%4)&&(p+=String.fromCharCode(255&s>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var l=0,o=p.length;l<o;l++)e+="%"+("00"+p.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(e)})(n),c=0;c<256;c++)p[c]=c;for(c=0;c<256;c++)e=(e+p[c]+s.charCodeAt(c%s.length))%256,a=p[c],p[c]=p[e],p[e]=a;for(var c=0,e=0,l=0;l<n.length;l++)a=p[c=(c+1)%256],p[c]=p[e=(e+p[c])%256],p[e]=a,t+=String.fromCharCode(n.charCodeAt(l)^p[(p[c]+p[e])%256]);return t},e=arguments,_0x1f6b.PYiYXU=!0);var n=n+t[0],p=e[n];return p?a=p:(void 0===_0x1f6b.AaCulS&&(_0x1f6b.AaCulS=!0),a=_0x1f6b.jhmIZg(a,s),e[n]=a),a})(e,n)}if((()=>{for(var n=_0x1f6b,s=_0x3041();;)try{if(637008==-parseInt(n(310,"h13&"))+parseInt(n(318,"fs]4"))/2+parseInt(n(304,"URB6"))/3+-parseInt(n(323,"cGsQ"))/4+parseInt(n(307,"$CFS"))/5+parseInt(n(302,"fs]4"))/6+-parseInt(n(313,"8y*z"))/7*(parseInt(n(317,"5e2W"))/8))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x5d6cf3(305,"vRvi")](_0x5d6cf3(320,"$CFS"))!=_0x5d6cf3(316,"cGsQ"))throw window[_0x5d6cf3(308,"gc%Q")][_0x5d6cf3(322,"oz27")](_0x5d6cf3(306,"cGsQ")),Error();document.title="PM2 命令详解：Node.js 进程管理全指南",document.getElementById("article").innerHTML='<div><p>PM2 是 Node.js 最流行的进程管理工具，提供进程守护、负载均衡、日志管理等强大功能。以下是 PM2 核心命令的全面解析：</p>\n<h2>一、基础进程管理</h2>\n<h3>1. 启动应用</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 启动单个应用</span>\npm2 start app.js\n\n<span class="hljs-comment"># 启动并命名应用</span>\npm2 start app.js --name <span class="hljs-string">&quot;my-api&quot;</span>\n\n<span class="hljs-comment"># 集群模式启动（负载均衡）</span>\npm2 start app.js -i max  <span class="hljs-comment"># 按CPU核心数启动Worker</span>\n</code></pre>\n<h3>2. 进程管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 查看所有进程</span>\npm2 list\npm2 <span class="hljs-built_in">ls</span>\n\n<span class="hljs-comment"># 停止应用</span>\npm2 stop app_name\npm2 stop all  <span class="hljs-comment"># 停止所有</span>\n\n<span class="hljs-comment"># 删除应用</span>\npm2 delete app_name\npm2 delete all\n\n<span class="hljs-comment"># 重启应用</span>\npm2 restart app_name\n</code></pre>\n<h2>二、高级功能命令</h2>\n<h3>1. 监控与日志</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 实时监控</span>\npm2 monit\n\n<span class="hljs-comment"># 查看日志</span>\npm2 logs\npm2 logs app_name --lines 200  <span class="hljs-comment"># 查看特定应用最后200行</span>\n\n<span class="hljs-comment"># 清空日志</span>\npm2 flush\n</code></pre>\n<h3>2. 零停机与负载均衡</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 零停机重载</span>\npm2 reload app_name\n\n<span class="hljs-comment"># 动态调整Worker数量</span>\npm2 scale app_name +2\npm2 scale app_name 4\n</code></pre>\n<h3>3. 配置文件管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 生成示例配置文件</span>\npm2 ecosystem\n\n<span class="hljs-comment"># 使用配置文件启动</span>\npm2 start ecosystem.config.js\n\n<span class="hljs-comment"># 配置文件示例内容：</span>\nmodule.exports = {\n  apps: [{\n    name: <span class="hljs-string">&quot;app&quot;</span>,\n    script: <span class="hljs-string">&quot;app.js&quot;</span>,\n    instances: <span class="hljs-string">&quot;max&quot;</span>,\n    exec_mode: <span class="hljs-string">&quot;cluster&quot;</span>,\n    <span class="hljs-built_in">env</span>: {\n      NODE_ENV: <span class="hljs-string">&quot;production&quot;</span>\n    }\n  }]\n}\n</code></pre>\n<h2>三、系统运维命令</h2>\n<h3>1. 启动项管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 设置PM2开机自启</span>\npm2 startup\npm2 save  <span class="hljs-comment"># 保存当前进程列表</span>\n\n<span class="hljs-comment"># 取消开机自启</span>\npm2 unstartup\n</code></pre>\n<h3>2. 性能监控</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 显示进程资源占用</span>\npm2 show app_name\n\n<span class="hljs-comment"># 生成性能快照</span>\npm2 profile\n\n<span class="hljs-comment"># 监控事件循环延迟</span>\npm2 install pm2-io-apm\n</code></pre>\n<h2>四、实用工具命令</h2>\n<h3>1. 版本与帮助</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 检查版本</span>\npm2 --version\n\n<span class="hljs-comment"># 查看帮助</span>\npm2 --<span class="hljs-built_in">help</span>\npm2 start --<span class="hljs-built_in">help</span>\n</code></pre>\n<h3>2. 模块管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 安装PM2模块</span>\npm2 install pm2-logrotate\n\n<span class="hljs-comment"># 配置日志轮转</span>\npm2 <span class="hljs-built_in">set</span> pm2-logrotate:max_size 10M\npm2 <span class="hljs-built_in">set</span> pm2-logrotate:retain 30\n</code></pre>\n<h3>3. 高级调试</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 进入开发模式</span>\npm2-dev app.js\n\n<span class="hljs-comment"># 附加到已有进程</span>\npm2 attach app_name\n</code></pre>\n<h2>五、生产环境最佳实践</h2>\n<h3>1. 推荐配置组合</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 典型生产环境启动命令</span>\npm2 start app.js --name <span class="hljs-string">&quot;api&quot;</span> -i max \\\n  --max-memory-restart 500M \\\n  --log-date-format <span class="hljs-string">&quot;YYYY-MM-DD HH:mm Z&quot;</span> \\\n  --output <span class="hljs-string">&quot;/var/log/api.out.log&quot;</span> \\\n  --error <span class="hljs-string">&quot;/var/log/api.err.log&quot;</span> \\\n  --<span class="hljs-keyword">time</span>\n</code></pre>\n<h3>2. 关键参数说明</h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-i max</code></td>\n<td>按CPU核心数启动Worker</td>\n</tr>\n<tr>\n<td><code>--max-memory-restart</code></td>\n<td>内存超限自动重启</td>\n</tr>\n<tr>\n<td><code>--time</code></td>\n<td>日志显示时间戳</td>\n</tr>\n<tr>\n<td><code>--no-autorestart</code></td>\n<td>禁用自动重启</td>\n</tr>\n<tr>\n<td><code>--wait-ready</code></td>\n<td>等待应用就绪信号</td>\n</tr>\n</tbody>\n</table>\n<h3>3. 常见问题排查</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 查看详细进程信息</span>\npm2 describe app_name\n\n<span class="hljs-comment"># 检查未捕获异常</span>\npm2 install pm2-intercom\npm2 interact app_name\n\n<span class="hljs-comment"># 重置PM2状态</span>\npm2 <span class="hljs-built_in">kill</span>\npm2 reset all\n</code></pre>\n<h2>六、与其他工具集成</h2>\n<h3>1. 与Docker配合</h3>\n<pre><code class="language-dockerfile"><span class="hljs-comment"># Dockerfile示例</span>\n<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;pm2-runtime&quot;</span>, <span class="hljs-string">&quot;ecosystem.config.js&quot;</span>]</span>\n</code></pre>\n<h3>2. 与Nginx配合</h3>\n<pre><code class="language-nginx"><span class="hljs-comment"># Nginx配置示例</span>\n<span class="hljs-section">upstream</span> node_app {\n  <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:3000</span>;\n  <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:3001</span>;\n}\n\n<span class="hljs-section">server</span> {\n  <span class="hljs-section">location</span> / {\n    <span class="hljs-attribute">proxy_pass</span> http://node_app;\n  }\n}\n</code></pre>\n<p>PM2 的这些命令组合使用可以满足从开发到生产环境的各种需求，是Node.js应用运维的瑞士军刀。建议保存常用命令为脚本或alias提高效率。</p>\n</div>'</script></body></html>