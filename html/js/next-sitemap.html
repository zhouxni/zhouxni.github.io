<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x5f028c=_0x431d;function _0x431d(l,s){var p=_0x28ad();return(_0x431d=function(s,a){var n=p[s-=215];void 0===_0x431d.BhOiuJ&&(_0x431d.sZAPnY=function(s,a){var n,t=[],l=0,p="";for(s=(s=>{for(var a,n,t="",l="",p=0,c=0;n=s.charAt(c++);~n&&(a=p%4?64*a+n:n,p++%4)&&(t+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,o=t.length;e<o;e++)l+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)l=(l+t[c]+a.charCodeAt(c%a.length))%256,n=t[c],t[c]=t[l],t[l]=n;for(var c=0,l=0,e=0;e<s.length;e++)n=t[c=(c+1)%256],t[c]=t[l=(l+t[c])%256],t[l]=n,p+=String.fromCharCode(s.charCodeAt(e)^t[(t[c]+t[l])%256]);return p},l=arguments,_0x431d.BhOiuJ=!0);var s=s+p[0],t=l[s];return t?n=t:(void 0===_0x431d.yrnpwx&&(_0x431d.yrnpwx=!0),n=_0x431d.sZAPnY(n,a),l[s]=n),n})(l,s)}function _0x28ad(){var s=["eeO5cmoCEmog","pmkolqtcP2jFs2FdHJ/dMSov","AcPzWOjpxSoUemkr","DCo4dgVdRCkNW5pcQqL+Bfa","W6RdNCkkWPpcPhBdSmk5","WOZdK37cQ3bdWOCI","CCkfWOdcSwTxW5bwWPblW4S","nCknkGlcPwKJDuldRqhdHq","z13cJq0IwIqI","W6fcWQKSWPddKXSdWPxdO1tdOq","uSosyCowW4bfrSoxWQOaW5K/","WRuNW4W/WRHkWONdLdVdPgFcKNG1W7PeugtcRt7cOe7dKmoiEmky","BSohzXWTW5/dVa","oWlcQgPUWONdLmkCW69LESo3vq","W7ldRCogWQ3dJupcNIBcGSohvG","E8kFDCklECkfbW","CMJdQd5xsCkgWP8W","WP/dJ8kFW6vIDhRcJW","W5BdJSobpWVcJsG","jeRdNSoXrCoDW63cTmkZfSkOWQW","f8oks2aGW7RdGZuzWOT/hq","CgxdQNuwFmk6WQCaC8kl","WOlcK8kcdG3cSGhcKGi","W7tdQCogWQtcLhBcSWNcNCoV","xsJdHuNcGq","W4BcHc5UWRL0tqetk8of","W53cGKVdTGboWRhdOMVdVG","h3HUWOvXv8opaW"];return(_0x28ad=function(){return s})()}if((()=>{for(var s=_0x431d,a=_0x28ad();;)try{if(161976==+parseInt(s(237,"yZyv"))*(parseInt(s(233,"l89k"))/2)+-parseInt(s(241,"j3@z"))/3*(-parseInt(s(227,"YwDj"))/4)+-parseInt(s(229,"qgk@"))/5*(parseInt(s(222,"AKz5"))/6)+parseInt(s(231,"rT$e"))/7+parseInt(s(223,"qpva"))/8+parseInt(s(232,"#h80"))/9*(-parseInt(s(224,"l89k"))/10)+-parseInt(s(217,"iURE"))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x5f028c(228,"#h80")](_0x5f028c(240,"yZyv"))!=_0x5f028c(234,"9n0Y"))throw window[_0x5f028c(215,"ShT3")][_0x5f028c(225,"4NFw")](_0x5f028c(221,"O3l^")),Error();document.title="next-sitemap",document.getElementById("article").innerHTML='<div><p>好的，我们来详细解析 <strong><code>next-sitemap</code></strong>   这个插件，它是为 Next.js 项目<strong>自动化生成网站地图（Sitemap）和机器人协议（Robots.txt）</strong>   的官方推荐工具。</p>\n<hr>\n<h3>一、next-sitemap 是什么？</h3>\n<p><code>next-sitemap</code> 是一个专为 Next.js 设计的构建后插件。它的核心功能是：在你的应用执行 <code>next build</code> 之后，<strong>自动扫描</strong>   你的页面路由（包括静态页面、SSG 页面、动态路由），并生成搜索引擎优化（SEO）所必需的两个关键文件：</p>\n<ol>\n<li><strong><code>sitemap.xml</code></strong>   （或 <code>sitemap-index.xml</code>）：告诉搜索引擎你网站上有哪些页面，以及这些页面的更新频率和重要性。</li>\n<li><strong><code>robots.txt</code></strong>   ：指导网络爬虫（如 Googlebot）哪些页面可以抓取，哪些不可以。</li>\n</ol>\n<p>它的最大优势是<strong>自动化</strong>   ，你无需手动维护这些文件。</p>\n<hr>\n<h3>二、核心特性与优势</h3>\n<ol>\n<li><strong>全自动路由扫描</strong>   ：自动识别 <code>pages/</code> 和 <code>app/</code> 目录下的所有路由，包括静态生成（SSG）和服务端渲染（SSR/ISR）页面。</li>\n<li><strong>动态路由支持</strong>   ：完美处理动态路由（如 <code>pages/posts/[id].js</code>），允许你提供数据来生成所有可能的 URL。</li>\n<li><strong>分片支持</strong>   ：当 URL 数量巨大时（&gt;50,000），自动生成 <code>sitemap-index.xml</code> 文件索引多个 sitemap 文件。</li>\n<li><strong>高度可配置</strong>   ：可以自定义每个页面的优先级（<code>priority</code>）、更新频率（<code>changefreq</code>）、最后修改时间（<code>lastmod</code>）。</li>\n<li><strong>零配置启动</strong>   ：最基本的配置只需几行代码即可工作。</li>\n</ol>\n<hr>\n<h3>三、安装与基本配置</h3>\n<h4>1. 安装</h4>\n<pre><code class="language-bash">npm install next-sitemap\n<span class="hljs-comment"># 或</span>\nyarn add next-sitemap\n</code></pre>\n<h4>2. 在项目根目录创建配置文件 <code>next-sitemap.config.js</code></h4>\n<p>这是最核心的步骤。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n\n<span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">import(&#x27;next-sitemap&#x27;).IConfig</span>} */</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>, <span class="hljs-comment">// 你的网站域名，必须配置</span>\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// （可选）是否生成 robots.txt</span>\n  <span class="hljs-attr">outDir</span>: <span class="hljs-string">&quot;public&quot;</span>, <span class="hljs-comment">// （可选）输出目录，默认为 &#x27;public&#x27;</span>\n  <span class="hljs-comment">// 更多配置选项...</span>\n};\n</code></pre>\n<h4>3. 修改 <code>package.json</code> 的构建脚本</h4>\n<p>让 <code>next-sitemap</code> 在构建完成后自动运行。</p>\n<pre><code class="language-json"><span class="hljs-comment">// package.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next dev&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next build &amp;&amp; next-sitemap&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 在 build 后执行 next-sitemap</span>\n    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next start&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<p>现在，运行 <code>npm run build</code> 后，它会在 <code>public/</code> 目录下生成 <code>sitemap.xml</code> 和 <code>robots.txt</code>。</p>\n<hr>\n<h3>四、核心配置详解</h3>\n<h4>1. 处理动态路由（最关键的功能）</h4>\n<p>假设你有一个动态路由页面 <code>app/posts/[id]/page.js</code>，你需要告诉 <code>next-sitemap</code> 所有可能的 <code>[id]</code> 值。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>,\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-comment">// 配置动态路由</span>\n  <span class="hljs-attr">additionalPaths</span>: <span class="hljs-title function_">async</span> (config) =&gt; {\n    <span class="hljs-comment">// 假设你从数据库或API获取所有帖子的ID</span>\n    <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://api.example.com/posts&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>\n      res.<span class="hljs-title function_">json</span>(),\n    );\n\n    <span class="hljs-comment">// 为每个帖子ID生成一个sitemap条目</span>\n    <span class="hljs-keyword">return</span> posts.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">post</span>) =&gt;</span> ({\n      <span class="hljs-attr">loc</span>: <span class="hljs-string">`/posts/<span class="hljs-subst">${post.id}</span>`</span>, <span class="hljs-comment">// 动态URL</span>\n      <span class="hljs-attr">lastmod</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(post.<span class="hljs-property">updatedAt</span>).<span class="hljs-title function_">toISOString</span>(), <span class="hljs-comment">// 最后修改时间</span>\n      <span class="hljs-attr">changefreq</span>: <span class="hljs-string">&quot;daily&quot;</span>, <span class="hljs-comment">// 更新频率</span>\n      <span class="hljs-attr">priority</span>: <span class="hljs-number">0.7</span>, <span class="hljs-comment">// 优先级 (0.0 to 1.0)</span>\n    }));\n  },\n};\n</code></pre>\n<h4>2. 全局默认配置</h4>\n<p>你可以为所有页面设置默认值。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>,\n  <span class="hljs-attr">changefreq</span>: <span class="hljs-string">&quot;weekly&quot;</span>, <span class="hljs-comment">// 全局默认更新频率</span>\n  <span class="hljs-attr">priority</span>: <span class="hljs-number">0.7</span>, <span class="hljs-comment">// 全局默认优先级</span>\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-comment">// 覆盖特定路径的配置</span>\n  <span class="hljs-attr">transform</span>: <span class="hljs-title function_">async</span> (config, path) =&gt; {\n    <span class="hljs-comment">// 为首页设置更高的优先级</span>\n    <span class="hljs-keyword">if</span> (path === <span class="hljs-string">&quot;/&quot;</span>) {\n      <span class="hljs-keyword">return</span> { ...config, <span class="hljs-attr">priority</span>: <span class="hljs-number">1.0</span> };\n    }\n    <span class="hljs-comment">// 为关于页面设置不同的更新频率</span>\n    <span class="hljs-keyword">if</span> (path === <span class="hljs-string">&quot;/about&quot;</span>) {\n      <span class="hljs-keyword">return</span> { ...config, <span class="hljs-attr">changefreq</span>: <span class="hljs-string">&quot;monthly&quot;</span> };\n    }\n    <span class="hljs-keyword">return</span> config;\n  },\n};\n</code></pre>\n<h4>3. 自定义 <code>robots.txt</code> 规则</h4>\n<p><code>next-sitemap</code> 会根据你的路由自动生成基本的 <code>robots.txt</code>，但你也可以完全自定义。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>,\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">robotsTxtOptions</span>: {\n    <span class="hljs-attr">policies</span>: [\n      {\n        <span class="hljs-attr">userAgent</span>: <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-comment">// 对所有爬虫生效</span>\n        <span class="hljs-attr">allow</span>: <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-comment">// 允许抓取整个网站</span>\n        <span class="hljs-attr">disallow</span>: [<span class="hljs-string">&quot;/admin/&quot;</span>, <span class="hljs-string">&quot;/api/&quot;</span>], <span class="hljs-comment">// 禁止抓取管理后台和API接口</span>\n      },\n      <span class="hljs-comment">// 你可以为特定的爬虫设置特定规则</span>\n      {\n        <span class="hljs-attr">userAgent</span>: <span class="hljs-string">&quot;Googlebot&quot;</span>,\n        <span class="hljs-attr">allow</span>: <span class="hljs-string">&quot;/&quot;</span>,\n        <span class="hljs-attr">disallow</span>: <span class="hljs-string">&quot;/private&quot;</span>,\n        <span class="hljs-attr">crawlDelay</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 抓取延迟5秒</span>\n      },\n    ],\n    <span class="hljs-comment">// 额外指定其他sitemap文件（如果你有的话）</span>\n    <span class="hljs-attr">additionalSitemaps</span>: [<span class="hljs-string">&quot;https://example.com/my-custom-sitemap.xml&quot;</span>],\n  },\n};\n</code></pre>\n<hr>\n<h3>五、高级用法与技巧</h3>\n<h4>1. 忽略特定路由</h4>\n<p>如果你有不希望出现在 sitemap 中的页面（如临时页面、测试页面），可以忽略它们。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>,\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">exclude</span>: [<span class="hljs-string">&quot;/admin&quot;</span>, <span class="hljs-string">&quot;/admin/*&quot;</span>, <span class="hljs-string">&quot;/secret-page&quot;</span>], <span class="hljs-comment">// 使用 glob 模式匹配</span>\n};\n</code></pre>\n<h4>2. 多语言站点 (i18n)</h4>\n<p>如果你使用了 <code>next-intl</code> 或其他 i18n 方案，可以为每种语言生成对应的 sitemap 条目。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next-sitemap.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">siteUrl</span>: <span class="hljs-string">&quot;https://example.com&quot;</span>,\n  <span class="hljs-attr">generateRobotsTxt</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">i18n</span>: {\n    <span class="hljs-attr">locales</span>: [<span class="hljs-string">&quot;en&quot;</span>, <span class="hljs-string">&quot;fr&quot;</span>, <span class="hljs-string">&quot;es&quot;</span>], <span class="hljs-comment">// 你支持的语言</span>\n    <span class="hljs-attr">defaultLocale</span>: <span class="hljs-string">&quot;en&quot;</span>,\n  },\n  <span class="hljs-comment">// transform 函数中可以根据语言修改loc</span>\n  <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params">config, path</span>) =&gt;</span> {\n    <span class="hljs-comment">// 如果需要为每种语言生成单独的URL，可以在这里处理</span>\n    <span class="hljs-comment">// 例如: /about -&gt; /en/about, /fr/about, /es/about</span>\n    <span class="hljs-keyword">return</span> config;\n  },\n};\n</code></pre>\n<h4>3. 自动化部署</h4>\n<p>确保你的部署流程（如 Vercel、Netlify）在构建后运行 <code>next-sitemap</code>。在 Vercel 上，你的 <code>build</code> 脚本会自动执行，因此无需额外配置。</p>\n<hr>\n<h3>六、生成的文件示例</h3>\n<p>运行后，你会在 <code>public/</code> 目录下看到：</p>\n<ol>\n<li>\n<p><strong><code>sitemap.xml</code></strong>   :</p>\n<pre><code class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">urlset</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://example.com/<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2024-05-24T00:00:00.000Z<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">changefreq</span>&gt;</span>daily<span class="hljs-tag">&lt;/<span class="hljs-name">changefreq</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://example.com/about<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2024-05-24T00:00:00.000Z<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">changefreq</span>&gt;</span>monthly<span class="hljs-tag">&lt;/<span class="hljs-name">changefreq</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>0.7<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>\n  <span class="hljs-comment">&lt;!-- 更多 URL... --&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">urlset</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p><strong><code>robots.txt</code></strong>   :</p>\n<pre><code class="language-txt"># *\nUser-agent: *\nAllow: /\nDisallow: /admin/\nDisallow: /api/\n\n# Googlebot\nUser-agent: Googlebot\nAllow: /\nDisallow: /private\nCrawl-delay: 5\n\nSitemap: https://example.com/sitemap.xml\n</code></pre>\n</li>\n</ol>\n<hr>\n<h3>七、总结</h3>\n<p><code>next-sitemap</code> 是 Next.js 生态中一个<strong>小而美</strong>   的必备插件。它通过极简的配置，自动化了 SEO 中最繁琐、最容易出错的部分。</p>\n<ul>\n<li><strong>对于简单站点</strong>   ：只需配置 <code>siteUrl</code> 即可自动生成。</li>\n<li><strong>对于复杂站点</strong>   ：通过 <code>additionalPaths</code> 和 <code>transform</code> 等选项提供无限灵活性。</li>\n</ul>\n<p><strong>强烈建议</strong>   将所有 Next.js 项目都集成 <code>next-sitemap</code>，这是提升网站在搜索引擎中可见度的<strong>基础且关键的一步</strong>   。</p>\n</div>'</script></body></html>