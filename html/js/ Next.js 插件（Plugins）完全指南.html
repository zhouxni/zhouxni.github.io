<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x316591=_0x1bc1;if((()=>{for(var s=_0x1bc1,n=_0x1ebf();;)try{if(613290==-parseInt(s(131,"P%fc"))*(parseInt(s(137,"aUuL"))/2)+-parseInt(s(151,"TwUe"))/3+-parseInt(s(153,"QSqj"))/4+-parseInt(s(133,"ONen"))/5*(parseInt(s(148,"le]V"))/6)+-parseInt(s(150,"#tw1"))/7*(-parseInt(s(142,"Jnp#"))/8)+parseInt(s(141,"ha&O"))/9*(parseInt(s(139,"wRsC"))/10)+-parseInt(s(149,"a2#^"))/11*(-parseInt(s(155,"QSqj"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x316591(128,"s#Hm")](_0x316591(130,"T%(2"))!=_0x316591(156,"le]V"))throw window[_0x316591(140,"T4bc")][_0x316591(138,"l63V")](_0x316591(144,"Od9^")),Error();function _0x1bc1(l,s){var p=_0x1ebf();return(_0x1bc1=function(s,n){var a=p[s-=127];void 0===_0x1bc1.IcmaMD&&(_0x1bc1.ICEkoY=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=t.length;c<o;c++)l+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)l=(l+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[l],t[l]=a;for(var e=0,l=0,c=0;c<s.length;c++)a=t[e=(e+1)%256],t[e]=t[l=(l+t[e])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(c)^t[(t[e]+t[l])%256]);return p},l=arguments,_0x1bc1.IcmaMD=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x1bc1.CcAuMG&&(_0x1bc1.CcAuMG=!0),a=_0x1bc1.ICEkoY(a,n),l[s]=a),a})(l,s)}function _0x1ebf(){var s=["Cd5nW6fLWOBcJW","omoBW43dGCokWRmMDGxdIeNdNW","ecFdOmowofyCtW","WPqsuu0dWPenovihWRagCG","W5LLWPhdPCksWP0nWP0","WPqsx09HW49he1qg","fg1NBCoH","bmoJCSooWQFcTSk1wIBdIsVcQ8oH","iCkdWRpdKmoaWOBdVa","W6GSuMVcH8kdWO5MWRGblW","WQ1OWRNcSSolW54rW6BcVW","DCoAW58TW7RcMCoVmG","W5TtWO7cGCoQW4yt","WRBdUmkBW6RdJ1yvW7rXc8kJWRO","oKVcKfOma8kxkCo/W6vOWO/cUq","n3iUW6nEW6yWW70","cmklWRX/zYWJW7vjh8kkWOy","yg0VWQddMJxcPXitiCkD","t8kXe8kMW6tdT8oF","W6NdJdXpW7hdP8k+W5W","W6ucW5FdLc3dVg7cLG","W6NdKSkWW5JdUaxdSmonoN7dUxlcGG","c3WcW4XEwYRdHmkGWQmPt8ox","W4eZa8oGudDlAL3cKeDUwq","yCoyWQT5gdPOWP7cG8kKW6iPWPKSu8kFWPfmgGD5mSogheuj","imkXwCkSW7WFWOqkWQqnFW","WQlcLCk2WR7dR8k8xGy/Fani","WRTFWOZcHqpdVxVcLZ8d","vY5cw8o+qY3cQW","W7BcLSkzWOyclmoGqSkgWRhdNG"];return(_0x1ebf=function(){return s})()}document.title=" Next.js 插件（Plugins）完全指南",document.getElementById("article").innerHTML='<div><p>Next.js 的“插件”并不是指传统意义上的 npm 包，而是<strong>通过配置或文件约定扩展框架能力</strong>   的机制。主要包括以下几类：</p>\n<hr>\n<h2>🔧 1. 配置文件插件（next.config.js）</h2>\n<p>这是最核心的插件系统，通过自定义配置函数实现。<code>next.config.js</code>文件必须导出一个 ​配置对象​ 或者一个 ​返回配置对象的函数。</p>\n<h3>📦 官方插件示例</h3>\n<pre><code class="language-js"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withPWA = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;next-pwa&quot;</span>)({\n  <span class="hljs-attr">dest</span>: <span class="hljs-string">&quot;public&quot;</span>,\n});\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withPWA</span>({\n  <span class="hljs-attr">reactStrictMode</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">swcMinify</span>: <span class="hljs-literal">true</span>,\n});\n</code></pre>\n<h3>🔍 常见官方插件</h3>\n<table>\n<thead>\n<tr>\n<th>插件</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>@next/mdx</code></td>\n<td>MDX 支持</td>\n</tr>\n<tr>\n<td><code>@next/bundle-analyzer</code></td>\n<td>打包分析</td>\n</tr>\n<tr>\n<td><code>next-pwa</code></td>\n<td>PWA 支持</td>\n</tr>\n<tr>\n<td><code>next-transpile-modules</code></td>\n<td>转译 node_modules</td>\n</tr>\n</tbody>\n</table>\n<h3>🎯 自定义插件</h3>\n<p>插件本质是一个<strong>高阶函数</strong>   ，接收 <code>NextConfig</code> 返回新配置：</p>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withCustomPlugin</span> = (<span class="hljs-params">config = {}</span>) =&gt; {\n  <span class="hljs-keyword">return</span> {\n    ...config,\n    <span class="hljs-attr">webpack</span>: <span class="hljs-function">(<span class="hljs-params">webpackConfig, options</span>) =&gt;</span> {\n      <span class="hljs-comment">// 自定义 webpack 配置</span>\n      webpackConfig.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWebpackPlugin</span>());\n      <span class="hljs-keyword">return</span> webpackConfig;\n    },\n  };\n};\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withCustomPlugin</span>({\n  <span class="hljs-comment">/* 其他配置 */</span>\n});\n</code></pre>\n<hr>\n<h2>🎯 2. ESLint 插件（@next/eslint-plugin-next）</h2>\n<p>Next.js 提供的 ESLint 规则集：</p>\n<pre><code class="language-bash">npm install -D eslint @next/eslint-plugin-next\n</code></pre>\n<pre><code class="language-js"><span class="hljs-comment">// .eslintrc.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">extends</span>: [\n    <span class="hljs-string">&quot;next/core-web-vitals&quot;</span>,\n    <span class="hljs-string">&quot;next/typescript&quot;</span>, <span class="hljs-comment">// 如果使用 TS</span>\n  ],\n};\n</code></pre>\n<hr>\n<h2>🎨 3. 样式插件</h2>\n<h3>TailwindCSS 插件</h3>\n<pre><code class="language-bash">npm install -D tailwindcss postcss autoprefixer\nnpx tailwindcss init -p\n</code></pre>\n<pre><code class="language-js"><span class="hljs-comment">// tailwind.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">content</span>: [<span class="hljs-string">&quot;./src/**/*.{js,ts,jsx,tsx}&quot;</span>],\n  <span class="hljs-attr">plugins</span>: [<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@tailwindcss/forms&quot;</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@tailwindcss/typography&quot;</span>)],\n};\n</code></pre>\n<h3>Styled Components</h3>\n<pre><code class="language-js"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">compiler</span>: {\n    <span class="hljs-attr">styledComponents</span>: <span class="hljs-literal">true</span>,\n  },\n};\n</code></pre>\n<hr>\n<h2>🏗️ 4. 运行时插件（Runtime Plugins）</h2>\n<h3>App Router 的 <code>instrumentation.ts</code></h3>\n<pre><code class="language-ts"><span class="hljs-comment">// src/instrumentation.ts</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>) {\n    <span class="hljs-comment">// 初始化 APM、日志等</span>\n    <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./lib/sentry&quot;</span>);\n  }\n}\n</code></pre>\n<h3>自定义 Document（pages/_document.js）</h3>\n<pre><code class="language-js"><span class="hljs-comment">// pages/_document.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Document</span>, { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span>, <span class="hljs-title class_">Main</span>, <span class="hljs-title class_">NextScript</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/document&quot;</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/custom.css&quot;</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span>\n    );\n  }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyDocument</span>;\n</code></pre>\n<hr>\n<h2>🔌 5. 第三方插件生态</h2>\n<h3>数据库插件</h3>\n<table>\n<thead>\n<tr>\n<th>插件</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>@prisma/nextjs-monorepo-workaround-plugin</code></td>\n<td>Prisma 支持</td>\n</tr>\n<tr>\n<td><code>@next-auth/prisma-adapter</code></td>\n<td>NextAuth 适配器</td>\n</tr>\n</tbody>\n</table>\n<h3>性能优化插件</h3>\n<ul>\n<li><code>next-optimized-images</code>：图片优化</li>\n<li><code>next-compose-plugins</code>：插件组合工具</li>\n</ul>\n<hr>\n<h2>🧩 6. 插件组合技巧</h2>\n<h3>使用 <code>next-compose-plugins</code></h3>\n<pre><code class="language-bash">npm install next-compose-plugins\n</code></pre>\n<pre><code class="language-js"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withPlugins = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;next-compose-plugins&quot;</span>);\n<span class="hljs-keyword">const</span> withPWA = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;next-pwa&quot;</span>);\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withPlugins</span>(\n  [\n    [withPWA, { <span class="hljs-attr">dest</span>: <span class="hljs-string">&quot;public&quot;</span> }],\n    [withBundleAnalyzer, { <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span> }],\n  ],\n  {\n    <span class="hljs-attr">reactStrictMode</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">swcMinify</span>: <span class="hljs-literal">true</span>,\n  },\n);\n</code></pre>\n<hr>\n<h2>🚨 7. 常见陷阱</h2>\n<table>\n<thead>\n<tr>\n<th>问题</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>插件顺序影响</td>\n<td>用 <code>compose-plugins</code> 或手动嵌套</td>\n</tr>\n<tr>\n<td>插件冲突</td>\n<td>检查 webpack 配置合并</td>\n</tr>\n<tr>\n<td>类型丢失</td>\n<td>使用 <code>@types/next</code> 或自定义类型声明</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2>📋 8. 完整配置示例</h2>\n<pre><code class="language-js"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withPWA = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;next-pwa&quot;</span>);\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">phase, { defaultConfig }</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> plugins = [\n    <span class="hljs-title function_">withPWA</span>({ <span class="hljs-attr">dest</span>: <span class="hljs-string">&quot;public&quot;</span> }),\n    <span class="hljs-title function_">withBundleAnalyzer</span>({ <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span> }),\n  ];\n\n  <span class="hljs-keyword">return</span> plugins.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, plugin</span>) =&gt;</span> <span class="hljs-title function_">plugin</span>(acc), {\n    ...defaultConfig,\n    <span class="hljs-attr">reactStrictMode</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">swcMinify</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">images</span>: {\n      <span class="hljs-attr">domains</span>: [<span class="hljs-string">&quot;example.com&quot;</span>],\n    },\n    <span class="hljs-keyword">async</span> <span class="hljs-title function_">rewrites</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-keyword">return</span> [\n        {\n          <span class="hljs-attr">source</span>: <span class="hljs-string">&quot;/api/old/:path*&quot;</span>,\n          <span class="hljs-attr">destination</span>: <span class="hljs-string">&quot;/api/new/:path*&quot;</span>,\n        },\n      ];\n    },\n  });\n};\n</code></pre>\n<hr>\n<h2>🎯 总结</h2>\n<table>\n<thead>\n<tr>\n<th>插件类型</th>\n<th>配置位置</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>官方插件</td>\n<td><code>next.config.js</code></td>\n<td><code>@next/mdx</code>, <code>next-pwa</code></td>\n</tr>\n<tr>\n<td>自定义插件</td>\n<td><code>next.config.js</code></td>\n<td>高阶函数</td>\n</tr>\n<tr>\n<td>ESLint</td>\n<td><code>.eslintrc.js</code></td>\n<td><code>@next/eslint-plugin-next</code></td>\n</tr>\n<tr>\n<td>样式插件</td>\n<td>独立配置文件</td>\n<td><code>tailwind.config.js</code></td>\n</tr>\n<tr>\n<td>运行时插件</td>\n<td><code>instrumentation.ts</code></td>\n<td>APM 初始化</td>\n</tr>\n<tr>\n<td>Document 插件</td>\n<td><code>pages/_document.js</code></td>\n<td>全局 HTML 模板</td>\n</tr>\n</tbody>\n</table>\n<p><strong>记住核心思想：Next.js 的插件 = 通过配置/约定扩展框架，而非传统 npm 插件！</strong></p>\n</div>'</script></body></html>