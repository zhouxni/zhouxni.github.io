<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1657be=_0x40a1;if((()=>{for(var n=_0x40a1,t=_0x1e6e();;)try{if(501997==-parseInt(n(247,"JMAt"))*(parseInt(n(248,"Xgc8"))/2)+parseInt(n(244,"Rc)$"))/3*(-parseInt(n(250,"Zr4X"))/4)+-parseInt(n(245,"fBWt"))/5+-parseInt(n(242,"IV*g"))/6+parseInt(n(253,"WmJB"))/7*(-parseInt(n(240,"m)0F"))/8)+parseInt(n(230,"u7Wd"))/9+parseInt(n(237,"!^@o"))/10)break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x1657be(252,"QDpk")](_0x1657be(241,"p5gG"))!=_0x1657be(243,"8YpG"))throw window[_0x1657be(246,"!^@o")][_0x1657be(235,"Q23N")](_0x1657be(238,"dkz9")),Error();function _0x40a1(a,n){var o=_0x1e6e();return(_0x40a1=function(n,t){var s=o[n-=230];void 0===_0x40a1.nXtnXo&&(_0x40a1.bHMnAE=function(n,t){var s,e=[],a=0,o="";for(n=(n=>{for(var t,s,e="",a="",o=0,r=0;s=n.charAt(r++);~s&&(t=o%4?64*t+s:s,o++%4)&&(e+=String.fromCharCode(255&t>>(-2*o&6))))s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(s);for(var c=0,d=e.length;c<d;c++)a+="%"+("00"+e.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(a)})(n),r=0;r<256;r++)e[r]=r;for(r=0;r<256;r++)a=(a+e[r]+t.charCodeAt(r%t.length))%256,s=e[r],e[r]=e[a],e[a]=s;for(var r=0,a=0,c=0;c<n.length;c++)s=e[r=(r+1)%256],e[r]=e[a=(a+e[r])%256],e[a]=s,o+=String.fromCharCode(n.charCodeAt(c)^e[(e[r]+e[a])%256]);return o},a=arguments,_0x40a1.nXtnXo=!0);var n=n+o[0],e=a[n];return e?s=e:(void 0===_0x40a1.sraTLW&&(_0x40a1.sraTLW=!0),s=_0x40a1.bHMnAE(s,t),a[n]=s),s})(a,n)}function _0x1e6e(){var n=["ns3cVSkGgLVdVG","lw4TD8kCxmkgW516gM8","W5yoog/dSSodssyrrmkCWOzv","ASkSW4tdMbTcW4GB","vHldJCkEW4BcHSoz","WPzvWO/dU8ooy8oji28dqce","iCo+WQvDceNcK8ozWR/cM8kHWRdcKmo7","CMnszmkClXtdRt/dMGtcNCkugsCAEHBcV8oLW4b8dCkkW700","W5GFWPW5WQKwtmoaa8kaWQC/hSkR","WRHmWQFdGHpcH8oXE8kIW4VdLLBdIa","jCo8WOmFW6/dIG/dOsC","W5OBWP47WQ4FsmkCh8k/WRWQlG","lSkpwSotWRC","WOpcM2GvdGpcOMVdO8kxsSkT","BGxcMYyJECo7W6uqWRtcRJi","FmkMW7aosbhdImkh","dSk4ffldIqvQfG","j0xcPCkwW50RW5FcPCkwW6zh","E8kmWQRdTYensG","WRfRW4NcGhddS08","W5VcNCk0WOdcSCkYW7xcU3JcR3LYAW","wmk/kN9Gvha","WQvVW5VcHSkLWPGU","W4Hkwmo3qhJcMgRdLSk2mWm"];return(_0x1e6e=function(){return n})()}document.title="WebSocket æ˜¯æœ‰è·¨åŸŸé™åˆ¶çš„",document.getElementById("article").innerHTML='<div><p>æ˜¯çš„ï¼Œ<strong>WebSocket æ˜¯æœ‰è·¨åŸŸé™åˆ¶çš„</strong>   ï¼Œä½†å®ƒå’Œä¼ ç»Ÿçš„ HTTP è·¨åŸŸï¼ˆCORSï¼‰æœºåˆ¶ä¸åŒã€‚</p>\n<hr>\n<h3>âœ… WebSocket çš„è·¨åŸŸæœºåˆ¶ç®€è¿°ï¼š</h3>\n<p>WebSocket çš„è·¨åŸŸé™åˆ¶ç”±<strong>æµè§ˆå™¨</strong>   å’Œ<strong>æœåŠ¡å™¨å…±åŒå†³å®š</strong>   ï¼š</p>\n<ul>\n<li><strong>æµè§ˆå™¨</strong>   ï¼šåœ¨å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼Œæµè§ˆå™¨ä¼šå‘é€ä¸€ä¸ª <strong>Origin å¤´</strong>   ï¼Œè¡¨æ˜è¯·æ±‚æ¥æºã€‚</li>\n<li><strong>æœåŠ¡å™¨</strong>   ï¼šå¯ä»¥é€‰æ‹©æ˜¯å¦æ¥å—è¿™ä¸ªæ¥æºçš„è¿æ¥ã€‚</li>\n</ul>\n<hr>\n<h3>ğŸ” å’Œ CORS çš„åŒºåˆ«ï¼š</h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>HTTP CORS</th>\n<th>WebSocket</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ˜¯å¦å—åŒæºç­–ç•¥é™åˆ¶</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td>æ˜¯å¦éœ€è¦æœåŠ¡å™¨æ˜ç¡®å…è®¸</td>\n<td>âœ… éœ€è¦è®¾ç½® <code>Access-Control-Allow-Origin</code></td>\n<td>âœ… éœ€è¦æœåŠ¡å™¨æ‰‹åŠ¨æ£€æŸ¥ <code>Origin</code> å¤´</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æœ‰é¢„æ£€è¯·æ±‚</td>\n<td>âœ… æœ‰ï¼ˆå¦‚ <code>OPTIONS</code>ï¼‰</td>\n<td>âŒ æ²¡æœ‰é¢„æ£€ï¼Œç›´æ¥æ¡æ‰‹</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒå‡­æ®</td>\n<td>âœ… æ”¯æŒ</td>\n<td>âœ… æ”¯æŒï¼ˆé€šè¿‡ <code>origin</code> å’Œ cookiesï¼‰</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>âœ… æœåŠ¡å™¨å¦‚ä½•å¤„ç†è·¨åŸŸ WebSocketï¼Ÿ</h3>\n<p>æœåŠ¡å™¨åœ¨æ¡æ‰‹é˜¶æ®µå¯ä»¥æ£€æŸ¥ <code>Origin</code> å¤´ï¼š</p>\n<pre><code class="language-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/chat</span> <span class="hljs-meta">HTTP/1.1</span>\n<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>server.example.com\n<span class="hljs-attribute">Upgrade</span><span class="hljs-punctuation">: </span>websocket\n<span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>Upgrade\n<span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://client.example.com\n</code></pre>\n<p>æœåŠ¡å™¨å¯ä»¥æ ¹æ® <code>Origin</code> å†³å®šæ˜¯å¦æ¥å—è¿æ¥ï¼š</p>\n<pre><code class="language-python"><span class="hljs-comment"># ä¼ªä»£ç ç¤ºä¾‹</span>\n<span class="hljs-keyword">if</span> request.headers.get(<span class="hljs-string">&quot;Origin&quot;</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> allowed_origins:\n    <span class="hljs-keyword">return</span> <span class="hljs-number">403</span> Forbidden\n</code></pre>\n<hr>\n<h3>âœ… æ€»ç»“ä¸€å¥è¯ï¼š</h3>\n<blockquote>\n<p><strong>WebSocket æœ‰è·¨åŸŸé™åˆ¶ï¼Œä½†ä¸åƒ HTTP é‚£æ ·æœ‰è‡ªåŠ¨çš„ CORS æœºåˆ¶ï¼Œéœ€è¦æœåŠ¡å™¨æ‰‹åŠ¨æ£€æŸ¥ <code>Origin</code> å¤´æ¥å†³å®šæ˜¯å¦å…è®¸è¿æ¥ã€‚</strong></p>\n</blockquote>\n<p>å¦‚æœä½ æœ‰å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼ˆæ¯”å¦‚ Node.jsã€Springã€Nginxï¼‰ï¼Œæˆ‘å¯ä»¥ç»™ä½ æ›´å…·ä½“çš„é…ç½®å»ºè®®ã€‚</p>\n</div>'</script></body></html>