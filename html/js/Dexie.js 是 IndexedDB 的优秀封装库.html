<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x578c7e=_0x583a;function _0x2211(){var s=["yrTxW5SEWPtcVCohvgXFW4xdGW","iSo2WR1tWOxdV0P/CSoyWPLsBW","W5RdKXtdHmksbca","WQXybSoDWOOQhgRcLq","WPRcI8k3B8kvs0FcGmkC","de/dGCohW5KGWOxcPa","WP10h8k9WRxcGCk7W5JcTmkSF8k4WRHl","vCk6W7SMWQiuBSoHna","WOnGF8kafahcKq","W7NcVCkCs8k0oYnUgsRcUG","WO50fKpdOGldSW","W4miWOH2W7NdLComW7RcQgSGW4JdHq","cSkFc8oxW5q","FSkRfWpcTSo2WO3cKmkFW4pdRdVcVq","amo4jx1RWR09g8kOW4tdM8k/aa","gmowcvNdSJBdQv5XW7xdRSowWRm","W5ZdSYGlWRFcRCkDW6FcPCozWP3dMCoZW7mwf0TTWPaApmkLW7HesbW","svWTvrxdHwKiWQBdQ8kBiCkr","W4JdU8kRqweagq","q1qSvXhdG2z6WPNdGCkdcmkGWPW","WOfoWRmtESoYW7exWP/cSIu","W4zQECkjhZBcOa","WOBcGmomxSk6l1ldHh9SWRpcGmo8","W7JdP8ozhCoSbHK","W7GaWQtcKvVdS8ohomkusaFdJJ8"];return(_0x2211=function(){return s})()}function _0x583a(p,s){var e=_0x2211();return(_0x583a=function(s,a){var n=e[s-=423];void 0===_0x583a.gWRgcF&&(_0x583a.awzQlq=function(s,a){var n,l=[],p=0,e="";for(s=(s=>{for(var a,n,l="",p="",e=0,t=0;n=s.charAt(t++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)p=(p+l[t]+a.charCodeAt(t%a.length))%256,n=l[t],l[t]=l[p],l[p]=n;for(var t=0,p=0,c=0;c<s.length;c++)n=l[t=(t+1)%256],l[t]=l[p=(p+l[t])%256],l[p]=n,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[t]+l[p])%256]);return e},p=arguments,_0x583a.gWRgcF=!0);var s=s+e[0],l=p[s];return l?n=l:(void 0===_0x583a.RIgOfE&&(_0x583a.RIgOfE=!0),n=_0x583a.awzQlq(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x583a,a=_0x2211();;)try{if(700700==-parseInt(s(427,"f2aC"))*(parseInt(s(425,"AtLz"))/2)+parseInt(s(447,"O003"))/3+-parseInt(s(434,"MD)3"))/4*(parseInt(s(432,"KM%f"))/5)+parseInt(s(426,"x[xI"))/6*(parseInt(s(423,"MD)3"))/7)+-parseInt(s(438,"lbav"))/8+-parseInt(s(442,"QJ]Z"))/9+parseInt(s(431,"i%VA"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x578c7e(435,")Yyz")](_0x578c7e(428,"(AU4"))!=_0x578c7e(437,"MZ#K"))throw window[_0x578c7e(430,"B(r#")][_0x578c7e(433,"xRW#")](_0x578c7e(441,"qF4f")),Error();document.title="Dexie.js 是 IndexedDB 的优秀封装库",document.getElementById("article").innerHTML='<div><p>Dexie.js 是 IndexedDB 的优秀封装库，它解决了原生 IndexedDB API 繁琐、回调嵌套复杂的问题，同时提供了类 SQL 的查询语法、事务管理和版本迁移等高级功能，是构建复杂前端处理大量结构化数据的理想选择。</p>\n<h3>一、Dexie.js 的核心优势</h3>\n<ol>\n<li><strong>简洁的 API 设计</strong>   ：用 Promise 替代原生回调，支持 <code>async/await</code>，代码更简洁。</li>\n<li><strong>强大的查询能力</strong>   ：提供类似 SQL 的查询语法（<code>where</code>、<code>orderBy</code>、<code>limit</code> 等），支持复杂条件组合。</li>\n<li><strong>完善的事务支持</strong>   ：简化事务管理，确保数据操作的原子性。</li>\n<li><strong>版本迁移工具</strong>   ：轻松数据库结构变更（新增表、索引）更简单，自动需需版本升级流程。</li>\n<li><strong>性能优化</strong>   ：内置查询缓存、批量操作优化，提升大数据处理效率。</li>\n<li><strong>类型友好</strong>   ：原生 TypeScript 完整支持，提供类型提示。</li>\n</ol>\n<h3>二、基本使用流程</h3>\n<h4>1. 安装</h4>\n<pre><code class="language-bash">npm install dexie  <span class="hljs-comment"># npm</span>\n<span class="hljs-comment"># 或</span>\nyarn add dexie     <span class="hljs-comment"># yarn</span>\n</code></pre>\n<h4>2. 初始化数据库</h4>\n<p>通过 <code>new Dexie()</code> 创建数据库实例，定义版本和数据结构（对象仓库、索引）。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Dexie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dexie&quot;</span>;\n\n<span class="hljs-comment">// 创建数据库实例（名称为 &quot;MyDatabase&quot;）</span>\n<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dexie</span>(<span class="hljs-string">&quot;MyDatabase&quot;</span>);\n\n<span class="hljs-comment">// 定义版本 1 的结构</span>\ndb.<span class="hljs-title function_">version</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">stores</span>({\n  <span class="hljs-comment">// 格式：对象仓库名: &quot;主键, 索引1, 索引2, ...&quot;</span>\n  <span class="hljs-attr">users</span>: <span class="hljs-string">&quot;id, name, email, age&quot;</span>, <span class="hljs-comment">// id 为主键（自动推断）</span>\n  <span class="hljs-attr">orders</span>: <span class="hljs-string">&quot;orderId, userId, [userId+date], total&quot;</span>, <span class="hljs-comment">// [userId+date] 表示复合索引</span>\n});\n\n<span class="hljs-comment">// 打开数据库（返回 Promise）</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">open</span>();\n</code></pre>\n<ul>\n<li><strong>对象仓库（表）</strong>   ：<code>users</code> 和 <code>orders</code> 是两个独立的对象仓库。</li>\n<li><strong>主键</strong>   ：第一个字段（如 <code>id</code>、<code>orderId</code>）默认为主键，支持自动递增（需配置 <code>id++</code>）。</li>\n<li><strong>索引</strong>   ：除主键外的字段（如 <code>name</code>、<code>email</code>）会自动创建索引，复合索引用 <code>[字段1+字段2]</code> 定义。</li>\n</ul>\n<h4>3. 基本操作（CRUD）</h4>\n<h5>（1）新增数据（Add）</h5>\n<pre><code class="language-javascript"><span class="hljs-comment">// 新增单条</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">add</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;alice@test.com&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> });\n\n<span class="hljs-comment">// 批量新增</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">bulkAdd</span>([\n  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;bob@test.com&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },\n  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Charlie&quot;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;charlie@test.com&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> },\n]);\n</code></pre>\n<ul>\n<li>若主键已存在，<code>add</code> 会抛出错误；如需“存在则更新”，用 <code>put</code> 方法。</li>\n</ul>\n<h5>（2）查询数据（Query）</h5>\n<p>Dexie 提供丰富的查询方法，支持链式调用：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 1. 通过主键查询</span>\n<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// { id:1, name: &#x27;Alice&#x27;, ... }</span>\n\n<span class="hljs-comment">// 2. 条件查询（年龄 &gt; 28 的用户）</span>\n<span class="hljs-keyword">const</span> adults = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;age&quot;</span>).<span class="hljs-title function_">above</span>(<span class="hljs-number">28</span>).<span class="hljs-title function_">toArray</span>(); <span class="hljs-comment">// 返回数组</span>\n\n<span class="hljs-comment">// 3. 模糊查询（名字包含 &#x27;A&#x27;）</span>\n<span class="hljs-keyword">const</span> aUsers = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n  .<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;name&quot;</span>)\n  .<span class="hljs-title function_">startsWithAnyOfIgnoreCase</span>(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)\n  .<span class="hljs-title function_">toArray</span>();\n\n<span class="hljs-comment">// 4. 排序和分页（按年龄升序，取前 2 条）</span>\n<span class="hljs-keyword">const</span> sortedUsers = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">&quot;age&quot;</span>) <span class="hljs-comment">// 按 age 索引排序</span>\n  .<span class="hljs-title function_">limit</span>(<span class="hljs-number">2</span>)\n  .<span class="hljs-title function_">toArray</span>();\n\n<span class="hljs-comment">// 5. 复合索引查询（查询 userId=2 且 date 在 2023 年的订单）</span>\n<span class="hljs-keyword">const</span> userOrders = <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>\n  .<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;[userId+date]&quot;</span>)\n  .<span class="hljs-title function_">between</span>([<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)], [<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">31</span>)])\n  .<span class="hljs-title function_">toArray</span>();\n</code></pre>\n<h5>（3）更新数据（Update）</h5>\n<pre><code class="language-javascript"><span class="hljs-comment">// 1. 更新单条（通过主键）</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">update</span>(<span class="hljs-number">1</span>, { <span class="hljs-attr">age</span>: <span class="hljs-number">31</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;new-alice@test.com&quot;</span> });\n\n<span class="hljs-comment">// 2. 批量更新（条件匹配的所有记录）</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n  .<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;age&quot;</span>)\n  .<span class="hljs-title function_">below</span>(<span class="hljs-number">20</span>)\n  .<span class="hljs-title function_">modify</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> {\n    user.<span class="hljs-property">isYoung</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 给年龄 &lt;20 的用户添加 isYoung 字段</span>\n  });\n</code></pre>\n<h5>（4）删除数据（Delete）</h5>\n<pre><code class="language-javascript"><span class="hljs-comment">// 1. 通过主键删除</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">1</span>);\n\n<span class="hljs-comment">// 2. 批量删除（条件匹配的记录）</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;age&quot;</span>).<span class="hljs-title function_">above</span>(<span class="hljs-number">60</span>).<span class="hljs-title function_">delete</span>();\n</code></pre>\n<h3>三、事务管理</h3>\n<p>Dexie 简化了事务操作，确保一组操作要么全部成功，要么全部失败：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 事务模式：&#x27;r&#x27;（只读）、&#x27;rw&#x27;（读写）</span>\n<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;rw&quot;</span>, db.<span class="hljs-property">users</span>, db.<span class="hljs-property">orders</span>, <span class="hljs-title function_">async</span> () =&gt; {\n  <span class="hljs-comment">// 操作 1：新增用户</span>\n  <span class="hljs-keyword">const</span> userId = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">add</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Dave&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">40</span> });\n\n  <span class="hljs-comment">// 操作 2：为该用户新增订单（依赖操作 1 的结果）</span>\n  <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>.<span class="hljs-title function_">add</span>({\n    <span class="hljs-attr">orderId</span>: <span class="hljs-number">1001</span>,\n    <span class="hljs-attr">userId</span>: userId,\n    <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),\n    <span class="hljs-attr">total</span>: <span class="hljs-number">99.9</span>,\n  });\n\n  <span class="hljs-comment">// 若中间出错（如抛出异常），所有操作会回滚</span>\n});\n</code></pre>\n<ul>\n<li>事务中可操作多个对象仓库（如同时操作 <code>users</code> 和 <code>orders</code>）。</li>\n<li>事务自动提交，无需手动处理。</li>\n</ul>\n<h3>四、版本迁移</h3>\n<p>当需要修改数据库结构（如新增表、索引）时，通过版本升级实现：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 版本 1（初始版本）</span>\ndb.<span class="hljs-title function_">version</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">stores</span>({\n  <span class="hljs-attr">users</span>: <span class="hljs-string">&quot;id, name, age&quot;</span>,\n});\n\n<span class="hljs-comment">// 版本 2（新增 orders 表和 users 的 email 索引）</span>\ndb.<span class="hljs-title function_">version</span>(<span class="hljs-number">2</span>)\n  .<span class="hljs-title function_">stores</span>({\n    <span class="hljs-attr">users</span>: <span class="hljs-string">&quot;id, name, age, email&quot;</span>, <span class="hljs-comment">// 新增 email 索引</span>\n    <span class="hljs-attr">orders</span>: <span class="hljs-string">&quot;orderId, userId&quot;</span>, <span class="hljs-comment">// 新增 orders 表</span>\n  })\n  .<span class="hljs-title function_">upgrade</span>(<span class="hljs-function">(<span class="hljs-params">tx</span>) =&gt;</span> {\n    <span class="hljs-comment">// 可选：迁移旧数据（如为现有用户添加 email 字段默认值）</span>\n    <span class="hljs-keyword">return</span> tx.<span class="hljs-property">users</span>.<span class="hljs-title function_">toCollection</span>().<span class="hljs-title function_">modify</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> {\n      user.<span class="hljs-property">email</span> = <span class="hljs-string">`<span class="hljs-subst">${user.name.toLowerCase()}</span>@test.com`</span>;\n    });\n  });\n\n<span class="hljs-comment">// 版本 3（修改 orders 表，新增 total 字段索引）</span>\ndb.<span class="hljs-title function_">version</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">stores</span>({\n  <span class="hljs-attr">orders</span>: <span class="hljs-string">&quot;orderId, userId, total&quot;</span>, <span class="hljs-comment">// 新增 total 索引</span>\n});\n</code></pre>\n<ul>\n<li>版本号必须递增（1→2→3）。</li>\n<li><code>upgrade</code> 回调用于数据迁移（如补全旧数据的新字段）。</li>\n</ul>\n<h3>五、高级特性</h3>\n<h4>1. 实时查询（Live Queries）</h4>\n<p>监听数据变化并自动更新查询结果，适合 UI 实时同步：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监听年龄 &gt; 30 的用户变化</span>\n<span class="hljs-keyword">const</span> liveQuery = db.<span class="hljs-property">users</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;age&quot;</span>).<span class="hljs-title function_">above</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">liveQuery</span>();\n\n<span class="hljs-comment">// 数据变化时触发</span>\nliveQuery.<span class="hljs-title function_">subscribe</span>({\n  <span class="hljs-title function_">next</span>(<span class="hljs-params">users</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;当前符合条件的用户：&quot;</span>, users);\n  },\n  <span class="hljs-title function_">error</span>(<span class="hljs-params">err</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;查询错误：&quot;</span>, err);\n  },\n});\n\n<span class="hljs-comment">// 组件卸载时取消监听</span>\n<span class="hljs-comment">// liveQuery.unsubscribe();</span>\n</code></pre>\n<h4>2. 批量操作优化</h4>\n<p><code>bulkAdd</code>、<code>bulkPut</code>、<code>bulkDelete</code> 等方法比循环单条操作效率高 10-100 倍，适合处理大量数据：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 批量插入 1000 条数据</span>\n<span class="hljs-keyword">const</span> data = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({\n  <span class="hljs-attr">id</span>: i + <span class="hljs-number">100</span>,\n  <span class="hljs-attr">name</span>: <span class="hljs-string">`User <span class="hljs-subst">${i}</span>`</span>,\n  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> + (i % <span class="hljs-number">30</span>),\n}));\n\n<span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">bulkAdd</span>(data);\n</code></pre>\n<h4>3. 索引迭代与游标</h4>\n<p>对于超大数据集（如 10 万+ 条），用游标分页加载更高效：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> pageSize = <span class="hljs-number">100</span>;\n<span class="hljs-keyword">let</span> lastId = <span class="hljs-number">0</span>;\n\n<span class="hljs-comment">// 分页加载（从 lastId 开始，取 100 条）</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadNextPage</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n    .<span class="hljs-title function_">where</span>(<span class="hljs-string">&quot;id&quot;</span>)\n    .<span class="hljs-title function_">above</span>(lastId)\n    .<span class="hljs-title function_">limit</span>(pageSize)\n    .<span class="hljs-title function_">toArray</span>();\n\n  <span class="hljs-keyword">if</span> (users.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {\n    lastId = users[users.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">id</span>;\n    <span class="hljs-keyword">return</span> users;\n  }\n  <span class="hljs-keyword">return</span> []; <span class="hljs-comment">// 没有更多数据</span>\n}\n</code></pre>\n<h3>六、兼容性与最佳实践</h3>\n<ul>\n<li><strong>兼容性</strong>   ：支持所有现代浏览器（Chrome、Firefox、Edge、Safari 10+），与原生 IndexedDB 一致。</li>\n<li><strong>最佳实践</strong>   ：\n<ul>\n<li>\n<p>为频繁查询的字段创建索引（如 <code>where</code> 条件中常用的字段）。</p>\n</li>\n<li>\n<p>复杂操作使用事务，确保数据一致性。</p>\n</li>\n<li>\n<p>大数据批量操作优先用 <code>bulk*</code> 方法。</p>\n</li>\n<li>\n<p>页面卸载前关闭数据库连接（<code>db.close()</code>）。</p>\n</li>\n<li>\n<p>结合 TypeScript 使用，定义数据模型接口：</p>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {\n  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;\n  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;\n  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;\n  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;\n}\n\n<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dexie</span>(<span class="hljs-string">&quot;MyDB&quot;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Dexie</span> &amp; {\n  <span class="hljs-attr">users</span>: <span class="hljs-title class_">Dexie</span>.<span class="hljs-property">Table</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-built_in">number</span>&gt;;\n};\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h3>总结</h3>\n<p>Dexie.js 是 IndexedDB 的“瑞士军刀”，它既保留了 IndexedDB 的强大功能（大容量、事务、索引），又通过简洁的 API 降低了使用门槛。无论是简单的键值对存储，还是复杂的离线应用数据管理，Dexie.js 都能显著提升开发效率，是前端本地数据库的首选工具之一。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Dexie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dexie&#x27;</span>;\n\n<span class="hljs-comment">// 1. 定义数据库模型（TypeScript 可选）</span>\ninterface <span class="hljs-title class_">User</span> {\n  <span class="hljs-attr">id</span>: number;\n  <span class="hljs-attr">name</span>: string;\n  <span class="hljs-attr">email</span>: string;\n  <span class="hljs-attr">age</span>: number;\n}\n\ninterface <span class="hljs-title class_">Order</span> {\n  <span class="hljs-attr">orderId</span>: number;\n  <span class="hljs-attr">userId</span>: number;\n  <span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span>;\n  <span class="hljs-attr">total</span>: number;\n}\n\n<span class="hljs-comment">// 2. 初始化数据库</span>\n<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dexie</span>(<span class="hljs-string">&#x27;ShopDB&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Dexie</span> &amp; {\n  <span class="hljs-attr">users</span>: <span class="hljs-title class_">Dexie</span>.<span class="hljs-property">Table</span>&lt;<span class="hljs-title class_">User</span>, number&gt;;\n  <span class="hljs-attr">orders</span>: <span class="hljs-title class_">Dexie</span>.<span class="hljs-property">Table</span>&lt;<span class="hljs-title class_">Order</span>, number&gt;;\n};\n\n<span class="hljs-comment">// 3. 定义版本与结构</span>\ndb.<span class="hljs-title function_">version</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">stores</span>({\n  <span class="hljs-attr">users</span>: <span class="hljs-string">&#x27;id++, name, email, age&#x27;</span>, <span class="hljs-comment">// id++ 表示自增主键</span>\n  <span class="hljs-attr">orders</span>: <span class="hljs-string">&#x27;orderId++, userId, date, total, [userId+date]&#x27;</span> <span class="hljs-comment">// 复合索引</span>\n});\n\n<span class="hljs-comment">// 4. 数据库操作示例</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-comment">// 打开数据库</span>\n    <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">open</span>();\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;数据库打开成功&#x27;</span>);\n\n    <span class="hljs-comment">// 清空旧数据（演示用）</span>\n    <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">clear</span>();\n    <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>.<span class="hljs-title function_">clear</span>();\n\n    <span class="hljs-comment">// 新增用户</span>\n    <span class="hljs-keyword">const</span> userId1 = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">add</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>,\n      <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;alice@example.com&#x27;</span>,\n      <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>\n    });\n\n    <span class="hljs-keyword">const</span> userId2 = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>.<span class="hljs-title function_">add</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Bob&#x27;</span>,\n      <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;bob@example.com&#x27;</span>,\n      <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>\n    });\n\n    <span class="hljs-comment">// 事务：新增订单并关联用户</span>\n    <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&#x27;rw&#x27;</span>, db.<span class="hljs-property">orders</span>, <span class="hljs-title function_">async</span> () =&gt; {\n      <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>.<span class="hljs-title function_">add</span>({\n        <span class="hljs-attr">userId</span>: userId1,\n        <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>),\n        <span class="hljs-attr">total</span>: <span class="hljs-number">99.9</span>\n      });\n\n      <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>.<span class="hljs-title function_">add</span>({\n        <span class="hljs-attr">userId</span>: userId1,\n        <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>),\n        <span class="hljs-attr">total</span>: <span class="hljs-number">149.9</span>\n      });\n    });\n\n    <span class="hljs-comment">// 查询：Alice 的所有订单</span>\n    <span class="hljs-keyword">const</span> aliceOrders = <span class="hljs-keyword">await</span> db.<span class="hljs-property">orders</span>\n      .<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;userId&#x27;</span>)\n      .<span class="hljs-title function_">equals</span>(userId1)\n      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">&#x27;date&#x27;</span>)\n      .<span class="hljs-title function_">reverse</span>() <span class="hljs-comment">// 倒序（最新的在前）</span>\n      .<span class="hljs-title function_">toArray</span>();\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Alice 的订单：&#x27;</span>, aliceOrders);\n\n    <span class="hljs-comment">// 查询：年龄 &gt; 28 的用户</span>\n    <span class="hljs-keyword">const</span> adults = <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n      .<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>)\n      .<span class="hljs-title function_">above</span>(<span class="hljs-number">28</span>)\n      .<span class="hljs-title function_">toArray</span>();\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;年龄 &gt; 28 的用户：&#x27;</span>, adults);\n\n    <span class="hljs-comment">// 更新：Bob 的年龄改为 26</span>\n    <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n      .<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;id&#x27;</span>)\n      .<span class="hljs-title function_">equals</span>(userId2)\n      .<span class="hljs-title function_">modify</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {\n        user.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>;\n      });\n\n    <span class="hljs-comment">// 删除：删除邮箱为 bob@example.com 的用户</span>\n    <span class="hljs-keyword">await</span> db.<span class="hljs-property">users</span>\n      .<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;email&#x27;</span>)\n      .<span class="hljs-title function_">equals</span>(<span class="hljs-string">&#x27;bob@example.com&#x27;</span>)\n      .<span class="hljs-title function_">delete</span>();\n\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;操作失败：&#x27;</span>, err);\n  } <span class="hljs-keyword">finally</span> {\n    <span class="hljs-comment">// 关闭数据库</span>\n    db.<span class="hljs-title function_">close</span>();\n  }\n}\n\n<span class="hljs-comment">// 执行演示</span>\n<span class="hljs-title function_">demo</span>();\n\n\n</code></pre>\n<p>以上示例涵盖了 Dexie.js 的核心功能，包括数据库初始化、CRUD 操作、事务管理和复杂查询。实际项目中，可根据需求扩展更多功能（如实时查询、数据迁移等）。</p>\n</div>'</script></body></html>