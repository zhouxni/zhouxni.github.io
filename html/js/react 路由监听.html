<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1428e1=_0x2c59;function _0x2c59(l,s){var p=_0x2a32();return(_0x2c59=function(s,n){var a=p[s-=467];void 0===_0x2c59.zxbfBN&&(_0x2c59.fAUPLR=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,c=t.length;o<c;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)l=(l+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[l],t[l]=a;for(var e=0,l=0,o=0;o<s.length;o++)a=t[e=(e+1)%256],t[e]=t[l=(l+t[e])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(o)^t[(t[e]+t[l])%256]);return p},l=arguments,_0x2c59.zxbfBN=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x2c59.nWBgxe&&(_0x2c59.nWBgxe=!0),a=_0x2c59.fAUPLR(a,n),l[s]=a),a})(l,s)}function _0x2a32(){var s=["uCkCW6rHWQvhsG","eNeLFSkc","ugn/mqHGWPGYW7NcPG4","sxWjzWxdL8k+","W6DYW7evrSoCWPiF","emohgf3cR05/WRS5WRxcJs8","WOpcLX3dUXX5mvyR","qCo3BSknW6ZdVmo6W57dPhVdSW","tXzVaelcT8kJW57dNmo+D8ko","WQ3cNw5iCSo8i1W","WPldRCkIWPZcSWPyW7i","AxBdTCkFfmk+WRZdKapcH1Ol","W4HYtCktW5FdHIresIFdPt5t","gxb/ddeHW5uuW4WWWOVcMmkT","BGNcMCkjWQBcR0hdUSklW6XRDmo4WQ7cGwldPSkGWRxdVCkKzMRdISo3W6a","fh7dKG8ae8k1vq","uZzUoSomW7xdV2ZcP3BdV1ZcJa","WOZcJ8kPW78Nsxy","WOpcOsRdHavhW7G","nYzTWPurfCo/W4hcHvhdOq8","W7VcRJBdJCo0FqmyFJZdRSo5iW","W57dTh3dGmovsd9L","WO7dGshcPmkOF8omWRdcRbTh","mKxcMSkoWR/dUaNcMq","WR9ZW7jcW6feWRv6","W605WPpcLbddH2NcOhtdL8kD","vdTMW6q0Bmo0W4BdSNa3Fq","oCo4p8opWPfnW5dcHa","kmoIoCkSW4ldLw7cRaJdOZym","oSo0a8ofWQrfW7JcJW"];return(_0x2a32=function(){return s})()}if((()=>{for(var s=_0x2c59,n=_0x2a32();;)try{if(178996==-parseInt(s(496,"w9RH"))*(-parseInt(s(467,"y6aG"))/2)+parseInt(s(475,"%Nsd"))/3+-parseInt(s(483,"X5pf"))/4+parseInt(s(486,"yFbG"))/5*(parseInt(s(493,"p@T5"))/6)+-parseInt(s(492,"Tl*H"))/7*(-parseInt(s(487,"$N3E"))/8)+parseInt(s(491,"p@T5"))/9*(-parseInt(s(484,"**Hd"))/10)+parseInt(s(468,"amQ$"))/11*(parseInt(s(477,"$yWw"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1428e1(481,"g3yy")](_0x1428e1(470,"ujN*"))!=_0x1428e1(495,"Kw5M"))throw window[_0x1428e1(485,"[EHn")][_0x1428e1(494,"9J*(")](_0x1428e1(478,"$N3E")),Error();document.title="react 路由监听",document.getElementById("article").innerHTML='<div><p>在 React 中监听路由变化是常见的需求，例如在用户切换页面时执行某些操作（如埋点统计、权限校验、动态加载数据等）。以下是几种实现方式，适用于不同场景：</p>\n<hr>\n<h2><strong>1. 使用 <code>react-router-dom</code> 的 Hooks（推荐）</strong></h2>\n<p>适用于 <strong>React Router v5/v6</strong>  ，通过内置的 Hooks 监听路由变化。</p>\n<h3><strong>方式 1：<code>useLocation</code> + <code>useEffect</code></strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-comment">// 路由变化时触发</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;路由变化:&#x27;</span>, location.<span class="hljs-property">pathname</span>);\n    <span class="hljs-comment">// 在这里执行你的逻辑（如埋点、权限检查等）</span>\n  }, [location]); <span class="hljs-comment">// 依赖 location 对象</span>\n\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 你的页面内容 */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n}\n</code></pre>\n<h3><strong>方式 2：<code>useNavigationType</code>（监听导航行为）</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useNavigationType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> navigationType = <span class="hljs-title function_">useNavigationType</span>(); <span class="hljs-comment">// &quot;POP&quot; | &quot;PUSH&quot; | &quot;REPLACE&quot;</span>\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;导航方式:&#x27;</span>, navigationType);\n  }, [navigationType]);\n}\n</code></pre>\n<hr>\n<h2><strong>2. 监听 <code>history</code> 对象（适用于 React Router v5）</strong></h2>\n<p>如果使用 <strong>React Router v5</strong>  ，可以直接监听 <code>history</code> 对象：</p>\n<h3><strong>方式 1：<code>history.listen</code></strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { useHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> history = <span class="hljs-title function_">useHistory</span>();\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> unlisten = history.<span class="hljs-title function_">listen</span>(<span class="hljs-function">(<span class="hljs-params">location, action</span>) =&gt;</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;路由变化:&#x27;</span>, location.<span class="hljs-property">pathname</span>, <span class="hljs-string">&#x27;动作:&#x27;</span>, action);\n    });\n\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">unlisten</span>(); <span class="hljs-comment">// 组件卸载时取消监听</span>\n  }, []);\n\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 你的页面内容 */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n}\n</code></pre>\n<h3><strong>方式 2：自定义 <code>&lt;Router&gt;</code> + <code>history</code></strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n<span class="hljs-keyword">import</span> { createBrowserHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;history&#x27;</span>;\n\n<span class="hljs-keyword">const</span> history = <span class="hljs-title function_">createBrowserHistory</span>();\n\nhistory.<span class="hljs-title function_">listen</span>(<span class="hljs-function">(<span class="hljs-params">location, action</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;路由变化:&#x27;</span>, location.<span class="hljs-property">pathname</span>, <span class="hljs-string">&#x27;动作:&#x27;</span>, action);\n});\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{history}</span>&gt;</span>\n      {/* 你的路由配置 */}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<hr>\n<h2><strong>3. 监听全局 <code>window</code> 事件（通用方案）</strong></h2>\n<p>如果未使用 <code>react-router</code>，或者需要监听 <strong>非 React Router 管理的路由</strong>  （如原生 <code>window.location</code> 变化），可以使用：</p>\n<h3><strong>方式 1：<code>popstate</code> 事件（监听浏览器前进/后退）</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRouteChange</span> = (<span class="hljs-params"></span>) =&gt; {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;路由变化:&#x27;</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>);\n    };\n\n    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;popstate&#x27;</span>, handleRouteChange);\n\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;popstate&#x27;</span>, handleRouteChange);\n    };\n  }, []);\n\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 你的页面内容 */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n}\n</code></pre>\n<h3><strong>方式 2：<code>hashchange</code> 事件（监听 Hash 路由）</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHashChange</span> = (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hash 变化:&#x27;</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>);\n  };\n\n  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;hashchange&#x27;</span>, handleHashChange);\n\n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;hashchange&#x27;</span>, handleHashChange);\n  };\n}, []);\n</code></pre>\n<hr>\n<h2><strong>4. 结合状态管理（如 Redux）</strong></h2>\n<p>如果需要在全局监听路由变化并存储状态，可以结合 Redux 或 Context：</p>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n<span class="hljs-keyword">import</span> { useDispatch } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;\n<span class="hljs-keyword">import</span> { updateCurrentRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store/slices/routerSlice&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">RouteListener</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();\n  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">updateCurrentRoute</span>(location.<span class="hljs-property">pathname</span>));\n  }, [location]);\n\n  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 无 UI 渲染</span>\n}\n\n<span class="hljs-comment">// 在 App.js 中使用</span>\n&lt;<span class="hljs-title class_">RouteListener</span> /&gt;\n</code></pre>\n<hr>\n<h2><strong>总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>适用场景</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>useLocation</code> + <code>useEffect</code></strong></td>\n<td>React Router v5/v6</td>\n<td>推荐方式，简单高效</td>\n</tr>\n<tr>\n<td><strong><code>history.listen</code></strong></td>\n<td>React Router v5</td>\n<td>适用于需要监听导航动作（PUSH/POP/REPLACE）</td>\n</tr>\n<tr>\n<td><strong><code>popstate</code> / <code>hashchange</code></strong></td>\n<td>非 React Router 路由</td>\n<td>监听浏览器原生路由变化</td>\n</tr>\n<tr>\n<td><strong>Redux + 路由监听</strong></td>\n<td>全局状态管理</td>\n<td>适合需要跨组件共享路由状态</td>\n</tr>\n</tbody>\n</table>\n<p>根据你的项目需求选择合适的方式，<strong>React Router v6 推荐 <code>useLocation</code> + <code>useEffect</code></strong>  ，它是最简洁的解决方案。</p>\n</div>'</script></body></html>