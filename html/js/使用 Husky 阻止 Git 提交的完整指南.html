<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x196d(p,s){var t=_0x194a();return(_0x196d=function(s,n){var a=t[s-=355];void 0===_0x196d.MWRNtC&&(_0x196d.hpMzON=function(s,n){var a,l=[],p=0,t="";for(s=(s=>{for(var n,a,l="",p="",t=0,c=0;a=s.charAt(c++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,h=l.length;o<h;o++)p+="%"+("00"+l.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+n.charCodeAt(c%n.length))%256,a=l[c],l[c]=l[p],l[p]=a;for(var c=0,p=0,o=0;o<s.length;o++)a=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=a,t+=String.fromCharCode(s.charCodeAt(o)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x196d.MWRNtC=!0);var s=s+t[0],l=p[s];return l?a=l:(void 0===_0x196d.rUMukS&&(_0x196d.rUMukS=!0),a=_0x196d.hpMzON(a,n),p[s]=a),a})(p,s)}var _0x352f0c=_0x196d;function _0x194a(){var s=["W5/dRfT+W6TQWOm","W6tcOSo5W5FdPZrbwe1CW6bB","WOmWWPtcMSk8BcKYdG","zd7dO8oVWOyqWQZdM1H/tG","WOmWWPddP8owhK0KngNdS8kgW78","WRRdNdNcUKtcRmkcx8k4yMldVq","W5T2fchcLMlcQtXHfCkuW7fx","EWBcRCoAWOaiWRxdOG","W5FdTCotumozWOzE","WRuyd8krW5pcNuVcMX3dTmkLW5iJDCoPcSk9nmoFWPGDWQSngJOx","oqf1W6W/xqr8h8k/wSorwq","t8oQBf7cM043W7a8e8oq","EtCgWO5AbmoBkmkRc8o9","bJ/cQ8kpE8oOaSoWWOFcP8oaW5KS","tKO6W5JdK1PlWPu","dgxcRuerCgVcHw8peexcKG","WP7cVY0be0FdQInI","WOhcPSoJq8oyWPbyvq","W70XnCkuW68JW6CRfCkt","WQ7dTmk+W47cJSoRW63cPv3dTq","WQ7dSCk7W4NdRCk+WPFcG3JdSav1W6S","umoQW6hcLSkud8kSW59IW6mwhmoP","W5ldSmoQWRZdNSkeWPjwW6JcVWqabW","FSkmwCk8WOrwC8kFDCkWW54","ySoCW4j6lCkfWOj6WQG","W5FcRCkiW6lcQCoLW7G","r37dRColmW","W4ldTCoxDComWObw"];return(_0x194a=function(){return s})()}if((()=>{for(var s=_0x196d,n=_0x194a();;)try{if(281763==-parseInt(s(382,"QoDw"))*(-parseInt(s(362,"0cBp"))/2)+parseInt(s(377,")783"))/3+-parseInt(s(381,"]G*C"))/4*(-parseInt(s(368,"dand"))/5)+-parseInt(s(378,"&rfw"))/6+parseInt(s(361,"V^#g"))/7*(-parseInt(s(374,"c53l"))/8)+parseInt(s(372,"8]Gq"))/9+-parseInt(s(369,"7ZW&"))/10*(parseInt(s(375,"0!1c"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x352f0c(365,"c53l")](_0x352f0c(373,"8WZP"))!=_0x352f0c(355,"euli"))throw window[_0x352f0c(371,"ZlTX")][_0x352f0c(356,"c53l")](_0x352f0c(366,"0O1b")),Error();document.title="使用 Husky 阻止 Git 提交的完整指南",document.getElementById("article").innerHTML='<div><p>Husky 可以通过 Git 钩子在提交前运行检查脚本，如果检查失败（脚本返回非零退出码），则会阻止提交。以下是详细实现方法：</p>\n<h2>1. 基本阻止提交配置</h2>\n<h3>1.1 安装 Husky</h3>\n<pre><code class="language-sh">npm install husky --save-dev\n</code></pre>\n<h3>1.2 初始化 Husky</h3>\n<pre><code class="language-sh">npx husky install\n</code></pre>\n<h3>1.3 创建 pre-commit 钩子</h3>\n<pre><code class="language-sh">npx husky add .husky/pre-commit <span class="hljs-string">&quot;npm test&quot;</span>\n<span class="hljs-comment"># 或手动创建 .husky/pre-commit 文件</span>\n</code></pre>\n<h2>2. 阻止提交的几种方式</h2>\n<h3>2.1 使用测试失败阻止</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-comment"># 如果测试失败，脚本会返回非0状态码，阻止提交</span>\nnpm <span class="hljs-built_in">test</span>\n</code></pre>\n<h3>2.2 使用 ESLint 检查阻止</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-comment"># 检查JS/TS文件，有错误则阻止提交</span>\nnpx eslint --max-warnings 0 src/**/*.{js,jsx,ts,tsx}\n</code></pre>\n<h3>2.3 使用 lint-staged 精确检查</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-comment"># 只检查暂存区的文件</span>\nnpx lint-staged\n</code></pre>\n<h2>3. 高级阻止逻辑</h2>\n<h3>3.1 自定义检查脚本</h3>\n<p>创建 <code>scripts/pre-commit-check.js</code>:</p>\n<pre><code class="language-javascript"><span class="hljs-meta">#!/usr/bin/env node</span>\n<span class="hljs-keyword">const</span> process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;process&#x27;</span>)\n\n<span class="hljs-keyword">try</span> {\n  <span class="hljs-comment">// 你的检查逻辑</span>\n  <span class="hljs-keyword">if</span> (someCondition) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;发现不允许提交的内容&#x27;</span>)\n    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 非0退出码会阻止提交</span>\n  }\n  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// 0表示允许提交</span>\n} <span class="hljs-keyword">catch</span> (error) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;检查出错:&#x27;</span>, error)\n  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)\n}\n</code></pre>\n<p>然后在 pre-commit 中调用：</p>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\nnode scripts/pre-commit-check.js\n</code></pre>\n<h3>3.2 多条件检查</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-comment"># 按顺序执行检查，任何一个失败都会阻止提交</span>\nnpm run lint &amp;&amp; \\\nnpm run <span class="hljs-built_in">test</span> &amp;&amp; \\\nnpm run type-check\n</code></pre>\n<h2>4. 优化用户体验</h2>\n<h3>4.1 友好的错误提示</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-keyword">if</span> ! npm run lint; <span class="hljs-keyword">then</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;❌ ESLint 检查失败，提交被阻止&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;💡 尝试运行: npm run lint:fix&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">exit</span> 1\n<span class="hljs-keyword">fi</span>\n</code></pre>\n<h3>4.2 跳过检查的方法（紧急情况）</h3>\n<pre><code class="language-sh">git commit --no-verify -m <span class="hljs-string">&quot;紧急修复&quot;</span>\n</code></pre>\n<h2>5. 完整配置示例</h2>\n<h3>package.json</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;prepare&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;husky install&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;lint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint src --ext .js,.jsx,.ts,.tsx&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;lint:fix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint --fix src --ext .js,.jsx,.ts,.tsx&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jest&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;type-check&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tsc --noEmit&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{js,jsx,ts,tsx}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix --max-warnings 0&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;prettier --write&quot;</span>\n    <span class="hljs-punctuation">]</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>.husky/pre-commit</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\n<span class="hljs-comment"># 彩色输出</span>\nRED=<span class="hljs-string">&#x27;\\033[0;31m&#x27;</span>\nNC=<span class="hljs-string">&#x27;\\033[0m&#x27;</span>\n\n<span class="hljs-keyword">if</span> ! npx lint-staged; <span class="hljs-keyword">then</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">${RED}</span>🚫 提交被阻止：代码检查未通过<span class="hljs-variable">${NC}</span>&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;💡 尝试运行: npm run lint:fix&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">exit</span> 1\n<span class="hljs-keyword">fi</span>\n\n<span class="hljs-keyword">if</span> ! npm run type-check; <span class="hljs-keyword">then</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">${RED}</span>🚫 提交被阻止：类型检查失败<span class="hljs-variable">${NC}</span>&quot;</span>\n  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>\n  <span class="hljs-built_in">exit</span> 1\n<span class="hljs-keyword">fi</span>\n</code></pre>\n<h2>6. 注意事项</h2>\n<ol>\n<li><strong>确保钩子文件可执行</strong>  ：<pre><code class="language-sh"><span class="hljs-built_in">chmod</span> +x .husky/pre-commit\n</code></pre>\n</li>\n<li><strong>Windows 兼容性</strong>  ：\n<ul>\n<li>使用 Git Bash 或 WSL</li>\n<li>确保行尾是 LF 而非 CRLF</li>\n</ul>\n</li>\n<li><strong>性能考虑</strong>  ：\n<ul>\n<li>检查应该快速完成</li>\n<li>对于大项目，考虑增量检查</li>\n</ul>\n</li>\n<li><strong>团队协作</strong>  ：\n<ul>\n<li>将 .husky 目录加入版本控制</li>\n<li>在文档中说明检查规则</li>\n</ul>\n</li>\n</ol>\n<p>通过这种配置，你可以确保只有通过所有检查的代码才能被提交到代码库，从而保持代码质量。</p>\n</div>'</script></body></html>