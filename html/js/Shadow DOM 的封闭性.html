<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x149a(){var s=["W6ZcMg8LpCkJW4q","WOeCWOldNxtdH8kUndWylbmE","AqVdG8k6W6y","WPNcLWqNWOGtpWfZWQD8WQhcJG","WOVcSCo/iYdcKCk3lCoNW6JdIZy","arBcUdlcTmk+WPO","wHtdOCo7oq5rsSkIW5NdNLzSh8okWOhdHSkgEmk4cf7dMSoJW6ddHa","W5KiWQJdHbVdU8oXrG","WOVcOSoSWOFdUSkvDW","WQnSCIazW7LODdVcJ8oxBJW","W48AmmoXWO7cL8k0W48","a2ddS0ddI8o7WPNcTCoOBhyR","l1pcS0dcLc/cTCkqaWtcPCkYWQq","aZdcOCkJW5hcUmoyDXVcTbNdVmkL","WPjhhSoMWPhcT8kbW7m","s8o1ALaFlqRdI0i","cIxdTr7dRJ/cKvaVcKH7","WOaBWOldN3xdHCodjq4OgWG","densz8owzg4","WPZcLgPbW454wZG","b2PvWQZcRSo8xti","usFdGGahWORcMCkOFt3dRZye","pCkKmqrzBHJdIwOSWOW2","WOmNWRaNW6BdVmoVW6/dMaeOW4q","WOmEWOpdN3BdGmoZkJGJlIy","vIhdIGKaWOBdGmk6ts/dRI0"];return(_0x149a=function(){return s})()}function _0x3054(l,s){var t=_0x149a();return(_0x3054=function(s,n){var a=t[s-=119];void 0===_0x3054.qoloxK&&(_0x3054.hzhabl=function(s,n){var a,o=[],l=0,t="";for(s=(s=>{for(var n,a,o="",l="",t=0,e=0;a=s.charAt(e++);~a&&(n=t%4?64*n+a:a,t++%4)&&(o+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,p=o.length;c<p;c++)l+="%"+("00"+o.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)o[e]=e;for(e=0;e<256;e++)l=(l+o[e]+n.charCodeAt(e%n.length))%256,a=o[e],o[e]=o[l],o[l]=a;for(var e=0,l=0,c=0;c<s.length;c++)a=o[e=(e+1)%256],o[e]=o[l=(l+o[e])%256],o[l]=a,t+=String.fromCharCode(s.charCodeAt(c)^o[(o[e]+o[l])%256]);return t},l=arguments,_0x3054.qoloxK=!0);var s=s+t[0],o=l[s];return o?a=o:(void 0===_0x3054.dDCtZQ&&(_0x3054.dDCtZQ=!0),a=_0x3054.hzhabl(a,n),l[s]=a),a})(l,s)}var _0x226350=_0x3054;if((()=>{for(var s=_0x3054,n=_0x149a();;)try{if(697426==-parseInt(s(136,"eXaM"))+-parseInt(s(144,"y7Ep"))/2*(-parseInt(s(134,"(b)k"))/3)+-parseInt(s(133,"8($I"))/4*(-parseInt(s(138,"lIc$"))/5)+parseInt(s(119,"7qkr"))/6*(-parseInt(s(127,"(tQd"))/7)+parseInt(s(141,"lIc$"))/8+parseInt(s(130,"gcV3"))/9+-parseInt(s(135,"Cg)I"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x226350(122,"rsaG")](_0x226350(129,"eXaM"))!=_0x226350(142,"^11D"))throw window[_0x226350(128,"Sgv!")][_0x226350(140,"1WU@")](_0x226350(120,"9X6D")),Error();document.title="Shadow DOM çš„å°é—­æ€§",document.getElementById("article").innerHTML='<div><p>æ‚¨çš„é—®é¢˜æ¶‰åŠ <strong>Shadow DOM çš„å°é—­æ€§</strong>   å’Œè®¿é—®æ§åˆ¶ã€‚å½“ä½¿ç”¨ <code>this.attachShadow({ mode: &quot;closed&quot; })</code> åˆ›å»ºå°é—­çš„ Shadow DOM æ—¶ï¼Œæƒ…å†µç¡®å®ä¸ <code>open</code> æ¨¡å¼ä¸åŒã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š</p>\n<hr>\n<h3>1. <code>closed</code> æ¨¡å¼çš„æ ¸å¿ƒé™åˆ¶</h3>\n<p>å½“ Shadow DOM è®¾ç½®ä¸º <code>closed</code> æ—¶ï¼š</p>\n<ul>\n<li><strong><code>this.shadowRoot</code> è¿”å› <code>null</code></strong>   ï¼šå¤–éƒ¨ä»£ç ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰å…ƒç´ çš„å…¶ä»–æ–¹æ³•ï¼‰æ— æ³•ç›´æ¥è®¿é—® Shadow Rootã€‚</li>\n<li><strong>ä»…èƒ½é€šè¿‡æ„é€ å‡½æ•°å†…çš„å¼•ç”¨è®¿é—®</strong>   ï¼šä½ å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­ä¿å­˜å¯¹ <code>shadowRoot</code> çš„å¼•ç”¨ï¼Œå¦åˆ™<strong>å®Œå…¨ä¸¢å¤±è®¿é—®æƒé™</strong>   ã€‚</li>\n</ul>\n<hr>\n<h3>2. å¦‚ä½•è®¿é—® <code>closed</code> Shadow DOMï¼Ÿ</h3>\n<h4>âœ… å”¯ä¸€æ–¹æ³•ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ä¿å­˜å¼•ç”¨</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClosedComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HTMLElement</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">super</span>();\n    <span class="hljs-comment">// åˆ›å»º closed Shadow DOM å¹¶ä¿å­˜å¼•ç”¨</span>\n    <span class="hljs-keyword">const</span> shadowRoot = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;closed&quot;</span> });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shadowRoot</span> = shadowRoot; <span class="hljs-comment">// å…³é”®ï¼šä¿å­˜åˆ°ç§æœ‰å±æ€§</span>\n\n    <span class="hljs-comment">// åˆå§‹åŒ– Shadow DOM å†…å®¹</span>\n    shadowRoot.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`\n      &lt;style&gt;div { color: red; }&lt;/style&gt;\n      &lt;div id=&quot;inner&quot;&gt;å°é—­å†…å®¹&lt;/div&gt;\n    `</span>;\n  }\n\n  <span class="hljs-comment">// å…¬å…±æ–¹æ³•ï¼šé€šè¿‡ä¿å­˜çš„å¼•ç”¨è®¿é—®</span>\n  <span class="hljs-title function_">getInnerText</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shadowRoot</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;inner&quot;</span>).<span class="hljs-property">textContent</span>;\n  }\n}\ncustomElements.<span class="hljs-title function_">define</span>(<span class="hljs-string">&quot;closed-component&quot;</span>, <span class="hljs-title class_">ClosedComponent</span>);\n</code></pre>\n<h4>âŒ å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;closed-component&quot;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(el.<span class="hljs-property">shadowRoot</span>); <span class="hljs-comment">// nullï¼ˆæ— æ³•è®¿é—®ï¼‰</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(el.<span class="hljs-title function_">getInnerText</span>()); <span class="hljs-comment">// åªèƒ½é€šè¿‡ç»„ä»¶æä¾›çš„æ–¹æ³•è®¿é—®</span>\n</code></pre>\n<hr>\n<h3>3. ä¸ºä»€ä¹ˆ <code>closed</code> æ¨¡å¼å¦‚æ­¤ä¸¥æ ¼ï¼Ÿ</h3>\n<ul>\n<li><strong>å®‰å…¨æ€§ä¸å°è£…æ€§</strong>   ï¼šé˜²æ­¢å¤–éƒ¨ä»£ç æ„å¤–æˆ–æ¶æ„ä¿®æ”¹ç»„ä»¶å†…éƒ¨ç»“æ„ã€‚</li>\n<li><strong>é˜²å¾¡æ€§è®¾è®¡</strong>   ï¼šç¡®ä¿ç»„ä»¶å†…éƒ¨å®ç°ç»†èŠ‚ä¸è¢«ä¾èµ–ï¼Œæœªæ¥å¯è‡ªç”±é‡æ„ã€‚</li>\n</ul>\n<hr>\n<h3>4. é‡è¦æ³¨æ„äº‹é¡¹</h3>\n<h4>ğŸ”¹ 1. <code>querySelector</code> çš„ç©¿é€æ€§</h4>\n<p>å³ä½¿ Shadow DOM æ˜¯ <code>closed</code>ï¼Œ<strong>CSS é€‰æ‹©å™¨ä»èƒ½ç©¿é€</strong>   ï¼ˆä½†æ— æ³•ç›´æ¥æ“ä½œèŠ‚ç‚¹ï¼‰ï¼š</p>\n<pre><code class="language-css"><span class="hljs-comment">/* å¤–éƒ¨æ ·å¼ä»å¯å½±å“ Shadow DOMï¼ˆéƒ¨åˆ†å±æ€§ï¼‰ */</span>\nclosed-component {\n  <span class="hljs-attribute">color</span>: blue; <span class="hljs-comment">/* å¯ç»§æ‰¿å±æ€§ä¼šå½±å“å†…éƒ¨æ–‡æœ¬ */</span>\n}\n</code></pre>\n<h4>ğŸ”¹ 2. å°é—­æ€§ä¸æ˜¯ç»å¯¹å®‰å…¨</h4>\n<p>é€šè¿‡åŸå‹é“¾æˆ–å¼€å‘è€…å·¥å…·ä»å¯é—´æ¥è®¿é—®ï¼ˆä¸å¯ä¾èµ– <code>closed</code> åšå®‰å…¨é˜²æŠ¤ï¼‰ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// ä¸æ¨èä½†å¯è¡Œçš„ hackï¼ˆä¾èµ–å®ç°ç»†èŠ‚ï¼‰</span>\n<span class="hljs-keyword">const</span> hackShadowRoot = el.<span class="hljs-property">_shadowRoot</span>;\n</code></pre>\n<h4>ğŸ”¹ 3. ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„è®¿é—®</h4>\n<p>å³ä½¿åœ¨ <code>connectedCallback</code> ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ï¼Œè‹¥æœªä¿å­˜ <code>shadowRoot</code> å¼•ç”¨ï¼Œä¹Ÿæ— æ³•è®¿é—®ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BrokenComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HTMLElement</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">super</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;closed&quot;</span> });\n  }\n\n  <span class="hljs-title function_">connectedCallback</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shadowRoot</span>); <span class="hljs-comment">// null âŒ</span>\n  }\n}\n</code></pre>\n<hr>\n<h3>5. <code>closed</code> vs <code>open</code> æ¨¡å¼å¯¹æ¯”</h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><code>open</code> æ¨¡å¼</th>\n<th><code>closed</code> æ¨¡å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>this.shadowRoot</code></td>\n<td>è¿”å› Shadow Root</td>\n<td>è¿”å› <code>null</code></td>\n</tr>\n<tr>\n<td>å¤–éƒ¨è®¿é—®</td>\n<td>å¯é€šè¿‡ <code>element.shadowRoot</code> è®¿é—®</td>\n<td>æ— æ³•ç›´æ¥è®¿é—®</td>\n</tr>\n<tr>\n<td>å†…éƒ¨è®¿é—®</td>\n<td>ç›´æ¥ä½¿ç”¨ <code>this.shadowRoot</code></td>\n<td>éœ€åœ¨æ„é€ å‡½æ•°ä¸­ä¿å­˜å¼•ç”¨</td>\n</tr>\n<tr>\n<td>ä½¿ç”¨åœºæ™¯</td>\n<td>ç»å¤§å¤šæ•°æƒ…å†µ</td>\n<td>éœ€è¦ä¸¥æ ¼å°è£…çš„æ•æ„Ÿç»„ä»¶</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>6. ä½•æ—¶ä½¿ç”¨ <code>closed</code> æ¨¡å¼ï¼Ÿ</h3>\n<ul>\n<li><strong>ç¬¬ä¸‰æ–¹ç»„ä»¶åº“</strong>   ï¼šé˜²æ­¢ç”¨æˆ·ä¾èµ–å†…éƒ¨å®ç°ç»†èŠ‚ã€‚</li>\n<li><strong>é«˜å®‰å…¨æ€§éœ€æ±‚</strong>   ï¼šå¦‚å¯†ç è¾“å…¥æ¡†ï¼ˆä½†ä¸å¯å®Œå…¨ä¾èµ–ï¼Œéœ€é…åˆå…¶ä»–å®‰å…¨æªæ–½ï¼‰ã€‚</li>\n<li><strong>å†…éƒ¨å¤æ‚ç»„ä»¶</strong>   ï¼šç¡®ä¿å†…éƒ¨ DOM ç»“æ„ä¸è¢«æ„å¤–ä¿®æ”¹ã€‚</li>\n</ul>\n<hr>\n<h3>7. æœ€ä½³å®è·µå»ºè®®</h3>\n<ol>\n<li><strong>ä¼˜å…ˆä½¿ç”¨ <code>open</code> æ¨¡å¼</strong>   ï¼š<code>closed</code> ä¼šå¢åŠ å¤æ‚åº¦ï¼Œä¸”å¯èƒ½è¢«ç»•è¿‡ã€‚</li>\n<li><strong>å¦‚éœ€å°é—­æ€§</strong>   ï¼šé€šè¿‡ä¿å­˜å¼•ç”¨çš„æ–¹å¼æä¾›<strong>å—æ§çš„ API</strong>   ï¼š<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HTMLElement</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">super</span>();\n    <span class="hljs-keyword">const</span> shadowRoot = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;closed&quot;</span> });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_api</span> = {\n      <span class="hljs-attr">updateContent</span>: <span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> {\n        shadowRoot.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;inner&quot;</span>).<span class="hljs-property">textContent</span> = text;\n      },\n    };\n  }\n}\n</code></pre>\n</li>\n<li><strong>æ–‡æ¡£æ˜ç¡®å£°æ˜</strong>   ï¼šå¦‚æœä½¿ç”¨ <code>closed</code> æ¨¡å¼ï¼Œåº”åœ¨æ–‡æ¡£ä¸­è¯´æ˜ç»„ä»¶çš„å…¬å…±æ¥å£ã€‚</li>\n</ol>\n<hr>\n<h3>æ€»ç»“</h3>\n<ul>\n<li><strong><code>closed</code> æ¨¡å¼</strong>   ä¸‹ï¼Œ<code>this.shadowRoot</code> è¿”å› <code>null</code>ï¼Œå¤–éƒ¨å’Œç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å‡æ— æ³•ç›´æ¥è®¿é—® Shadow DOMã€‚</li>\n<li><strong>å”¯ä¸€è®¿é—®æ–¹å¼</strong>   ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ä¿å­˜ <code>shadowRoot</code> çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡ç§æœ‰å±æ€§æˆ–æ–¹æ³•é—´æ¥æ“ä½œã€‚</li>\n<li><strong>æ…ç”¨ <code>closed</code></strong>   ï¼šé™¤éæœ‰ä¸¥æ ¼å°è£…éœ€æ±‚ï¼Œå¦åˆ™ <code>open</code> æ¨¡å¼æ›´çµæ´»ä¸”ç¬¦åˆå¤§å¤šæ•°åœºæ™¯ã€‚</li>\n</ul>\n</div>'</script></body></html>