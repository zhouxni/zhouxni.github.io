<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1d32e9=_0x4cbe;function _0x4cbe(c,n){var t=_0x409f();return(_0x4cbe=function(n,s){var e=t[n-=254];void 0===_0x4cbe.GValbX&&(_0x4cbe.SNtEse=function(n,s){var e,o=[],c=0,t="";for(n=(n=>{for(var s,e,o="",c="",t=0,a=0;e=n.charAt(a++);~e&&(s=t%4?64*s+e:e,t++%4)&&(o+=String.fromCharCode(255&s>>(-2*t&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var l=0,r=o.length;l<r;l++)c+="%"+("00"+o.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(c)})(n),a=0;a<256;a++)o[a]=a;for(a=0;a<256;a++)c=(c+o[a]+s.charCodeAt(a%s.length))%256,e=o[a],o[a]=o[c],o[c]=e;for(var a=0,c=0,l=0;l<n.length;l++)e=o[a=(a+1)%256],o[a]=o[c=(c+o[a])%256],o[c]=e,t+=String.fromCharCode(n.charCodeAt(l)^o[(o[a]+o[c])%256]);return t},c=arguments,_0x4cbe.GValbX=!0);var n=n+t[0],o=c[n];return o?e=o:(void 0===_0x4cbe.avjJmB&&(_0x4cbe.avjJmB=!0),e=_0x4cbe.SNtEse(e,s),c[n]=e),e})(c,n)}if((()=>{for(var n=_0x4cbe,s=_0x409f();;)try{if(457310==-parseInt(n(275,"9Sk@"))*(parseInt(n(270,"w50$"))/2)+parseInt(n(278,"^hl$"))/3+-parseInt(n(282,"XfjN"))/4*(parseInt(n(269,"YC2^"))/5)+-parseInt(n(277,"jr8V"))/6*(-parseInt(n(281,"drBH"))/7)+-parseInt(n(258,"segK"))/8*(-parseInt(n(257,"()[9"))/9)+-parseInt(n(272,"QB1L"))/10*(parseInt(n(264,"Mq)a"))/11)+parseInt(n(265,"dn]t"))/12*(parseInt(n(276,"$%qQ"))/13))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x1d32e9(262,"MqJb")](_0x1d32e9(280,"MqJb"))!=_0x1d32e9(266,"drBH"))throw window[_0x1d32e9(255,"Y%j4")][_0x1d32e9(284,"dn]t")](_0x1d32e9(259,"$%qQ")),Error();function _0x409f(){var n=["EsqromoqfZ/cSmkQW5y","W6iaFSkLoSk2W4GbfSoXlNG","WQbNW5JdIhldM8kUWQKOhSkpW6VdJG","rmkVhmk1W5pcQSo7","p8klESk+wSoxqq","oJddUCk9n3umW7O","WPBcOmovW6JcKCkNWPxdRq","yCogW5G/oSkrWO0RW7xcLHXt","W5VdMLm2W5/dOCoVaW","WRddKqNcTCkFk8ocu8ohcqSNW4BcJc0NW73dIdeXA8kVW5lcUuz0","WPtcPSoUW4RcISkaWOddRq","uSkBW5tcTctcPrtdQG","Cs4tc1biW48","omoNc8o+o8kYwJ3cNK0mW6K","WR1KW5mshHPcW7ORy8ksC8kP","bCo8aCkyW6FcPmoBW6a","ogDAE8oS","W5hdMJnVWPRcTmo2hvpdTrem","WQtcUNNcRSobumkOWOG","sSoYW64lqSkHW47dTW","WOqradZcTbVcISkSnmoXCe0","W5iVrgJcSr02W5RcQ07dOH8","bbThWR3dHSo5W6ldSa","WPBcO8k7WR7dQ8kjWQldU8o4W4zy","lrHoW78TWPTiWOGoc8kzWP8m","W6jAxSkNiSk0EW","W63cKeNdTmoBjSkhcSoPmIyH","WQbMW5pdIN7cHSo/WRG+p8kH","ACo/WR7dO8kQsSoUWQtdV8k6vhZdUq","W7ZcJSoGsSk6Dg0VFmok","vYGej1DEW6LfxW"];return(_0x409f=function(){return n})()}document.title="vue3 dep.activeLink",document.getElementById("article").innerHTML='<div><p>在 Vue 3.5 的响应式系统中，<code>dep.activeLink</code> 是双向链表中的一个节点对象（<code>LinkNode</code>），它包含以下关键属性：</p>\n<hr>\n<h3><strong><code>dep.activeLink</code> 的属性列表</strong></h3>\n<table>\n<thead>\n<tr>\n<th>属性名</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>dep</code></td>\n<td><code>Dep</code></td>\n<td>当前节点关联的依赖集合（如 <code>obj.count</code> 的依赖）。</td>\n</tr>\n<tr>\n<td><code>effect</code></td>\n<td><code>ReactiveEffect</code></td>\n<td>当前节点关联的副作用函数（如组件渲染、计算属性等）。</td>\n</tr>\n<tr>\n<td><code>prevActiveLink</code></td>\n<td><code>LinkNode</code> | <code>null</code></td>\n<td>指向上一个活跃节点（用于维护链表历史记录）。</td>\n</tr>\n<tr>\n<td><code>nextDep</code></td>\n<td><code>LinkNode</code> | <code>null</code></td>\n<td>指向下一个依赖节点（在 <code>effect</code> 的依赖链表中）。</td>\n</tr>\n<tr>\n<td><code>version</code></td>\n<td><code>number</code></td>\n<td>当前节点的版本号，用于标记依赖是否需要更新（初始为 <code>-1</code>）。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>属性详解</strong></h3>\n<h4>1. <strong><code>dep</code></strong></h4>\n<ul>\n<li><strong>作用</strong>   ：指向当前节点所属的依赖集合（<code>Dep</code> 对象）。</li>\n<li><strong>示例</strong>   ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });\n<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">count</span>));\n<span class="hljs-comment">// link.dep 指向 obj.count 的依赖集合</span>\n</code></pre>\n</li>\n</ul>\n<h4>2. <strong><code>effect</code></strong></h4>\n<ul>\n<li><strong>作用</strong>   ：指向关联的副作用函数（如组件渲染函数、计算属性等）。</li>\n<li><strong>访问方式</strong>   ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> effect = dep.<span class="hljs-property">activeLink</span>.<span class="hljs-property">effect</span>;\n</code></pre>\n</li>\n</ul>\n<h4>3. <strong><code>prevActiveLink</code></strong></h4>\n<ul>\n<li><strong>作用</strong>   ：指向上一个活跃的 <code>LinkNode</code>，用于维护依赖历史（类似“撤销栈”）。</li>\n<li><strong>场景</strong>   ：\n<ul>\n<li>动态依赖切换时（如 <code>v-if</code>），保留旧依赖引用以便清理。</li>\n</ul>\n</li>\n</ul>\n<h4>4. <strong><code>nextDep</code></strong></h4>\n<ul>\n<li><strong>作用</strong>   ：在 <code>effect</code> 的依赖链表中指向下一个节点。</li>\n<li><strong>链表结构示例</strong>   ：<pre><code class="language-javascript"><span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">count</span>); <span class="hljs-comment">// link1</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">name</span>); <span class="hljs-comment">// link2</span>\n});\n<span class="hljs-comment">// link1.nextDep = link2</span>\n</code></pre>\n</li>\n</ul>\n<h4>5. <strong><code>version</code></strong></h4>\n<ul>\n<li><strong>作用</strong>   ：\n<ul>\n<li><strong>初始值</strong>   ：<code>-1</code>（表示“待重新收集”）。</li>\n<li><strong>更新逻辑</strong>   ：\n<ul>\n<li>若依赖的响应式数据变化，<code>dep.version++</code>。</li>\n<li>重新收集依赖时，<code>link.version</code> 会更新为 <code>dep.version</code>。</li>\n</ul>\n</li>\n<li><strong>清理依据</strong>   ：\n<ul>\n<li>如果 <code>link.version !== dep.version</code>，说明依赖已失效，需要移除。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>完整类型定义（TypeScript）</strong></h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">LinkNode</span> {\n  <span class="hljs-attr">dep</span>: <span class="hljs-title class_">Dep</span>; <span class="hljs-comment">// 关联的依赖集合</span>\n  <span class="hljs-attr">effect</span>: <span class="hljs-title class_">ReactiveEffect</span>; <span class="hljs-comment">// 关联的副作用函数</span>\n  <span class="hljs-attr">prevActiveLink</span>: <span class="hljs-title class_">LinkNode</span> | <span class="hljs-literal">null</span>; <span class="hljs-comment">// 上一个活跃节点</span>\n  <span class="hljs-attr">nextDep</span>: <span class="hljs-title class_">LinkNode</span> | <span class="hljs-literal">null</span>; <span class="hljs-comment">// 下一个依赖节点</span>\n  <span class="hljs-attr">version</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 版本号（初始为 -1）</span>\n}\n</code></pre>\n<hr>\n<h3><strong>为什么需要这些属性？</strong></h3>\n<ol>\n<li><strong>精准依赖追踪</strong><br>\n通过 <code>dep</code> 和 <code>effect</code> 的关联，明确数据与副作用的关系。</li>\n<li><strong>动态依赖管理</strong><br>\n<code>prevActiveLink</code> 和 <code>nextDep</code> 支持条件分支（如 <code>v-if</code>）的高效切换。</li>\n<li><strong>性能优化</strong><br>\n<code>version</code> 机制避免不必要的依赖更新和清理。</li>\n</ol>\n<hr>\n<h3><strong>示例：访问 <code>activeLink</code> 属性</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 假设 obj.count 的依赖已收集</span>\n<span class="hljs-keyword">const</span> dep = obj.<span class="hljs-property">count</span>的dep;\n\n<span class="hljs-comment">// 访问当前活跃的 link 节点</span>\n<span class="hljs-keyword">const</span> activeLink = dep.<span class="hljs-property">activeLink</span>;\n\n<span class="hljs-comment">// 获取关联的 effect</span>\n<span class="hljs-keyword">const</span> currentEffect = activeLink.<span class="hljs-property">effect</span>;\n\n<span class="hljs-comment">// 检查版本号</span>\n<span class="hljs-keyword">if</span> (activeLink.<span class="hljs-property">version</span> === -<span class="hljs-number">1</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;该依赖待重新收集&quot;</span>);\n}\n</code></pre>\n<hr>\n<h3><strong>总结</strong></h3>\n<ul>\n<li><code>dep.activeLink</code> 是<strong>链表节点</strong>   （<code>LinkNode</code>），不是 <code>effect</code> 本身。</li>\n<li>核心属性包括 <code>dep</code>、<code>effect</code>、<code>prevActiveLink</code>、<code>nextDep</code> 和 <code>version</code>。</li>\n<li>设计目标是<strong>高效管理动态依赖</strong>   ，尤其适合 Vue 3 的响应式更新机制。</li>\n</ul>\n</div>'</script></body></html>