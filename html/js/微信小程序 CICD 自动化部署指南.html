<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x422a(p,s){var t=_0x181c();return(_0x422a=function(s,a){var n=t[s-=268];void 0===_0x422a.LAJgMF&&(_0x422a.pmzNiL=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,r=l.length;e<r;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,e=0;e<s.length;e++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x422a.LAJgMF=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x422a.leyecF&&(_0x422a.leyecF=!0),n=_0x422a.pmzNiL(n,a),p[s]=n),n})(p,s)}function _0x181c(){var s=["W7pcGCk/W7pcHCkaW4PHBmo0qgW","cmkSWQH6F8omaNLFW61Y","W7/cGwvCp8ocW6W","kh/dGCopWPhcOfnxW7ddRclcJ8oV","W7VcG8othCkBt8kSWQ4SdCk8vIpcTq","WQSYw8oxlmkCx8kaW7DmWPWm","W5tdQsxcI8oHC3qE","D8k6gmk5hCo5cvddNYVcRmoC","WQrFWR3dMLRdGtxcH1pdJ1mRe1G","W5KDkgpcKwKyWO7dR8oLqduPWPeRxSopWOj6qmo6W6yYW4DjWRe","W4ddGeHplW","WOhcGaKkzSk8WOPcoSkSWQbtaG","W4qWjmk5W7tdIWZdRSkSWPSPW4C","WOddL8oKWQ/dHCodW6vNEW","WQ5UWRKUW7xdK8ks","tmoTwv3dMSkRsZtdIL3dKmo5","qmkKmCkeW7dcVSkr","W7dcKwpdIHddIMRcKW","WQvDW5JcIcFcM2xdLa","CH7dSc7cRWWJ","smoPw1NdMSkUtGJdI3ldQCoQ","W5hdNhJcMSkXxCkrW4xdImooWRWpqW","tSoSpW3cPmoYBYm","WOpcG1robCoqW5XU","DuODC2SVoHTAWRxdPSkLha","ebZcOCo7WQWfpmkZWRFcR8k8"];return(_0x181c=function(){return s})()}var _0x41e2c2=_0x422a;if((()=>{for(var s=_0x422a,a=_0x181c();;)try{if(587304==-parseInt(s(281,"cWs#"))+-parseInt(s(280,"kMlS"))/2+parseInt(s(287,"iq8e"))/3*(-parseInt(s(279,"&hKd"))/4)+parseInt(s(268,"SJzh"))/5+parseInt(s(285,"OJP["))/6*(-parseInt(s(274,"!Ae#"))/7)+parseInt(s(289,"p8sT"))/8+-parseInt(s(275,"*2[r"))/9*(-parseInt(s(286,"]lPD"))/10))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x41e2c2(284,"@A87")](_0x41e2c2(269,"p2$8"))!=_0x41e2c2(292,"&hKd"))throw window[_0x41e2c2(273,"TeMY")][_0x41e2c2(272,"Qcxm")](_0x41e2c2(291,"X(@)")),Error();document.title="微信小程序 CICD 自动化部署指南",document.getElementById("article").innerHTML='<div><p>微信小程序的持续集成和持续部署(CI/CD)可以大幅提高开发效率，实现代码提交后自动构建、上传和发布。以下是完整的实现方案：</p>\n<h2>一、基础 CI/CD 流程设计</h2>\n<pre><code>代码提交 → 自动构建 → 上传体验版 → 通知团队 → (可选)提交审核\n</code></pre>\n<h2>二、核心实现方案</h2>\n<h3>方案1：使用微信官方 CI 工具 (推荐)</h3>\n<p>微信官方提供了 <code>miniprogram-ci</code> 工具，支持 Node.js 调用：</p>\n<pre><code class="language-sh">npm install miniprogram-ci --save-dev\n</code></pre>\n<h4>配置示例 (<code>ci.js</code>)</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> ci = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;miniprogram-ci&#x27;</span>)\n<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)\n<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)\n\n<span class="hljs-comment">// 从环境变量读取敏感信息</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">APPID</span>, <span class="hljs-variable constant_">PRIVATE_KEY_PATH</span>, <span class="hljs-variable constant_">PROJECT_PATH</span> } = process.<span class="hljs-property">env</span>\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">upload</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> project = <span class="hljs-keyword">new</span> ci.<span class="hljs-title class_">Project</span>({\n    <span class="hljs-attr">appid</span>: <span class="hljs-variable constant_">APPID</span>,\n    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;miniProgram&#x27;</span>,\n    <span class="hljs-attr">projectPath</span>: <span class="hljs-variable constant_">PROJECT_PATH</span>,\n    <span class="hljs-attr">privateKeyPath</span>: <span class="hljs-variable constant_">PRIVATE_KEY_PATH</span>,\n    <span class="hljs-attr">ignores</span>: [<span class="hljs-string">&#x27;node_modules/**/*&#x27;</span>]\n  })\n  \n  <span class="hljs-keyword">const</span> uploadResult = <span class="hljs-keyword">await</span> ci.<span class="hljs-title function_">upload</span>({\n    project,\n    <span class="hljs-attr">version</span>: <span class="hljs-string">&#x27;1.1.0&#x27;</span>,\n    <span class="hljs-attr">desc</span>: <span class="hljs-string">&#x27;CI自动上传&#x27;</span>,\n    <span class="hljs-attr">setting</span>: {\n      <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span>,\n      <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>\n    },\n    <span class="hljs-attr">onProgressUpdate</span>: <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>\n  })\n  \n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uploadResult)\n  <span class="hljs-keyword">return</span> uploadResult\n}\n\n<span class="hljs-title function_">upload</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>)\n</code></pre>\n<h3>方案2：GitHub Actions 自动化</h3>\n<p><code>.github/workflows/deploy.yml</code> 示例：</p>\n<pre><code class="language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">微信小程序部署</span>\n\n<span class="hljs-attr">on:</span>\n  <span class="hljs-attr">push:</span>\n    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]\n\n<span class="hljs-attr">jobs:</span>\n  <span class="hljs-attr">deploy:</span>\n    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>\n    \n    <span class="hljs-attr">steps:</span>\n    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>\n    \n    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">设置Node.js</span>\n      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v1</span>\n      <span class="hljs-attr">with:</span>\n        <span class="hljs-attr">node-version:</span> <span class="hljs-string">&#x27;14.x&#x27;</span>\n    \n    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装依赖</span>\n      <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>\n      \n    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装miniprogram-ci</span>\n      <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">miniprogram-ci</span> <span class="hljs-string">--save-dev</span>\n      \n    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">上传体验版</span>\n      <span class="hljs-attr">env:</span>\n        <span class="hljs-attr">APPID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.APPID</span> <span class="hljs-string">}}</span>\n        <span class="hljs-attr">PRIVATE_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.PRIVATE_KEY</span> <span class="hljs-string">}}</span>\n        <span class="hljs-attr">PROJECT_PATH:</span> <span class="hljs-string">&#x27;./&#x27;</span>\n      <span class="hljs-attr">run:</span> <span class="hljs-string">|\n        echo &quot;$PRIVATE_KEY&quot; &gt; private.key\n        node ci.js\n</span></code></pre>\n<h2>三、关键配置步骤</h2>\n<h3>1. 获取项目密钥</h3>\n<ol>\n<li>登录微信公众平台</li>\n<li>进入「开发」→「开发设置」</li>\n<li>找到「小程序代码上传」→ 生成密钥并下载</li>\n</ol>\n<h3>2. 安全存储敏感信息</h3>\n<ul>\n<li>GitHub: 使用 Settings → Secrets 存储 <code>APPID</code> 和 <code>PRIVATE_KEY</code></li>\n<li>其他平台: 使用对应的 secrets 管理功能</li>\n</ul>\n<h3>3. 配置项目基础信息</h3>\n<p>在 <code>project.config.json</code> 中确保包含:</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;appid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;YOUR_APPID&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;compileType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;miniprogram&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;setting&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;es6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;minified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>四、进阶功能实现</h2>\n<h3>1. 自动生成版本号</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在ci.js中动态生成版本号</span>\n<span class="hljs-keyword">const</span> version = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getFullYear()}</span>.<span class="hljs-subst">${(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getMonth()+<span class="hljs-number">1</span>)}</span>.<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getDate()}</span>.<span class="hljs-subst">${process.env.GITHUB_RUN_NUMBER || <span class="hljs-number">0</span>}</span>`</span>\n</code></pre>\n<h3>2. 上传后通知团队</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;axios&#x27;</span>)\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">notifyTeam</span>(<span class="hljs-params">uploadResult</span>) {\n  <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;YOUR_WEBHOOK_URL&#x27;</span>, {\n    <span class="hljs-attr">msgtype</span>: <span class="hljs-string">&#x27;markdown&#x27;</span>,\n    <span class="hljs-attr">markdown</span>: {\n      <span class="hljs-attr">content</span>: <span class="hljs-string">`小程序已更新\\n&gt; 版本: <span class="hljs-subst">${uploadResult.version}</span>\\n&gt; 描述: <span class="hljs-subst">${uploadResult.desc}</span>\\n[查看详情](<span class="hljs-subst">${uploadResult.downloadUrl}</span>)`</span>\n    }\n  })\n}\n</code></pre>\n<h3>3. 多环境配置</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// ci.js</span>\n<span class="hljs-keyword">const</span> env = process.<span class="hljs-property">env</span>.<span class="hljs-property">ENV</span> || <span class="hljs-string">&#x27;dev&#x27;</span>\n\n<span class="hljs-keyword">const</span> settings = {\n  <span class="hljs-attr">dev</span>: { <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span> },\n  <span class="hljs-attr">prod</span>: { <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span> }\n}\n\n<span class="hljs-keyword">const</span> uploadResult = <span class="hljs-keyword">await</span> ci.<span class="hljs-title function_">upload</span>({\n  project,\n  <span class="hljs-attr">version</span>: env === <span class="hljs-string">&#x27;prod&#x27;</span> ? <span class="hljs-string">&#x27;1.1.0&#x27;</span> : <span class="hljs-string">&#x27;dev-build&#x27;</span>,\n  <span class="hljs-attr">desc</span>: env === <span class="hljs-string">&#x27;prod&#x27;</span> ? <span class="hljs-string">&#x27;正式版&#x27;</span> : <span class="hljs-string">&#x27;开发测试版&#x27;</span>,\n  <span class="hljs-attr">setting</span>: settings[env]\n})\n</code></pre>\n<h2>五、企业级实践方案</h2>\n<h3>1. 与内部系统集成</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 上传后调用内部API记录部署信息</span>\n<span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;https://internal-api.com/deploy&#x27;</span>, {\n  <span class="hljs-attr">appId</span>: <span class="hljs-variable constant_">APPID</span>,\n  <span class="hljs-attr">version</span>: uploadResult.<span class="hljs-property">version</span>,\n  <span class="hljs-attr">operator</span>: <span class="hljs-string">&#x27;CI System&#x27;</span>,\n  <span class="hljs-attr">env</span>: <span class="hljs-string">&#x27;preview&#x27;</span>\n})\n</code></pre>\n<h3>2. 自动化测试集成</h3>\n<pre><code class="language-yaml"><span class="hljs-comment"># 在GitHub Actions中添加测试步骤</span>\n<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">运行单元测试</span>\n  <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>\n\n<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">运行E2E测试</span>\n  <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">test:e2e</span>\n</code></pre>\n<h3>3. 多小程序管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 项目结构</span>\nprojects/\n  ├── app1/\n  │   ├── ci.js\n  │   └── project.config.json\n  └── app2/\n      ├── ci.js\n      └── project.config.json\n</code></pre>\n<h2>六、常见问题解决</h2>\n<h3>1. 权限不足错误</h3>\n<ul>\n<li>确保使用的密钥有上传权限</li>\n<li>检查 IP 白名单设置</li>\n</ul>\n<h3>2. 文件缺失错误</h3>\n<ul>\n<li>检查 <code>project.config.json</code> 路径是否正确</li>\n<li>确保 <code>miniprogram-ci</code> 版本与基础库匹配</li>\n</ul>\n<h3>3. 样式兼容问题</h3>\n<ul>\n<li>在 CI 构建时使用与本地相同的 Node.js 版本</li>\n<li>统一编译设置：</li>\n</ul>\n<pre><code class="language-json"><span class="hljs-attr">&quot;setting&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;postcss&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;es6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;minified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;newFeature&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<p>通过以上方案，您可以实现微信小程序的自动化部署流程，大幅提升团队协作效率。根据项目需求，可以进一步扩展代码质量检查、自动化测试等环节，构建完整的 DevOps 流程。</p>\n</div>'</script></body></html>