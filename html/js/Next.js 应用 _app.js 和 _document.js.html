<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x40a5(p,s){var t=_0x4ebe();return(_0x40a5=function(s,a){var n=t[s-=494];void 0===_0x40a5.ZXKdvQ&&(_0x40a5.fjdbZl=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,o=l.length;c<o;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x40a5.ZXKdvQ=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x40a5.VrHdZu&&(_0x40a5.VrHdZu=!0),n=_0x40a5.fjdbZl(n,a),p[s]=n),n})(p,s)}var _0x2b5640=_0x40a5;function _0x4ebe(){var s=["owmKW4pdSXLHW5xdLrtcOSoLlW","AeW9pSopadyfWO4TWO7dTq","W68YWRvOaSoUW7FcS8kX","wCkpWR1SW6JdTXXC","W5P6WOBcQmoHWQNcUW1HWPrcW5RdKG","yMRcQZiYWRJcJ1xdTmo8W7ddO8kba8k1mmotCmoHWRtcNNdcGSkZWRnL","kfvLeSoQyIaBWRS","wWe2eCouvcKMWQu","d8kPW7WDpu/cG8osWOFdHmkCWRXP","W51OD8kadmkHWOCY","WR87W5pcGvJdRNu","Ba3cKCkWW7/dJGe","F8o0lYulif/dI3rzp8kZnG","oqpdSCkXW47dP8o9F8k/W7GU","t8kXWQVcQsutWPRdIa","WQ3cLmkRpmkHwSo+W589gmkOqmkp","W53cLebOgxNdKSkMori8WQrv","W7/cIJJcVSk0WPvevHmQW4eRjG","W77dJgFdUSotW6yg","fSk7W5Sfb8kAW5rVWQu9WQFcMq","vCoiWPzbW7FdTcm","fmkZW5bzxCoEW7fiWOq","ECkYEwjQvHG","W7NcGd/cS8k1WPnbwZi7W6atfa","DKJdJSoeiW/dSY1UW4vzWQC","WP8rW6FdIbG","W75NWPRdMWhcVhyvi8ojW7uD","W7ldHSoRqSoJc8kQ","sCkYW7/cRcygWQZdOfW","mhr7dSk3ACkhDCoGtNy"];return(_0x4ebe=function(){return s})()}if((()=>{for(var s=_0x40a5,a=_0x4ebe();;)try{if(568874==+parseInt(s(510,"HUHj"))+parseInt(s(506,"zaB5"))/2*(-parseInt(s(501,")!K)"))/3)+-parseInt(s(513,"3HeA"))/4*(parseInt(s(512,"40fC"))/5)+-parseInt(s(515,"Scx5"))/6*(-parseInt(s(505,"!kV2"))/7)+parseInt(s(504,"VI94"))/8*(-parseInt(s(522,"IibW"))/9)+parseInt(s(518,"logK"))/10+parseInt(s(517,"VI94"))/11*(parseInt(s(500,"NNbX"))/12))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x2b5640(511,"[ip7")](_0x2b5640(520,"[^bv"))!=_0x2b5640(509,"[3ji"))throw window[_0x2b5640(523,"Do$6")][_0x2b5640(494,"HUHj")](_0x2b5640(519,"zK)f")),Error();document.title="Next.js 应用 _app.js 和 _document.js",document.getElementById("article").innerHTML='<div><p>在 Next.js 应用里，<code>_app.js</code> 和 <code>_document.js</code> 是两个特殊的文件，它们在应用的渲染流程中起着关键作用。下面为你详细介绍它们的作用以及使用场景。</p>\n<h3>一、<code>_app.js</code> 的作用</h3>\n<p><code>_app.js</code> 是 Next.js 应用的根组件，所有页面都会继承它。其主要作用如下：</p>\n<h4>1. 全局状态和上下文管理</h4>\n<p>你可以在 <code>_app.js</code> 中初始化全局状态，像 Redux store、Context API 等都能在这里初始化。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _app.js</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Provider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-redux&quot;</span>;\n<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../store&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params">{ Component, pageProps }</span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...pageProps</span>} /&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>\n  );\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyApp</span>;\n</code></pre>\n<h4>2. 全局样式和 CSS 模块</h4>\n<p>可以在 <code>_app.js</code> 中引入全局 CSS 文件或者 CSS 模块。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _app.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;../styles/globals.css&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params">{ Component, pageProps }</span>) {\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...pageProps</span>} /&gt;</span></span>;\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyApp</span>;\n</code></pre>\n<h4>3. 路由事件监听</h4>\n<p>借助 <code>next/router</code>，可以监听路由变化事件，比如路由开始切换、切换完成等。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _app.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/router&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params">{ Component, pageProps }</span>) {\n  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleStart</span> = (<span class="hljs-params">url</span>) =&gt; {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Loading: <span class="hljs-subst">${url}</span>`</span>);\n    };\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleComplete</span> = (<span class="hljs-params">url</span>) =&gt; {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Finished loading: <span class="hljs-subst">${url}</span>`</span>);\n    };\n\n    <span class="hljs-title class_">Router</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;routeChangeStart&quot;</span>, handleStart);\n    <span class="hljs-title class_">Router</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;routeChangeComplete&quot;</span>, handleComplete);\n\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-title class_">Router</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">&quot;routeChangeStart&quot;</span>, handleStart);\n      <span class="hljs-title class_">Router</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">&quot;routeChangeComplete&quot;</span>, handleComplete);\n    };\n  }, []);\n\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...pageProps</span>} /&gt;</span></span>;\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyApp</span>;\n</code></pre>\n<h4>4. 页面过渡动画</h4>\n<p>能够在页面切换时添加过渡动画。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _app.js</span>\n<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AnimatePresence</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;framer-motion&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params">{ Component, pageProps, router }</span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AnimatePresence</span> <span class="hljs-attr">exitBeforeEnter</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...pageProps</span>} <span class="hljs-attr">key</span>=<span class="hljs-string">{router.route}</span> /&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">AnimatePresence</span>&gt;</span></span>\n  );\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyApp</span>;\n</code></pre>\n<h3>二、<code>_document.js</code> 的作用</h3>\n<p><code>_document.js</code> 用于自定义应用的 HTML 结构，它会在服务器端渲染时执行，客户端不会对其进行水合操作。主要作用如下：</p>\n<h4>1. 自定义 HTML 标签</h4>\n<p>可以自定义 <code>&lt;html&gt;</code> 和 <code>&lt;body&gt;</code> 标签。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _document.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Document</span>, { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span>, <span class="hljs-title class_">Main</span>, <span class="hljs-title class_">NextScript</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/document&quot;</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span> /&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;custom-body&quot;</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span>\n    );\n  }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyDocument</span>;\n</code></pre>\n<h4>2. 添加自定义元标签</h4>\n<p>能够在 <code>&lt;head&gt;</code> 标签中添加自定义的元标签，如 favicon、SEO 标签等。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _document.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Document</span>, { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span>, <span class="hljs-title class_">Main</span>, <span class="hljs-title class_">NextScript</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/document&quot;</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;shortcut icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/favicon.ico&quot;</span> /&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;#123456&quot;</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span>\n    );\n  }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyDocument</span>;\n</code></pre>\n<h4>3. 自定义脚本和样式</h4>\n<p>可以添加全局脚本或者内联样式。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// _document.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Document</span>, { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span>, <span class="hljs-title class_">Main</span>, <span class="hljs-title class_">NextScript</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/document&quot;</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.example.com/script.js&quot;</span> /&gt;</span><span class="language-handlebars"><span class="language-xml">\n          <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">jsx</span> <span class="hljs-attr">global</span>&gt;</span><span class="language-css">{`\n            <span class="hljs-selector-tag">body</span> {\n              <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;\n              <span class="hljs-attribute">font-family</span>:\n                -apple-system, BlinkMacSystemFont, <span class="hljs-string">&quot;Segoe UI&quot;</span>, Roboto;\n            }\n          `}</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>\n          <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span></span></span>\n    );\n  }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyDocument</span>;\n</code></pre>\n<h3>三、两者的主要区别</h3>\n<table>\n<thead>\n<tr>\n<th><strong>特性</strong></th>\n<th><strong>_app.js</strong></th>\n<th><strong>_document.js</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>执行位置</strong></td>\n<td>服务端和客户端</td>\n<td>仅服务端</td>\n</tr>\n<tr>\n<td><strong>是否参与水合</strong></td>\n<td>是</td>\n<td>否</td>\n</tr>\n<tr>\n<td><strong>主要用途</strong></td>\n<td>管理全局状态、样式和路由事件</td>\n<td>自定义 HTML 结构和元数据</td>\n</tr>\n<tr>\n<td><strong>常用场景</strong></td>\n<td>Redux 初始化、全局 CSS 引入</td>\n<td>添加自定义 HTML 标签、元标签</td>\n</tr>\n<tr>\n<td><strong>渲染时机</strong></td>\n<td>在页面组件之前</td>\n<td>在应用初始化之前</td>\n</tr>\n</tbody>\n</table>\n<h3>四、注意事项</h3>\n<ol>\n<li><strong>避免在 <code>_document.js</code> 中使用 React 组件</strong>   ：<code>_document.js</code> 运行在服务器端，不能使用需要浏览器环境的 React 特性，如 <code>useState</code>、<code>useEffect</code> 等。</li>\n<li><strong>谨慎修改 <code>_document.js</code></strong>   ：不正确的修改可能会破坏 Next.js 的默认行为，比如影响自动静态优化。</li>\n<li><strong>优先使用 <code>_app.js</code></strong>   ：大多数情况下，应用的自定义需求都可以在 <code>_app.js</code> 中实现，应尽量避免修改 <code>_document.js</code>。</li>\n</ol>\n<p>通过合理使用 <code>_app.js</code> 和 <code>_document.js</code>，你可以更好地控制 Next.js 应用的全局行为和 HTML 结构，从而优化应用的性能和用户体验。</p>\n</div>'</script></body></html>