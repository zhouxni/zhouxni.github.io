<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x55ffd9=_0xb0b1;function _0xb0b1(l,s){var p=_0x2f5a();return(_0xb0b1=function(s,a){var n=p[s-=158];void 0===_0xb0b1.rsZlCJ&&(_0xb0b1.HDCQmV=function(s,a){var n,t=[],l=0,p="";for(s=(s=>{for(var a,n,t="",l="",p=0,e=0;n=s.charAt(e++);~n&&(a=p%4?64*a+n:n,p++%4)&&(t+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var o=0,c=t.length;o<c;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)l=(l+t[e]+a.charCodeAt(e%a.length))%256,n=t[e],t[e]=t[l],t[l]=n;for(var e=0,l=0,o=0;o<s.length;o++)n=t[e=(e+1)%256],t[e]=t[l=(l+t[e])%256],t[l]=n,p+=String.fromCharCode(s.charCodeAt(o)^t[(t[e]+t[l])%256]);return p},l=arguments,_0xb0b1.rsZlCJ=!0);var s=s+p[0],t=l[s];return t?n=t:(void 0===_0xb0b1.iakWgh&&(_0xb0b1.iakWgh=!0),n=_0xb0b1.HDCQmV(n,a),l[s]=n),n})(l,s)}function _0x2f5a(){var s=["FJfPW4hdOvtdRCouxGdcH2dcLq","WRXafbqYo2GOdgGAW6jf","W5VcNmkwW5hdVXpdKW","WQK4mgxdUblcHSojdhldICk/W5y","W7urWRVcSg9ld8oZ","f0XCCSo7w8oP","W7JdNv55wmoLWRm","WOJcRGe9omkqoGfoW4ZdM8kmWOq","W67dRMyZWQRcTxNdMeDIWQpcOL4","W5dcJ2L7bbG5WOhdRG0iwa","tmkmW4movKVdMW","W67cU8orobDGkKLsa8km","W4ORWQSqzx/dOa","sCk9jSkHhXbpo390WQRdHCkf","WQ55wHJcGMJdOq","hSkxtmoeoSkYWRVcVITycvnH","WQC9vCoWdmoGW5yaW4pcImk5","WPNdJmoQu1lcPKRcR8ozWOuroKm","WRtdJCokxCo9lCo+zmkje8oRW7fX","W6tdOM4ZWQ7cSbZdTe57WOdcOG","W5GDWRVcTgHrk8o4kG","erddL0HdW7FcKW","WOf5aCkCgSocW7tdVtSFuSkaWOO","s8ocBCo7x14c","yvPfiCk+","emoXymoOxXjuvNj0WOldOSkFgrKGpc9LW6NdPeJdSbhdVJG"];return(_0x2f5a=function(){return s})()}if((()=>{for(var s=_0xb0b1,a=_0x2f5a();;)try{if(700695==-parseInt(s(167,"nuu6"))*(parseInt(s(181,"g$aw"))/2)+-parseInt(s(159,"5s3Y"))/3*(-parseInt(s(158,"IDpW"))/4)+-parseInt(s(173,"HSS["))/5*(-parseInt(s(176,"BLAu"))/6)+parseInt(s(177,"By@D"))/7+parseInt(s(175,"5s3Y"))/8+parseInt(s(170,"g$aw"))/9+-parseInt(s(162,"(1zt"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x55ffd9(164,"!2VN")](_0x55ffd9(182,"dtl["))!=_0x55ffd9(160,"6%0k"))throw window[_0x55ffd9(166,"dtl[")][_0x55ffd9(172,")knI")](_0x55ffd9(161,"5s3Y")),Error();document.title="React 19 useFormStatus 和 useFormState 钩子函数",document.getElementById("article").innerHTML='<div><p><code>useFormStatus</code> 和 <code>useFormState</code> 是 React 19 新增的表单处理钩子，专门用于简化表单提交状态管理和表单数据处理，尤其与 <strong>Server Actions</strong>   配合时能大幅减少模板代码。</p>\n<h3>1. <code>useFormStatus</code>：跟踪表单提交状态</h3>\n<p>用于获取当前表单的提交状态（如是否正在加载、提交的动作等），通常在表单内部的子组件中使用（如提交按钮）。</p>\n<h4>核心功能：</h4>\n<ul>\n<li>提供表单提交的 <code>pending</code> 状态（布尔值）</li>\n<li>提供当前提交的 <code>action</code> 函数引用</li>\n<li>提供表单提交的 <code>method</code>（如 <code>POST</code>）</li>\n</ul>\n<h4>使用场景：</h4>\n<ul>\n<li>禁用提交按钮防止重复提交</li>\n<li>显示加载状态（如&quot;提交中...&quot;）</li>\n<li>根据提交状态修改 UI</li>\n</ul>\n<h4>示例：</h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useFormStatus } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;\n\n<span class="hljs-comment">// 子组件：提交按钮</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">SubmitButton</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-comment">// 获取当前表单的提交状态</span>\n  <span class="hljs-keyword">const</span> { pending } = <span class="hljs-title function_">useFormStatus</span>();\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{pending}</span>&gt;</span>\n      {pending ? &quot;提交中...&quot; : &quot;提交&quot;}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>\n  );\n}\n\n<span class="hljs-comment">// 父组件：表单</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyForm</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-comment">// 定义服务器操作（提交表单）</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">formData</span>) {\n    <span class="hljs-string">&quot;use server&quot;</span>;\n    <span class="hljs-comment">// 处理表单数据（如保存到数据库）</span>\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveData</span>(formData);\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span>\n      {/* 使用状态感知的提交按钮 */}\n      <span class="hljs-tag">&lt;<span class="hljs-name">SubmitButton</span> /&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h4>注意：</h4>\n<ul>\n<li><code>useFormStatus</code> 必须在表单内部的子组件中使用（通过上下文获取状态）</li>\n<li>无需手动传递状态，React 会自动关联最近的表单上下文</li>\n</ul>\n<h3>2. <code>useFormState</code>：管理表单状态与提交结果</h3>\n<p>用于跟踪表单的状态（如输入值、提交结果、错误信息），并将表单操作与状态管理绑定，支持同步或异步处理（如 Server Actions）。</p>\n<h4>核心功能：</h4>\n<ul>\n<li>维护表单的状态（如提交后的成功/错误信息）</li>\n<li>自动处理表单提交的触发与状态更新</li>\n<li>支持重置表单状态</li>\n</ul>\n<h4>语法：</h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> [state, formAction] = <span class="hljs-title function_">useFormState</span>(action, initialState);\n</code></pre>\n<ul>\n<li><code>action</code>：处理表单提交的函数（可异步，支持 Server Actions）</li>\n<li><code>initialState</code>：初始状态（如 <code>{ message: \'\', error: null }</code>）</li>\n<li>返回值：<code>[当前状态, 绑定后的表单动作]</code></li>\n</ul>\n<h4>使用场景：</h4>\n<ul>\n<li>显示提交成功/失败的提示信息</li>\n<li>处理表单验证错误</li>\n<li>基于提交结果更新 UI</li>\n</ul>\n<h4>示例：</h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useFormState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;\n\n<span class="hljs-comment">// 处理表单提交的函数（可在服务器组件中定义）</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">prevState, formData</span>) {\n  <span class="hljs-string">&quot;use server&quot;</span>;\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveUser</span>(formData);\n    <span class="hljs-keyword">return</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;保存成功！&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> };\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-keyword">return</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;保存失败，请重试&quot;</span> };\n  }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserForm</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-comment">// 初始化状态，并绑定表单动作</span>\n  <span class="hljs-keyword">const</span> [state, formAction] = <span class="hljs-title function_">useFormState</span>(updateUser, {\n    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;&quot;</span>,\n    <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,\n  });\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{formAction}</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>保存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n\n      {/* 显示提交结果 */}\n      {state.message &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> &quot;<span class="hljs-attr">green</span>&quot; }}&gt;</span>{state.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}\n      {state.error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> &quot;<span class="hljs-attr">red</span>&quot; }}&gt;</span>{state.error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h4>注意：</h4>\n<ul>\n<li><code>action</code> 函数的第一个参数是 <strong>上一次的状态</strong>   ，第二个参数是 <code>formData</code></li>\n<li>状态会在提交后自动更新，无需手动调用 <code>setState</code></li>\n<li>支持与客户端函数配合使用（不仅限于 Server Actions）</li>\n</ul>\n<h3>两者的区别与配合</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th><code>useFormStatus</code></th>\n<th><code>useFormState</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>核心作用</td>\n<td>跟踪提交状态（加载中）</td>\n<td>管理表单数据与提交结果</td>\n</tr>\n<tr>\n<td>依赖上下文</td>\n<td>必须在表单内部使用</td>\n<td>可在表单外使用（通过 <code>formAction</code> 关联）</td>\n</tr>\n<tr>\n<td>典型场景</td>\n<td>提交按钮状态控制</td>\n<td>显示成功/错误信息</td>\n</tr>\n</tbody>\n</table>\n<p><strong>配合使用示例</strong>   ：<br>\n用 <code>useFormState</code> 管理提交结果，用 <code>useFormStatus</code> 控制按钮状态，实现完整的表单交互逻辑。</p>\n<p>这两个钩子大幅简化了表单处理流程，尤其在结合 Server Actions 时，无需手动处理 API 调用、加载状态和错误处理，让表单逻辑更清晰。</p>\n</div>'</script></body></html>