<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x4eba(){var s=["W6ZdMWeeWRLPW7pcGZhdUWRdHa","juxcNc/cLdhcJeRcQG","W5JdR8oLjSkjW6vlna","W4hcSCo+etRcOmoriSoPvCk9rG","WQ5vx03dTmoslX8","uSobxLfcDgHdaLmBW5JcNq","A8oxWPtdQSkPW5BdI8o/kv/cM8o6","W5BdVLVdL0RcU2S","te4FW7P8uXNcUtbQ","tcTHWOnjvHS","zrldLaNcKt7cOq","WQXtlZpcJmkgvXaYW6hcTKBcLa","xCoIiCkgp8o5zeOsW7r8","W6/dMG8dW6aRW6dcSGVdKG","a37dJG12irNcNHebW5NdMW","swBdUHrSW7ldVCkuga","W5ldV8oqW6xcQmoMWOK6W7qz","WPpdLWVcOmod","W7VdHCo5W41lDfmO","WRdcIvlcJrDUA8oykSol","wCkFf8o4zui6DheyWObA","nxT/WOrtW6bCdg8","W6RcGHuPj8oawJ9nW6ddQq","WRNdRIRdScL7wq","W5NdR1VdRK3dPcLgsSkDnCoknGhdMxnXWPtdRIldTCotF8kOW7HZ","c0pcPSkWW70xWQFcI2hcVW","mCoVw8o4ibidnWur","CSk9y8kUWR7dN0vDW7/dTq","W5dcKKRdP8kkmsNcKelcNCk0cq","wmkEhSo6nqKdwLaI"];return(_0x4eba=function(){return s})()}var _0x4904dc=_0x21b7;function _0x21b7(l,s){var p=_0x4eba();return(_0x21b7=function(s,n){var a=p[s-=229];void 0===_0x21b7.mhtUkO&&(_0x21b7.FOftIk=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,c=0;a=s.charAt(c++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,r=t.length;e<r;e++)l+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)l=(l+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[l],t[l]=a;for(var c=0,l=0,e=0;e<s.length;e++)a=t[c=(c+1)%256],t[c]=t[l=(l+t[c])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(e)^t[(t[c]+t[l])%256]);return p},l=arguments,_0x21b7.mhtUkO=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x21b7.mmAWiB&&(_0x21b7.mmAWiB=!0),a=_0x21b7.FOftIk(a,n),l[s]=a),a})(l,s)}if((()=>{for(var s=_0x21b7,n=_0x4eba();;)try{if(299288==-parseInt(s(252,"i(1U"))*(-parseInt(s(242,"l6UP"))/2)+-parseInt(s(256,"z6HT"))/3+parseInt(s(239,"a*u6"))/4*(parseInt(s(236,"JUN1"))/5)+parseInt(s(245,"[oT("))/6*(-parseInt(s(246,"fbP%"))/7)+parseInt(s(229,"TzNA"))/8*(parseInt(s(248,"[^W7"))/9)+-parseInt(s(231,"S]$R"))/10+-parseInt(s(253,"8F]i"))/11*(-parseInt(s(241,"nZK2"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x4904dc(257,"eP4#")](_0x4904dc(235,"[UEI"))!=_0x4904dc(237,"[^W7"))throw window[_0x4904dc(238,"(#f7")][_0x4904dc(230,"NBL4")](_0x4904dc(244,"eP4#")),Error();document.title="@vue--test-utils 完整方法",document.getElementById("article").innerHTML='<div><p>以下是针对 <code>@vue/test-utils</code> 的完整方法详解，涵盖核心 API、实用技巧和最佳实践，适用于 Vue 2 和 Vue 3 的组件测试：</p>\n<hr>\n<h3>一、核心渲染方法</h3>\n<h4>1. <strong>挂载组件</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vue/test-utils&#x27;</span>;\n\n<span class="hljs-comment">// 基础挂载</span>\n<span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">Component</span>, {\n  <span class="hljs-attr">propsData</span>: { <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;Hello&#x27;</span> },  <span class="hljs-comment">// Vue 2 的 props</span>\n  <span class="hljs-attr">props</span>: { <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;Hello&#x27;</span> },      <span class="hljs-comment">// Vue 3 的 props</span>\n  <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;&lt;div&gt;slot内容&lt;/div&gt;&#x27;</span> },\n  <span class="hljs-attr">global</span>: {\n    <span class="hljs-attr">plugins</span>: [router, store],   <span class="hljs-comment">// 挂载Vue插件</span>\n    <span class="hljs-attr">mocks</span>: { <span class="hljs-attr">$t</span>: <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> key } <span class="hljs-comment">// 模拟全局注入</span>\n  }\n});\n</code></pre>\n<h4>2. <strong>浅渲染（Shallow Mount）</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { shallowMount } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vue/test-utils&#x27;</span>;\n<span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">shallowMount</span>(<span class="hljs-title class_">Component</span>); <span class="hljs-comment">// 忽略子组件渲染</span>\n</code></pre>\n<hr>\n<h3>二、Wrapper 实例方法</h3>\n<h4>1. <strong>DOM 查询</strong></h4>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>示例</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>find()</code></td>\n<td><code>wrapper.find(\'.btn\')</code></td>\n<td>查找第一个匹配元素</td>\n</tr>\n<tr>\n<td><code>findAll()</code></td>\n<td><code>wrapper.findAll(\'li\')</code></td>\n<td>返回匹配元素的数组</td>\n</tr>\n<tr>\n<td><code>get()</code></td>\n<td><code>wrapper.get(\'#submit\')</code></td>\n<td>找不到元素时抛出错误</td>\n</tr>\n<tr>\n<td><code>findComponent()</code></td>\n<td><code>wrapper.findComponent(ChildComponent)</code></td>\n<td>查找子组件实例</td>\n</tr>\n</tbody>\n</table>\n<h4>2. <strong>属性与状态</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 获取 props</span>\nwrapper.<span class="hljs-title function_">props</span>(<span class="hljs-string">&#x27;msg&#x27;</span>); \n\n<span class="hljs-comment">// 获取 data</span>\nwrapper.<span class="hljs-property">vm</span>.<span class="hljs-property">someData</span>; \n\n<span class="hljs-comment">// 获取计算属性</span>\nwrapper.<span class="hljs-property">vm</span>.<span class="hljs-property">computedProp</span>;\n</code></pre>\n<h4>3. <strong>交互模拟</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 触发事件</span>\nwrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;button&#x27;</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">&#x27;click&#x27;</span>); \n\n<span class="hljs-comment">// 设置输入值</span>\nwrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;input&#x27;</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&#x27;new value&#x27;</span>);\n\n<span class="hljs-comment">// 提交表单</span>\nwrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;form&#x27;</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">&#x27;submit.prevent&#x27;</span>);\n</code></pre>\n<h4>4. <strong>生命周期控制</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">vm</span>.$nextTick(); <span class="hljs-comment">// 等待 Vue 更新</span>\n<span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">setProps</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;Updated&#x27;</span> }); <span class="hljs-comment">// 异步更新 props</span>\nwrapper.<span class="hljs-title function_">unmount</span>(); <span class="hljs-comment">// 手动卸载组件</span>\n</code></pre>\n<hr>\n<h3>三、断言与验证</h3>\n<h4>1. <strong>DOM 结构验证</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.alert&#x27;</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">html</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">&#x27;Hello World&#x27;</span>);\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;button&#x27;</span>).<span class="hljs-title function_">attributes</span>(<span class="hljs-string">&#x27;disabled&#x27;</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;disabled&#x27;</span>);\n</code></pre>\n<h4>2. <strong>事件触发验证</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 验证事件是否触发</span>\nwrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;button&#x27;</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">&#x27;click&#x27;</span>);\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">&#x27;submit&#x27;</span>)).<span class="hljs-title function_">toBeTruthy</span>();\n\n<span class="hljs-comment">// 验证事件负载</span>\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">&#x27;change&#x27;</span>)[<span class="hljs-number">0</span>]).<span class="hljs-title function_">toEqual</span>([<span class="hljs-string">&#x27;new value&#x27;</span>]);\n</code></pre>\n<h4>3. <strong>Vue 特定断言</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 验证 $emit</span>\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">&#x27;custom-event&#x27;</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">42</span>);\n\n<span class="hljs-comment">// 验证插槽内容</span>\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.slot-content&#x27;</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;slot内容&#x27;</span>);\n</code></pre>\n<hr>\n<h3>四、高级配置</h3>\n<h4>1. <strong>全局注入</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">Component</span>, {\n  <span class="hljs-attr">global</span>: {\n    <span class="hljs-attr">plugins</span>: [store, router],\n    <span class="hljs-attr">stubs</span>: [<span class="hljs-string">&#x27;FontAwesomeIcon&#x27;</span>], <span class="hljs-comment">// 替换子组件为存根</span>\n    <span class="hljs-attr">mocks</span>: { <span class="hljs-attr">$route</span>: mockRoute }, <span class="hljs-comment">// 模拟全局对象</span>\n    <span class="hljs-attr">provide</span>: { <span class="hljs-attr">theme</span>: <span class="hljs-string">&#x27;dark&#x27;</span> }   <span class="hljs-comment">// 提供依赖注入</span>\n  }\n});\n</code></pre>\n<h4>2. <strong>异步组件测试</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;异步加载组件&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; {\n  <span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComp</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./AsyncComp.vue&#x27;</span>));\n  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">AsyncComp</span>);\n  <span class="hljs-keyword">await</span> <span class="hljs-title function_">flushPromises</span>(); <span class="hljs-comment">// 等待异步解析完成</span>\n  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.loaded-content&#x27;</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);\n});\n</code></pre>\n<h4>3. <strong>路由测试</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>;\n\n<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({\n  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),\n  <span class="hljs-attr">routes</span>: [{ <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> }]\n});\n\n<span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">Component</span>, {\n  <span class="hljs-attr">global</span>: { <span class="hljs-attr">plugins</span>: [router] }\n});\n\n<span class="hljs-keyword">await</span> router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/&#x27;</span>);\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.home-page&#x27;</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);\n</code></pre>\n<hr>\n<h3>五、Vue 2 与 Vue 3 差异</h3>\n<table>\n<thead>\n<tr>\n<th>功能</th>\n<th>Vue 2</th>\n<th>Vue 3</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Props 传递</td>\n<td><code>propsData</code></td>\n<td><code>props</code></td>\n</tr>\n<tr>\n<td>全局注入</td>\n<td><code>mocks: { $store }</code></td>\n<td><code>global: { plugins: [store] }</code></td>\n</tr>\n<tr>\n<td>事件验证</td>\n<td><code>emitted()</code></td>\n<td>相同，但需注意 Composition API 的 <code>emit</code></td>\n</tr>\n<tr>\n<td>生命周期</td>\n<td><code>destroy()</code></td>\n<td><code>unmount()</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>六、最佳实践</h3>\n<ol>\n<li><strong>测试重点</strong>  ：<pre><code class="language-markdown"><span class="hljs-bullet">-</span> 用户交互行为（点击/输入）\n<span class="hljs-bullet">-</span> Props 变化引起的 UI 更新\n<span class="hljs-bullet">-</span> 事件触发与传递\n<span class="hljs-bullet">-</span> 条件渲染逻辑\n</code></pre>\n</li>\n<li><strong>避免反模式</strong>  ：<pre><code class="language-javascript"><span class="hljs-comment">// ❌ 不要测试实现细节</span>\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-property">vm</span>.<span class="hljs-property">internalState</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);\n\n<span class="hljs-comment">// ✅ 应该测试公开行为</span>\n<span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.result&#x27;</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;1&#x27;</span>);\n</code></pre>\n</li>\n<li><strong>性能优化</strong>  ：<pre><code class="language-javascript"><span class="hljs-comment">// 使用 shallowMount 减少不必要的子组件渲染</span>\n<span class="hljs-comment">// 对大型列表使用 `findAll` 时添加 `{ timeout: 100 }` 限制</span>\n</code></pre>\n</li>\n</ol>\n<hr>\n<h3>七、完整示例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vue/test-utils&#x27;</span>;\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Counter.vue&#x27;</span>;\n\n<span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;计数器交互测试&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; {\n  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">Counter</span>, {\n    <span class="hljs-attr">props</span>: { <span class="hljs-attr">initialCount</span>: <span class="hljs-number">5</span> }\n  });\n\n  <span class="hljs-comment">// 验证初始状态</span>\n  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.count&#x27;</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;5&#x27;</span>);\n\n  <span class="hljs-comment">// 模拟增加计数</span>\n  <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.increment-btn&#x27;</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">&#x27;click&#x27;</span>);\n  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.count&#x27;</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;6&#x27;</span>);\n  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">&#x27;change&#x27;</span>)[<span class="hljs-number">0</span>]).<span class="hljs-title function_">toEqual</span>([<span class="hljs-number">6</span>]);\n\n  <span class="hljs-comment">// 测试 prop 更新</span>\n  <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">setProps</span>({ <span class="hljs-attr">initialCount</span>: <span class="hljs-number">10</span> });\n  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">&#x27;.count&#x27;</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">&#x27;10&#x27;</span>);\n});\n</code></pre>\n<hr>\n<p>通过掌握这些方法，您可以高效地编写 Vue 组件测试。建议结合 <a href="https://vue-test-utils.vuejs.org/" target="_blank">Vue Test Utils 官方文档</a> 和实际项目需求灵活运用。</p>\n</div>'</script></body></html>