<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xc603(l,s){var p=_0x3a62();return(_0xc603=function(s,a){var n=p[s-=135];void 0===_0xc603.YrgVrn&&(_0xc603.BBxRFx=function(s,a){var n,t=[],l=0,p="";for(s=(s=>{for(var a,n,t="",l="",p=0,c=0;n=s.charAt(c++);~n&&(a=p%4?64*a+n:n,p++%4)&&(t+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var o=0,e=t.length;o<e;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)l=(l+t[c]+a.charCodeAt(c%a.length))%256,n=t[c],t[c]=t[l],t[l]=n;for(var c=0,l=0,o=0;o<s.length;o++)n=t[c=(c+1)%256],t[c]=t[l=(l+t[c])%256],t[l]=n,p+=String.fromCharCode(s.charCodeAt(o)^t[(t[c]+t[l])%256]);return p},l=arguments,_0xc603.YrgVrn=!0);var s=s+p[0],t=l[s];return t?n=t:(void 0===_0xc603.xFnteF&&(_0xc603.xFnteF=!0),n=_0xc603.BBxRFx(n,a),l[s]=n),n})(l,s)}var _0x2abb4b=_0xc603;function _0x3a62(){var s=["W4ugW45qymkpEdj0WOipW6u","W5ncb8oQWO3dPfBcHSoGW6RcRq8","d2VcO8oaW7PMWOPfWOG","jYpcJgTaFSkjFtBdGCoatmoklG","cCo9DHa+Eq0mWQW5W53cKCoC","tZBdOCo2W6PrWPK","WQaFlsOWWPDiWRi","kSktWPbXW7DezJ5OW5dcSSkJ","W5FdOW08wdRcK8kxtmkJAKJcSCke","Bmo1WPVdIJTgBa","cCo5c0LGmLeK","d2tcOSkRWRGgW4LTWQGDDCkpea","WPXhWOiqk8kemMPcWPShW4BcQCkSW4ici8o4cSktWRfudtWqWRq","D1ePW4ddN8oIWQdcLSk+jCoChG","dfVcTutcMCkDWRxdN0nYiCoy","nCo2W4tdNLKIfqNdUCkTbG","WQHQlLFdJSo8WPOMW4u","WOSKfCklB1BdTda","cSo/Fbi+DaO4WOKKW6FcGSom","W4ugW4qmp8ouuZDW","ndvMWRTMjWJdVsa","W4aeW4rqAmkgwWDAWQyBW7i","a8oZW4tdRMGvWQ52","emoctSkAya","W41gW7JcTG/dOSoztCouEKy","WQmuxmk/W4BcPNJcLmov","WPC3ftrPiCozgG","cSojW6i+mmkrq8oAxmo/uNFcVG"];return(_0x3a62=function(){return s})()}if((()=>{for(var s=_0xc603,a=_0x3a62();;)try{if(565587==-parseInt(s(153,"iVsM"))+-parseInt(s(145,"m)@a"))/2+parseInt(s(156,"9XM6"))/3*(parseInt(s(152,"msBK"))/4)+parseInt(s(150,"N6v&"))/5+-parseInt(s(162,"p!5@"))/6*(parseInt(s(161,"(gf8"))/7)+-parseInt(s(136,"N6v&"))/8*(parseInt(s(154,"&(TR"))/9)+-parseInt(s(135,"f)If"))/10*(-parseInt(s(149,"T9vh"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x2abb4b(141,"5d0%")](_0x2abb4b(157,"(gf8"))!=_0x2abb4b(155,"Fp%8"))throw window[_0x2abb4b(138,"vTl)")][_0x2abb4b(137,"p!5@")](_0x2abb4b(144,"iVsM")),Error();document.title="React Jotai 详解",document.getElementById("article").innerHTML='<div><p>Jotai 是一个基于原子化状态管理的 JavaScript 库，深受 Recoil 启发，但设计上更加简洁轻量。它采用&quot;原子&quot;(atom)作为状态管理的基本单位，非常适合 React 应用，尤其在处理复杂状态依赖关系时表现出色。</p>\n<h3>核心概念</h3>\n<ol>\n<li><strong>原子(Atom)</strong>   : 状态的基本单位，可被读取和写入</li>\n<li><strong>派生原子(Derived Atom)</strong>   : 基于其他原子计算得出的原子</li>\n<li><strong>原子依赖</strong>   : 自动追踪原子之间的依赖关系</li>\n</ol>\n<h3>主要 API 介绍</h3>\n<h4>1. <code>atom</code> - 创建状态原子</h4>\n<p>基础用法，创建可读写的原子：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { atom } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai&quot;</span>;\n\n<span class="hljs-comment">// 创建一个简单原子</span>\n<span class="hljs-keyword">const</span> countAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-number">0</span>);\n\n<span class="hljs-comment">// 创建带有读写函数的原子</span>\n<span class="hljs-keyword">const</span> userAtom = <span class="hljs-title function_">atom</span>(\n  <span class="hljs-function">(<span class="hljs-params">get</span>) =&gt;</span> <span class="hljs-title function_">get</span>(userDataAtom), <span class="hljs-comment">// 读取函数</span>\n  <span class="hljs-function">(<span class="hljs-params">get, set, newName</span>) =&gt;</span> {\n    <span class="hljs-comment">// 写入函数</span>\n    <span class="hljs-keyword">const</span> current = <span class="hljs-title function_">get</span>(userDataAtom);\n    <span class="hljs-title function_">set</span>(userDataAtom, { ...current, <span class="hljs-attr">name</span>: newName });\n  },\n);\n</code></pre>\n<h4>2. <code>useAtom</code> - 在组件中使用原子</h4>\n<p>React 钩子，用于在组件中读取和更新原子状态：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useAtom } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-comment">// [当前值, 更新函数]</span>\n  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useAtom</span>(countAtom);\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount((c) =&gt; c + 1)}&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h4>3. <code>useAtomValue</code> - 仅读取原子值</h4>\n<p>当只需要读取原子值而不需要更新时使用：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useAtomValue } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">CountDisplay</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useAtomValue</span>(countAtom);\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Current count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;\n}\n</code></pre>\n<h4>4. <code>useSetAtom</code> - 仅获取更新函数</h4>\n<p>当只需要更新原子值而不需要读取时使用：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useSetAtom } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">IncrementButton</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> setCount = <span class="hljs-title function_">useSetAtom</span>(countAtom);\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount((c) =&gt; c + 1)}&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;\n}\n</code></pre>\n<h4>5. 派生原子 - 基于其他原子计算</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 基础原子</span>\n<span class="hljs-keyword">const</span> priceAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-number">10</span>);\n<span class="hljs-keyword">const</span> quantityAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-number">2</span>);\n\n<span class="hljs-comment">// 派生原子（只读）</span>\n<span class="hljs-keyword">const</span> totalAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-function">(<span class="hljs-params">get</span>) =&gt;</span> <span class="hljs-title function_">get</span>(priceAtom) * <span class="hljs-title function_">get</span>(quantityAtom));\n\n<span class="hljs-comment">// 使用派生原子</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">TotalDisplay</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> total = <span class="hljs-title function_">useAtomValue</span>(totalAtom);\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Total: ${total}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;\n}\n</code></pre>\n<h4>6. <code>atomFamily</code> - 创建动态原子集合</h4>\n<p>用于管理同类但多个实例的状态：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { atomFamily } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai/utils&quot;</span>;\n\n<span class="hljs-comment">// 创建原子家族</span>\n<span class="hljs-keyword">const</span> todoAtomFamily = <span class="hljs-title function_">atomFamily</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span>\n  <span class="hljs-title function_">atom</span>({\n    id,\n    <span class="hljs-attr">text</span>: <span class="hljs-string">`Todo <span class="hljs-subst">${id}</span>`</span>,\n    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,\n  }),\n);\n\n<span class="hljs-comment">// 使用</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoItem</span>(<span class="hljs-params">{ id }</span>) {\n  <span class="hljs-keyword">const</span> [todo, setTodo] = <span class="hljs-title function_">useAtom</span>(<span class="hljs-title function_">todoAtomFamily</span>(id));\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>\n        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>\n        <span class="hljs-attr">checked</span>=<span class="hljs-string">{todo.completed}</span>\n        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setTodo({ ...todo, completed: e.target.checked })}\n      /&gt;\n      {todo.text}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h4>7. 异步原子 - 处理异步数据</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 异步读取</span>\n<span class="hljs-keyword">const</span> userAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-title function_">async</span> (get) =&gt; {\n  <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">get</span>(userIdAtom);\n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);\n  <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();\n});\n\n<span class="hljs-comment">// 异步写入</span>\n<span class="hljs-keyword">const</span> fetchUserAtom = <span class="hljs-title function_">atom</span>(\n  <span class="hljs-literal">null</span>, <span class="hljs-comment">// 不关心读取值</span>\n  <span class="hljs-title function_">async</span> (get, set, userId) =&gt; {\n    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);\n    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();\n    <span class="hljs-title function_">set</span>(userDataAtom, user);\n  },\n);\n</code></pre>\n<h4>8. <code>selectAtom</code> - 选择原子的部分状态</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { selectAtom } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jotai/utils&quot;</span>;\n\n<span class="hljs-keyword">const</span> userAtom = <span class="hljs-title function_">atom</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">address</span>: { <span class="hljs-attr">city</span>: <span class="hljs-string">&quot;NY&quot;</span> } });\n\n<span class="hljs-comment">// 只选择需要的部分</span>\n<span class="hljs-keyword">const</span> userNameAtom = <span class="hljs-title function_">selectAtom</span>(userAtom, <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> user.<span class="hljs-property">name</span>);\n\n<span class="hljs-comment">// 组件中使用</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserName</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">useAtomValue</span>(userNameAtom);\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Name: {name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;\n}\n</code></pre>\n<h3>Jotai 的优势</h3>\n<ol>\n<li><strong>原子化设计</strong>   ：状态被拆分为最小单位，只更新依赖的组件</li>\n<li><strong>减少重渲染</strong>   ：精确控制更新范围，提高性能</li>\n<li><strong>简洁 API</strong>   ：学习成本低，易于上手</li>\n<li><strong>良好的 TypeScript 支持</strong>   ：类型安全</li>\n<li><strong>与 React 生态兼容</strong>   ：可与 React 并发模式良好协作</li>\n</ol>\n<p>Jotai 特别适合中等复杂度的应用，既能保持状态管理的清晰性，又不会引入过多的样板代码。对于需要精细控制状态更新的场景，Jotai 是一个非常优秀的选择。</p>\n</div>'</script></body></html>