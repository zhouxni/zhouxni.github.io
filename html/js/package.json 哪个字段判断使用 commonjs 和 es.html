<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x5c8a19=_0x563d;function _0x563d(a,n){var c=_0xf1ac();return(_0x563d=function(n,s){var o=c[n-=109];void 0===_0x563d.NUvzsa&&(_0x563d.BdxMJh=function(n,s){var o,t=[],a=0,c="";for(n=(n=>{for(var s,o,t="",a="",c=0,l=0;o=n.charAt(l++);~o&&(s=c%4?64*s+o:o,c++%4)&&(t+=String.fromCharCode(255&s>>(-2*c&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var p=0,e=t.length;p<e;p++)a+="%"+("00"+t.charCodeAt(p).toString(16)).slice(-2);return decodeURIComponent(a)})(n),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)a=(a+t[l]+s.charCodeAt(l%s.length))%256,o=t[l],t[l]=t[a],t[a]=o;for(var l=0,a=0,p=0;p<n.length;p++)o=t[l=(l+1)%256],t[l]=t[a=(a+t[l])%256],t[a]=o,c+=String.fromCharCode(n.charCodeAt(p)^t[(t[l]+t[a])%256]);return c},a=arguments,_0x563d.NUvzsa=!0);var n=n+c[0],t=a[n];return t?o=t:(void 0===_0x563d.ZuVTHq&&(_0x563d.ZuVTHq=!0),o=_0x563d.BdxMJh(o,s),a[n]=o),o})(a,n)}function _0xf1ac(){var n=["W4JcQCo8Ch3dHGXsbCovnq","W7pdKqhdNCoBW5e0WOpcHa","W7WzW43cOSojDSkbW4xcUCkJWPi","W6yjW5fnWP0","tuRdLeG+dvzW","pCodW6igWQSQxCkpW5G","W4GXWRGQASkqcWLes1PB","W4GvuCorbubODW","WQZcJtuZW6VcTSkUoq","W7hcIu3dVCofW6up","xSk2WOH2WPiMFgtdVt3cU8oVCG","ENtdTCkLcmo0oCka","W4FcO8o+WOZdPL4JWPabW759z8oO","fa7dK1OjEIKwWQNdV8k0sYFcSMBdVMfMBvS6BaKovSka","WPiRD17dLqBcLsfxxgZdOW","CYtcUM7dVcldHSo3ECk9W5a","WOyxW4SAWPZdU8kmFHddUclcPwu","WQFcGCoKkCkTWRFcS8oijSoxegNcLq","WQxcG0ddUSo6W4qA","WPubWPZcIZxdV0RdQ1S","dH/dL0yBi2m","W5lcRv/dU1RdT1lcOmovWP0bWRC","F3xdQHfzqr4","wc7dU8kSymojnh/cGSkTW4jlWOO","CLzRfalcQg3dLCkpW54","WQblWPenW51LWOxdSSoSW7BcUa","BmouW4tcVmoLhmoiFG","WOGLW4FdQ8kZf8kuW6LrbSonz0e","W44qamkRoMTWAmomW5S","tmkhWQeYvSklmgdcRGJdGmo8"];return(_0xf1ac=function(){return n})()}if((()=>{for(var n=_0x563d,s=_0xf1ac();;)try{if(828044==-parseInt(n(136,"wgD["))*(-parseInt(n(119,"z(2q"))/2)+parseInt(n(133,"aM7v"))/3*(parseInt(n(132,"3Ymc"))/4)+-parseInt(n(128,"IFu5"))/5+parseInt(n(138,"83l&"))/6+parseInt(n(116,"A@V]"))/7*(parseInt(n(125,"05SB"))/8)+-parseInt(n(127,"R2%["))/9*(-parseInt(n(115,"Ncg("))/10)+parseInt(n(109,"L!!c"))/11*(-parseInt(n(111,"#y]z"))/12))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x5c8a19(129,"LmGB")](_0x5c8a19(130,"*a!L"))!=_0x5c8a19(114,"wgD["))throw window[_0x5c8a19(137,"x2qD")][_0x5c8a19(131,"Ncg(")](_0x5c8a19(124,"Ncg(")),Error();document.title="package.json 哪个字段判断使用 commonjs 和 es",document.getElementById("article").innerHTML='<div><p>在 <code>package.json</code> 中，<strong>模块系统（CommonJS 或 ES Modules）的判定</strong>  主要通过以下字段控制：</p>\n<hr>\n<h3><strong>1. 核心字段</strong></h3>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>用途</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>&quot;type&quot;</code></strong></td>\n<td>定义 <code>.js</code> 文件的默认模块类型：<br/> <code>&quot;commonjs&quot;</code>（默认）或 <code>&quot;module&quot;</code>（ESM）</td>\n<td><code>&quot;commonjs&quot;</code></td>\n</tr>\n<tr>\n<td><strong><code>&quot;main&quot;</code></strong></td>\n<td>项目入口文件（CommonJS 优先），如 <code>index.js</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td><strong><code>&quot;module&quot;</code></strong></td>\n<td>ESM 格式的入口文件（如 <code>index.mjs</code>），供支持 ESM 的工具（如 Webpack）使用</td>\n<td>-</td>\n</tr>\n<tr>\n<td><strong><code>&quot;exports&quot;</code></strong></td>\n<td>更灵活的入口定义，可区分 CommonJS 和 ESM（Node.js 12+ 支持）</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>2. 文件扩展名规则</strong></h3>\n<ul>\n<li><strong><code>.js</code></strong><br>\n行为由 <code>&quot;type&quot;</code> 字段决定：\n<ul>\n<li><code>&quot;type&quot;: &quot;commonjs&quot;</code> → 解析为 CommonJS</li>\n<li><code>&quot;type&quot;: &quot;module&quot;</code> → 解析为 ESM</li>\n</ul>\n</li>\n<li><strong><code>.cjs</code></strong><br>\n强制视为 CommonJS（忽略 <code>&quot;type&quot;</code>）。</li>\n<li><strong><code>.mjs</code></strong><br>\n强制视为 ESM（忽略 <code>&quot;type&quot;</code>）。</li>\n</ul>\n<hr>\n<h3><strong>3. 示例配置</strong></h3>\n<h4><strong>场景 1：纯 CommonJS 项目</strong></h4>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;commonjs&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.js&quot;</span>  <span class="hljs-comment">// CommonJS 入口</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h4><strong>场景 2：纯 ESM 项目</strong></h4>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.js&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// ESM 入口（因为 &quot;type&quot;: &quot;module&quot;）</span>\n  <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.mjs&quot;</span> <span class="hljs-comment">// 可选，供打包工具使用</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h4><strong>场景 3：混合模式（同时支持 CJS 和 ESM）</strong></h4>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;commonjs&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.cjs&quot;</span><span class="hljs-punctuation">,</span>       <span class="hljs-comment">// CommonJS 入口</span>\n  <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.mjs&quot;</span><span class="hljs-punctuation">,</span>     <span class="hljs-comment">// ESM 入口</span>\n  <span class="hljs-attr">&quot;exports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.cjs&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// CJS 导入时使用</span>\n    <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.mjs&quot;</span>    <span class="hljs-comment">// ESM 导入时使用</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h3><strong>4. 关键注意事项</strong></h3>\n<ol>\n<li><strong><code>&quot;type&quot;</code> 的优先级低于文件扩展名</strong>  ：\n<ul>\n<li><code>.mjs</code> 或 <code>.cjs</code> 会覆盖 <code>&quot;type&quot;</code> 的设置。</li>\n</ul>\n</li>\n<li><strong>工具链兼容性</strong>  ：\n<ul>\n<li>旧版 Node.js（&lt; 12）可能不支持 <code>&quot;exports&quot;</code> 或 <code>&quot;type&quot;: &quot;module&quot;</code>。</li>\n<li>Webpack/Rollup 等打包工具会优先读取 <code>&quot;module&quot;</code> 字段（如果存在）。</li>\n</ul>\n</li>\n<li><strong>ESM 与 CommonJS 的互操作</strong>  ：\n<ul>\n<li>在 ESM 项目中（<code>&quot;type&quot;: &quot;module&quot;</code>），可通过 <code>import</code> 加载 CommonJS 模块，但部分高级特性（如动态 <code>require()</code>）不可用。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>5. 如何验证模块类型？</strong></h3>\n<ul>\n<li>在项目中创建测试文件：<pre><code class="language-javascript"><span class="hljs-comment">// test.js</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>); <span class="hljs-comment">// 如果输出 URL，则为 ESM；否则为 CJS</span>\n</code></pre>\n</li>\n<li>运行命令：<pre><code class="language-sh">node test.js\n</code></pre>\n</li>\n</ul>\n<hr>\n<p>通过合理配置这些字段，可以明确控制项目的模块系统行为。更多细节参考 <a href="https://nodejs.org/api/packages.html#packages_determining_module_system" target="_blank">Node.js 官方文档</a>。</p>\n</div>'</script></body></html>