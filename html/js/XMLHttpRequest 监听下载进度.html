<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x30610d=_0x4f82;function _0x4f82(p,s){var t=_0x4b25();return(_0x4f82=function(s,n){var a=t[s-=223];void 0===_0x4f82.kjaBFT&&(_0x4f82.tciyAi=function(s,n){var a,l=[],p=0,t="";for(s=(s=>{for(var n,a,l="",p="",t=0,o=0;a=s.charAt(o++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,c=l.length;e<c;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)p=(p+l[o]+n.charCodeAt(o%n.length))%256,a=l[o],l[o]=l[p],l[p]=a;for(var o=0,p=0,e=0;e<s.length;e++)a=l[o=(o+1)%256],l[o]=l[p=(p+l[o])%256],l[p]=a,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[o]+l[p])%256]);return t},p=arguments,_0x4f82.kjaBFT=!0);var s=s+t[0],l=p[s];return l?a=l:(void 0===_0x4f82.ymyGCb&&(_0x4f82.ymyGCb=!0),a=_0x4f82.tciyAi(a,n),p[s]=a),a})(p,s)}function _0x4b25(){var s=["w8kHtSoLDuzynCky","WR4rdsfciLNcT3xcMmozwW","lmkhqSolD1rW","g8orW5ldPmo5amoVx1RcNfxcI8ku","W5ddJCkRWOOWeSo/WOBcVCoSmWa","z8k8WR5cqwZdIWaBWQpdJfG","W4NcPJbHWOldUbpcNa","o1pcOSoLu28ZFIjaW5VcGaZdICo3fmkQibhdLCkkW5nfW5JcKvO","BmowWP5PnCoqWRCvW6GfW7Gj","rtJcGwJdOmoSWQ4MW4D5xSoDBW","t8oakWuF","yCoEWQDJW6NdO2XHWODnjLy","WRxcKSomfCkCW5u4c8o4W7FcQM4","W5pdGSkTWOSXeCoYWRVcR8oNhYi","wSklWRH9fxjCWP/dN2xcHvFdRG","pmorWQFdSgVcTx5bWQ7cVmkFxa","yCk1W6hdKSo2W4JdHIxdKCkwWR/dVa","B8ozWPvInmotWPqeW7acW4iD","nelcOSoCvdbX","rK/dMbdcP8k1W7u","WRKubYXklIZcMgpcJ8olwSov","C8kSjYb8jSkC"];return(_0x4b25=function(){return s})()}if((()=>{for(var s=_0x4f82,n=_0x4b25();;)try{if(184796==-parseInt(s(237,"j40u"))+-parseInt(s(236,"6&Ka"))/2+-parseInt(s(238,"X4hW"))/3+-parseInt(s(240,"Lkp3"))/4+parseInt(s(228,"B6!R"))/5*(parseInt(s(227,"Yw$p"))/6)+-parseInt(s(230,"fzAU"))/7+parseInt(s(239,"UJ&^"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x30610d(243,"]mLa")](_0x30610d(225,"Yw$p"))!=_0x30610d(235,"n^At"))throw window[_0x30610d(231,"ED$W")][_0x30610d(224,"&Fzq")](_0x30610d(232,"]mLa")),Error();document.title="XMLHttpRequest 监听下载进度",document.getElementById("article").innerHTML='<div><p>是的，XMLHttpRequest（XHR）可以通过其 <code>onprogress</code> 事件实现下载进度条功能，这是一种常用的前端下载进度展示方案。</p>\n<p><code>onprogress</code> 事件会在数据传输过程中周期性触发，通过它可以获取已加载字节数和总字节数，从而计算下载进度。</p>\n<p>以下是一个完整的带进度条的下载实现示例：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// HTML结构（需要提前准备）</span>\n<span class="hljs-comment">// &lt;div class=&quot;progress-container&quot;&gt;</span>\n<span class="hljs-comment">//   &lt;div id=&quot;progress-bar&quot; style=&quot;width: 0%; height: 5px; background: #4CAF50;&quot;&gt;&lt;/div&gt;</span>\n<span class="hljs-comment">//   &lt;div id=&quot;progress-text&quot;&gt;0%&lt;/div&gt;</span>\n<span class="hljs-comment">// &lt;/div&gt;</span>\n<span class="hljs-comment">// &lt;button onclick=&quot;downloadFile()&quot;&gt;下载文件&lt;/button&gt;</span>\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">downloadFile</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> url = <span class="hljs-string">&quot;https://example.com/large-file.zip&quot;</span>; <span class="hljs-comment">// 替换为实际文件URL</span>\n  <span class="hljs-keyword">const</span> filename = <span class="hljs-string">&quot;large-file.zip&quot;</span>; <span class="hljs-comment">// 保存的文件名</span>\n  <span class="hljs-comment">/*\n axios({\n      url: fileUrl,\n      method: &#x27;GET&#x27;,\n      responseType: &#x27;blob&#x27;, // 重要：指定响应类型为blob\n      onDownloadProgress:(progressEvent)=&gt;{}\n      })\n */</span>\n  <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();\n  xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url, <span class="hljs-literal">true</span>);\n  xhr.<span class="hljs-property">responseType</span> = <span class="hljs-string">&quot;blob&quot;</span>; <span class="hljs-comment">// 以二进制blob形式接收响应</span>\n\n  <span class="hljs-comment">// 下载进度处理</span>\n  xhr.<span class="hljs-property">onprogress</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {\n    <span class="hljs-comment">// 检查是否可以计算进度</span>\n    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">lengthComputable</span>) {\n      <span class="hljs-comment">// 计算进度百分比</span>\n      <span class="hljs-keyword">const</span> percentComplete = (e.<span class="hljs-property">loaded</span> / e.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;\n\n      <span class="hljs-comment">// 更新进度条UI</span>\n      <span class="hljs-keyword">const</span> progressBar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;progress-bar&quot;</span>);\n      <span class="hljs-keyword">const</span> progressText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;progress-text&quot;</span>);\n\n      progressBar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = percentComplete + <span class="hljs-string">&quot;%&quot;</span>;\n      progressText.<span class="hljs-property">textContent</span> = percentComplete.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">1</span>) + <span class="hljs-string">&quot;%&quot;</span>;\n    }\n  };\n\n  <span class="hljs-comment">// 下载完成处理</span>\n  xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {\n      <span class="hljs-comment">// 创建blob对象</span>\n      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([xhr.<span class="hljs-property">response</span>], {\n        <span class="hljs-attr">type</span>: xhr.<span class="hljs-title function_">getResponseHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>),\n      });\n\n      <span class="hljs-comment">// 创建下载链接并触发下载</span>\n      <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);\n      <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;a&quot;</span>);\n      a.<span class="hljs-property">href</span> = url;\n      a.<span class="hljs-property">download</span> = filename;\n      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);\n      a.<span class="hljs-title function_">click</span>();\n\n      <span class="hljs-comment">// 清理资源</span>\n      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(a);\n        <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);\n      }, <span class="hljs-number">0</span>);\n\n      <span class="hljs-comment">// 重置进度条为完成状态</span>\n      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;progress-bar&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&quot;100%&quot;</span>;\n      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;progress-text&quot;</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">&quot;100%&quot;</span>;\n    }\n  };\n\n  <span class="hljs-comment">// 错误处理</span>\n  xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;下载失败，请检查网络连接&quot;</span>);\n  };\n\n  <span class="hljs-comment">// 取消处理</span>\n  xhr.<span class="hljs-property">onabort</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;下载已取消&quot;</span>);\n  };\n\n  <span class="hljs-comment">// 开始下载</span>\n  xhr.<span class="hljs-title function_">send</span>();\n}\n</code></pre>\n<h3>实现原理说明：</h3>\n<ol>\n<li>\n<p><strong>进度事件触发</strong>   ：<code>onprogress</code> 事件在数据传输过程中会多次触发，通常每接收一部分数据就会触发一次</p>\n</li>\n<li>\n<p><strong>进度计算依据</strong>   ：</p>\n<ul>\n<li><code>e.loaded</code>：已下载的字节数</li>\n<li><code>e.total</code>：文件总字节数（需要服务器返回正确的 <code>Content-Length</code> 头）</li>\n<li>只有 <code>e.lengthComputable</code> 为 <code>true</code> 时，才能计算进度</li>\n</ul>\n</li>\n<li>\n<p><strong>跨域注意事项</strong>   ：</p>\n<ul>\n<li>如果是跨域下载，服务器需要配置 <code>Access-Control-Expose-Headers: Content-Length</code></li>\n<li>否则前端无法获取 <code>e.total</code> 值，也就无法计算进度</li>\n</ul>\n</li>\n<li>\n<p><strong>优势</strong>   ：</p>\n<ul>\n<li>兼容性好，支持所有现代浏览器及旧版浏览器</li>\n<li>可以精确获取下载进度</li>\n<li>支持中断下载（xhr.abort()）</li>\n</ul>\n</li>\n</ol>\n<p>这种方法特别适合需要展示下载进度的场景，如下载大文件、安装包等，能给用户提供更好的视觉反馈。</p>\n</div>'</script></body></html>