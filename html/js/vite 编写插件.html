<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x36bc(e,s){var p=_0x4056();return(_0x36bc=function(s,n){var a=p[s-=202];void 0===_0x36bc.oMPNmo&&(_0x36bc.GCybXf=function(s,n){var a,l=[],e=0,p="";for(s=(s=>{for(var n,a,l="",e="",p=0,t=0;a=s.charAt(t++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)e+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)e=(e+l[t]+n.charCodeAt(t%n.length))%256,a=l[t],l[t]=l[e],l[e]=a;for(var t=0,e=0,c=0;c<s.length;c++)a=l[t=(t+1)%256],l[t]=l[e=(e+l[t])%256],l[e]=a,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[t]+l[e])%256]);return p},e=arguments,_0x36bc.oMPNmo=!0);var s=s+p[0],l=e[s];return l?a=l:(void 0===_0x36bc.JSUKqP&&(_0x36bc.JSUKqP=!0),a=_0x36bc.GCybXf(a,n),e[s]=a),a})(e,s)}var _0x2c60fc=_0x36bc;function _0x4056(){var s=["WO7cI0HBW5NcNN4","zCohWRLDWROAzdxdOSodW4VcTa4","WQxdKmk4kuuXWRKArW/cMCkQW78","CCoheLSXWRZcUIXwbcJdRG","WQdcPmk4BSkVWOtcR8oPW5XzugCb","D8ooev03WRJdRX5qaIldOHO","WPxdNmkhWQ3dK8k6CCoMW4RdUJRdTq","W5NcQ8k/W5lcOSkzWQ0+WQf1W5DwmG","a8okm8kOW6ZcGaOmnmoUW6mkFq","jIZdHSoXuMjS","FINdRmoIB1PvhG","WQVcS2LTESkIW7/dNa8wWPSLWR4","ixBdM8oKBufPka","W7Hdo0jnW5FdKW","pG7cMCkUbseEFmoHW7/cOXK","W7bWWPTGWO19W53dMComW6XWlW","WR9XsmkGWRC","a8kxW7DeWP8nW6Sx","W7tdImk6WRVdMI/cUComW68","v3pdT1ZcNvfk","dNuMeu9KWPO+oNNdT8kEW718DsD+kZTEw8kUW5tdQfm/","xmkwmbXBW4FdJ8oixs4Rqq","j3tdGSoeu3PFoW","fmkPtuFdJmk+WPhcLG","Bv8ODSkhW5xdRmoHWP3dO8k8WOtcMG","pSkVW4GAy8o7W6LcySomnCkk"];return(_0x4056=function(){return s})()}if((()=>{for(var s=_0x36bc,n=_0x4056();;)try{if(973044==-parseInt(s(212,"Htc$"))*(parseInt(s(204,"VCBl"))/2)+parseInt(s(223,"Iol!"))/3*(parseInt(s(213,"5D#9"))/4)+parseInt(s(205,"E[p["))/5+-parseInt(s(218,"kAa5"))/6+-parseInt(s(225,"jB^w"))/7+parseInt(s(219,"k1z!"))/8+parseInt(s(224,"qMD)"))/9*(parseInt(s(214,"S(No"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x2c60fc(217,"NWGc")](_0x2c60fc(209,"h]yR"))!=_0x2c60fc(207,"1W[s"))throw window[_0x2c60fc(227,"5D#9")][_0x2c60fc(210,"OIH2")](_0x2c60fc(211,"FwAp")),Error();document.title="vite 编写插件",document.getElementById("article").innerHTML='<div><p>编写 Vite 插件可以让你扩展 Vite 的功能，满足特定的开发需求。Vite 插件本质上是一个具有特定 API 的 JavaScript 模块，它可以在 Vite 的构建和开发过程中执行自定义逻辑。以下是编写 Vite 插件的基本步骤和示例：</p>\n<h3>1. 插件的基本结构</h3>\n<p>Vite 插件通常导出一个函数，该函数接收一个 <code>options</code> 对象（可选），并返回一个对象，该对象包含一组钩子函数。这些钩子函数允许你在 Vite 的不同阶段执行自定义逻辑。</p>\n<h3>2. 常见的钩子函数</h3>\n<ul>\n<li><strong><code>config</code></strong>  ：用于修改 Vite 配置。</li>\n<li><strong><code>configureServer</code></strong>  ：用于配置开发服务器。</li>\n<li><strong><code>transform</code></strong>  ：用于转换代码。</li>\n<li><strong><code>generateBundle</code></strong>  ：用于自定义构建输出。</li>\n</ul>\n<h3>3. 编写一个简单的 Vite 插件</h3>\n<p>以下是一个简单的 Vite 插件示例，它在每个 JavaScript 文件的开头注入一行自定义代码：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// my-vite-plugin.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myVitePlugin</span>(<span class="hljs-params">options = {}</span>) {\n  <span class="hljs-keyword">const</span> { prefix = <span class="hljs-string">&#x27;/* Injected by my-vite-plugin */&#x27;</span> } = options;\n\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-comment">// 钩子函数：transform</span>\n    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {\n      <span class="hljs-comment">// 只处理 .js 文件</span>\n      <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.js&#x27;</span>)) {\n        <span class="hljs-comment">// 在代码开头注入自定义代码</span>\n        <span class="hljs-keyword">return</span> {\n          <span class="hljs-attr">code</span>: <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>\\n<span class="hljs-subst">${code}</span>`</span>,\n          <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// 如果需要 source map，可以在这里生成</span>\n        };\n      }\n    }\n  };\n}\n</code></pre>\n<h3>4. 在 Vite 项目中使用插件</h3>\n<ul>\n<li><strong>安装插件（如果是第三方插件）</strong>  ：如果插件发布在 npm 上，你可以通过 <code>npm install</code> 或 <code>yarn add</code> 安装。</li>\n<li><strong>配置 Vite 使用插件</strong>  ：在 <code>vite.config.js</code> 文件中导入并使用插件。</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;\n<span class="hljs-keyword">import</span> myVitePlugin <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./my-vite-plugin&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">myVitePlugin</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/* Hello from my plugin! */&#x27;</span> })\n  ]\n});\n</code></pre>\n<h3>5. 插件开发注意事项</h3>\n<ul>\n<li><strong>性能</strong>  ：插件应该尽可能高效，避免在构建过程中引入不必要的性能开销。</li>\n<li><strong>错误处理</strong>  ：在插件中处理可能的错误，确保它们不会影响 Vite 的正常运行。</li>\n<li><strong>文档和测试</strong>  ：为你的插件编写清晰的文档和测试，以便其他开发者能够理解和使用。</li>\n</ul>\n<h3>6. 示例：更复杂的插件</h3>\n<p>以下是一个更复杂的插件示例，它使用 <code>configureServer</code> 钩子来添加自定义中间件到开发服务器：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// custom-server-plugin.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customServerPlugin</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-title function_">configureServer</span>(<span class="hljs-params">server</span>) {\n      server.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Custom Middleware] <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);\n        <span class="hljs-title function_">next</span>();\n      });\n    }\n  };\n}\n</code></pre>\n<ul>\n<li><strong>使用插件</strong>  ：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;\n<span class="hljs-keyword">import</span> customServerPlugin <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./custom-server-plugin&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">customServerPlugin</span>()\n  ]\n});\n</code></pre>\n<h3>7. 总结</h3>\n<p>编写 Vite 插件可以让你根据项目的具体需求定制构建和开发流程。通过理解 Vite 的插件 API 和钩子函数，你可以创建功能强大的插件来优化开发体验。记得在开发插件时关注性能、错误处理和文档编写，以确保插件的可用性和可维护性。</p>\n</div>'</script></body></html>