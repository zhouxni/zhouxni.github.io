<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5a23(r,e){var a=_0x106e();return(_0x5a23=function(e,t){var n=a[e-=238];void 0===_0x5a23.gGdELd&&(_0x5a23.grXtgl=function(e,t){var n,o=[],r=0,a="";for(e=(e=>{for(var t,n,o="",r="",a=0,c=0;n=e.charAt(c++);~n&&(t=a%4?64*t+n:n,a++%4)&&(o+=String.fromCharCode(255&t>>(-2*a&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var d=0,W=o.length;d<W;d++)r+="%"+("00"+o.charCodeAt(d).toString(16)).slice(-2);return decodeURIComponent(r)})(e),c=0;c<256;c++)o[c]=c;for(c=0;c<256;c++)r=(r+o[c]+t.charCodeAt(c%t.length))%256,n=o[c],o[c]=o[r],o[r]=n;for(var c=0,r=0,d=0;d<e.length;d++)n=o[c=(c+1)%256],o[c]=o[r=(r+o[c])%256],o[r]=n,a+=String.fromCharCode(e.charCodeAt(d)^o[(o[c]+o[r])%256]);return a},r=arguments,_0x5a23.gGdELd=!0);var e=e+a[0],o=r[e];return o?n=o:(void 0===_0x5a23.fKhVuG&&(_0x5a23.fKhVuG=!0),n=_0x5a23.grXtgl(n,t),r[e]=n),n})(r,e)}function _0x106e(){var e=["idSdgxRcMCkFddZcQ8oYxem","W7PTW5LLevZcHv3cN010nq","e8ohW5DlW5pcRCoE","qe1fymkuWONcLev6pmkMW73dUG","WPZcLCk9WRJdLf1dgG","W6KnySoSW75nW4e","WQNcOColWRxcHmoMWPHk","WOrVWRXPW51srY99","gSoCrmovWPbIBCoXuSoeWQGw","WRlcRmk5WRmamJjJW6GDW6GIW5K","g8orsCoxWPrGg8oiw8oDWRicWQ0","WP1qimkIjZ54","W7RdKNP7BfnZW4i","WOf3W4FdJr5TW5BdTSofh2GYqW","ier8WRvOWRVdNCowqCoCvZldHG","W5XbmhehW4SEW7lcRf5/W6XC","f2dcMCo5cSkaWPxdSq","WQZcLmo5hmkWWOu5","WRSQW4FcNmkEW47dVqHyW47dH8o4gW","W6ZdKu5EWQlcH8kSW6NcUWz9W4lcTq","vSoDW5ycwahdOmknW5z1W4mW","lL1dCXZdU8oH","sJqdd8okW4ddSW","WRNdH8oFWPFcJ8oZW4a7","EZVdTq7dJ0pdMbtcM8one8ka","WQ3cUSoCWQtcG8k1W5GlW5CDW6rBm31zWPTAWP05BgFcNCkcW7ZcTCkk","fvzOFSo/"];return(_0x106e=function(){return e})()}var _0x64d8ce=_0x5a23;if((()=>{for(var e=_0x5a23,t=_0x106e();;)try{if(970347==+parseInt(e(244,"&D!i"))*(parseInt(e(248,"Bbfn"))/2)+parseInt(e(261,"mW*@"))/3+parseInt(e(262,"L1r!"))/4+parseInt(e(243,"DQKN"))/5*(-parseInt(e(260,"29Cf"))/6)+-parseInt(e(252,"18C@"))/7+parseInt(e(251,"E$LQ"))/8*(parseInt(e(239,"xsCA"))/9)+-parseInt(e(246,"vOIB"))/10*(-parseInt(e(255,"OV5Q"))/11))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(),localStorage[_0x64d8ce(254,"itb%")](_0x64d8ce(250,"1^Kb"))!=_0x64d8ce(242,"V(OL"))throw window[_0x64d8ce(249,"Pfqg")][_0x64d8ce(245,"W&g2")](_0x64d8ce(241,"Pfqg")),Error();document.title="babel  async 函数异常捕获",document.getElementById("article").innerHTML="<div><pre><code>const babel = require(&quot;@babel/core&quot;);\nconst traverse = require(&quot;@babel/traverse&quot;).default;\nconst types = require(&quot;@babel/types&quot;);\nconst generate = require(&quot;@babel/generator&quot;).default;\n\n// 示例代码，包含 await 表达式\nconst code = `\nasync function fetchData() {\n  const data = await fetch('https://api.example.com/data');\n  console.log(data);\n}\n`;\n\n// 解析代码为 AST\nconst ast = babel.parse(code);\n\n// 遍历 AST，找到 AwaitExpression 并包装在 TryStatement 中\ntraverse(ast, {\n  FunctionDeclaration(path) {\n    if (path.node.async) {\n      path.node.body = types.blockStatement([\n        types.tryStatement(\n          path.node.body,\n          types.catchClause(\n            types.identifier(&quot;error&quot;),\n            types.blockStatement([\n              types.expressionStatement(\n                types.callExpression(\n                  types.memberExpression(\n                    types.identifier(&quot;console&quot;),\n                    types.identifier(&quot;error&quot;)\n                  ),\n                  [\n                    types.stringLiteral(&quot;Error occurred:&quot;),\n                    types.identifier(&quot;error&quot;),\n                  ]\n                )\n              ),\n            ])\n          )\n        ),\n      ]);\n    }\n  },\n});\n\n// 生成修改后的代码\nconst output = generate(ast, {}, code);\n\nconsole.log(output.code);\n\n</code></pre>\n</div>"</script></body></html>