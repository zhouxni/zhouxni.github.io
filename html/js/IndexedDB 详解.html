<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x59dbd1=_0x31eb;function _0x31eb(l,s){var e=_0x3ab8();return(_0x31eb=function(s,n){var a=e[s-=133];void 0===_0x31eb.Kpawbd&&(_0x31eb.iqCili=function(s,n){var a,t=[],l=0,e="";for(s=(s=>{for(var n,a,t="",l="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,c=t.length;o<c;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),p=0;p<256;p++)t[p]=p;for(p=0;p<256;p++)l=(l+t[p]+n.charCodeAt(p%n.length))%256,a=t[p],t[p]=t[l],t[l]=a;for(var p=0,l=0,o=0;o<s.length;o++)a=t[p=(p+1)%256],t[p]=t[l=(l+t[p])%256],t[l]=a,e+=String.fromCharCode(s.charCodeAt(o)^t[(t[p]+t[l])%256]);return e},l=arguments,_0x31eb.Kpawbd=!0);var s=s+e[0],t=l[s];return t?a=t:(void 0===_0x31eb.PTsyfx&&(_0x31eb.PTsyfx=!0),a=_0x31eb.iqCili(a,n),l[s]=a),a})(l,s)}function _0x3ab8(){var s=["fSkcx8o/bvlcQXC","WOLPyMqsAvNcJxCkW54Y","WOLLW6efWPZdNGK","WO04ASk5WOq+sG","WO5np8oKW7X9pJZdPeVdNqK3","vqRdJSk6W45RqZVdSXveWPW","zvRdOwSbW7O6","hb7dLXlcPCkmawq","svlcPg8yid8","W5XhW74CW6K5WRtdLa/cPW","W6xdNSocW69jnhldQW","BarApCoDW7xcMf4jW7ZcGYS","WPBdRM/cN2m2W6rFe8opW452","WPBdQchdPXT7W4XW","sSogCSoMmYVdGfFcH8kTBHhdIN4CkSkDWQT0jK4Ke8kFW7FdGa","b8kkWP/cQZC5WPtdKCkeWOaBga","WQKEa1RdUSorWOm","uSoFemorW5qucCouCCkltSoF","W4VdPw42bSkUW4PvW6i","WO5Rz2mBpNhcUfGeW7q","WPhdQgdcNgi8W6XAimo0W5H+","AarupCoBW7FcGuGuW47cNcu","fbG4rSo3W73cLfHkCW","dSkBDsD8","d8kzi8kYqCk2y8oWcYq5","lSoYWPekWQSqzq","WR/dQ8o3xConz8opBmoefM3dKW","W4NcTttdJYrNW49A","W6BdQ8kvxJldPmklW4GomfhcGSkX","FZLivCoDhCoGWQpcHJjbbG"];return(_0x3ab8=function(){return s})()}if((()=>{for(var s=_0x31eb,n=_0x3ab8();;)try{if(289970==-parseInt(s(137,"#QkO"))*(parseInt(s(140,"!w6$"))/2)+parseInt(s(158,"X01t"))/3+parseInt(s(138,"w[UM"))/4*(-parseInt(s(153,"5yKO"))/5)+-parseInt(s(133,"@a%R"))/6+parseInt(s(149,"S1H*"))/7*(-parseInt(s(139,"PTJz"))/8)+parseInt(s(136,"zKXR"))/9*(parseInt(s(142,"dk@1"))/10)+parseInt(s(151,"@a%R"))/11*(parseInt(s(141,"yPe^"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x59dbd1(148,"FQ([")](_0x59dbd1(150,"c9Q3"))!=_0x59dbd1(155,"YYbz"))throw window[_0x59dbd1(159,"XP34")][_0x59dbd1(157,"NFFo")](_0x59dbd1(146,"Jdnj")),Error();document.title="IndexedDB 详解",document.getElementById("article").innerHTML='<div><p>IndexedDB 是浏览器提供的一种低级别的、异步的、事务型的 NoSQL 数据库，用于在客户端存储大量结构化数据（最高可达数百 MB 甚至更多，具体取决于浏览器和设备）。它非常适合需要在前端存储复杂数据结构、离线数据或大量数据的场景（如离线应用、数据缓存、复杂表单存储等）。</p>\n<h3>一、IndexedDB 的核心特性</h3>\n<ol>\n<li><strong>非关系型（NoSQL）</strong>   ：数据以键值对形式存储，值可以是复杂对象（包括二进制数据），无需预定义表结构。</li>\n<li><strong>异步操作</strong>   ：所有操作不会阻塞主线程（避免页面卡顿），通过回调、Promise 或 async/await 处理结果。</li>\n<li><strong>事务支持</strong>   ：操作在事务中执行，确保数据一致性（要么全部成功，要么全部失败）。</li>\n<li><strong>跨会话持久化</strong>   ：数据长期保存，除非手动删除或用户清理浏览器数据。</li>\n<li><strong>大容量存储</strong>   ：远大于 <code>localStorage</code>（通常为 5MB），容量取决于设备剩余空间，浏览器会提示用户授权更大空间。</li>\n<li><strong>支持索引</strong>   ：可对字段创建索引，实现高效查询（类似数据库的索引功能）。</li>\n<li><strong>同源限制</strong>   ：遵循同源策略，只有同一域名的页面可访问其存储的数据。</li>\n</ol>\n<h3>二、IndexedDB 核心概念</h3>\n<ol>\n<li>\n<p><strong>数据库（Database）</strong>   ：<br>\n一个域名下可以有多个数据库，每个数据库有唯一名称，通过版本号管理（版本号为正整数，只能递增）。</p>\n</li>\n<li>\n<p><strong>对象仓库（Object Store）</strong>   ：<br>\n数据库中的“表”，用于存储同类数据。每个对象仓库有一个主键（key），主键具有唯一性，可自动生成或手动指定。</p>\n</li>\n<li>\n<p><strong>索引（Index）</strong>   ：<br>\n基于对象仓库中的字段创建，用于加速查询。索引可以是唯一的（避免重复值）或非唯一的。</p>\n</li>\n<li>\n<p><strong>事务（Transaction）</strong>   ：<br>\n所有对数据的操作（增删改查）必须在事务中执行。事务有三种模式：</p>\n<ul>\n<li><code>readonly</code>：只读（默认，不能修改数据）。</li>\n<li><code>readwrite</code>：可读可写（可修改数据）。</li>\n<li><code>versionchange</code>：版本变更（仅用于数据库结构修改，如创建/删除对象仓库）。</li>\n</ul>\n</li>\n<li>\n<p><strong>游标（Cursor）</strong>   ：<br>\n用于遍历对象仓库中的数据，支持按条件、排序、分页查询。</p>\n</li>\n</ol>\n<h3>三、IndexedDB 基本操作流程</h3>\n<h4>1. 打开/创建数据库</h4>\n<p>使用 <code>indexedDB.open()</code> 方法，返回一个 <code>IDBOpenDBRequest</code> 对象，通过事件处理结果。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 打开名为 &quot;myDB&quot; 的数据库，版本号为 1</span>\n<span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;myDB&quot;</span>, <span class="hljs-number">1</span>);\n\n<span class="hljs-comment">// 数据库首次创建或版本号升级时触发（用于初始化结构）</span>\nrequest.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;\n\n  <span class="hljs-comment">// 如果 &quot;users&quot; 对象仓库不存在，则创建</span>\n  <span class="hljs-keyword">if</span> (!db.<span class="hljs-property">objectStoreNames</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&quot;users&quot;</span>)) {\n    <span class="hljs-comment">// 创建对象仓库，主键为 &quot;id&quot;，自动递增</span>\n    <span class="hljs-keyword">const</span> userStore = db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">&quot;users&quot;</span>, {\n      <span class="hljs-attr">keyPath</span>: <span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-comment">// 主键字段</span>\n      <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 主键自动生成</span>\n    });\n\n    <span class="hljs-comment">// 为 &quot;name&quot; 字段创建索引（非唯一）</span>\n    userStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">&quot;idx_name&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });\n    <span class="hljs-comment">// 为 &quot;email&quot; 字段创建索引（唯一，避免重复邮箱）</span>\n    userStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">&quot;idx_email&quot;</span>, <span class="hljs-string">&quot;email&quot;</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> });\n  }\n};\n\n<span class="hljs-comment">// 打开数据库成功</span>\nrequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;数据库打开成功&quot;</span>);\n  <span class="hljs-comment">// 后续操作（增删改查）需通过 db 对象执行</span>\n};\n\n<span class="hljs-comment">// 打开数据库失败</span>\nrequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;数据库打开失败：&quot;</span>, event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);\n};\n</code></pre>\n<h4>2. 新增数据（Add）</h4>\n<p>通过 <code>readwrite</code> 事务向对象仓库添加数据。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params">db, userData</span>) {\n  <span class="hljs-comment">// 创建事务（操作 &quot;users&quot; 仓库，模式为 readwrite）</span>\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readwrite&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-comment">// 添加数据</span>\n  <span class="hljs-keyword">const</span> request = userStore.<span class="hljs-title function_">add</span>(userData);\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;数据添加成功，主键为：&quot;</span>, request.<span class="hljs-property">result</span>);\n  };\n\n  request.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;数据添加失败：&quot;</span>, request.<span class="hljs-property">error</span>);\n  };\n\n  <span class="hljs-comment">// 事务完成（成功或失败）</span>\n  transaction.<span class="hljs-property">oncomplete</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;事务完成&quot;</span>);\n  };\n}\n\n<span class="hljs-comment">// 调用示例（需在数据库打开成功后执行）</span>\n<span class="hljs-comment">// addUser(db, { name: &quot;Alice&quot;, email: &quot;alice@example.com&quot;, age: 30 });</span>\n</code></pre>\n<h4>3. 查询数据</h4>\n<h5>（1）通过主键查询（get）</h5>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params">db, id</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readonly&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-keyword">const</span> request = userStore.<span class="hljs-title function_">get</span>(id);\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">result</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;查询到用户：&quot;</span>, request.<span class="hljs-property">result</span>);\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;未找到用户&quot;</span>);\n    }\n  };\n}\n\n<span class="hljs-comment">// 调用示例</span>\n<span class="hljs-comment">// getUserById(db, 1);</span>\n</code></pre>\n<h5>（2）通过索引查询（index + get）</h5>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserByEmail</span>(<span class="hljs-params">db, email</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readonly&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n  <span class="hljs-comment">// 获取 &quot;idx_email&quot; 索引</span>\n  <span class="hljs-keyword">const</span> emailIndex = userStore.<span class="hljs-title function_">index</span>(<span class="hljs-string">&quot;idx_email&quot;</span>);\n\n  <span class="hljs-keyword">const</span> request = emailIndex.<span class="hljs-title function_">get</span>(email);\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;通过邮箱查询结果：&quot;</span>, request.<span class="hljs-property">result</span>);\n  };\n}\n\n<span class="hljs-comment">// 调用示例</span>\n<span class="hljs-comment">// getUserByEmail(db, &quot;alice@example.com&quot;);</span>\n</code></pre>\n<h5>（3）通过游标遍历（适合批量查询）</h5>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllUsers</span>(<span class="hljs-params">db</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readonly&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-comment">// 打开游标（默认从头开始遍历）</span>\n  <span class="hljs-keyword">const</span> request = userStore.<span class="hljs-title function_">openCursor</span>();\n\n  <span class="hljs-keyword">const</span> users = [];\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> cursor = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;\n    <span class="hljs-keyword">if</span> (cursor) {\n      users.<span class="hljs-title function_">push</span>(cursor.<span class="hljs-property">value</span>);\n      cursor.<span class="hljs-title function_">continue</span>(); <span class="hljs-comment">// 继续下一个</span>\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;所有用户：&quot;</span>, users);\n    }\n  };\n}\n\n<span class="hljs-comment">// 调用示例</span>\n<span class="hljs-comment">// getAllUsers(db);</span>\n</code></pre>\n<h5>（4）条件查询（游标 + 范围）</h5>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUsersByAgeRange</span>(<span class="hljs-params">db, minAge, maxAge</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readonly&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-comment">// 创建年龄范围（IDBKeyRange）</span>\n  <span class="hljs-keyword">const</span> range = <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">bound</span>(minAge, maxAge);\n\n  <span class="hljs-comment">// 打开游标，按 &quot;age&quot; 字段排序（需先为 age 创建索引）</span>\n  <span class="hljs-keyword">const</span> ageIndex = userStore.<span class="hljs-title function_">index</span>(<span class="hljs-string">&quot;idx_age&quot;</span>); <span class="hljs-comment">// 假设已创建 idx_age 索引</span>\n  <span class="hljs-keyword">const</span> request = ageIndex.<span class="hljs-title function_">openCursor</span>(range);\n\n  <span class="hljs-keyword">const</span> users = [];\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> cursor = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;\n    <span class="hljs-keyword">if</span> (cursor) {\n      users.<span class="hljs-title function_">push</span>(cursor.<span class="hljs-property">value</span>);\n      cursor.<span class="hljs-title function_">continue</span>();\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`年龄在 <span class="hljs-subst">${minAge}</span>-<span class="hljs-subst">${maxAge}</span> 的用户：`</span>, users);\n    }\n  };\n}\n</code></pre>\n<h4>4. 更新数据（Put）</h4>\n<p><code>put()</code> 方法：若主键存在则更新，不存在则新增（类似“upsert”）。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">db, updatedUser</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readwrite&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-keyword">const</span> request = userStore.<span class="hljs-title function_">put</span>(updatedUser); <span class="hljs-comment">// updatedUser 必须包含主键 id</span>\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;用户更新成功&quot;</span>);\n  };\n}\n\n<span class="hljs-comment">// 调用示例</span>\n<span class="hljs-comment">// updateUser(db, { id: 1, name: &quot;Alice Smith&quot;, email: &quot;alice@example.com&quot;, age: 31 });</span>\n</code></pre>\n<h4>5. 删除数据（Delete）</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">db, id</span>) {\n  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-string">&quot;readwrite&quot;</span>);\n  <span class="hljs-keyword">const</span> userStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">&quot;users&quot;</span>);\n\n  <span class="hljs-keyword">const</span> request = userStore.<span class="hljs-title function_">delete</span>(id);\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;用户删除成功&quot;</span>);\n  };\n}\n\n<span class="hljs-comment">// 调用示例</span>\n<span class="hljs-comment">// deleteUser(db, 1);</span>\n</code></pre>\n<h4>6. 删除数据库</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteDatabase</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">deleteDatabase</span>(<span class="hljs-string">&quot;myDB&quot;</span>);\n\n  request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;数据库删除成功&quot;</span>);\n  };\n\n  request.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;数据库删除失败：&quot;</span>, request.<span class="hljs-property">error</span>);\n  };\n}\n</code></pre>\n<h3>四、IndexedDB 高级特性</h3>\n<ol>\n<li>\n<p><strong>二进制数据存储</strong>   ：支持存储 <code>Blob</code>、<code>File</code> 等二进制数据（如图片、文件），适合离线缓存媒体资源。</p>\n</li>\n<li>\n<p><strong>事务并发控制</strong>   ：多个事务可同时执行，但读写冲突时会按顺序处理（<code>readwrite</code> 事务优先于 <code>readonly</code>）。</p>\n</li>\n<li>\n<p><strong>版本管理</strong>   ：数据库结构变更（如新增对象仓库、索引）必须通过版本升级（<code>onupgradeneeded</code> 事件），版本号只能递增。</p>\n</li>\n<li>\n<p><strong>事件监听</strong>   ：除了操作相关事件，还可监听数据库连接关闭（<code>onclose</code>）、版本变更阻塞（<code>onblocked</code>）等事件。</p>\n</li>\n</ol>\n<h3>五、兼容性与最佳实践</h3>\n<ol>\n<li>\n<p><strong>兼容性</strong>   ：所有现代浏览器（Chrome、Firefox、Edge、Safari 10+）均支持，可通过 <code>window.indexedDB</code> 判断是否支持。</p>\n</li>\n<li>\n<p><strong>最佳实践</strong>   ：</p>\n<ul>\n<li><strong>封装操作</strong>   ：将 IndexedDB 操作封装为 Promise 或工具类，简化异步处理（避免回调地狱）。</li>\n<li><strong>错误处理</strong>   ：所有操作必须添加 <code>onerror</code> 监听，避免未捕获的异常。</li>\n<li><strong>控制事务生命周期</strong>   ：事务会在操作完成后自动提交，避免长时间持有事务（可能导致阻塞）。</li>\n<li><strong>清理无用数据</strong>   ：定期删除过期数据，避免占用过多存储空间。</li>\n<li><strong>结合 Service Worker</strong>   ：实现离线数据同步，提升 PWA（渐进式 Web 应用）的离线体验。</li>\n</ul>\n</li>\n</ol>\n<h3>六、与其他存储方案的对比</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>IndexedDB</th>\n<th>localStorage</th>\n<th>SessionStorage</th>\n<th>Cookie</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>存储容量</td>\n<td>大（数百 MB）</td>\n<td>小（约 5MB）</td>\n<td>小（约 5MB）</td>\n<td>极小（约 4KB）</td>\n</tr>\n<tr>\n<td>数据类型</td>\n<td>复杂对象、二进制</td>\n<td>字符串</td>\n<td>字符串</td>\n<td>字符串</td>\n</tr>\n<tr>\n<td>操作方式</td>\n<td>异步</td>\n<td>同步</td>\n<td>同步</td>\n<td>随请求自动发送</td>\n</tr>\n<tr>\n<td>持久化</td>\n<td>长期保存</td>\n<td>长期保存</td>\n<td>会话结束后清除</td>\n<td>可设置过期时间</td>\n</tr>\n<tr>\n<td>适用场景</td>\n<td>大量/复杂数据、离线存储</td>\n<td>简单键值对</td>\n<td>会话级临时数据</td>\n<td>身份验证、状态标识</td>\n</tr>\n</tbody>\n</table>\n<p>IndexedDB 是前端本地存储的“终极方案”，尤其适合需要处理大量结构化数据或离线功能的应用。虽然 API 相对复杂，但通过合理封装和工具类（如 <code>localForage</code> 等库），可以大幅降低使用门槛。</p>\n<h3>IndexedDB 支持存储的主要数据类型包括：</h3>\n<ul>\n<li>基本数据类型：字符串（String）、数字（Number）、布尔值（Boolean）、null、undefined</li>\n<li>复杂数据类型：对象（Object）、数组（Array）</li>\n<li>二进制数据：ArrayBuffer、TypedArray、Blob、File</li>\n</ul>\n<p>但以下类型的数据无法直接存储到 IndexedDB 中：</p>\n<ul>\n<li>函数（Function）：会被转换为字符串 &quot;[object Function]&quot; 存储，失去函数功能</li>\n<li>正则表达式（RegExp）：存储后会丢失正则表达式的标志（flags）</li>\n<li>Date 对象：会被转换为字符串存储，需要手动转换回 Date 对象才能使用其方法</li>\n<li>Map 和 Set：会被转换为普通对象或数组存储，失去原有的数据结构特性</li>\n<li>循环引用的对象：存储时会报错</li>\n<li>DOM 节点：无法直接存储</li>\n</ul>\n<p>如果需要存储不支持的类型，通常需要先进行序列化处理（如使用 JSON.stringify() 转换为字符串），读取时再进行反序列化还原，但这可能会导致部分数据信息丢失。</p>\n</div>'</script></body></html>