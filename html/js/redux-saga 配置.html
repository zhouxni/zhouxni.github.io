<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x47b9(t,s){var e=_0x175f();return(_0x47b9=function(s,a){var n=e[s-=473];void 0===_0x47b9.itSkjY&&(_0x47b9.FTjctd=function(s,a){var n,l=[],t=0,e="";for(s=(s=>{for(var a,n,l="",t="",e=0,r=0;n=s.charAt(r++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,o=l.length;c<o;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),r=0;r<256;r++)l[r]=r;for(r=0;r<256;r++)t=(t+l[r]+a.charCodeAt(r%a.length))%256,n=l[r],l[r]=l[t],l[t]=n;for(var r=0,t=0,c=0;c<s.length;c++)n=l[r=(r+1)%256],l[r]=l[t=(t+l[r])%256],l[t]=n,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[r]+l[t])%256]);return e},t=arguments,_0x47b9.itSkjY=!0);var s=s+e[0],l=t[s];return l?n=l:(void 0===_0x47b9.CvLbbs&&(_0x47b9.CvLbbs=!0),n=_0x47b9.FTjctd(n,a),t[s]=n),n})(t,s)}var _0x5b1337=_0x47b9;if((()=>{for(var s=_0x47b9,a=_0x175f();;)try{if(745784==-parseInt(s(480,"Wjp1"))+parseInt(s(495,"kN0*"))/2+-parseInt(s(473,"61!W"))/3+-parseInt(s(487,"rS$O"))/4*(-parseInt(s(475,"19cl"))/5)+-parseInt(s(474,"8eC3"))/6*(-parseInt(s(481,"19cl"))/7)+-parseInt(s(478,"rS$O"))/8+parseInt(s(489,"4675"))/9)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x5b1337(476,"4675")](_0x5b1337(485,"lOZI"))!=_0x5b1337(493,"#VS!"))throw window[_0x5b1337(490,"z&i)")][_0x5b1337(477,"SoTG")](_0x5b1337(484,"@d&D")),Error();function _0x175f(){var s=["W6jgW57dONddOfy","WO3cHCk/CbBdJHK","W5RdG1NcRSkdW5KZW5pcQ8oLWQjzqmoZ","W4q6iCoZW4pcJx7cJSkHWP8HnNK","W6BdSCkcW6vpnx7cGSoCdGFcRq","imoYW77cUSoKW5FdIa","WOyZW6pdK2iNW5ddLCk5mXX4W5lcVG","smkgW4pcSsBcTCo2WR7cM8ksCqe","W593WQBcLsqTW4/dISkQfJrDW5pcP2dcShmgW4SyW61gwdaJW4q","WOxdImkmW5C0EJmiBW","W4m5jSo9W4pdKbxcKmkxWRWY","W5RdI1ddSSoCWRPSWOJcQa","WO9cjLdcUSkFWO8","WRCtWPRcMZFcTWKNFCoZzmoAWR4","WOBcSYRdHCk2lSoPCG","W7RdNcRdVLhdSCoZWQtcSX86","WPRcVCk1W50rWOhdI8kIWOC","xXJdOCojW6K","s8ozW6xcMHdcHK3dObFcLSkDsv0","W7DyW4xdK8kMzCobW6pdSSoZuSkUsa","WRCwWPNcNdtcVamqr8oisSoPWQi","WQddKX3dKSoYBJbVWOdcHri","WRGkkx9bW5ZdK0C2FhhcHmoA","iCk2WO3dT8k2W6RdR8k0cCoBW5q"];return(_0x175f=function(){return s})()}document.title="redux-saga 配置",document.getElementById("article").innerHTML='<div><p><strong>redux-saga 详解</strong></p>\n<p>redux-saga 是一个用于管理 Redux 应用异步操作的中间件。它基于 ES6 的生成器函数（Generator Functions）和事件监听模式，提供了一种优雅的方式来处理异步操作和副作用。以下是对 redux-saga 的详细解析：</p>\n<h3>一、核心概念</h3>\n<ol>\n<li><strong>Saga</strong>  ：\n<ul>\n<li>Saga 是一种特殊的函数，它使用生成器函数来定义异步操作。</li>\n<li>Saga 可以被看作是一个单独的线程，负责处理应用程序中的副作用，如异步请求、定时器等。</li>\n</ul>\n</li>\n<li><strong>Worker Saga 和 Watcher Saga</strong>  ：\n<ul>\n<li>Worker Saga：负责执行具体的异步操作，如调用 API、进行异步请求等。</li>\n<li>Watcher Saga：监听被 dispatch 的 actions，当接收到特定的 action 时，调用对应的 Worker Saga。</li>\n</ul>\n</li>\n<li><strong>Effect</strong>  ：\n<ul>\n<li>Effect 是 redux-saga 提供的一系列 API，用于描述异步操作。</li>\n<li>常用的 Effect 包括 <code>call</code>、<code>put</code>、<code>take</code>、<code>takeEvery</code>、<code>takeLatest</code>、<code>fork</code> 等。</li>\n</ul>\n</li>\n</ol>\n<h3>二、工作原理</h3>\n<ol>\n<li><strong>创建 Saga 中间件</strong>  ：\n<ul>\n<li>使用 <code>createSagaMiddleware</code> 函数创建一个 Saga 中间件。</li>\n<li>将 Saga 中间件应用到 Redux Store 中。</li>\n</ul>\n</li>\n<li><strong>运行 Saga</strong>  ：\n<ul>\n<li>使用 <code>sagaMiddleware.run(saga)</code> 方法运行一个 Saga。</li>\n<li>Saga 开始执行，监听特定的 actions，并根据需要执行异步操作。</li>\n</ul>\n</li>\n<li><strong>处理异步操作</strong>  ：\n<ul>\n<li>当接收到特定的 action 时，Watcher Saga 调用对应的 Worker Saga。</li>\n<li>Worker Saga 使用 Effect 来描述异步操作，如调用 API、进行异步请求等。</li>\n<li>redux-saga 中间件负责执行这些 Effect，并将结果返回给 Worker Saga。</li>\n</ul>\n</li>\n<li><strong>更新 State</strong>  ：\n<ul>\n<li>Worker Saga 根据异步操作的结果，使用 <code>put</code> Effect 发起新的 action。</li>\n<li>这些 action 被 dispatch 到 Redux Store，更新应用的状态。</li>\n</ul>\n</li>\n</ol>\n<h3>三、常用 Effect</h3>\n<ol>\n<li><strong><code>call</code></strong>  ：\n<ul>\n<li>用于调用异步函数，如 API 请求。</li>\n<li>返回一个 Promise，当 Promise 解析时，Saga 继续执行。</li>\n</ul>\n</li>\n<li><strong><code>put</code></strong>  ：\n<ul>\n<li>用于发起一个 action。</li>\n<li>类似于 Redux 的 <code>dispatch</code> 方法。</li>\n</ul>\n</li>\n<li><strong><code>take</code></strong>  ：\n<ul>\n<li>用于监听特定的 action。</li>\n<li>当接收到该 action 时，Saga 继续执行。</li>\n</ul>\n</li>\n<li><strong><code>takeEvery</code></strong>  ：\n<ul>\n<li>监听特定的 action，每次接收到该 action 时都执行指定的 Worker Saga。</li>\n<li>允许多个请求同时执行。</li>\n</ul>\n</li>\n<li><strong><code>takeLatest</code></strong>  ：\n<ul>\n<li>监听特定的 action，每次接收到该 action 时都取消之前的请求，只执行最新的请求。</li>\n</ul>\n</li>\n<li><strong><code>fork</code></strong>  ：\n<ul>\n<li>用于非阻塞地调用另一个 Saga。</li>\n<li>被调用的 Saga 在后台继续执行，不会阻塞当前的 Saga。</li>\n</ul>\n</li>\n</ol>\n<h3>四、优点</h3>\n<ol>\n<li><strong>易于测试</strong>  ：\n<ul>\n<li>由于 Saga 是纯函数，且使用 Effect 来描述异步操作，因此易于测试。</li>\n<li>可以使用单元测试框架来验证 Saga 的行为。</li>\n</ul>\n</li>\n<li><strong>更好的异步流程控制</strong>  ：\n<ul>\n<li>redux-saga 提供了丰富的 Effect API，可以方便地实现复杂的异步流程控制。</li>\n<li>如并发请求、竞速请求、任务取消等。</li>\n</ul>\n</li>\n<li><strong>可取消性</strong>  ：\n<ul>\n<li>redux-saga 允许在任何时候取消正在运行的 Saga，这对于处理用户取消操作或应用程序卸载时的清理操作非常有用。</li>\n</ul>\n</li>\n<li><strong>集中处理副作用</strong>  ：\n<ul>\n<li>所有的异步操作和副作用都被集中在 Saga 中处理，使得代码更加清晰和易于维护。</li>\n</ul>\n</li>\n</ol>\n<h3>五、示例</h3>\n<p>以下是一个简单的 redux-saga 示例，展示了如何使用 Saga 来处理异步请求：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createStore, applyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;\n<span class="hljs-keyword">import</span> createSagaMiddleware <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-saga&#x27;</span>;\n<span class="hljs-keyword">import</span> { call, put, takeEvery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-saga/effects&#x27;</span>;\n\n<span class="hljs-comment">// 定义一个异步函数，用于模拟 API 请求</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {\n    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;Hello, Saga!&#x27;</span> }), <span class="hljs-number">1000</span>);\n  });\n}\n\n<span class="hljs-comment">// 定义一个 Worker Saga，用于处理异步请求</span>\n<span class="hljs-keyword">function</span>* <span class="hljs-title function_">fetchDataSaga</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">call</span>(fetchData);\n    <span class="hljs-keyword">yield</span> <span class="hljs-title function_">put</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_DATA_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: result });\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-keyword">yield</span> <span class="hljs-title function_">put</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_DATA_FAILURE&#x27;</span>, error });\n  }\n}\n\n<span class="hljs-comment">// 定义一个 Watcher Saga，用于监听 FETCH_DATA_REQUEST action</span>\n<span class="hljs-keyword">function</span>* <span class="hljs-title function_">watchFetchData</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">yield</span> <span class="hljs-title function_">takeEvery</span>(<span class="hljs-string">&#x27;FETCH_DATA_REQUEST&#x27;</span>, fetchDataSaga);\n}\n\n<span class="hljs-comment">// 创建 Saga 中间件</span>\n<span class="hljs-keyword">const</span> sagaMiddleware = <span class="hljs-title function_">createSagaMiddleware</span>();\n\n<span class="hljs-comment">// 创建 Redux Store，并应用 Saga 中间件</span>\n<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(\n  <span class="hljs-function">(<span class="hljs-params">state = {}, action</span>) =&gt;</span> {\n    <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;FETCH_DATA_SUCCESS&#x27;</span>:\n        <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">data</span>: action.<span class="hljs-property">payload</span>.<span class="hljs-property">data</span> };\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;FETCH_DATA_FAILURE&#x27;</span>:\n        <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">error</span>: action.<span class="hljs-property">error</span> };\n      <span class="hljs-attr">default</span>:\n        <span class="hljs-keyword">return</span> state;\n    }\n  },\n  <span class="hljs-title function_">applyMiddleware</span>(sagaMiddleware)\n);\n\n<span class="hljs-comment">// 运行 Watcher Saga</span>\nsagaMiddleware.<span class="hljs-title function_">run</span>(watchFetchData);\n\n<span class="hljs-comment">// 发起 FETCH_DATA_REQUEST action</span>\nstore.<span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_DATA_REQUEST&#x27;</span> });\n</code></pre>\n<h3>六、总结</h3>\n<p>redux-saga 是一个强大的 Redux 中间件，用于管理异步操作和副作用。它基于生成器函数和事件监听模式，提供了一种优雅的方式来处理复杂的异步流程。通过使用 redux-saga，开发者可以更容易地测试和维护异步代码，同时提高应用的性能和用户体验。</p>\n</div>'</script></body></html>