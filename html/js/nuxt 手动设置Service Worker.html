<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x30cc(e,s){var c=_0x4ba3();return(_0x30cc=function(s,n){var a=c[s-=360];void 0===_0x30cc.lMxuGH&&(_0x30cc.IKyqIh=function(s,n){var a,l=[],e=0,c="";for(s=(s=>{for(var n,a,l="",e="",c=0,p=0;a=s.charAt(p++);~a&&(n=c%4?64*n+a:a,c++%4)&&(l+=String.fromCharCode(255&n>>(-2*c&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var t=0,r=l.length;t<r;t++)e+="%"+("00"+l.charCodeAt(t).toString(16)).slice(-2);return decodeURIComponent(e)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)e=(e+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[e],l[e]=a;for(var p=0,e=0,t=0;t<s.length;t++)a=l[p=(p+1)%256],l[p]=l[e=(e+l[p])%256],l[e]=a,c+=String.fromCharCode(s.charCodeAt(t)^l[(l[p]+l[e])%256]);return c},e=arguments,_0x30cc.lMxuGH=!0);var s=s+c[0],l=e[s];return l?a=l:(void 0===_0x30cc.CxOzVK&&(_0x30cc.CxOzVK=!0),a=_0x30cc.IKyqIh(a,n),e[s]=a),a})(e,s)}var _0x50c4f4=_0x30cc;function _0x4ba3(){var s=["sq/dP23dKCoitSoVWPTTEmksFW","u8oXWQ8RxCkgyCo1WPhdK0mb","W652D8kAW5DYo8obW6NdPmkoiwq","W7FdVL8nDdhcJSokewrfAW","B2xdM8oCW7VcHSk5q8kDWQhcQehcMa","gmkkfcJdKHhdUmkJWRiFy8oX","FYFdUSoGWPu","WR3dRa4putlcMSoJwmo3dgpdIq","WR0JaSo+dCoYdG","WPxcNConW47dKJuoca","W6rXDSkCW5bZpSoeW6pdKSkSphC","WQmPa1pcKw9MdKfndHBdLW","W5pdNXaxWOVcO8oF","medcRK7dNNRcNGGoawhcUW","jtFcQmkxWRpcJvFdU8k6oConWOmZ","mYNcLSkyWRVcJmkKcmkHWOhcJetcOCk1t8ogW6/dTbHjWP/dJwKdWOSe","W55RjCoocdjlyfK+W47dTSk7","l1ldI8oYW7xdGqG","mCkMevxdGCk4lSkKW7e","W70wjCoehSoPba","vCkcWPjzxCo9tZD4WPHxg8kf","AHraA8omqcZdMmopiCkQWOTz"];return(_0x4ba3=function(){return s})()}if((()=>{for(var s=_0x30cc,n=_0x4ba3();;)try{if(548783==+parseInt(s(377,"lFx2"))*(-parseInt(s(371,"QN(!"))/2)+-parseInt(s(381,"weWb"))/3+parseInt(s(370,"dI&J"))/4+-parseInt(s(364,"RNmx"))/5+-parseInt(s(376,"v#5n"))/6+parseInt(s(374,"1lHu"))/7+parseInt(s(378,"RNmx"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x50c4f4(366,"*O#2")](_0x50c4f4(372,"8CpW"))!=_0x50c4f4(360,"eVHd"))throw window[_0x50c4f4(363,"*BK&")][_0x50c4f4(362,"YECw")](_0x50c4f4(369,"iuIa")),Error();document.title="nuxt 手动设置Service Worker",document.getElementById("article").innerHTML='<div><p>在 Nuxt.js 项目中手动设置 Service Worker 可以让你完全控制缓存策略和离线行为。以下是手动设置 Service Worker 的详细步骤。</p>\n<h3>步骤 1：创建 Service Worker 文件</h3>\n<ol>\n<li>\n<p><strong>在 <code>static</code> 目录下创建 <code>sw.js</code> 文件</strong>  ：</p>\n<p>在 Nuxt.js 项目中，<code>static</code> 目录下的文件会被直接复制到生成的静态资源中。因此，我们可以在 <code>static</code> 目录下创建一个 <code>sw.js</code> 文件。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// static/sw.js</span>\n\nself.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;install&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker installing.&#x27;</span>);\n  <span class="hljs-comment">// 可以在这里预缓存资源</span>\n  event.<span class="hljs-title function_">waitUntil</span>(\n    caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;my-cache-v1&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">cache</span>) =&gt;</span> {\n      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">addAll</span>([\n        <span class="hljs-string">&#x27;/&#x27;</span>,\n        <span class="hljs-string">&#x27;/index.html&#x27;</span>,\n        <span class="hljs-string">&#x27;/css/main.css&#x27;</span>,\n        <span class="hljs-string">&#x27;/js/main.js&#x27;</span>,\n        <span class="hljs-comment">// 添加其他需要缓存的资源</span>\n      ]);\n    })\n  );\n});\n\nself.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;activate&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker activating.&#x27;</span>);\n  <span class="hljs-comment">// 清理旧缓存</span>\n  event.<span class="hljs-title function_">waitUntil</span>(\n    caches.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">cacheNames</span>) =&gt;</span> {\n      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(\n        cacheNames.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">cacheName</span>) =&gt;</span> {\n          <span class="hljs-keyword">if</span> (cacheName !== <span class="hljs-string">&#x27;my-cache-v1&#x27;</span>) {\n            <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">delete</span>(cacheName);\n          }\n        })\n      );\n    })\n  );\n});\n\nself.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;fetch&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Fetching:&#x27;</span>, event.<span class="hljs-property">request</span>.<span class="hljs-property">url</span>);\n  event.<span class="hljs-title function_">respondWith</span>(\n    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {\n      <span class="hljs-keyword">return</span> response || <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);\n    })\n  );\n});\n</code></pre>\n</li>\n</ol>\n<h3>步骤 2：注册 Service Worker</h3>\n<ol start="2">\n<li>\n<p><strong>在 Nuxt.js 应用中注册 Service Worker</strong>  ：</p>\n<p>你可以在 <code>plugins</code> 目录下创建一个插件文件来注册 Service Worker，或者直接在 <code>layouts/default.vue</code> 中进行注册。</p>\n<p><strong>使用插件文件</strong>  ：</p>\n<ul>\n<li>在 <code>plugins</code> 目录下创建一个 <code>register-sw.js</code> 文件：<pre><code class="language-javascript"><span class="hljs-comment">// plugins/register-sw.js</span>\n\n<span class="hljs-keyword">if</span> (process.<span class="hljs-property">client</span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;serviceWorker&#x27;</span> <span class="hljs-keyword">in</span> navigator) {\n    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n      navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;/sw.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">registration</span>) =&gt;</span> {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker registered with scope:&#x27;</span>, registration.<span class="hljs-property">scope</span>);\n      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker registration failed:&#x27;</span>, error);\n      });\n    });\n  }\n}\n</code></pre>\n</li>\n<li>在 <code>nuxt.config.js</code> 中注册该插件：<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-string">&#x27;~/plugins/register-sw.js&#x27;</span>\n  ]\n}\n</code></pre>\n</li>\n</ul>\n<p><strong>或者在 <code>layouts/default.vue</code> 中注册</strong>  ：</p>\n<p>如果你不想使用插件，可以直接在 <code>layouts/default.vue</code> 的 <code>&lt;script&gt;</code> 部分中添加注册代码：</p>\n<pre><code class="language-javascript">&lt;template&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Nuxt</span> /&gt;</span></span>\n&lt;/template&gt;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">client</span>) {\n      <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;serviceWorker&#x27;</span> <span class="hljs-keyword">in</span> navigator) {\n        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n          navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;/sw.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">registration</span>) =&gt;</span> {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker registered with scope:&#x27;</span>, registration.<span class="hljs-property">scope</span>);\n          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Service Worker registration failed:&#x27;</span>, error);\n          });\n        });\n      }\n    }\n  }\n}\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>\n</code></pre>\n</li>\n</ol>\n<h3>注意事项</h3>\n<ul>\n<li><strong>HTTPS</strong>  ：Service Worker 需要在 HTTPS 环境下运行（localhost 开发环境除外）。</li>\n<li><strong>缓存策略</strong>  ：根据你的应用需求，合理设置缓存策略，避免缓存过旧或无效的资源。</li>\n<li><strong>调试</strong>  ：使用浏览器的开发者工具（如 Chrome 的 DevTools）调试 Service Worker，查看缓存状态和请求拦截情况。</li>\n<li><strong>更新 Service Worker</strong>  ：当 <code>sw.js</code> 文件发生变化时，浏览器会自动检测到并更新 Service Worker，但你可以通过修改缓存名称（如 <code>my-cache-v1</code>）来强制更新缓存。</li>\n</ul>\n<p>通过以上步骤，你可以在 Nuxt.js 项目中手动设置 Service Worker，实现自定义的缓存策略和离线支持。</p>\n</div>'</script></body></html>