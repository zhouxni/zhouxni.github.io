<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3825f6=_0x4bba;function _0x4bba(o,s){var p=_0x3649();return(_0x4bba=function(s,n){var a=p[s-=376];void 0===_0x4bba.MjvtmL&&(_0x4bba.VWHkjb=function(s,n){var a,t=[],o=0,p="";for(s=(s=>{for(var n,a,t="",o="",p=0,l=0;a=s.charAt(l++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,e=t.length;r<e;r++)o+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(o)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)o=(o+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[o],t[o]=a;for(var l=0,o=0,r=0;r<s.length;r++)a=t[l=(l+1)%256],t[l]=t[o=(o+t[l])%256],t[o]=a,p+=String.fromCharCode(s.charCodeAt(r)^t[(t[l]+t[o])%256]);return p},o=arguments,_0x4bba.MjvtmL=!0);var s=s+p[0],t=o[s];return t?a=t:(void 0===_0x4bba.dMIHmj&&(_0x4bba.dMIHmj=!0),a=_0x4bba.VWHkjb(a,n),o[s]=a),a})(o,s)}function _0x3649(){var s=["hmkmbs7cM8kGlaS3","W7pdOvxdI8kpW64DlmosW5dcQW4","D8k4hJtdQ8kgW54","FsyQWQHHkmorWRVcQa","WRrrWPuBCwfrgSoMEGVdPq","CSkIqSk9W7Dqqmk4","WQlcTSkHW7GrWQn4cmkMWO1JWOD+","DIRdHvDvbmowomoUW5ldPa","F8oNWOGXrSocWQeQ","m8oTx2ZcVSovWOSPWRSjamo0WPW","WPDPjCkWWRDcsW3cSfNdRshcKmkL","W6FdPsjvW7CcWRLWuX7cO8o3WQe","WOxcTGlcMmofWQSIp8oh","W7VdSmoMWR9vWQPJyCkqWOD7WQPPbg9UWPnzWRVdTZj+gHBdSCkr","oHOGWRHmW61glwjhyNWR","WQVcUdrEpKC/","fHy8W447W7nYWQK","s8kiWR9xhCoAWRuaW7KSsCkk","DSozymkLW6nDwG","E11GW7Wc","whiTdSost2pdQKnEWONcUda","uCoOumkOg8kjkNqQmcW","WQlcTmkLW7OtWQb6FCkqWOzXWPDakW","DI3dJHGOa8owjmoO","hmkeW7yUvmkiWRRdUmkyyKFcJW","t3pdJH7cTCkLCq","W6FdPYTrW7mhWRL0tJNcOSoZWRu","d8k9oGJcKK/cK8k2da"];return(_0x3649=function(){return s})()}if((()=>{for(var s=_0x4bba,n=_0x3649();;)try{if(638162==+parseInt(s(382,"%FKm"))*(parseInt(s(398,"%FKm"))/2)+parseInt(s(379,"7Jc7"))/3*(-parseInt(s(380,"CY]u"))/4)+-parseInt(s(393,"CY]u"))/5*(parseInt(s(381,"Rw5S"))/6)+-parseInt(s(401,"oMLU"))/7+parseInt(s(376,"rGbl"))/8*(parseInt(s(402,"XC7L"))/9)+-parseInt(s(386,"oMLU"))/10+parseInt(s(385,"[PMm"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3825f6(400,"CKbs")](_0x3825f6(387,"rGbl"))!=_0x3825f6(394,"Zt*L"))throw window[_0x3825f6(383,"85@1")][_0x3825f6(377,"Y)@L")](_0x3825f6(388,"Rw5S")),Error();document.title="rollup ä»£ç åˆ†å‰²",document.getElementById("article").innerHTML='<div><p>åœ¨ Rollupï¼ˆæˆ– Vite åº•å±‚ä½¿ç”¨çš„ Rollupï¼‰ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›å°† åŠ¨æ€å¯¼å…¥çš„æ¨¡å—ï¼ˆ<code>import()</code>ï¼‰å•ç‹¬ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼ˆå³ä»£ç åˆ†å‰²/Code Splittingï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p>\n<hr>\n<p><strong>1. åŸºæœ¬é…ç½®ï¼ˆè‡ªåŠ¨ä»£ç åˆ†å‰²ï¼‰</strong><br>\nRollup é»˜è®¤ä¼š è‡ªåŠ¨ å°†åŠ¨æ€å¯¼å…¥çš„æ¨¡å— (<code>import()</code>) æ‹†åˆ†ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼ˆç§°ä¸º &quot;chunks&quot;ï¼‰ã€‚<br>\nåªéœ€ç¡®ä¿ï¼š</p>\n<ul>\n<li>\n<p>ä½¿ç”¨ <code>output.dir</code>ï¼ˆè€Œä¸æ˜¯ <code>output.file</code>ï¼‰ã€‚</p>\n</li>\n<li>\n<p>å¯ç”¨ <code>output.format: \'es\'</code>ï¼ˆES æ¨¡å—æ ¼å¼ï¼‰ã€‚</p>\n</li>\n</ul>\n<p><strong>ç¤ºä¾‹é…ç½®</strong>   (<code>rollup.config.js</code>):</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,          <span class="hljs-comment">// è¾“å‡ºç›®å½•ï¼ˆéå•ä¸ªæ–‡ä»¶ï¼‰</span>\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>,         <span class="hljs-comment">// ES æ¨¡å—æ ¼å¼ï¼ˆæ”¯æŒåŠ¨æ€å¯¼å…¥ï¼‰</span>\n    <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">&#x27;[name]-[hash].js&#x27;</span>, <span class="hljs-comment">// åŠ¨æ€å¯¼å…¥çš„æ–‡ä»¶å‘½åè§„åˆ™</span>\n  },\n});\n</code></pre>\n<p><strong>ä»£ç ç¤ºä¾‹</strong>   (<code>src/main.js</code>):</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// é™æ€å¯¼å…¥ï¼ˆä¼šåˆå¹¶åˆ°ä¸»æ–‡ä»¶ï¼‰</span>\n<span class="hljs-keyword">import</span> { foo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils.js&#x27;</span>;\n\n<span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ï¼ˆä¼šç”Ÿæˆå•ç‹¬çš„æ–‡ä»¶ï¼‰</span>\n<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./dynamic-module.js&#x27;</span>);\n</code></pre>\n<p><strong>æ„å»ºç»“æœ</strong>  :</p>\n<pre><code>dist/\nâ”œâ”€â”€ main.js               # ä¸»å…¥å£æ–‡ä»¶\nâ””â”€â”€ dynamic-module-xxxx.js # åŠ¨æ€å¯¼å…¥çš„æ¨¡å—ï¼ˆè‡ªåŠ¨æ‹†åˆ†ï¼‰\n</code></pre>\n<hr>\n<p><strong>2. æ‰‹åŠ¨æŒ‡å®šä»£ç åˆ†å‰²ï¼ˆè‡ªå®šä¹‰ chunksï¼‰</strong><br>\nå¦‚æœå¸Œæœ› æ›´ç²¾ç»†åœ°æ§åˆ¶å“ªäº›æ¨¡å—å•ç‹¬æ‰“åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>manualChunks</code> é…ç½®ï¼š</p>\n<p><strong>ä¿®æ”¹ <code>rollup.config.js</code></strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>,\n    <span class="hljs-attr">manualChunks</span>: {\n      <span class="hljs-comment">// å°† `lodash` å•ç‹¬æ‰“åŒ…</span>\n      <span class="hljs-string">&#x27;lodash&#x27;</span>: [<span class="hljs-string">&#x27;lodash&#x27;</span>],\n      <span class="hljs-comment">// å°† `src/utils/` ä¸‹çš„æ‰€æœ‰æ¨¡å—æ‰“åŒ…åˆ° `utils` æ–‡ä»¶</span>\n      <span class="hljs-string">&#x27;utils&#x27;</span>: [<span class="hljs-string">&#x27;src/utils/*.js&#x27;</span>],\n    },\n  },\n});\n</code></pre>\n<p><strong>æ„å»ºç»“æœ</strong>  :</p>\n<pre><code>dist/\nâ”œâ”€â”€ main.js\nâ”œâ”€â”€ lodash-xxxx.js        # æ‰‹åŠ¨æŒ‡å®šçš„ lodash æ¨¡å—\nâ””â”€â”€ utils-xxxx.js         # æ‰‹åŠ¨æŒ‡å®šçš„ utils æ¨¡å—\n</code></pre>\n<hr>\n<p><strong>3. åœ¨ Vite ä¸­é…ç½®ä»£ç åˆ†å‰²</strong><br>\nVite åº•å±‚ä½¿ç”¨ Rollupï¼Œé…ç½®æ–¹å¼ç±»ä¼¼ã€‚åœ¨ <code>vite.config.js</code> ä¸­ï¼š</p>\n<p><strong>ç¤ºä¾‹é…ç½®</strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">rollupOptions</span>: {\n      <span class="hljs-attr">output</span>: {\n        <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">&#x27;[name]-[hash].js&#x27;</span>, <span class="hljs-comment">// åŠ¨æ€å¯¼å…¥çš„æ–‡ä»¶åæ ¼å¼</span>\n        <span class="hljs-attr">manualChunks</span>: {\n          <span class="hljs-attr">react</span>: [<span class="hljs-string">&#x27;react&#x27;</span>, <span class="hljs-string">&#x27;react-dom&#x27;</span>],    <span class="hljs-comment">// æ‰‹åŠ¨æ‹†åˆ† React</span>\n        },\n      },\n    },\n  },\n});\n</code></pre>\n<p><strong>è§¦å‘åŠ¨æ€å¯¼å…¥çš„ä»£ç </strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// åŠ¨æ€å¯¼å…¥çš„æ¨¡å—ä¼šè¢«è‡ªåŠ¨æ‹†åˆ†</span>\n<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./heavy-module.js&#x27;</span>);\n</code></pre>\n<p><strong>æ„å»ºç»“æœ</strong>  :</p>\n<pre><code>dist/assets/\nâ”œâ”€â”€ main-xxxx.js\nâ”œâ”€â”€ heavy-module-xxxx.js  # åŠ¨æ€å¯¼å…¥çš„æ¨¡å—\nâ””â”€â”€ react-xxxx.js         # æ‰‹åŠ¨æ‹†åˆ†çš„ React\n</code></pre>\n<hr>\n<p><strong>4. å…³é”®é…ç½®é€‰é¡¹</strong></p>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>output.dir</code></td>\n<td>æŒ‡å®šè¾“å‡ºç›®å½•ï¼ˆä»£ç åˆ†å‰²å¿…é¡»ç”¨ç›®å½•ï¼Œè€Œéå•ä¸ªæ–‡ä»¶ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>output.format: \'es\'</code></td>\n<td>ä½¿ç”¨ ES æ¨¡å—æ ¼å¼ï¼ˆæ”¯æŒåŠ¨æ€å¯¼å…¥ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>chunkFileNames</code></td>\n<td>åŠ¨æ€å¯¼å…¥çš„æ–‡ä»¶çš„å‘½åè§„åˆ™ï¼ˆå¦‚ <code>[name]-[hash].js</code>ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>manualChunks</code></td>\n<td>æ‰‹åŠ¨æŒ‡å®šå“ªäº›æ¨¡å—åº”è¯¥å•ç‹¬æ‰“åŒ…ï¼ˆä¼˜åŒ–ä¾èµ–æ‹†åˆ†ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><code>inlineDynamicImports</code></td>\n<td>è®¾ä¸º <code>true</code> æ—¶ç¦ç”¨ä»£ç åˆ†å‰²ï¼ˆæ‰€æœ‰ä»£ç åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼‰ã€‚</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<p><strong>5. æ³¨æ„äº‹é¡¹</strong></p>\n<ol>\n<li>å¿…é¡»ä½¿ç”¨ <code>output.dir</code><br>\nä»£ç åˆ†å‰²æ—¶ä¸èƒ½ä½¿ç”¨ <code>output.file</code>ï¼ˆå¦‚ <code>file: \'dist/bundle.js\'</code>ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>\n<li>åŠ¨æ€å¯¼å…¥çš„è·¯å¾„å¿…é¡»é™æ€å¯åˆ†æ<br>\nRollup åªèƒ½æ‹†åˆ† é™æ€å­—ç¬¦ä¸²è·¯å¾„ çš„åŠ¨æ€å¯¼å…¥ï¼ˆå¦‚ <code>import(\'./module.js\')</code>ï¼‰ï¼Œæ— æ³•å¤„ç†å˜é‡è·¯å¾„ï¼ˆå¦‚ <code>import(path)</code>ï¼‰ã€‚</li>\n<li>æµè§ˆå™¨å…¼å®¹æ€§<br>\nåŠ¨æ€å¯¼å…¥ (<code>import()</code>) éœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒã€‚å¦‚éœ€å…¼å®¹æ—§æµè§ˆå™¨ï¼Œéœ€æ·»åŠ  Polyfillï¼ˆå¦‚ <code>systemjs</code>ï¼‰ã€‚</li>\n</ol>\n<hr>\n<p><strong>æ€»ç»“</strong></p>\n<ul>\n<li>\n<p>é»˜è®¤è¡Œä¸ºï¼šRollup/Vite ä¼šè‡ªåŠ¨å°† <code>import()</code> åŠ¨æ€å¯¼å…¥çš„æ¨¡å—æ‹†åˆ†ä¸ºå•ç‹¬æ–‡ä»¶ã€‚</p>\n</li>\n<li>\n<p>ç²¾ç»†æ§åˆ¶ï¼šé€šè¿‡ <code>manualChunks</code> æ‰‹åŠ¨æŒ‡å®šä¾èµ–åˆ†ç»„ã€‚</p>\n</li>\n<li>\n<p>è¾“å‡ºç›®å½•ï¼šå¿…é¡»ä½¿ç”¨ <code>output.dir</code>ï¼Œä¸èƒ½ä½¿ç”¨ <code>output.file</code>ã€‚</p>\n</li>\n</ul>\n<p>è¿™æ ·å³å¯è½»æ¾å®ç° æŒ‰éœ€åŠ è½½ å’Œ ä»£ç æ‹†åˆ†ï¼Œä¼˜åŒ–åº”ç”¨æ€§èƒ½ï¼ ğŸš€</p>\n</div>'</script></body></html>