<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3825f6=_0x4bba;function _0x4bba(o,s){var p=_0x3649();return(_0x4bba=function(s,n){var a=p[s-=376];void 0===_0x4bba.MjvtmL&&(_0x4bba.VWHkjb=function(s,n){var a,t=[],o=0,p="";for(s=(s=>{for(var n,a,t="",o="",p=0,l=0;a=s.charAt(l++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,e=t.length;r<e;r++)o+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(o)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)o=(o+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[o],t[o]=a;for(var l=0,o=0,r=0;r<s.length;r++)a=t[l=(l+1)%256],t[l]=t[o=(o+t[l])%256],t[o]=a,p+=String.fromCharCode(s.charCodeAt(r)^t[(t[l]+t[o])%256]);return p},o=arguments,_0x4bba.MjvtmL=!0);var s=s+p[0],t=o[s];return t?a=t:(void 0===_0x4bba.dMIHmj&&(_0x4bba.dMIHmj=!0),a=_0x4bba.VWHkjb(a,n),o[s]=a),a})(o,s)}function _0x3649(){var s=["hmkmbs7cM8kGlaS3","W7pdOvxdI8kpW64DlmosW5dcQW4","D8k4hJtdQ8kgW54","FsyQWQHHkmorWRVcQa","WRrrWPuBCwfrgSoMEGVdPq","CSkIqSk9W7Dqqmk4","WQlcTSkHW7GrWQn4cmkMWO1JWOD+","DIRdHvDvbmowomoUW5ldPa","F8oNWOGXrSocWQeQ","m8oTx2ZcVSovWOSPWRSjamo0WPW","WPDPjCkWWRDcsW3cSfNdRshcKmkL","W6FdPsjvW7CcWRLWuX7cO8o3WQe","WOxcTGlcMmofWQSIp8oh","W7VdSmoMWR9vWQPJyCkqWOD7WQPPbg9UWPnzWRVdTZj+gHBdSCkr","oHOGWRHmW61glwjhyNWR","WQVcUdrEpKC/","fHy8W447W7nYWQK","s8kiWR9xhCoAWRuaW7KSsCkk","DSozymkLW6nDwG","E11GW7Wc","whiTdSost2pdQKnEWONcUda","uCoOumkOg8kjkNqQmcW","WQlcTmkLW7OtWQb6FCkqWOzXWPDakW","DI3dJHGOa8owjmoO","hmkeW7yUvmkiWRRdUmkyyKFcJW","t3pdJH7cTCkLCq","W6FdPYTrW7mhWRL0tJNcOSoZWRu","d8k9oGJcKK/cK8k2da"];return(_0x3649=function(){return s})()}if((()=>{for(var s=_0x4bba,n=_0x3649();;)try{if(638162==+parseInt(s(382,"%FKm"))*(parseInt(s(398,"%FKm"))/2)+parseInt(s(379,"7Jc7"))/3*(-parseInt(s(380,"CY]u"))/4)+-parseInt(s(393,"CY]u"))/5*(parseInt(s(381,"Rw5S"))/6)+-parseInt(s(401,"oMLU"))/7+parseInt(s(376,"rGbl"))/8*(parseInt(s(402,"XC7L"))/9)+-parseInt(s(386,"oMLU"))/10+parseInt(s(385,"[PMm"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3825f6(400,"CKbs")](_0x3825f6(387,"rGbl"))!=_0x3825f6(394,"Zt*L"))throw window[_0x3825f6(383,"85@1")][_0x3825f6(377,"Y)@L")](_0x3825f6(388,"Rw5S")),Error();document.title="rollup 代码分割",document.getElementById("article").innerHTML='<div><p>在 Rollup（或 Vite 底层使用的 Rollup）中，如果你希望将 动态导入的模块（<code>import()</code>）单独生成一个文件（即代码分割/Code Splitting），可以通过以下方式实现：</p>\n<hr>\n<p><strong>1. 基本配置（自动代码分割）</strong><br>\nRollup 默认会 自动 将动态导入的模块 (<code>import()</code>) 拆分为单独的文件（称为 &quot;chunks&quot;）。<br>\n只需确保：</p>\n<ul>\n<li>\n<p>使用 <code>output.dir</code>（而不是 <code>output.file</code>）。</p>\n</li>\n<li>\n<p>启用 <code>output.format: \'es\'</code>（ES 模块格式）。</p>\n</li>\n</ul>\n<p><strong>示例配置</strong>   (<code>rollup.config.js</code>):</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,          <span class="hljs-comment">// 输出目录（非单个文件）</span>\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>,         <span class="hljs-comment">// ES 模块格式（支持动态导入）</span>\n    <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">&#x27;[name]-[hash].js&#x27;</span>, <span class="hljs-comment">// 动态导入的文件命名规则</span>\n  },\n});\n</code></pre>\n<p><strong>代码示例</strong>   (<code>src/main.js</code>):</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 静态导入（会合并到主文件）</span>\n<span class="hljs-keyword">import</span> { foo } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils.js&#x27;</span>;\n\n<span class="hljs-comment">// 动态导入（会生成单独的文件）</span>\n<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./dynamic-module.js&#x27;</span>);\n</code></pre>\n<p><strong>构建结果</strong>  :</p>\n<pre><code>dist/\n├── main.js               # 主入口文件\n└── dynamic-module-xxxx.js # 动态导入的模块（自动拆分）\n</code></pre>\n<hr>\n<p><strong>2. 手动指定代码分割（自定义 chunks）</strong><br>\n如果希望 更精细地控制哪些模块单独打包，可以使用 <code>manualChunks</code> 配置：</p>\n<p><strong>修改 <code>rollup.config.js</code></strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">dir</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span>,\n    <span class="hljs-attr">manualChunks</span>: {\n      <span class="hljs-comment">// 将 `lodash` 单独打包</span>\n      <span class="hljs-string">&#x27;lodash&#x27;</span>: [<span class="hljs-string">&#x27;lodash&#x27;</span>],\n      <span class="hljs-comment">// 将 `src/utils/` 下的所有模块打包到 `utils` 文件</span>\n      <span class="hljs-string">&#x27;utils&#x27;</span>: [<span class="hljs-string">&#x27;src/utils/*.js&#x27;</span>],\n    },\n  },\n});\n</code></pre>\n<p><strong>构建结果</strong>  :</p>\n<pre><code>dist/\n├── main.js\n├── lodash-xxxx.js        # 手动指定的 lodash 模块\n└── utils-xxxx.js         # 手动指定的 utils 模块\n</code></pre>\n<hr>\n<p><strong>3. 在 Vite 中配置代码分割</strong><br>\nVite 底层使用 Rollup，配置方式类似。在 <code>vite.config.js</code> 中：</p>\n<p><strong>示例配置</strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">rollupOptions</span>: {\n      <span class="hljs-attr">output</span>: {\n        <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">&#x27;[name]-[hash].js&#x27;</span>, <span class="hljs-comment">// 动态导入的文件名格式</span>\n        <span class="hljs-attr">manualChunks</span>: {\n          <span class="hljs-attr">react</span>: [<span class="hljs-string">&#x27;react&#x27;</span>, <span class="hljs-string">&#x27;react-dom&#x27;</span>],    <span class="hljs-comment">// 手动拆分 React</span>\n        },\n      },\n    },\n  },\n});\n</code></pre>\n<p><strong>触发动态导入的代码</strong>  :</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动态导入的模块会被自动拆分</span>\n<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./heavy-module.js&#x27;</span>);\n</code></pre>\n<p><strong>构建结果</strong>  :</p>\n<pre><code>dist/assets/\n├── main-xxxx.js\n├── heavy-module-xxxx.js  # 动态导入的模块\n└── react-xxxx.js         # 手动拆分的 React\n</code></pre>\n<hr>\n<p><strong>4. 关键配置选项</strong></p>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>output.dir</code></td>\n<td>指定输出目录（代码分割必须用目录，而非单个文件）。</td>\n</tr>\n<tr>\n<td><code>output.format: \'es\'</code></td>\n<td>使用 ES 模块格式（支持动态导入）。</td>\n</tr>\n<tr>\n<td><code>chunkFileNames</code></td>\n<td>动态导入的文件的命名规则（如 <code>[name]-[hash].js</code>）。</td>\n</tr>\n<tr>\n<td><code>manualChunks</code></td>\n<td>手动指定哪些模块应该单独打包（优化依赖拆分）。</td>\n</tr>\n<tr>\n<td><code>inlineDynamicImports</code></td>\n<td>设为 <code>true</code> 时禁用代码分割（所有代码合并到一个文件）。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<p><strong>5. 注意事项</strong></p>\n<ol>\n<li>必须使用 <code>output.dir</code><br>\n代码分割时不能使用 <code>output.file</code>（如 <code>file: \'dist/bundle.js\'</code>），否则会报错。</li>\n<li>动态导入的路径必须静态可分析<br>\nRollup 只能拆分 静态字符串路径 的动态导入（如 <code>import(\'./module.js\')</code>），无法处理变量路径（如 <code>import(path)</code>）。</li>\n<li>浏览器兼容性<br>\n动态导入 (<code>import()</code>) 需要现代浏览器支持。如需兼容旧浏览器，需添加 Polyfill（如 <code>systemjs</code>）。</li>\n</ol>\n<hr>\n<p><strong>总结</strong></p>\n<ul>\n<li>\n<p>默认行为：Rollup/Vite 会自动将 <code>import()</code> 动态导入的模块拆分为单独文件。</p>\n</li>\n<li>\n<p>精细控制：通过 <code>manualChunks</code> 手动指定依赖分组。</p>\n</li>\n<li>\n<p>输出目录：必须使用 <code>output.dir</code>，不能使用 <code>output.file</code>。</p>\n</li>\n</ul>\n<p>这样即可轻松实现 按需加载 和 代码拆分，优化应用性能！ 🚀</p>\n</div>'</script></body></html>