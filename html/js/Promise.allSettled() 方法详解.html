<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x562f72=_0x1587;function _0x1587(t,s){var e=_0x4c08();return(_0x1587=function(s,n){var a=e[s-=281];void 0===_0x1587.LXsRMR&&(_0x1587.nQBnNu=function(s,n){var a,l=[],t=0,e="";for(s=(s=>{for(var n,a,l="",t="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,c=l.length;r<c;r++)t+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[t],l[t]=a;for(var p=0,t=0,r=0;r<s.length;r++)a=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=a,e+=String.fromCharCode(s.charCodeAt(r)^l[(l[p]+l[t])%256]);return e},t=arguments,_0x1587.LXsRMR=!0);var s=s+e[0],l=t[s];return l?a=l:(void 0===_0x1587.KAgjfb&&(_0x1587.KAgjfb=!0),a=_0x1587.nQBnNu(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x1587,n=_0x4c08();;)try{if(361629==+parseInt(s(292,"Cw)p"))*(parseInt(s(284,"sMwN"))/2)+parseInt(s(282,"Etj]"))/3+-parseInt(s(286,"L&&V"))/4*(parseInt(s(300,"Euw$"))/5)+-parseInt(s(308,"h59O"))/6*(-parseInt(s(309,"B#(l"))/7)+-parseInt(s(294,"DBoI"))/8*(-parseInt(s(299,"dTn]"))/9)+parseInt(s(297,"xRYL"))/10+parseInt(s(307,"Owe@"))/11*(-parseInt(s(304,"K&tI"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x562f72(305,"wKq@")](_0x562f72(285,"Etj]"))!=_0x562f72(293,"nygw"))throw window[_0x562f72(290,"sMwN")][_0x562f72(296,"pLzL")](_0x562f72(303,"%(Qb")),Error();function _0x4c08(){var s=["pCoFWRvMWQuwW75rWOBdTmkSEZi","W697W40cDCk+WR/dUCkCW6hdPfXv","WOXOW7/cGsLJWPBcRmkyWPOrW5ZcKG","WQLDbCkkFdldSMddQhm","tCkTf8kirSkGwSoW","zmkDW7uNW6CAW6qrWPpdHCkNEIigp8kgW4G4WRORWQldQspcHSkmW70","W41VW6mdW7fFW6FdJmkZWRmKurG","eSoWfmkzxCkTxG","hfjCW5BdQ8oRamoeWOy7WPddUW","rSkHW6CCWOFcG8kAWP8","W4a6WQfmyID7BSk5iW","WQJdGmobWRyXWRuSW5H/CG","W45MW6iaWO0bWOldKCkDWOO","sColW7iMWPVcOmkb","WQPDcmkpiuJcPMpdKM7dLCkQW6G","WPhdG0/dGrDGW7uVW6RdTefuW7O","uXhcSmotECorWO7cK8oYWQVdKbC","W5Oix8oByW3dMgNdHa","W4f1tSoWW53dKba","bNdcMmo/a8kmra","dYlcTSkesCoRW5ldSWBdKmkqW48V","W4LDW7tcJmkaW4qF","dKJdOSkloCkmWOBcMG","WQOvW5bGW6D6W6tcTZjqW4L2W6m","WR/cM8kpm8o8FSkA","xreEWPZcPG","p15cW4RdSmo7EG","DmoFW7BdUdWMacddVmoYuSk+mq","WQZcJx4Humo6iG","WP7cOCkwpSkfWOtcUSkvWPj5eYKS"];return(_0x4c08=function(){return s})()}document.title="Promise.allSettled() 方法详解",document.getElementById("article").innerHTML='<div><p><code>Promise.allSettled()</code> 是 ES2020 引入的一个 Promise 组合方法，它接收一个 Promise 数组作为输入，并返回一个新的 Promise，该 Promise 在所有输入的 Promise 都已完成（无论是 fulfilled 还是 rejected）时才会 resolve。</p>\n<h2>基本语法</h2>\n<pre><code class="language-javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(iterable);\n</code></pre>\n<ul>\n<li><code>iterable</code>: 一个可迭代对象（通常是 Promise 数组）</li>\n<li>返回值: 一个 Promise，在所有输入的 Promise 都完成后 resolve</li>\n</ul>\n<h2>与 <code>Promise.all()</code> 的区别</h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th><code>Promise.all()</code></th>\n<th><code>Promise.allSettled()</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>成功条件</strong></td>\n<td>所有 Promise 都成功</td>\n<td>所有 Promise 都完成（无论成功或失败）</td>\n</tr>\n<tr>\n<td><strong>返回值</strong></td>\n<td>所有成功的值的数组</td>\n<td>包含每个 Promise 结果的对象数组</td>\n</tr>\n<tr>\n<td><strong>错误处理</strong></td>\n<td>遇到第一个 reject 就立即 reject</td>\n<td>等待所有 Promise 完成</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>需要所有操作都成功</td>\n<td>需要知道每个操作的结果</td>\n</tr>\n</tbody>\n</table>\n<h2>返回值结构</h2>\n<p><code>Promise.allSettled()</code> 返回的 Promise resolve 一个数组，数组中的每个元素都是一个对象，描述对应 Promise 的结果：</p>\n<ul>\n<li>对于 fulfilled 的 Promise:<pre><code class="language-javascript">{ <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;fulfilled&#x27;</span>, <span class="hljs-attr">value</span>: &lt;结果值&gt; }\n</code></pre>\n</li>\n<li>对于 rejected 的 Promise:<pre><code class="language-javascript">{ <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;rejected&#x27;</span>, <span class="hljs-attr">reason</span>: &lt;错误原因&gt; }\n</code></pre>\n</li>\n</ul>\n<h2>使用示例</h2>\n<h3>基本用法</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> promises = [\n  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>),\n  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Error occurred&#x27;</span>),\n  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)\n];\n\n<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(promises)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {\n    results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {\n      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fulfilled&#x27;</span>) {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;成功:&#x27;</span>, result.<span class="hljs-property">value</span>);\n      } <span class="hljs-keyword">else</span> {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;失败:&#x27;</span>, result.<span class="hljs-property">reason</span>);\n      }\n    });\n  });\n\n<span class="hljs-comment">// 输出:</span>\n<span class="hljs-comment">// 成功: 1</span>\n<span class="hljs-comment">// 失败: Error occurred</span>\n<span class="hljs-comment">// 成功: 3</span>\n</code></pre>\n<h3>实际应用场景</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 同时请求多个API，需要知道每个请求的结果</span>\n<span class="hljs-keyword">const</span> apiRequests = [\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>),\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/products&#x27;</span>),\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/orders&#x27;</span>)\n];\n\n<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(apiRequests)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> successfulData = results\n      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fulfilled&#x27;</span>)\n      .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">value</span>);\n    \n    <span class="hljs-keyword">const</span> errors = results\n      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;rejected&#x27;</span>)\n      .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">reason</span>);\n    \n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;成功获取的数据:&#x27;</span>, successfulData);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;发生的错误:&#x27;</span>, errors);\n  });\n</code></pre>\n<h2>兼容性处理</h2>\n<p>如果需要在不支持 <code>Promise.allSettled()</code> 的环境中使用它，可以使用以下 polyfill:</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Promise</span>.<span class="hljs-property">allSettled</span>) {\n  <span class="hljs-title class_">Promise</span>.<span class="hljs-property">allSettled</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> \n      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(p).<span class="hljs-title function_">then</span>(\n        <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> ({ <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;fulfilled&#x27;</span>, value }),\n        <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> ({ <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;rejected&#x27;</span>, reason })\n      )\n    ));\n  };\n}\n</code></pre>\n<h2>总结</h2>\n<p><code>Promise.allSettled()</code> 是处理多个 Promise 时非常有用的工具，特别是当你:</p>\n<ol>\n<li>需要知道每个 Promise 的最终状态</li>\n<li>不想因为单个 Promise 的失败而中断整个操作</li>\n<li>需要收集所有操作的结果（包括成功和失败的）</li>\n</ol>\n<p>它提供了比 <code>Promise.all()</code> 更灵活的错误处理方式，使开发者能够更全面地处理异步操作的结果。</p>\n</div>'</script></body></html>