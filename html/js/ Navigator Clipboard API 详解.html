<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2bc1(){var s=["WO4SWO0tWP3dT2VdSCoXvCk3W7xcOa","omk6W5ZdMYWfW4KSW6nZsZ8","z142W5ldJmkprq","W5i0WQRcSSkVB3lcQ8oEzmo4W5ddIIS","Ce4XW6JdGq","WR8jWRWCW7tcPexdIW","W75BWRywsSoBWQ4ynCo6aW","W6r9WQBdRulcQmonnHldQYaWW6m","CIhcPMXKh3JdSSoY","W7tdGmopWRNcIulcGxDLW7P2","iCodW5eaW77dGmkzW7JcSq","etlcMZCsWPXWW63dQmobWOdcU10","W6KJWPmyWPldPMi/","catcNmkcDYaXi0FcI2u","WQ3dHSk2WODUWRiIgGxcKW","A8omWQf2WO0jlW","W7tdHmohWR3cIXxdMrrMW4jVb8oXcG","mq1YWQZcISosFCkyW6DZaHC","WOBcM29sCSoJbrG","mq52WQ7cJSoCh8k0W51pad7dHW","lCo2FmkrW74Ewe8zWORcOLLaaSkTW4NdICoOWPvwzfa7W4fIW5O","W5tdM1RcOmo8lKNdJ8kN","o8k8W5KTACoFxHpcLmoHWP1Kiq","ufSmswTfzhSxWR1+","gLVcUtZdJmkdW4r6W4BdU8kwmmoJ","WO4KWO0tW6hcKa7dNmoFEa"];return(_0x2bc1=function(){return s})()}function _0x2fcb(p,s){var t=_0x2bc1();return(_0x2fcb=function(s,a){var n=t[s-=197];void 0===_0x2fcb.nGYLYN&&(_0x2fcb.JtPEhm=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,o=l.length;c<o;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x2fcb.nGYLYN=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x2fcb.vLydIX&&(_0x2fcb.vLydIX=!0),n=_0x2fcb.JtPEhm(n,a),p[s]=n),n})(p,s)}var _0xde9001=_0x2fcb;if((()=>{for(var s=_0x2fcb,a=_0x2bc1();;)try{if(850584==+parseInt(s(216,"ce@e"))+-parseInt(s(217,"tyi8"))/2*(-parseInt(s(202,"V[Pj"))/3)+parseInt(s(201,"D%zN"))/4+-parseInt(s(212,"*%OW"))/5+parseInt(s(218,"q19)"))/6*(parseInt(s(204,"XmZp"))/7)+-parseInt(s(206,"g#gg"))/8*(parseInt(s(213,"&Iw]"))/9)+-parseInt(s(208,"vtf@"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0xde9001(207,"^8s4")](_0xde9001(215,"3vmu"))!=_0xde9001(209,"^8s4"))throw window[_0xde9001(210,"yxLA")][_0xde9001(220,"&8AT")](_0xde9001(199,"mal1")),Error();document.title=" Navigator Clipboard API 详解",document.getElementById("article").innerHTML='<div><h2>概述</h2>\n<p>Navigator Clipboard API 是现代浏览器提供的异步剪贴板访问接口，支持读写多种数据类型，比传统的 <code>document.execCommand(\'copy\')</code> 更强大和安全。</p>\n<h2>核心 API 方法</h2>\n<h3>1. 读取方法</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 读取文本内容</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readText</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">readText</span>();\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;剪贴板文本:&quot;</span>, text);\n    <span class="hljs-keyword">return</span> text;\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;读取失败:&quot;</span>, err);\n  }\n}\n\n<span class="hljs-comment">// 读取多种格式内容</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readMultipleFormats</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> clipboardItems = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> clipboardItems) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;可用格式:&quot;</span>, item.<span class="hljs-property">types</span>);\n\n      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> type <span class="hljs-keyword">of</span> item.<span class="hljs-property">types</span>) {\n        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(type);\n        <span class="hljs-keyword">await</span> <span class="hljs-title function_">processBlob</span>(blob, type);\n      }\n    }\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;读取失败:&quot;</span>, err);\n  }\n}\n</code></pre>\n<h3>2. 写入方法</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 写入文本</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">writeText</span>(<span class="hljs-params">content</span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">writeText</span>(content);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;文本已复制&quot;</span>);\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;写入失败:&quot;</span>, err);\n  }\n}\n\n<span class="hljs-comment">// 写入多种格式</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">writeRichContent</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> textBlob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">&quot;纯文本内容&quot;</span>], { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;text/plain&quot;</span> });\n    <span class="hljs-keyword">const</span> htmlBlob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">&quot;&lt;p&gt;HTML内容&lt;/p&gt;&quot;</span>], { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;text/html&quot;</span> });\n\n    <span class="hljs-keyword">const</span> clipboardItem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClipboardItem</span>({\n      <span class="hljs-string">&quot;text/plain&quot;</span>: textBlob,\n      <span class="hljs-string">&quot;text/html&quot;</span>: htmlBlob,\n    });\n\n    <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">write</span>([clipboardItem]);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;富内容已复制&quot;</span>);\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;写入失败:&quot;</span>, err);\n  }\n}\n</code></pre>\n<h2>支持的 MIME 类型完整列表</h2>\n<table>\n<thead>\n<tr>\n<th>MIME 类型</th>\n<th>描述</th>\n<th>示例用途</th>\n<th>浏览器支持</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>text/plain</code></td>\n<td>纯文本</td>\n<td>普通文本复制</td>\n<td>全支持</td>\n</tr>\n<tr>\n<td><code>text/html</code></td>\n<td>HTML 内容</td>\n<td>富文本编辑器</td>\n<td>Chrome, Edge, Safari</td>\n</tr>\n<tr>\n<td><code>text/css</code></td>\n<td>CSS 代码</td>\n<td>样式复制</td>\n<td>有限支持</td>\n</tr>\n<tr>\n<td><code>text/uri-list</code></td>\n<td>URL 列表</td>\n<td>链接集合</td>\n<td>Chrome, Edge</td>\n</tr>\n<tr>\n<td><code>image/png</code></td>\n<td>PNG 图像</td>\n<td>截图、图标</td>\n<td>Chrome, Edge</td>\n</tr>\n<tr>\n<td><code>image/jpeg</code></td>\n<td>JPEG 图像</td>\n<td>照片</td>\n<td>Chrome, Edge</td>\n</tr>\n<tr>\n<td><code>image/gif</code></td>\n<td>GIF 图像</td>\n<td>动图</td>\n<td>Chrome, Edge</td>\n</tr>\n<tr>\n<td><code>image/svg+xml</code></td>\n<td>SVG 图像</td>\n<td>矢量图形</td>\n<td>有限支持</td>\n</tr>\n<tr>\n<td><code>application/json</code></td>\n<td>JSON 数据</td>\n<td>数据交换</td>\n<td>有限支持</td>\n</tr>\n<tr>\n<td><code>application/rtf</code></td>\n<td>RTF 格式</td>\n<td>文档格式</td>\n<td>有限支持</td>\n</tr>\n</tbody>\n</table>\n<h2>详细使用示例</h2>\n<h3>1. 处理图片文件</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleImagePaste</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> clipboardItems = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> clipboardItems) {\n      <span class="hljs-comment">// 查找图片类型</span>\n      <span class="hljs-keyword">const</span> imageTypes = item.<span class="hljs-property">types</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">type</span>) =&gt;</span> type.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;image/&quot;</span>));\n\n      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> imageType <span class="hljs-keyword">of</span> imageTypes) {\n        <span class="hljs-keyword">const</span> imageBlob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(imageType);\n        <span class="hljs-keyword">await</span> <span class="hljs-title function_">displayImage</span>(imageBlob, imageType);\n      }\n    }\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;图片处理失败:&quot;</span>, err);\n  }\n}\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">displayImage</span>(<span class="hljs-params">blob, mimeType</span>) {\n  <span class="hljs-comment">// 创建 Object URL</span>\n  <span class="hljs-keyword">const</span> imageUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);\n\n  <span class="hljs-comment">// 创建图片元素</span>\n  <span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);\n  img.<span class="hljs-property">src</span> = imageUrl;\n  img.<span class="hljs-property">alt</span> = <span class="hljs-string">&quot;粘贴的图片&quot;</span>;\n  img.<span class="hljs-property">style</span>.<span class="hljs-property">maxWidth</span> = <span class="hljs-string">&quot;100%&quot;</span>;\n\n  <span class="hljs-comment">// 清理内存</span>\n  img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(imageUrl);\n\n  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(img);\n\n  <span class="hljs-comment">// 获取图片信息</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;图片类型:&quot;</span>, mimeType);\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;图片大小:&quot;</span>, blob.<span class="hljs-property">size</span>, <span class="hljs-string">&quot;bytes&quot;</span>);\n}\n</code></pre>\n<h3>2. 复制图片到剪贴板</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyImageToClipboard</span>(<span class="hljs-params">imageUrl</span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-comment">// 获取图片数据</span>\n    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(imageUrl);\n    <span class="hljs-keyword">const</span> imageBlob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();\n\n    <span class="hljs-comment">// 创建 ClipboardItem</span>\n    <span class="hljs-keyword">const</span> clipboardItem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClipboardItem</span>({\n      [imageBlob.<span class="hljs-property">type</span>]: imageBlob,\n      <span class="hljs-string">&quot;text/plain&quot;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">&quot;图片描述&quot;</span>], { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;text/plain&quot;</span> }),\n    });\n\n    <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">write</span>([clipboardItem]);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;图片复制成功&quot;</span>);\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;图片复制失败:&quot;</span>, err);\n  }\n}\n</code></pre>\n<h3>3. 处理富文本内容</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRichTextPaste</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> clipboardItems = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> clipboardItems) {\n      <span class="hljs-comment">// 优先获取HTML内容</span>\n      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">types</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;text/html&quot;</span>)) {\n        <span class="hljs-keyword">const</span> htmlBlob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(<span class="hljs-string">&quot;text/html&quot;</span>);\n        <span class="hljs-keyword">const</span> htmlContent = <span class="hljs-keyword">await</span> htmlBlob.<span class="hljs-title function_">text</span>();\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;HTML内容:&quot;</span>, htmlContent);\n\n        <span class="hljs-comment">// 清理HTML（可选）</span>\n        <span class="hljs-keyword">const</span> cleanHtml = <span class="hljs-title function_">sanitizeHtml</span>(htmlContent);\n        <span class="hljs-keyword">return</span> cleanHtml;\n      }\n\n      <span class="hljs-comment">// 降级到纯文本</span>\n      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">types</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;text/plain&quot;</span>)) {\n        <span class="hljs-keyword">const</span> textBlob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(<span class="hljs-string">&quot;text/plain&quot;</span>);\n        <span class="hljs-keyword">const</span> textContent = <span class="hljs-keyword">await</span> textBlob.<span class="hljs-title function_">text</span>();\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;纯文本内容:&quot;</span>, textContent);\n        <span class="hljs-keyword">return</span> textContent;\n      }\n    }\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;富文本处理失败:&quot;</span>, err);\n  }\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">sanitizeHtml</span>(<span class="hljs-params">html</span>) {\n  <span class="hljs-comment">// 简单的HTML清理函数</span>\n  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);\n  div.<span class="hljs-property">innerHTML</span> = html;\n\n  <span class="hljs-comment">// 移除危险标签</span>\n  <span class="hljs-keyword">const</span> forbiddenTags = [<span class="hljs-string">&quot;script&quot;</span>, <span class="hljs-string">&quot;style&quot;</span>, <span class="hljs-string">&quot;iframe&quot;</span>];\n  forbiddenTags.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">tag</span>) =&gt;</span> {\n    div.<span class="hljs-title function_">querySelectorAll</span>(tag).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> el.<span class="hljs-title function_">remove</span>());\n  });\n\n  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHTML</span>;\n}\n</code></pre>\n<h2>权限管理</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// 完整的权限处理</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkClipboardPermission</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-comment">// 检查权限状态</span>\n    <span class="hljs-keyword">const</span> permission = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">query</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;clipboard-read&#x27;</span>\n    });\n\n    <span class="hljs-keyword">switch</span> (permission.<span class="hljs-property">state</span>) {\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;granted&#x27;</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;已有读取权限&#x27;</span>);\n        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;\n\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;prompt&#x27;</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>需要用户授权<span class="hljs-string">&#x27;);\n        // 需要在用户交互中触发权限请求\n        return false;\n\n      case &#x27;</span>denied<span class="hljs-string">&#x27;:\n        console.log(&#x27;</span>权限被拒绝<span class="hljs-string">&#x27;);\n        return false;\n    }\n  } catch (err) {\n    console.error(&#x27;</span>权限检查失败:<span class="hljs-string">&#x27;, err);\n    return false;\n  }\n}\n\n// 请求权限（必须在用户交互中调用）\nasync function requestClipboardPermission() {\n  try {\n    // 尝试读取会触发权限请求\n    const text = await navigator.clipboard.readText();\n    return true;\n  } catch (err) {\n    if (err.name === &#x27;</span><span class="hljs-title class_">NotAllowedError</span><span class="hljs-string">&#x27;) {\n      console.log(&#x27;</span>用户拒绝了权限<span class="hljs-string">&#x27;);\n    }\n    return false;\n  }\n}\n</span></code></pre>\n<h2>错误处理最佳实践</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClipboardManager</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSupported</span> = !!navigator.<span class="hljs-property">clipboard</span>;\n  }\n\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">read</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSupported</span>) {\n      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Clipboard API not supported&quot;</span>);\n    }\n\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleError</span>(err);\n      <span class="hljs-keyword">throw</span> err;\n    }\n  }\n\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">content, options = {}</span>) {\n    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSupported</span>) {\n      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fallbackWrite</span>(content);\n    }\n\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> content === <span class="hljs-string">&quot;string&quot;</span>) {\n        <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">writeText</span>(content);\n      } <span class="hljs-keyword">else</span> {\n        <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">write</span>(content);\n      }\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;Modern API failed, using fallback&quot;</span>);\n      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fallbackWrite</span>(content);\n    }\n  }\n\n  <span class="hljs-title function_">handleError</span>(<span class="hljs-params">err</span>) {\n    <span class="hljs-keyword">switch</span> (err.<span class="hljs-property">name</span>) {\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;NotAllowedError&quot;</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;权限被拒绝&quot;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;SecurityError&quot;</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;安全错误，需要HTTPS&quot;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;TypeError&quot;</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;数据类型错误&quot;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-attr">default</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;未知错误:&quot;</span>, err);\n    }\n  }\n\n  <span class="hljs-title function_">fallbackWrite</span>(<span class="hljs-params">text</span>) {\n    <span class="hljs-comment">// 传统复制方法</span>\n    <span class="hljs-keyword">const</span> textarea = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;textarea&quot;</span>);\n    textarea.<span class="hljs-property">value</span> = text;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(textarea);\n    textarea.<span class="hljs-title function_">select</span>();\n\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> successful = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">&quot;copy&quot;</span>);\n      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(textarea);\n      <span class="hljs-keyword">return</span> successful;\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(textarea);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n    }\n  }\n}\n</code></pre>\n<h2>浏览器兼容性处理</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// 兼容性检测和降级方案</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">getClipboardAPI</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">clipboard</span> &amp;&amp; navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-property">read</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;modern&quot;</span>;\n  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">clipboard</span> &amp;&amp; navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-property">readText</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;basic&quot;</span>;\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;legacy&quot;</span>;\n  }\n}\n\n<span class="hljs-comment">// 根据浏览器能力选择策略</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">smartPasteHandler</span>(<span class="hljs-params">event</span>) {\n  <span class="hljs-keyword">const</span> apiLevel = <span class="hljs-title function_">getClipboardAPI</span>();\n\n  <span class="hljs-keyword">switch</span> (apiLevel) {\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;modern&quot;</span>:\n      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">handlePasteModern</span>();\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;basic&quot;</span>:\n      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">handlePasteBasic</span>(event);\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;legacy&quot;</span>:\n      <span class="hljs-keyword">return</span> <span class="hljs-title function_">handlePasteLegacy</span>(event);\n  }\n}\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePasteBasic</span>(<span class="hljs-params">event</span>) {\n  <span class="hljs-comment">// 只处理文本</span>\n  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">readText</span>();\n  <span class="hljs-keyword">return</span> { text };\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePasteLegacy</span>(<span class="hljs-params">event</span>) {\n  <span class="hljs-comment">// 传统方式</span>\n  <span class="hljs-keyword">const</span> clipboardData = event.<span class="hljs-property">clipboardData</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">clipboardData</span>;\n  <span class="hljs-keyword">const</span> text = clipboardData.<span class="hljs-title function_">getData</span>(<span class="hljs-string">&quot;text&quot;</span>);\n  <span class="hljs-keyword">return</span> { text };\n}\n</code></pre>\n<h2>实际应用场景</h2>\n<h3>1. 富文本编辑器</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RichTextEditor</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">element</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span> = element;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();\n  }\n\n  <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;paste&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlePaste</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));\n  }\n\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handlePaste</span>(<span class="hljs-params">event</span>) {\n    <span class="hljs-comment">// 阻止默认粘贴行为</span>\n    event.<span class="hljs-title function_">preventDefault</span>();\n\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> clipboardItems = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n      <span class="hljs-keyword">let</span> insertedContent = <span class="hljs-literal">null</span>;\n\n      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> clipboardItems) {\n        <span class="hljs-comment">// 优先使用HTML格式</span>\n        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">types</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;text/html&quot;</span>)) {\n          <span class="hljs-keyword">const</span> htmlBlob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(<span class="hljs-string">&quot;text/html&quot;</span>);\n          <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">await</span> htmlBlob.<span class="hljs-title function_">text</span>();\n          insertedContent = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeAndInsertHtml</span>(html);\n          <span class="hljs-keyword">break</span>;\n        }\n      }\n\n      <span class="hljs-comment">// 如果没有HTML，使用纯文本</span>\n      <span class="hljs-keyword">if</span> (!insertedContent) {\n        <span class="hljs-keyword">const</span> textBlob = <span class="hljs-keyword">await</span> clipboardItems[<span class="hljs-number">0</span>].<span class="hljs-title function_">getType</span>(<span class="hljs-string">&quot;text/plain&quot;</span>);\n        <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> textBlob.<span class="hljs-title function_">text</span>();\n        insertedContent = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">insertText</span>(text);\n      }\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-comment">// 降级到默认粘贴行为</span>\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fallbackPaste</span>(event);\n    }\n  }\n}\n</code></pre>\n<h3>2. 图片上传工具</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleImageUploadFromClipboard</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">read</span>();\n    <span class="hljs-keyword">const</span> images = [];\n\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {\n      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> type <span class="hljs-keyword">of</span> item.<span class="hljs-property">types</span>) {\n        <span class="hljs-keyword">if</span> (type.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;image/&quot;</span>)) {\n          <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> item.<span class="hljs-title function_">getType</span>(type);\n          images.<span class="hljs-title function_">push</span>({\n            blob,\n            type,\n            <span class="hljs-attr">name</span>: <span class="hljs-string">`pasted-image-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>.<span class="hljs-subst">${type.split(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">1</span>]}</span>`</span>,\n          });\n        }\n      }\n    }\n\n    <span class="hljs-comment">// 上传所有图片</span>\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> image <span class="hljs-keyword">of</span> images) {\n      <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadImage</span>(image);\n    }\n\n    <span class="hljs-keyword">return</span> images;\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;图片上传失败:&quot;</span>, err);\n    <span class="hljs-keyword">return</span> [];\n  }\n}\n</code></pre>\n<h2>安全最佳实践</h2>\n<ol>\n<li><strong>最小权限原则</strong>   ：只在需要时请求权限</li>\n<li><strong>用户交互要求</strong>   ：必须在用户触发的事件中调用</li>\n<li><strong>内容审查</strong>   ：对剪贴板内容进行安全检查</li>\n<li><strong>错误处理</strong>   ：妥善处理权限拒绝情况</li>\n<li><strong>隐私保护</strong>   ：明确告知用户数据用途</li>\n</ol>\n<h2>性能优化建议</h2>\n<ol>\n<li><strong>延迟加载</strong>   ：不要提前初始化剪贴板监听</li>\n<li><strong>批量处理</strong>   ：对多个项目进行批量操作</li>\n<li><strong>内存管理</strong>   ：及时释放 Object URL</li>\n<li><strong>超时处理</strong>   ：为异步操作添加超时限制</li>\n</ol>\n<p>这个详细的指南涵盖了 Navigator Clipboard API 的所有重要方面，包括高级用法、错误处理和最佳实践。</p>\n</div>'</script></body></html>