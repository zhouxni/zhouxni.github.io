<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x6ec74d=_0x2ffc;function _0x4702(){var s=["CYhcJ8kXA8kLsxDxWOVcNCk7","jCoiWQpcOu/dO8k4ECo9smkxyse","FSkSWQOzW73cU3VdJ8orFuJcVKddTa","zCoWCaqCW7/cIaRcP8oXxIfSlq","WRFdSSkSW6hdS8kvWP1vyXKrW6SuAW","i8kPW47dPqlcTCo+","sSo0W57dUSkuWPFcLNbYWQ/dISk7","W4VcMhVcPNpdU8kz","eNDzW4RdRCkUurq","W6G0WQKdW4pcOqH/","W6ZcI2RcJ8oOWOZdH1zHC8kDWR3cTa","CKpcS8ogCmk8f0CIk8kyya","W4pcIGpdOCkrbg4","WPC+asLVxmkUW4RcSeJdKmoy","FrNdTCkhjCo6ga","rCkpW7n1hmoIW4/dMG","gSo8CmkjWQbWiCofta","emo+W5THfXjaWPKnWQxdICkV","W53cOSo6W4zUx8o0lqrfirdcSqG","baldKKxdPmkAAmklWPu","FSkLWQ4xW7FcVG/cPmoptghcRG","twz1W61uFCoTu8kT","WPHMWO4aW5JcIYrrW7C","z0BdOCoAA8oblSopk8kKg8of","WRhcK8opWQZcTCohW5O","WOnkW7iRWRNcKJqdW451W57dUqFdGg9hpgebrSogwXJdGNSc","tSoLA8kNrSo/d8k0tW","g8kHWP8Jrvj3","WR84WRFdHMxcH8oXtadcJSk8zG","sJDYWRZdLW"];return(_0x4702=function(){return s})()}function _0x2ffc(p,s){var l=_0x4702();return(_0x2ffc=function(s,n){var a=l[s-=417];void 0===_0x2ffc.DOwGhe&&(_0x2ffc.IftNUT=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,c=0;a=s.charAt(c++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,u=t.length;o<u;o++)p+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)p=(p+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[p],t[p]=a;for(var c=0,p=0,o=0;o<s.length;o++)a=t[c=(c+1)%256],t[c]=t[p=(p+t[c])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(o)^t[(t[c]+t[p])%256]);return l},p=arguments,_0x2ffc.DOwGhe=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0x2ffc.Bqgjzv&&(_0x2ffc.Bqgjzv=!0),a=_0x2ffc.IftNUT(a,n),p[s]=a),a})(p,s)}if((()=>{for(var s=_0x2ffc,n=_0x4702();;)try{if(907389==-parseInt(s(439,"V]9Z"))+parseInt(s(442,"z9P9"))/2*(parseInt(s(443,"Y3h7"))/3)+parseInt(s(419,"([tU"))/4*(-parseInt(s(445,"HV@P"))/5)+-parseInt(s(435,"kduR"))/6+parseInt(s(423,"e1!G"))/7*(parseInt(s(433,"e1!G"))/8)+-parseInt(s(420,"s^iq"))/9*(-parseInt(s(429,"5Xg1"))/10)+-parseInt(s(438,"H0v#"))/11*(parseInt(s(417,"AfS5"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x6ec74d(441,"69gT")](_0x6ec74d(421,"H0v#"))!=_0x6ec74d(428,"LshQ"))throw window[_0x6ec74d(444,"*WhC")][_0x6ec74d(436,"rRpS")](_0x6ec74d(424,"vCqE")),Error();document.title="lint-staged 完全指南",document.getElementById("article").innerHTML='<div><p>lint-staged 是一个专门针对 Git 暂存区(staged)文件运行 linters 的工具，它可以显著提高代码检查效率，只对即将提交的修改部分进行检查。</p>\n<h2>1. 基本概念与工作原理</h2>\n<h3>核心特点</h3>\n<ul>\n<li><strong>只检查暂存文件</strong>  ：不检查整个项目，速度更快</li>\n<li><strong>自动修复</strong>  ：支持自动修复可修复的问题</li>\n<li><strong>灵活配置</strong>  ：可为不同文件类型配置不同任务</li>\n<li><strong>与 Husky 完美配合</strong>  ：常用在 Git 的 pre-commit 钩子中</li>\n</ul>\n<h3>工作流程</h3>\n<ol>\n<li>开发者修改文件并 <code>git add</code> 到暂存区</li>\n<li>在提交前(pre-commit)，lint-staged 获取所有暂存文件</li>\n<li>根据配置对不同类型的文件执行对应的检查/修复命令</li>\n<li>如果所有检查通过，提交继续；否则阻止提交</li>\n</ol>\n<h2>2. 安装与基础配置</h2>\n<h3>安装</h3>\n<pre><code class="language-sh">npm install --save-dev lint-staged\n<span class="hljs-comment"># 或</span>\nyarn add -D lint-staged\n<span class="hljs-comment"># 或</span>\npnpm add -D lint-staged\n</code></pre>\n<h3>基础配置 (package.json)</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint --fix&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;*.css&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stylelint --fix&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>3. 高级配置方式</h2>\n<h3>3.1 多命令配置</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{js,jsx,ts,tsx}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;prettier --write&quot;</span>\n    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;*.{css,scss}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;stylelint --fix&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;prettier --write&quot;</span>\n    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;*.md&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;prettier --write&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>3.2 使用函数配置 (.lintstagedrc.js)</h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-string">&#x27;*.js&#x27;</span>: <span class="hljs-function">(<span class="hljs-params">filenames</span>) =&gt;</span> [\n    <span class="hljs-string">`eslint --fix <span class="hljs-subst">${filenames.join(<span class="hljs-string">&#x27; &#x27;</span>)}</span>`</span>,\n    <span class="hljs-string">`prettier --write <span class="hljs-subst">${filenames.join(<span class="hljs-string">&#x27; &#x27;</span>)}</span>`</span>\n  ],\n  <span class="hljs-string">&#x27;*.css&#x27;</span>: <span class="hljs-function">(<span class="hljs-params">filenames</span>) =&gt;</span> <span class="hljs-string">`stylelint --fix <span class="hljs-subst">${filenames.join(<span class="hljs-string">&#x27; &#x27;</span>)}</span>`</span>\n}\n</code></pre>\n<h3>3.3 忽略特定文件</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix --ignore-pattern &#x27;!.eslintrc.js&#x27;&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;prettier --write&quot;</span>\n    <span class="hljs-punctuation">]</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>4. 与 Husky 集成</h2>\n<h3>推荐配置方式</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;prepare&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;husky install&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;lint:staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lint-staged&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint --fix&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;husky&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^8.0.0&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^13.0.0&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>.husky/pre-commit 文件内容</h3>\n<pre><code class="language-sh"><span class="hljs-meta">#!/usr/bin/env sh</span>\n. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span>\n\nnpm run lint:staged\n</code></pre>\n<h2>5. 常用工具集成示例</h2>\n<h3>5.1 ESLint</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{js,jsx,ts,tsx}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint --fix --max-warnings 0&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>5.2 Prettier</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{js,jsx,ts,tsx,css,scss,md,json}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;prettier --write --ignore-unknown&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>5.3 Stylelint</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{css,scss}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stylelint --fix --allow-empty-input&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>5.4 TypeScript 类型检查</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.{ts,tsx}&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;tsc-files --noEmit&quot;</span>\n    <span class="hljs-punctuation">]</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>6. 高级技巧</h2>\n<h3>6.1 部分文件检查</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// .lintstagedrc.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-string">&#x27;*.js&#x27;</span>: <span class="hljs-function">(<span class="hljs-params">filenames</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> ignoreFiles = filenames.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> !file.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;test&#x27;</span>))\n    <span class="hljs-keyword">return</span> <span class="hljs-string">`eslint --fix <span class="hljs-subst">${ignoreFiles.join(<span class="hljs-string">&#x27; &#x27;</span>)}</span>`</span>\n  }\n}\n</code></pre>\n<h3>6.2 并行执行任务</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;jest --bail --findRelatedTests&quot;</span>\n    <span class="hljs-punctuation">]</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>6.3 自定义输出格式</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;lint-staged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n      <span class="hljs-string">&quot;eslint --fix --format=codeframe&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-string">&quot;prettier --write --loglevel=warn&quot;</span>\n    <span class="hljs-punctuation">]</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>7. 调试与问题解决</h2>\n<h3>7.1 调试模式</h3>\n<pre><code class="language-sh">DEBUG=lint-staged* npm run lint:staged\n</code></pre>\n<h3>7.2 查看处理的文件</h3>\n<pre><code class="language-sh">npx lint-staged --debug\n</code></pre>\n<h3>7.3 常见问题</h3>\n<ol>\n<li><strong>命令找不到</strong>  ：确保所有 linter 已安装为开发依赖</li>\n<li><strong>无效果</strong>  ：检查文件是否已 <code>git add</code></li>\n<li><strong>性能慢</strong>  ：限制检查范围，避免检查太多文件</li>\n</ol>\n<h2>8. 性能优化建议</h2>\n<ol>\n<li><strong>限制检查范围</strong>  ：只检查真正需要检查的文件类型</li>\n<li><strong>使用缓存</strong>  ：许多 linter 支持 <code>--cache</code> 选项</li>\n<li><strong>避免重复工作</strong>  ：合理安排任务顺序</li>\n<li><strong>增量检查</strong>  ：利用工具本身的增量检查功能</li>\n</ol>\n<p>lint-staged 的这种设计使得代码检查既全面又高效，特别适合在团队开发中维护代码质量，同时不拖慢开发流程。</p>\n</div>'</script></body></html>