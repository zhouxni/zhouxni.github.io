<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1ee2d6=_0x314f;function _0x314f(t,s){var p=_0x1f31();return(_0x314f=function(s,n){var a=p[s-=141];void 0===_0x314f.nnLrmh&&(_0x314f.zMCWUm=function(s,n){var a,l=[],t=0,p="";for(s=(s=>{for(var n,a,l="",t="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)t=(t+l[e]+n.charCodeAt(e%n.length))%256,a=l[e],l[e]=l[t],l[t]=a;for(var e=0,t=0,c=0;c<s.length;c++)a=l[e=(e+1)%256],l[e]=l[t=(t+l[e])%256],l[t]=a,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[t])%256]);return p},t=arguments,_0x314f.nnLrmh=!0);var s=s+p[0],l=t[s];return l?a=l:(void 0===_0x314f.SLevfC&&(_0x314f.SLevfC=!0),a=_0x314f.zMCWUm(a,n),t[s]=a),a})(t,s)}function _0x1f31(){var s=["puFdH8kKCJNdH8o+rSodtSohWRK","WRCHnSkVWQv/WRvUWQrTm08","v8kSWOdcHK9ezmkOW5u","r8kQW6ldOfauCbf1WOVcRCo5p0KgmmopfCo3g8ouWOBcTeLRpG","pmkNWPhdMCoZWPmLswb0WQ7dOW","vapcL8kqh2BdLqq/yWJdTG","W7uoF8keWQNcSa5Yk8o/fvTC","u1tcUHpdJNeyzgzchI0","xeNdIMldVSo9WPjarrzjWPS","WPmIsCoKW7jgWQm","n8k0mftcRSoQWOHF","xGdcNmkwewBdRGi4zaNdRG","ss7dSmkFj8khEwSopcJcSwe","WQnBp8o5W63dRvC","eKrRbvXJWPH/g8oNW5W5W6rS","WR/cQsRcSqNcRJm","W7G6q1vIW7eLW6NdN8ojW5TmW5PZ","W5GaWOddS8oag0aCBJhdKmoRW4/dVW","WPmFpxWuW6VcL8khWRqMWQ3dHmk2","kvLxW7ldUSk9WRq","k8kUieBcOW","WPmCm3KuW6BcLSoKWQeSWOldM8kjWRm"];return(_0x1f31=function(){return s})()}if((()=>{for(var s=_0x314f,n=_0x1f31();;)try{if(909417==-parseInt(s(143,"s]6S"))+parseInt(s(146,"Le0!"))/2+-parseInt(s(158,"8J4*"))/3*(parseInt(s(144,"hR9K"))/4)+-parseInt(s(153,"&eAq"))/5+parseInt(s(147,"K]6h"))/6+-parseInt(s(151,"#b!*"))/7+parseInt(s(156,"&eAq"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1ee2d6(148,"jlJm")](_0x1ee2d6(159,"Saop"))!=_0x1ee2d6(155,"8i$F"))throw window[_0x1ee2d6(145,"8i$F")][_0x1ee2d6(154,"SMJ0")](_0x1ee2d6(160,"1GWI")),Error();document.title="React 的 useTransition 钩子详解",document.getElementById("article").innerHTML='<div><p><code>useTransition</code> 是 React 18 引入的一个并发特性(Concurrent Feature)钩子，用于在非阻塞UI更新的情况下管理状态转换，特别适用于需要优化用户体验的场景。</p>\n<h2>基本用法</h2>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useTransition } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();\n  \n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-comment">// 在此更新状态</span>\n      <span class="hljs-title function_">setState</span>(newState);\n    });\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      {isPending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span>}\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>开始转换<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h2>核心概念</h2>\n<h3>1. 返回值</h3>\n<p><code>useTransition</code> 返回一个数组包含两个值：</p>\n<ul>\n<li><code>isPending</code>: 布尔值，表示是否有待处理的转换</li>\n<li><code>startTransition</code>: 函数，用于标记状态更新为&quot;过渡&quot;更新</li>\n</ul>\n<h3>2. 工作原理</h3>\n<ul>\n<li><strong>非阻塞更新</strong>  : 被 <code>startTransition</code> 包裹的更新会被标记为低优先级</li>\n<li><strong>中断机制</strong>  : React 可以在渲染过程中中断这些更新</li>\n<li><strong>视觉反馈</strong>  : <code>isPending</code> 提供显示加载状态的能力</li>\n</ul>\n<h2>使用场景</h2>\n<h3>1. 输入框搜索</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchBox</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);\n  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);\n  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();\n\n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) {\n    <span class="hljs-keyword">const</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;\n    <span class="hljs-title function_">setQuery</span>(value); <span class="hljs-comment">// 立即更新输入框</span>\n    \n    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-comment">// 延迟处理搜索逻辑</span>\n      <span class="hljs-title function_">setResults</span>(<span class="hljs-title function_">search</span>(value));\n    });\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{query}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span>\n      {isPending ? <span class="hljs-tag">&lt;<span class="hljs-name">Loading</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">Results</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{results}</span> /&gt;</span>}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3>2. 标签页切换</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Tabs</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [tab, setTab] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;home&#x27;</span>);\n  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();\n\n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">selectTab</span>(<span class="hljs-params">nextTab</span>) {\n    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-title function_">setTab</span>(nextTab);\n    });\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> selectTab(&#x27;home&#x27;)}&gt;首页<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> selectTab(&#x27;about&#x27;)}&gt;关于<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n      {isPending ? <span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">tab</span>=<span class="hljs-string">{tab}</span> /&gt;</span>}\n    <span class="hljs-tag">&lt;/&gt;</span></span>\n  );\n}\n</code></pre>\n<h2>高级用法</h2>\n<h3>1. 与 <code>Suspense</code> 配合使用</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [resource, setResource] = <span class="hljs-title function_">useState</span>(initialResource);\n  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();\n\n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRefresh</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-title function_">setResource</span>(<span class="hljs-title function_">fetchProfileData</span>());\n    });\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleRefresh}</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isPending}</span>&gt;</span>\n        {isPending ? &#x27;刷新中...&#x27; : &#x27;刷新&#x27;}\n      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>}&gt;\n        <span class="hljs-tag">&lt;<span class="hljs-name">ProfileDetails</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">{resource}</span> /&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3>2. 自定义超时配置</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>({\n  <span class="hljs-attr">timeoutMs</span>: <span class="hljs-number">3000</span> <span class="hljs-comment">// 3秒超时</span>\n});\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li><strong>不是所有状态更新都适合用 <code>useTransition</code></strong>\n<ul>\n<li>用户交互反馈（如按钮点击）应该立即更新</li>\n<li>后台计算、搜索等可以延迟</li>\n</ul>\n</li>\n<li><strong>与 <code>useDeferredValue</code> 的区别</strong>\n<ul>\n<li><code>useTransition</code> 控制更新的发起方</li>\n<li><code>useDeferredValue</code> 控制值的消费方</li>\n</ul>\n</li>\n<li><strong>性能影响</strong>\n<ul>\n<li>过度使用可能导致更新延迟时间过长</li>\n<li>应结合性能测试使用</li>\n</ul>\n</li>\n<li><strong>兼容性</strong>\n<ul>\n<li>仅 React 18+ 支持</li>\n<li>需要启用并发模式(Concurrent Mode)</li>\n</ul>\n</li>\n</ol>\n<h2>实际案例</h2>\n<h3>图片画廊加载</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);\n  <span class="hljs-keyword">const</span> [photos, setPhotos] = <span class="hljs-title function_">useState</span>([]);\n  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();\n\n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) {\n    <span class="hljs-keyword">const</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;\n    <span class="hljs-title function_">setQuery</span>(value);\n    \n    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-title function_">setPhotos</span>(<span class="hljs-title function_">fetchPhotos</span>(value));\n    });\n  }\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">SearchInput</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{query}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">opacity:</span> <span class="hljs-attr">isPending</span> ? <span class="hljs-attr">0.5</span> <span class="hljs-attr">:</span> <span class="hljs-attr">1</span> }}&gt;</span>\n        {photos.map(photo =&gt; (\n          <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{photo.id}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{photo.url}</span> /&gt;</span>\n        ))}\n      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<p><code>useTransition</code> 是 React 并发特性的重要组成部分，合理使用可以显著提升应用的用户体验，特别是在处理耗时操作和复杂界面更新时。</p>\n</div>'</script></body></html>