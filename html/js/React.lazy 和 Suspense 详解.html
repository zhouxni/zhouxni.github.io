<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x4fc22a=_0x50f3;function _0x4285(){var s=["pxJcVmkrW6ldVmk4AG","FCkxWR5hmSkmWPxcHgZcG8orW57cLq","t8kZnfddOa4AzW","ar87wmkHWP7dUq","nN7dLSo5W6ddP8kNqCokW7u","eSoCW63cRwdcV2eCW6mUW78Mrq","fWhcMIvwW6OrEG","kmkvvxLYrZi","BmkKqxHZ","WPJcUCoOW5NcJZP7W4vCWQXt","wmoknWWOt2RdVYaYza","exTerfFdVh4oWOa5","WRyNW7ikiSoEW6tdICoKWQK1W5e","WPlcNsKpWRBcJCopWQVdSCkkWQddMCke","WPJcT8oIW5NcJYHfW5b9WQX0","WRtcRJdcMCkgW6lcJeO9WPO","wConr0DryuFdQW","tYRcNJzAW5Cl","DCkvWRXcnCkjW4dcKvNcJ8ogW4u","qLBdIhWAWRSvxvnSWRiu","WR0SW7ebiSoxWRFdHmopWQKkW77cKq","W53cShdcKmkRWQBdImogWOXwWOBdVG","WPpcU8oJW5hdIcnbW4PnWOK","WOpdPdldQ8oPW7ddIa","ddLmcSokeSkqW5WmCW","w8oDW5K5WQ8QtSo8WQZcKW","y3NdTSkKW7RdJg7dOMO","WQuOF8k1W4hdI8khc8kEgcTWvfRcOeKgnqb4W4/dNIJcTwNcJW","W75VuSkDW4FcMmofDW","WRaqWQ9as8o2B8kGW5VcICko"];return(_0x4285=function(){return s})()}function _0x50f3(t,s){var p=_0x4285();return(_0x50f3=function(s,a){var n=p[s-=232];void 0===_0x50f3.gXoJCj&&(_0x50f3.FzwRKp=function(s,a){var n,l=[],t=0,p="";for(s=(s=>{for(var a,n,l="",t="",p=0,e=0;n=s.charAt(e++);~n&&(a=p%4?64*a+n:n,p++%4)&&(l+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,o=l.length;c<o;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)t=(t+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[t],l[t]=n;for(var e=0,t=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[t=(t+l[e])%256],l[t]=n,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[t])%256]);return p},t=arguments,_0x50f3.gXoJCj=!0);var s=s+p[0],l=t[s];return l?n=l:(void 0===_0x50f3.pZbBCv&&(_0x50f3.pZbBCv=!0),n=_0x50f3.FzwRKp(n,a),t[s]=n),n})(t,s)}if((()=>{for(var s=_0x50f3,a=_0x4285();;)try{if(381520==-parseInt(s(240,"A6]b"))+-parseInt(s(258,"AM6%"))/2*(-parseInt(s(232,")6c8"))/3)+parseInt(s(242,"bE7s"))/4+parseInt(s(233,"BK6]"))/5*(-parseInt(s(252,"U9)v"))/6)+parseInt(s(236,"OUM5"))/7*(parseInt(s(251,"R0GG"))/8)+-parseInt(s(261,"Ep$y"))/9*(parseInt(s(257,"R0GG"))/10)+-parseInt(s(239,"pgWQ"))/11*(parseInt(s(253,"Ep$y"))/12))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x4fc22a(234,")6c8")](_0x4fc22a(237,"0wMM"))!=_0x4fc22a(249,"xXE*"))throw window[_0x4fc22a(247,"AM6%")][_0x4fc22a(244,"nM@o")](_0x4fc22a(238,"pgWQ")),Error();document.title="React.lazy 和 Suspense 详解",document.getElementById("article").innerHTML='<div><p><code>React.lazy</code> 和 <code>Suspense</code> 是 React 提供的两个核心 API，用于<strong>代码分割（Code Splitting）</strong>  和<strong>异步加载组件时的状态管理</strong>  。它们能显著优化应用性能，减少初始加载时间。</p>\n<hr>\n<h2><strong>1. React.lazy：动态加载组件</strong></h2>\n<h3><strong>基本概念</strong></h3>\n<ul>\n<li><code>React.lazy</code> 允许你<strong>动态导入（懒加载）</strong>  一个组件，只有在真正渲染时才会加载对应的代码。</li>\n<li>底层基于 <strong>ES6 动态 <code>import()</code></strong>  ，Webpack 会自动进行代码拆分（生成单独的 chunk）。</li>\n</ul>\n<h3><strong>语法</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./LazyComponent&#x27;</span>));\n</code></pre>\n<ul>\n<li><code>React.lazy</code> 接收一个返回 <code>import()</code> 的函数。</li>\n<li>组件必须<strong>默认导出（default export）</strong>  。</li>\n</ul>\n<h3><strong>示例</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./LazyComponent&#x27;</span>));\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;\n        <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3><strong>关键点</strong></h3>\n<ol>\n<li><strong>仅支持默认导出</strong>\n<ul>\n<li>如果组件是命名导出，需转换：<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span>\n  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./NamedComponent&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> ({ <span class="hljs-attr">default</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">NamedComponent</span> }))\n);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>必须搭配 <code>&lt;Suspense&gt;</code> 使用</strong>\n<ul>\n<li>否则会报错：<code>A React component suspended while rendering, but no fallback UI was specified.</code></li>\n</ul>\n</li>\n</ol>\n<hr>\n<h2><strong>2. Suspense：处理加载状态</strong></h2>\n<h3><strong>基本概念</strong></h3>\n<ul>\n<li><code>&lt;Suspense&gt;</code> 是一个<strong>边界组件</strong>  ，用于包裹懒加载组件，并提供<strong>加载时的 fallback UI</strong>  。</li>\n<li>类似于 <code>Promise</code> 的 <code>pending</code> 状态，在组件加载完成前显示 <code>fallback</code>。</li>\n</ul>\n<h3><strong>语法</strong></h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">Suspense</span> fallback={<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoadingSpinner</span> /&gt;</span></span>}&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span></span>\n&lt;/<span class="hljs-title class_">Suspense</span>&gt;\n</code></pre>\n<ul>\n<li><code>fallback</code> 可以是任意 React 节点（如 <code>div</code>、<code>Spin</code> 组件等）。</li>\n</ul>\n<h3><strong>高级用法</strong></h3>\n<h4><strong>(1) 嵌套 Suspense</strong></h4>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">Suspense</span> fallback={<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FullPageLoader</span> /&gt;</span></span>}&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span>\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">SectionLoader</span> /&gt;</span>}&gt;\n    <span class="hljs-tag">&lt;<span class="hljs-name">LazyContent</span> /&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span></span>\n&lt;/<span class="hljs-title class_">Suspense</span>&gt;\n</code></pre>\n<ul>\n<li>不同层级的组件可以有不同的加载状态。</li>\n</ul>\n<h4><strong>(2) 结合 Error Boundary 处理错误</strong></h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n  state = { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> };\n\n  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params">error</span>) {\n    <span class="hljs-keyword">return</span> { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> };\n  }\n\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) {\n      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Failed to load component.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;\n  }\n}\n\n<span class="hljs-comment">// 使用方式</span>\n&lt;<span class="hljs-title class_">ErrorBoundary</span>&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;\n    <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>\n&lt;/<span class="hljs-title class_">ErrorBoundary</span>&gt;\n</code></pre>\n<hr>\n<h2><strong>3. 实际应用场景</strong></h2>\n<h3><strong>(1) 路由懒加载（React Router v6）</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/Home&#x27;</span>));\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/About&#x27;</span>));\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;\n      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;\n        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3><strong>(2) 按需加载弹窗/复杂组件</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyModal</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./LazyModal&#x27;</span>));\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [showModal, setShowModal] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowModal(true)}&gt;Open Modal<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n      {showModal &amp;&amp; (\n        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading modal...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;\n          <span class="hljs-tag">&lt;<span class="hljs-name">LazyModal</span> <span class="hljs-attr">onClose</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowModal(false)} /&gt;\n        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>\n      )}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3><strong>(3) 预加载组件（优化用户体验）</strong></h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./LazyComponent&#x27;</span>));\n\n<span class="hljs-comment">// 鼠标悬停时预加载</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">PreloadComponent</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [isPreloaded, setIsPreloaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleMouseEnter</span> = (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./LazyComponent&#x27;</span>);\n    <span class="hljs-title function_">setIsPreloaded</span>(<span class="hljs-literal">true</span>);\n  };\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">{handleMouseEnter}</span>&gt;</span>\n      {isPreloaded ? (\n        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;\n          <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>\n      ) : (\n        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hover to load<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n      )}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<hr>\n<h2><strong>4. 限制与注意事项</strong></h2>\n<table>\n<thead>\n<tr>\n<th>问题</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>不支持 SSR（服务端渲染）</strong></td>\n<td>改用 <code>@loadable/component</code></td>\n</tr>\n<tr>\n<td><strong>仅支持默认导出</strong></td>\n<td>转换命名导出：<code>.then(module =&gt; ({ default: module.NamedExport }))</code></td>\n</tr>\n<tr>\n<td><strong>网络错误导致加载失败</strong></td>\n<td>用 <code>ErrorBoundary</code> 捕获错误</td>\n</tr>\n<tr>\n<td><strong>过度拆分可能影响性能</strong></td>\n<td>仅对非关键组件（如弹窗、路由）使用懒加载</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>5. 总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th><code>React.lazy</code></th>\n<th><code>Suspense</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>作用</strong></td>\n<td>动态加载组件</td>\n<td>提供加载状态管理</td>\n</tr>\n<tr>\n<td><strong>依赖</strong></td>\n<td>ES6 <code>import()</code></td>\n<td>必须包裹懒加载组件</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>路由、弹窗、非关键组件</td>\n<td>所有异步渲染场景</td>\n</tr>\n<tr>\n<td><strong>SSR 支持</strong></td>\n<td>❌ 不支持</td>\n<td>❌ 不支持</td>\n</tr>\n</tbody>\n</table>\n<p><strong>最佳实践：</strong></p>\n<ul>\n<li>对<strong>路由级</strong>  和<strong>非首屏组件</strong>  使用 <code>React.lazy</code>。</li>\n<li>用 <code>Suspense</code> 提供友好的加载状态。</li>\n<li>结合 <code>ErrorBoundary</code> 处理加载失败。</li>\n</ul>\n<p>通过合理使用 <code>React.lazy</code> 和 <code>Suspense</code>，可以显著提升 React 应用的加载性能和用户体验！ 🚀</p>\n</div>'</script></body></html>