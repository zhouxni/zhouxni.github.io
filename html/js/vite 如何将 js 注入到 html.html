<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3e45(){var s=["W6hdQwi5g8kqfwVcTwVdSMlcVq","A8o8sSkmW6BdGWvHjdWCzNa","l3v/WQxdQcTsAcW","stBdSe4Ro1hdVCoQW4T6lNu","g8ojWRTmBL/dUq","D1RcJs5AW7/dU0isW4KUW6iQ","WRdcLM13sSoWW6TFW5tdQ1Cxba","WQzNWORdNCkmWR4osbhdRmoyiq","DSkDBSo3FSkVWRq","A8o6smoNWPVcL1T+bq","W5/cOmo9WOVdMmkViCkKemkfe19aWRi7W5CIttSzW6PJW4eaW7lcTa","W4RcJSoptCo1W5DcyG","B2bZW5aXz8o4WQFcKqVcUslcQa","W6pdJSoaCJJdIqldVGnXW5eKrq","A2b2W54ZzSkOWPlcVrlcSWu","W6FcSmkza3lcGKm","W75mfCoFW48wiG","cqJcHgvHWP0CbSoeW6xdTmkHxG","WQiLW7hcHSoOW4CT","WPBcHGKZwfpcMLzhWPhdPWfJ","t8kTwqNdRKbxq8kRFConvLm","pSoPAs7cSSkGxGZdQW","W6RdJcLocCoKleq","zwtcJmk6w8k1W6hcLW","WQuBiSkfgSkikW","CsddK14vWRpcUG","W5NdTCo0aCoJffFdUIXVis/cPW","W4GWWQFcLmo5","WOKZWPNcI8ovcmoJ"];return(_0x3e45=function(){return s})()}var _0xbf33=_0x3788;function _0x3788(t,s){var p=_0x3e45();return(_0x3788=function(s,n){var a=p[s-=200];void 0===_0x3788.rVFivD&&(_0x3788.xpQViF=function(s,n){var a,l=[],t=0,p="";for(s=(s=>{for(var n,a,l="",t="",p=0,c=0;a=s.charAt(c++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,r=l.length;e<r;e++)t+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(t)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)t=(t+l[c]+n.charCodeAt(c%n.length))%256,a=l[c],l[c]=l[t],l[t]=a;for(var c=0,t=0,e=0;e<s.length;e++)a=l[c=(c+1)%256],l[c]=l[t=(t+l[c])%256],l[t]=a,p+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[t])%256]);return p},t=arguments,_0x3788.rVFivD=!0);var s=s+p[0],l=t[s];return l?a=l:(void 0===_0x3788.qnBcUE&&(_0x3788.qnBcUE=!0),a=_0x3788.xpQViF(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x3788,n=_0x3e45();;)try{if(509302==-parseInt(s(218,"6)eE"))*(parseInt(s(225,"[zr4"))/2)+parseInt(s(204,"Twkc"))/3+parseInt(s(203,"r$x^"))/4*(parseInt(s(205,"r$x^"))/5)+parseInt(s(210,"lKTk"))/6*(-parseInt(s(206,"HYGr"))/7)+parseInt(s(220,"nt5B"))/8+-parseInt(s(207,"h![E"))/9*(parseInt(s(212,"bTAu"))/10)+parseInt(s(228,"nt5B"))/11*(parseInt(s(209,"U^Ma"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0xbf33(223,"GHNf")](_0xbf33(221,"c%b]"))!=_0xbf33(217,"6)eE"))throw window[_0xbf33(201,"yFse")][_0xbf33(227,"wF61")](_0xbf33(200,"OUa@")),Error();document.title="vite 如何将 js 注入到 html",document.getElementById("article").innerHTML='<div><p>在 Vite 中，将打包后的 JS 文件自动注入到 HTML 文件是完全自动化的过程，但也可以通过配置进行更精细的控制。以下是详细解决方案：</p>\n<p>一、基础自动注入（默认行为）\nVite 默认会自动处理 JS 注入，只需满足：</p>\n<ol>\n<li>项目根目录 有 <code>index.html</code></li>\n<li>使用 ESM 格式 的 <code>&lt;script&gt;</code> 标签</li>\n</ol>\n<pre><code class="language-html"><span class="hljs-comment">&lt;!-- index.html --&gt;</span>\n<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-comment">&lt;!-- 自动注入点（必须有 type=&quot;module&quot;） --&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/src/main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>\n</code></pre>\n<p>构建后会生成：</p>\n<pre><code class="language-html"><span class="hljs-comment">&lt;!-- dist/index.html --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/assets/index.123abc.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<p>二、高级控制方案</p>\n<ol>\n<li>多入口配置</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">rollupOptions</span>: {\n      <span class="hljs-attr">input</span>: {\n        <span class="hljs-attr">main</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;index.html&#x27;</span>),\n        <span class="hljs-attr">about</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;about.html&#x27;</span>)\n      }\n    }\n  }\n}\n</code></pre>\n<ol start="2">\n<li>自定义注入位置\n使用 <code>transformIndexHtml</code> 钩子：</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">plugins</span>: [{\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;custom-injection&#x27;</span>,\n    <span class="hljs-title function_">transformIndexHtml</span>(<span class="hljs-params">html</span>) {\n      <span class="hljs-keyword">return</span> html.<span class="hljs-title function_">replace</span>(\n        <span class="hljs-string">&#x27;&lt;!-- inject-here --&gt;&#x27;</span>,\n        <span class="hljs-string">&#x27;&lt;script type=&quot;module&quot; src=&quot;/src/custom.js&quot;&gt;&lt;/script&gt;&#x27;</span>\n      )\n    }\n  }]\n}\n</code></pre>\n<ol start="3">\n<li>使用官方 HTML 插件</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createHtmlPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-html&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">createHtmlPlugin</span>({\n      <span class="hljs-attr">inject</span>: {\n        <span class="hljs-attr">data</span>: {\n          <span class="hljs-attr">injectScript</span>: <span class="hljs-string">&#x27;&lt;script type=&quot;module&quot; src=&quot;/src/extra.js&quot;&gt;&lt;/script&gt;&#x27;</span>\n        }\n      }\n    })\n  ]\n}\n</code></pre>\n<p>在 HTML 中使用：</p>\n<pre><code class="language-html">&lt;%= injectScript %&gt;\n</code></pre>\n<p>三、开发模式 vs 生产模式</p>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>开发模式 (<code>vite dev</code>)</th>\n<th>生产模式 (<code>vite build</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JS 加载方式</td>\n<td>原生 ESM 直接加载</td>\n<td>打包后注入优化版本</td>\n</tr>\n<tr>\n<td>路径处理</td>\n<td>保持 <code>/src/...</code> 原始路径</td>\n<td>自动替换为哈希文件名</td>\n</tr>\n<tr>\n<td>HMR 支持</td>\n<td>自动热更新</td>\n<td>无</td>\n</tr>\n</tbody>\n</table>\n<p>四、特殊场景处理</p>\n<ol>\n<li>内联 JS（不生成文件）</li>\n</ol>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">\n<span class="hljs-comment">// 直接内联代码</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Inline script&#x27;</span>);\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<ol start="2">\n<li>条件注入</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">plugins</span>: [{\n    <span class="hljs-title function_">transformIndexHtml</span>(<span class="hljs-params">html, { path }</span>) {\n      <span class="hljs-keyword">return</span> path === <span class="hljs-string">&#x27;/about.html&#x27;</span> \n        ? html + <span class="hljs-string">&#x27;&lt;script&gt;console.log(&quot;About page&quot;)&lt;/script&gt;&#x27;</span>\n        : html\n    }\n  }]\n}\n</code></pre>\n<ol start="3">\n<li>非模块化脚本</li>\n</ol>\n<pre><code class="language-html"><span class="hljs-comment">&lt;!-- 传统脚本（避免使用 type=&quot;module&quot;） --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/lib/legacy.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<p>五、完整配置示例</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>\n<span class="hljs-keyword">import</span> { createHtmlPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-html&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">createHtmlPlugin</span>({\n      <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 生产环境压缩HTML</span>\n      <span class="hljs-attr">inject</span>: {\n        <span class="hljs-attr">data</span>: {\n          <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;My App&#x27;</span>,\n          <span class="hljs-attr">injectScript</span>: <span class="hljs-string">&#x27;&#x27;</span>\n        }\n      }\n    })\n  ],\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">rollupOptions</span>: {\n      <span class="hljs-attr">output</span>: {\n        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">&#x27;js/[name].[hash].js&#x27;</span>\n      }\n    }\n  }\n})\n</code></pre>\n<p>六、注意事项</p>\n<ol>\n<li>路径规则：</li>\n</ol>\n<ul>\n<li>\n<p>绝对路径 <code>/src/...</code> 会被 Vite 处理</p>\n<ul>\n<li>相对路径 <code>./lib.js</code> 需确保文件位置正确</li>\n</ul>\n</li>\n</ul>\n<ol start="2">\n<li>性能优化：<pre><code class="language-javascript"><span class="hljs-attr">build</span>: {\n  <span class="hljs-attr">chunkSizeWarningLimit</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 调整分块大小警告阈值</span>\n  <span class="hljs-attr">rollupOptions</span>: {\n    <span class="hljs-attr">output</span>: {\n      <span class="hljs-attr">manualChunks</span>: {\n        <span class="hljs-attr">lodash</span>: [<span class="hljs-string">&#x27;lodash&#x27;</span>] <span class="hljs-comment">// 手动拆分大依赖</span>\n      }\n    }\n  }\n}\n</code></pre>\n</li>\n<li>问题排查：</li>\n</ol>\n<ul>\n<li>\n<p>如果未注入：检查 HTML 中是否有 <code>&lt;script type=&quot;module&quot;&gt;</code></p>\n<ul>\n<li>路径错误：使用 <code>import.meta.env.BASE_URL</code> 处理基础路径</li>\n</ul>\n</li>\n</ul>\n<p>Vite 的 JS 注入机制既保持了零配置的便捷性，又提供了深度定制的可能性，适合从简单到复杂的各种项目场景。</p>\n</div>'</script></body></html>