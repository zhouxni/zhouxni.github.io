<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x262052=_0x40f6;function _0x40f6(p,s){var l=_0x2ec8();return(_0x40f6=function(s,n){var a=l[s-=227];void 0===_0x40f6.xcDHDe&&(_0x40f6.mmNGjg=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,e=0;a=s.charAt(e++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=t.length;c<o;c++)p+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)p=(p+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[p],t[p]=a;for(var e=0,p=0,c=0;c<s.length;c++)a=t[e=(e+1)%256],t[e]=t[p=(p+t[e])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(c)^t[(t[e]+t[p])%256]);return l},p=arguments,_0x40f6.xcDHDe=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0x40f6.lGUmXv&&(_0x40f6.lGUmXv=!0),a=_0x40f6.mmNGjg(a,n),p[s]=a),a})(p,s)}if((()=>{for(var s=_0x40f6,n=_0x2ec8();;)try{if(764912==+parseInt(s(248,"Rwgd"))*(-parseInt(s(241,"4nkB"))/2)+-parseInt(s(254,"7yOa"))/3*(parseInt(s(227,"pq*q"))/4)+parseInt(s(232,"7Q!u"))/5*(-parseInt(s(247,"kEEN"))/6)+parseInt(s(239,"6(uC"))/7+-parseInt(s(246,"R4J5"))/8*(parseInt(s(252,"qfAx"))/9)+-parseInt(s(228,"zVAt"))/10+-parseInt(s(236,"lxGt"))/11*(-parseInt(s(238,")rvY"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x262052(253,"9@y4")](_0x262052(249,"j%jf"))!=_0x262052(233,"R4J5"))throw window[_0x262052(245,"gMy[")][_0x262052(237,"4nkB")](_0x262052(231,"!Eb(")),Error();function _0x2ec8(){var s=["W651mM4gBmoX","W5C2WRxdMN83lfyzW5pcJKi","W4K7w34SjHePj8k0W5T9zCkHzvmaWQ0mWOLTWPNdPmoraCor","qsGCyCkJldzO","amkoWP/dGci","W6CcW7nkiGWyivbmbmog","DhuYBhpcJCoVfq","fZqqcCoVCSoBc8k5CW","WQPXWQ1Wkufk","WOVcI8k7WRZdHmo+jXP3sJC","W51IWRNdSCkuAuxcSHpdKf/cNxu","o8knWRb4FxFdHmkrW7FdOxy","W6aGW6uQErPcWPhdQmkUnCk3","y2ymWPldII7cGNxdQCooW5u","WR8GWRBcTYuVs3aJbbJdUCoA","W5vIWRZdTmkqBKFcMHVdPLRcK0q","WPZdRJNcTNe8WRK+","qCopW57cHMVcKmk2xeRcGfCdzq","hCoJrN86WPW+iaRcGGi","W7KdWR/cMNxdJhu","BNGPe0mHtCo3kq","vvRcPvVdQSkGWRi1dCk6","WRiSWRlcSIqRmhe/ctFdMG","WOmfdLTrmSoAWRm","W44Yymk9erZdSG","DZ7cJGm/WPZcImkhWQaaW6RcHa","Cd/dOvvIW4hcV8kp","W7mFxfZdK8kDvW","b2VcTmoHwxVdUCk3xNJcK8oI"];return(_0x2ec8=function(){return s})()}document.title=" Nuxt3 æ’ä»¶",document.getElementById("article").innerHTML='<div><p>ä¸‹é¢ç»™å‡ºä¸€ä»½ã€ŒNuxt 3 æ’ä»¶ï¼ˆPluginsï¼‰ã€çš„ç³»ç»Ÿæ€§æŒ‡å—ï¼Œæ¶µç›–æ¦‚å¿µã€ç”Ÿå‘½å‘¨æœŸã€å®æˆ˜å†™æ³•ã€ç±»å‹æç¤ºã€å¸¸è§å‘åŠæœ€ä½³å®è·µã€‚è¯»å®Œå³å¯åœ¨ä»»ä½•è§„æ¨¡çš„é¡¹ç›®ä¸­ç†Ÿç»ƒç¼–å†™ä¸ç»´æŠ¤ Nuxt 3 æ’ä»¶ã€‚</p>\n<hr>\n<h2>1. ä»€ä¹ˆæ˜¯ Nuxt 3 æ’ä»¶ï¼Ÿ</h2>\n<ul>\n<li>\n<p><strong>å®šä¹‰</strong><br>\næ’ä»¶æ˜¯ã€Œåœ¨ Nuxt åº”ç”¨å¯åŠ¨æ—©æœŸè¢«è‡ªåŠ¨åŠ è½½çš„ä¸€æ®µä»£ç ã€ï¼Œç”¨äºï¼š</p>\n<ul>\n<li>æ³¨å†Œå…¨å±€ç»„ä»¶ / æŒ‡ä»¤ / åº“ï¼ˆå¦‚ VueUseã€Vuetifyï¼‰</li>\n<li>æŠŠç¬¬ä¸‰æ–¹å®ä¾‹æ³¨å…¥åˆ° Nuxt ä¸Šä¸‹æ–‡ï¼ˆ<code>$axios</code>, <code>$dayjs</code> â€¦ï¼‰</li>\n<li>è¿è¡Œä¸€æ¬¡æ€§åˆå§‹åŒ–é€»è¾‘ï¼ˆæ‹¦æˆªå™¨ã€i18nã€Sentryã€mock æœåŠ¡â€¦ï¼‰</li>\n</ul>\n</li>\n<li>\n<p><strong>ä¸ Nuxt 2 çš„å·®å¼‚</strong></p>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>Nuxt 2</th>\n<th>Nuxt 3</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ–‡ä»¶ä½ç½®</td>\n<td><code>plugins/</code></td>\n<td><code>plugins/</code>ï¼ˆæ”¯æŒ <code>.js/.ts</code>ï¼‰</td>\n</tr>\n<tr>\n<td>å¯¼å‡ºæ–¹å¼</td>\n<td><code>export default (ctx, inject) =&gt; {}</code></td>\n<td><code>export default defineNuxtPlugin(nuxtApp =&gt; {})</code></td>\n</tr>\n<tr>\n<td>ç±»å‹æ”¯æŒ</td>\n<td>æ‰‹å†™ <code>Context</code></td>\n<td>å®Œæ•´çš„ TypeScript æ³›å‹æ¨å¯¼</td>\n</tr>\n<tr>\n<td>è‡ªåŠ¨æ³¨å†Œ</td>\n<td>éœ€é…ç½® <code>plugins: []</code></td>\n<td><strong>é›¶é…ç½®</strong>   ï¼Œæ–‡ä»¶å³æ’ä»¶</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<hr>\n<h2>2. æ’ä»¶ç”Ÿå‘½å‘¨æœŸ</h2>\n<ol>\n<li>Nitro å¯åŠ¨ï¼ˆServerï¼‰</li>\n<li>æœåŠ¡ç«¯æ’ä»¶æ‰§è¡Œï¼ˆSSRï¼‰</li>\n<li>å®¢æˆ·ç«¯æ°´åˆï¼ˆClient Hydrationï¼‰</li>\n<li>å®¢æˆ·ç«¯æ’ä»¶æ‰§è¡Œï¼ˆCSRï¼‰</li>\n</ol>\n<blockquote>\n<p>æ’ä»¶é»˜è®¤ã€Œ<strong>åŒæ—¶</strong>   ã€è¿è¡Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼›å¯é€šè¿‡æ–‡ä»¶åæˆ–æ¡ä»¶è¯­å¥æ§åˆ¶ã€‚</p>\n</blockquote>\n<hr>\n<h2>3. æ–‡ä»¶çº¦å®šä¸å‘½å</h2>\n<pre><code>plugins/\nâ”œâ”€ foo.client.ts     # ä»…åœ¨æµè§ˆå™¨æ‰§è¡Œ\nâ”œâ”€ bar.server.ts     # ä»…åœ¨æœåŠ¡å™¨æ‰§è¡Œ\nâ”œâ”€ baz.ts            # ä¸¤ç«¯éƒ½ä¼šæ‰§è¡Œ\nâ””â”€ deep/\n   â””â”€ nested.ts      # æ”¯æŒå­ç›®å½•\n</code></pre>\n<blockquote>\n<p>ä¸éœ€è¦åœ¨ <code>nuxt.config</code> ä¸­å£°æ˜ï¼Œ<code>/plugins/**</code> è‡ªåŠ¨æ‰«æã€‚</p>\n</blockquote>\n<hr>\n<h2>4. æœ€å°å¯è¿è¡Œç¤ºä¾‹</h2>\n<h3>4.1 å®šä¹‰æ’ä»¶</h3>\n<p><code>plugins/hello.client.ts</code></p>\n<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ğŸ‘‹ å®¢æˆ·ç«¯æ’ä»¶å·²æ‰§è¡Œ&quot;</span>);\n});\n</code></pre>\n<h3>4.2 å¸¦æ³¨å…¥çš„æ’ä»¶</h3>\n<p><code>plugins/dayjs.ts</code></p>\n<pre><code class="language-ts"><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs&quot;</span>;\n<span class="hljs-keyword">import</span> relativeTime <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs/plugin/relativeTime&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">(<span class="hljs-params">nuxtApp</span>) =&gt;</span> {\n  dayjs.<span class="hljs-title function_">extend</span>(relativeTime);\n\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">provide</span>: {\n      <span class="hljs-attr">dayjs</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">date</span>?: dayjs.<span class="hljs-title class_">ConfigType</span></span>) =&gt;</span> <span class="hljs-title function_">dayjs</span>(date),\n    },\n  };\n});\n</code></pre>\n<h3>4.3 åœ¨ç»„ä»¶ / API ä¸­ä½¿ç”¨</h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript">\n  <span class="hljs-keyword">const</span> { $dayjs } = <span class="hljs-title function_">useNuxtApp</span>();\n  <span class="hljs-keyword">const</span> ago = $dayjs(<span class="hljs-string">&quot;2023-01-01&quot;</span>).<span class="hljs-title function_">fromNow</span>();\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<hr>\n<h2>5. æ’ä»¶å‡½æ•°ç­¾å</h2>\n<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">(<span class="hljs-params">nuxtApp</span>) =&gt;</span> {\n  <span class="hljs-comment">// 1. è®¿é—®è¿è¡Œæ—¶</span>\n  <span class="hljs-keyword">const</span> { $config } = nuxtApp;\n\n  <span class="hljs-comment">// 2. æ³¨å†Œå…¨å±€å±æ€§</span>\n  nuxtApp.<span class="hljs-property">vueApp</span>.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$injected</span> = <span class="hljs-string">&quot;value&quot;</span>;\n\n  <span class="hljs-comment">// 3. ä½¿ç”¨ useRuntimeConfig / useRouter / useFetch ç­‰ç»„åˆå¼å‡½æ•°</span>\n  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();\n  router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è·¯ç”±å®ˆå«&quot;</span>, to.<span class="hljs-property">path</span>);\n  });\n\n  <span class="hljs-comment">// 4. è¿”å›ä¾›æ¨¡æ¿ä½¿ç”¨çš„æ³¨å…¥</span>\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">provide</span>: {\n      <span class="hljs-attr">hello</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-string">`Hello <span class="hljs-subst">${name}</span>`</span>,\n    },\n  };\n});\n</code></pre>\n<hr>\n<h2>6. è¿è¡Œç¯å¢ƒåˆ¤æ–­</h2>\n<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">server</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ä»…æœåŠ¡å™¨æ‰§è¡Œ&quot;</span>);\n  }\n  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">client</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ä»…æµè§ˆå™¨æ‰§è¡Œ&quot;</span>);\n  }\n});\n</code></pre>\n<hr>\n<h2>7. é«˜çº§æŠ€å·§</h2>\n<h3>7.1 æ’ä»¶å¯å¼‚æ­¥</h3>\n<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-title function_">async</span> () =&gt; {\n  <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> $fetch(<span class="hljs-string">&quot;/api/config&quot;</span>);\n  <span class="hljs-keyword">return</span> { <span class="hljs-attr">provide</span>: { <span class="hljs-attr">config</span>: data } };\n});\n</code></pre>\n<h3>7.2 æ’ä»¶å¯æ³¨å†Œå…¨å±€ç»„ä»¶</h3>\n<pre><code class="language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">MyButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/components/MyButton.vue&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">(<span class="hljs-params">nuxtApp</span>) =&gt;</span> {\n  nuxtApp.<span class="hljs-property">vueApp</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&quot;MyButton&quot;</span>, <span class="hljs-title class_">MyButton</span>);\n  nuxtApp.<span class="hljs-property">vueApp</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&quot;MyButton&quot;</span>, <span class="hljs-title class_">MyButton</span>); <span class="hljs-comment">// æ”¯æŒé“¾å¼</span>\n});\n</code></pre>\n<h3>7.3 æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤</h3>\n<pre><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">(<span class="hljs-params">nuxtApp</span>) =&gt;</span> {\n  nuxtApp.<span class="hljs-property">vueApp</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;focus&quot;</span>, {\n    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>) {\n      el.<span class="hljs-title function_">focus</span>();\n    },\n  });\n});\n</code></pre>\n<h3>7.4 ä½¿ç”¨ Pinia Store</h3>\n<pre><code class="language-ts"><span class="hljs-keyword">import</span> { useAuthStore } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/stores/auth&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtPlugin</span>(<span class="hljs-function">(<span class="hljs-params">nuxtApp</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> auth = <span class="hljs-title function_">useAuthStore</span>(nuxtApp.<span class="hljs-property">$pinia</span>);\n  auth.<span class="hljs-title function_">refreshToken</span>();\n});\n</code></pre>\n<hr>\n<h2>8. ç±»å‹å£°æ˜ï¼ˆé›¶é…ç½®ï¼‰</h2>\n<p>Nuxt 3 ä¼šè‡ªåŠ¨æŠŠæ’ä»¶çš„ <code>provide</code> åˆå¹¶åˆ° <code>NuxtApp</code> ç±»å‹ã€‚<br>\nå¦‚éœ€æ‰‹åŠ¨å¢å¼ºï¼š</p>\n<p><code>types/plugins.d.ts</code></p>\n<pre><code class="language-ts"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;#app&quot;</span> {\n  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NuxtApp</span> {\n    <span class="hljs-attr">$hello</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>;\n    <span class="hljs-attr">$dayjs</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">date</span>?: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;dayjs&quot;</span>).<span class="hljs-property">Dayjs</span>;\n  }\n}\n\n<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;vue&quot;</span> {\n  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentCustomProperties</span> {\n    <span class="hljs-attr">$hello</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>;\n  }\n}\n</code></pre>\n<hr>\n<h2>9. å¸¸è§é”™è¯¯æ’æŸ¥è¡¨</h2>\n<table>\n<thead>\n<tr>\n<th>é”™è¯¯ä¿¡æ¯</th>\n<th>åŸå› </th>\n<th>è§£å†³</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Cannot read properties of undefined ($xxx)</code></td>\n<td>æ’ä»¶åªåœ¨æœåŠ¡ç«¯è¿è¡Œï¼Œå´åœ¨å®¢æˆ·ç«¯æ¨¡æ¿ä¸­ä½¿ç”¨</td>\n<td>æ”¹å <code>.client.ts</code> æˆ–åŠ åˆ¤æ–­</td>\n</tr>\n<tr>\n<td><code>window is not defined</code></td>\n<td>æ’ä»¶åœ¨æœåŠ¡ç«¯è®¿é—® <code>window</code></td>\n<td>ç”¨ <code>process.client</code> åŒ…è£¹</td>\n</tr>\n<tr>\n<td>ç±»å‹æç¤ºä¸¢å¤±</td>\n<td>æœªå†™ <code>declare module</code></td>\n<td>è§ç¬¬ 8 èŠ‚</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2>10. æœ€ä½³å®è·µæ¸…å•</h2>\n<p>âœ… ä½¿ç”¨ <code>defineNuxtPlugin</code> ä¿è¯ç±»å‹å®‰å…¨<br>\nâœ… æ’ä»¶èŒè´£å•ä¸€ï¼Œä¸€ä¸ªæ’ä»¶åªåšä¸€ä»¶äº‹<br>\nâœ… éœ€è¦åº“å®ä¾‹ï¼ˆaxiosã€i18nï¼‰æ—¶ï¼Œç»Ÿä¸€ç”¨ <code>provide</code> æ³¨å…¥ï¼Œè€Œä¸æ˜¯æŒ‚å…¨å±€å˜é‡<br>\nâœ… æœåŠ¡ç«¯æ•æ„Ÿä¿¡æ¯åªåœ¨ <code>.server.ts</code> æ’ä»¶ä¸­ä½¿ç”¨<br>\nâœ… å¯¹ç¬¬ä¸‰æ–¹ UI åº“ï¼ˆVuetifyã€ElementPlusï¼‰åœ¨ <code>.client.ts</code> æ’ä»¶é‡Œ <code>app.use</code><br>\nâœ… å¤§ä½“ç§¯åº“æŒ‰éœ€å¼•å…¥ï¼Œé…åˆ Nuxt çš„ auto-import &amp; tree-shaking</p>\n<hr>\n<h2>11. å®Œæ•´èŒƒä¾‹ä»“åº“</h2>\n<p>GitHub å®˜æ–¹ç¤ºä¾‹ï¼š<br>\nhttps://github.com/nuxt/examples/tree/main/features/plugins</p>\n<hr>\n<p>è‡³æ­¤ï¼Œä½ å·²æŒæ¡ Nuxt 3 æ’ä»¶çš„å…¨éƒ¨æ ¸å¿ƒèƒ½åŠ›ã€‚Happy coding!</p>\n</div>'</script></body></html>