<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1f4a40=_0x7d3f;if((()=>{for(var s=_0x7d3f,a=_0x236f();;)try{if(807718==-parseInt(s(407,"5wZ("))*(-parseInt(s(403,"TPt@"))/2)+-parseInt(s(406,"b8mP"))/3*(parseInt(s(400,"OJQ4"))/4)+parseInt(s(399,"kfA]"))/5*(parseInt(s(413,"Td0J"))/6)+parseInt(s(414,"2N&O"))/7*(-parseInt(s(396,"Sy]i"))/8)+-parseInt(s(388,"ykG3"))/9+parseInt(s(405,"HeqZ"))/10*(-parseInt(s(393,"9vT@"))/11)+parseInt(s(402,"HeqZ"))/12)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1f4a40(391,"*D#x")](_0x1f4a40(392,"1@NE"))!=_0x1f4a40(390,"!mNR"))throw window[_0x1f4a40(389,"Sy]i")][_0x1f4a40(409,"HeqZ")](_0x1f4a40(410,"TMsO")),Error();function _0x7d3f(p,s){var t=_0x236f();return(_0x7d3f=function(s,a){var n=t[s-=388];void 0===_0x7d3f.iaPIKt&&(_0x7d3f.uBAUmH=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x7d3f.iaPIKt=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x7d3f.lcnnHK&&(_0x7d3f.lcnnHK=!0),n=_0x7d3f.uBAUmH(n,a),p[s]=n),n})(p,s)}function _0x236f(){var s=["W6iJWRpcRN9Yu8kqW7Po","xu9WqejZW5pcIG4z","W77dMtm5iIhdQh/cRCouxNbjqa","FrldU1RcO8kjDSkX","FCoqWQ7cOSoeWQJdRmkdW4NdNW","W7JdMZi/xhNcLIRcO8og","l8kqWPG6uqFdOSowygC","umoiaI/cU8o3mSoBW65i","BSkFWRmQW5yRWOBcOH/dK092W4O","WRJcJxzJDxpcVq","WRddLmkHW6qRhSoRamoeBCk7WPBdOmkho8oNg8ovW5PzWPlcN3NdHmoAWPu","BKDOF8kSWO7cRxa","W6hcPSk7qaBdI2jlWPXvqmklWRa","W67dOSkbWQzIldOY","eNRcQSocdCkSW6SKWRpdPG","v8oibYRdHSkUDCkfW6fvimoBW5hdJa","W4ddImo1ddBcL8kYpSoDrq","dHbgWQPmWONcQmolwxqb","W6hcPSk8sGpdGMraWPLxEmk6WPK","pmoRvhLlf0a7","WOpcRmkMFSkQ","Fmo0kH3dICkCW64","lXWJfwfLW5ZcJca","W4tdGSoYdu/cS8kZomoCASkz","WPddHcamW7/dK385h8ol","vCoaas3dGCoscSowW65Oja","yCkYdYWpevGJW5nXuG","B1uIW6pdGCkvW5WGW5ZcJa","WRr5WQ/dStrbymoI","BdKRw1nYWRNcOSk1W4xdVSovDq"];return(_0x236f=function(){return s})()}document.title="TypeScript 类型守卫详解",document.getElementById("article").innerHTML='<div><p>类型守卫（Type Guards）是 TypeScript 中用于在运行时检查类型并缩小类型范围的机制。以下是全面的类型守卫解析：</p>\n<h2>一、基础类型守卫</h2>\n<h3>1. <code>typeof</code> 类型守卫</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">&quot;number&quot;</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; &quot;</span>.<span class="hljs-title function_">repeat</span>(padding) + value; <span class="hljs-comment">// padding被推断为number</span>\n  }\n  <span class="hljs-keyword">return</span> padding + value; <span class="hljs-comment">// padding被推断为string</span>\n}\n</code></pre>\n<h3>2. <code>instanceof</code> 类型守卫</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> {\n  <span class="hljs-title function_">fly</span>(<span class="hljs-params"></span>) {}\n}\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span> {\n  <span class="hljs-title function_">swim</span>(<span class="hljs-params"></span>) {}\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">move</span>(<span class="hljs-params"><span class="hljs-attr">animal</span>: <span class="hljs-title class_">Bird</span> | <span class="hljs-title class_">Fish</span></span>) {\n  <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bird</span>) {\n    animal.<span class="hljs-title function_">fly</span>(); <span class="hljs-comment">// animal被推断为Bird</span>\n  } <span class="hljs-keyword">else</span> {\n    animal.<span class="hljs-title function_">swim</span>(); <span class="hljs-comment">// animal被推断为Fish</span>\n  }\n}\n</code></pre>\n<h3>3. <code>in</code> 操作符守卫</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> {\n  <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span>;\n}\n<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cat</span> {\n  <span class="hljs-title function_">meow</span>(): <span class="hljs-built_in">void</span>;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">petSound</span>(<span class="hljs-params"><span class="hljs-attr">pet</span>: <span class="hljs-title class_">Dog</span> | <span class="hljs-title class_">Cat</span></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;bark&quot;</span> <span class="hljs-keyword">in</span> pet) {\n    pet.<span class="hljs-title function_">bark</span>(); <span class="hljs-comment">// pet被推断为Dog</span>\n  } <span class="hljs-keyword">else</span> {\n    pet.<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// pet被推断为Cat</span>\n  }\n}\n</code></pre>\n<h2>二、自定义类型守卫</h2>\n<h3>1. 类型谓词（Type Predicate）</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params"><span class="hljs-attr">test</span>: <span class="hljs-built_in">any</span></span>): test is <span class="hljs-built_in">string</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> test === <span class="hljs-string">&quot;string&quot;</span>;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isString</span>(x)) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x.<span class="hljs-property">length</span>); <span class="hljs-comment">// x被推断为string</span>\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// x被推断为number</span>\n  }\n}\n</code></pre>\n<h3>2. 复杂对象类型检查</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> {\n  <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;admin&quot;</span>;\n  <span class="hljs-attr">adminOnly</span>: <span class="hljs-built_in">boolean</span>;\n}\n<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {\n  <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;user&quot;</span>;\n  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">isAdmin</span>(<span class="hljs-params"><span class="hljs-attr">person</span>: <span class="hljs-title class_">Admin</span> | <span class="hljs-title class_">User</span></span>): person is <span class="hljs-title class_">Admin</span> {\n  <span class="hljs-keyword">return</span> person.<span class="hljs-property">role</span> === <span class="hljs-string">&quot;admin&quot;</span>;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">showDashboard</span>(<span class="hljs-params"><span class="hljs-attr">person</span>: <span class="hljs-title class_">Admin</span> | <span class="hljs-title class_">User</span></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isAdmin</span>(person)) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">adminOnly</span>); <span class="hljs-comment">// person被推断为Admin</span>\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// person被推断为User</span>\n  }\n}\n</code></pre>\n<h2>三、高级守卫技巧</h2>\n<h3>1. 联合类型判别式</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Square</span> = { <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;square&quot;</span>; <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span> };\n<span class="hljs-keyword">type</span> <span class="hljs-title class_">Circle</span> = { <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;circle&quot;</span>; <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span> };\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">area</span>(<span class="hljs-params"><span class="hljs-attr">shape</span>: <span class="hljs-title class_">Square</span> | <span class="hljs-title class_">Circle</span></span>) {\n  <span class="hljs-keyword">switch</span> (shape.<span class="hljs-property">kind</span>) {\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;square&quot;</span>:\n      <span class="hljs-keyword">return</span> shape.<span class="hljs-property">size</span> * shape.<span class="hljs-property">size</span>; <span class="hljs-comment">// shape被推断为Square</span>\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;circle&quot;</span>:\n      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * shape.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>; <span class="hljs-comment">// shape被推断为Circle</span>\n  }\n}\n</code></pre>\n<h3>2. 类型守卫函数组合</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isNumberArray</span>(<span class="hljs-params"><span class="hljs-attr">arr</span>: <span class="hljs-built_in">unknown</span></span>): arr is <span class="hljs-built_in">number</span>[] {\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr) &amp;&amp; arr.<span class="hljs-title function_">every</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">&quot;number&quot;</span>);\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">processArray</span>(<span class="hljs-params"><span class="hljs-attr">arr</span>: <span class="hljs-built_in">unknown</span></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNumberArray</span>(arr)) {\n    <span class="hljs-keyword">const</span> sum = arr.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>); <span class="hljs-comment">// arr被推断为number[]</span>\n    <span class="hljs-keyword">return</span> sum;\n  }\n  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid array type&quot;</span>);\n}\n</code></pre>\n<h2>四、类型守卫与泛型</h2>\n<h3>1. 泛型类型守卫</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> isOfType&lt;T&gt;(<span class="hljs-attr">obj</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">key</span>: keyof T): obj is T {\n  <span class="hljs-keyword">return</span> key <span class="hljs-keyword">in</span> obj;\n}\n\n<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {\n  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;\n  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;\n}\n\n<span class="hljs-keyword">const</span> <span class="hljs-attr">maybePerson</span>: <span class="hljs-built_in">unknown</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> };\n\n<span class="hljs-keyword">if</span> (isOfType&lt;<span class="hljs-title class_">Person</span>&gt;(maybePerson, <span class="hljs-string">&quot;age&quot;</span>)) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(maybePerson.<span class="hljs-property">name</span>); <span class="hljs-comment">// maybePerson被推断为Person</span>\n}\n</code></pre>\n<h3>2. 类型守卫工厂</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> createTypeGuard&lt;T&gt;(<span class="hljs-attr">keys</span>: (keyof T)[]) {\n  <span class="hljs-keyword">return</span> (<span class="hljs-attr">obj</span>: <span class="hljs-built_in">unknown</span>): obj is T =&gt; {\n    <span class="hljs-keyword">return</span> keys.<span class="hljs-title function_">every</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> key <span class="hljs-title function_">in</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>));\n  };\n}\n\n<span class="hljs-keyword">const</span> isPerson = createTypeGuard&lt;<span class="hljs-title class_">Person</span>&gt;([<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>]);\n\n<span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPerson</span>(maybePerson)) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(maybePerson.<span class="hljs-property">age</span>); <span class="hljs-comment">// maybePerson被推断为Person</span>\n}\n</code></pre>\n<h2>五、常见应用场景</h2>\n<h3>1. API响应处理</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">SuccessResponse</span> {\n  <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;success&quot;</span>;\n  <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>;\n}\n<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ErrorResponse</span> {\n  <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;error&quot;</span>;\n  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResponse</span>(<span class="hljs-params"><span class="hljs-attr">response</span>: <span class="hljs-title class_">SuccessResponse</span> | <span class="hljs-title class_">ErrorResponse</span></span>) {\n  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-string">&quot;success&quot;</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">data</span>); <span class="hljs-comment">// response被推断为SuccessResponse</span>\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span>); <span class="hljs-comment">// response被推断为ErrorResponse</span>\n  }\n}\n</code></pre>\n<h3>2. 表单验证</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">FormField</span> =\n  | { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;text&quot;</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">maxLength</span>: <span class="hljs-built_in">number</span> }\n  | { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;number&quot;</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">min</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">max</span>: <span class="hljs-built_in">number</span> };\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateField</span>(<span class="hljs-params"><span class="hljs-attr">field</span>: <span class="hljs-title class_">FormField</span></span>) {\n  <span class="hljs-keyword">if</span> (field.<span class="hljs-property">type</span> === <span class="hljs-string">&quot;text&quot;</span>) {\n    <span class="hljs-keyword">return</span> field.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &lt;= field.<span class="hljs-property">maxLength</span>; <span class="hljs-comment">// field被推断为text类型</span>\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-keyword">return</span> field.<span class="hljs-property">value</span> &gt;= field.<span class="hljs-property">min</span> &amp;&amp; field.<span class="hljs-property">value</span> &lt;= field.<span class="hljs-property">max</span>; <span class="hljs-comment">// field被推断为number类型</span>\n  }\n}\n</code></pre>\n<p>类型守卫是 TypeScript 类型系统的核心特性之一，合理使用可以显著提高代码的类型安全性和可维护性。</p>\n</div>'</script></body></html>