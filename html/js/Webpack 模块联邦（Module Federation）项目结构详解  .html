<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x384bb9=_0x29f9;function _0xb2a0(){var s=["W4iSxGFdI2hdN21WW7NcTmod","W4bQW6eAWPddGxFdIfDwu8ob","W7RdUCkqiMi6tSo/WO/cGgzrWPJcVSk/a1VcKgqJtmkzWOBdHCk+WOm","WRD3bfFcGspdHeL7","tCk8EICefXNdQSoz","CSkyWQtcG1zSW4tcRW","WOFdLSkpAw3dPZPflKrz","f8kBpJlcP8olW7VdH8khWRTriW","gLD1z2ddH8kmCwm","lCkLWRL6W5i","WQDqBeq2WPD6","rmkiW5RcKxFdMmkhW7PcWOTWEG","WR1oW53dVGtcVmkuW6iI","W7ldSSkkW4ZcM1VdRJ7dTt1CW6y","lmolW4XcW77cLCowWPGtz8k/WQ4","cchdUL8krwhdICkkWOVdLa","amkGWR/cGCoRWPjkWOpcSIyYdt7cPW","fX0VW7pcLNOXWQ7dQW","W4uKaudcGbRdTMm","WO9WpSkvWQpdVSor","W7xdSSoFWO7dKsxdPH8","bSoWnb9+WQ/dVmoc","nmo6W4NdTCkYWRrF","eCkqpZ7cQCooWP/dI8kAWQ9ootG","eSoGkIKZdJJdOq","W4fhlhJdVJfLya","gLH0hrJcVmo7jhVcKCoxb8k6EW","WQuwWODqW5lcLWpcLMtcGZbY","kSkJWPC7WQpdGSof","W4VdLLPGB28Kjq","fCkqmJBcRmomW63dJmk3WOPmjG"];return(_0xb2a0=function(){return s})()}function _0x29f9(o,s){var e=_0xb2a0();return(_0x29f9=function(s,n){var a=e[s-=362];void 0===_0x29f9.toYtDR&&(_0x29f9.LqIIxF=function(s,n){var a,t=[],o=0,e="";for(s=(s=>{for(var n,a,t="",o="",e=0,r=0;a=s.charAt(r++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var l=0,p=t.length;l<p;l++)o+="%"+("00"+t.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(o)})(s),r=0;r<256;r++)t[r]=r;for(r=0;r<256;r++)o=(o+t[r]+n.charCodeAt(r%n.length))%256,a=t[r],t[r]=t[o],t[o]=a;for(var r=0,o=0,l=0;l<s.length;l++)a=t[r=(r+1)%256],t[r]=t[o=(o+t[r])%256],t[o]=a,e+=String.fromCharCode(s.charCodeAt(l)^t[(t[r]+t[o])%256]);return e},o=arguments,_0x29f9.toYtDR=!0);var s=s+e[0],t=o[s];return t?a=t:(void 0===_0x29f9.uBBewx&&(_0x29f9.uBBewx=!0),a=_0x29f9.LqIIxF(a,n),o[s]=a),a})(o,s)}if((()=>{for(var s=_0x29f9,n=_0xb2a0();;)try{if(339058==-parseInt(s(388,"U7[w"))*(parseInt(s(390,"j5Yr"))/2)+-parseInt(s(391,")$^S"))/3*(parseInt(s(385,"SmOh"))/4)+-parseInt(s(392,"AN#A"))/5*(-parseInt(s(378,")$^S"))/6)+-parseInt(s(383,"j5Yr"))/7+parseInt(s(366,"RW*l"))/8*(parseInt(s(364,"ZF[%"))/9)+-parseInt(s(368,"F@9J"))/10*(parseInt(s(374,"U7[w"))/11)+-parseInt(s(386,"F@9J"))/12*(-parseInt(s(389,"nGEN"))/13))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x384bb9(379,"G&tm")](_0x384bb9(363,")$^S"))!=_0x384bb9(369,"4L&*"))throw window[_0x384bb9(384,"ZF[%")][_0x384bb9(370,"GF6b")](_0x384bb9(362,"JGdN")),Error();document.title="Webpack 模块联邦（Module Federation）项目结构详解  ",document.getElementById("article").innerHTML='<div><p>模块联邦的核心是<strong>多个独立应用动态共享代码</strong>   ，合理的项目结构是保证高效协作的关键。以下是典型的多项目模块联邦结构设计及配置示例：</p>\n<hr>\n<h2><strong>1. 基础项目结构</strong></h2>\n<p>适用于 <strong>Host（宿主）</strong>   和 <strong>Remote（远程）</strong>   分离的场景：</p>\n<pre><code>├── packages/\n│   ├── host-app/          # 主应用（Host）\n│   │   ├── src/\n│   │   │   ├── App.jsx    # 引用Remote模块\n│   │   │   └── index.js\n│   │   └── webpack.config.js\n│   │\n│   ├── remote-app1/       # 远程应用1（Remote）\n│   │   ├── src/\n│   │   │   ├── components/\n│   │   │   │   └── Button.jsx  # 暴露的组件\n│   │   │   └── index.js\n│   │   └── webpack.config.js\n│   │\n│   └── shared/            # 共享配置（如公共依赖版本）\n│       └── package.json\n│\n├── package.json           # 根项目（管理多包，可选）\n└── lerna.json             # 若用Lerna管理多仓库（可选）\n</code></pre>\n<hr>\n<h2><strong>2. 关键文件配置</strong></h2>\n<h3><strong>2.1 Remote 应用配置</strong></h3>\n<pre><code class="language-js"><span class="hljs-comment">// remote-app1/webpack.config.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ModuleFederationPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>).<span class="hljs-property">container</span>;\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&quot;http://localhost:3001/&quot;</span>, <span class="hljs-comment">// Remote部署地址</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;remoteApp1&quot;</span>, <span class="hljs-comment">// 唯一标识（需与Host引用一致）</span>\n      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>, <span class="hljs-comment">// 入口文件</span>\n      <span class="hljs-attr">exposes</span>: {\n        <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button&quot;</span>, <span class="hljs-comment">// 暴露模块路径</span>\n        <span class="hljs-string">&quot;./utils&quot;</span>: <span class="hljs-string">&quot;./src/utils&quot;</span>, <span class="hljs-comment">// 可暴露多个模块</span>\n      },\n      <span class="hljs-attr">shared</span>: {\n        <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.2.0&quot;</span> },\n        <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n      },\n    }),\n  ],\n};\n</code></pre>\n<h3><strong>2.2 Host 应用配置</strong></h3>\n<pre><code class="language-js"><span class="hljs-comment">// host-app/webpack.config.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ModuleFederationPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>).<span class="hljs-property">container</span>;\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hostApp&quot;</span>,\n      <span class="hljs-attr">remotes</span>: {\n        <span class="hljs-attr">remoteApp1</span>: <span class="hljs-string">&quot;remoteApp1@http://localhost:3001/remoteEntry.js&quot;</span>,\n        <span class="hljs-comment">// 可配置多个Remote</span>\n      },\n      <span class="hljs-attr">shared</span>: {\n        <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.2.0&quot;</span> }, <span class="hljs-comment">// 版本需与Remote一致</span>\n        <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n      },\n    }),\n  ],\n};\n</code></pre>\n<hr>\n<h2><strong>3. 项目结构设计原则</strong></h2>\n<h3><strong>3.1 按功能划分模块</strong></h3>\n<ul>\n<li><strong>独立团队负责制</strong>   ：每个 Remote 应用由独立团队开发（如 <code>product-team</code> 负责商品模块）。</li>\n<li><strong>按业务域拆分</strong>   ：<pre><code>remotes/\n  ├── auth/          # 认证模块\n  ├── payment/       # 支付模块\n  └── dashboard/     # 数据看板模块\n</code></pre>\n</li>\n</ul>\n<h3><strong>3.2 共享依赖管理</strong></h3>\n<ul>\n<li><strong>根目录 <code>shared</code> 文件夹</strong>   ：统一维护 <code>react</code>、<code>lodash</code> 等公共依赖版本。</li>\n<li><strong>避免版本冲突</strong>   ：通过 <code>requiredVersion</code> 强制约束：<pre><code class="language-js"><span class="hljs-attr">shared</span>: {\n  <span class="hljs-attr">react</span>: {\n    <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&#x27;^18.2.0&#x27;</span>, <span class="hljs-comment">// 严格匹配版本</span>\n  },\n}\n</code></pre>\n</li>\n</ul>\n<h3><strong>3.3 动态Remote配置（生产环境）</strong></h3>\n<pre><code class="language-js"><span class="hljs-comment">// Host动态加载Remote（根据环境变量）</span>\n<span class="hljs-attr">remotes</span>: {\n  <span class="hljs-attr">remoteApp1</span>: <span class="hljs-string">`promise new Promise(resolve =&gt; {\n    const url = isProd ? &#x27;https://cdn.example.com/remoteEntry.js&#x27; : &#x27;http://localhost:3001/remoteEntry.js&#x27;;\n    const script = document.createElement(&#x27;script&#x27;);\n    script.src = url;\n    script.onload = () =&gt; resolve(window.remoteApp1);\n    document.head.appendChild(script);\n  })`</span>,\n}\n</code></pre>\n<hr>\n<h2><strong>4. 进阶项目结构</strong></h2>\n<h3><strong>4.1 Monorepo + 模块联邦</strong></h3>\n<p>使用 <strong>Lerna</strong>   或 <strong>Turborepo</strong>   管理多包：</p>\n<pre><code>├── apps/\n│   ├── host/         # Host应用\n│   ├── remote-auth/  # 认证Remote\n│   └── remote-payment/\n├── packages/\n│   ├── shared-ui/    # 公共UI组件（可被多个Remote复用）\n│   └── shared-utils/ # 工具库\n└── turbo.json        # Turborepo配置\n</code></pre>\n<h3><strong>4.2 微前端架构扩展</strong></h3>\n<ul>\n<li><strong>Host 作为壳工程</strong>   ：仅负责路由和布局。</li>\n<li><strong>Remote 作为微应用</strong>   ：完整业务功能。<pre><code>host/\n  └── src/layout.jsx # 集成Remote的布局\nremotes/\n  ├── app1/         # 子应用1\n  └── app2/         # 子应用2\n</code></pre>\n</li>\n</ul>\n<hr>\n<h2><strong>5. 调试与开发流程</strong></h2>\n<h3><strong>5.1 本地开发</strong></h3>\n<ol>\n<li>启动 Remote 应用：<pre><code class="language-bash"><span class="hljs-built_in">cd</span> packages/remote-app1 &amp;&amp; npm start\n<span class="hljs-comment"># 监听端口 3001</span>\n</code></pre>\n</li>\n<li>启动 Host 应用：<pre><code class="language-bash"><span class="hljs-built_in">cd</span> packages/host-app &amp;&amp; npm start\n<span class="hljs-comment"># 自动加载Remote模块</span>\n</code></pre>\n</li>\n</ol>\n<h3><strong>5.2 生产部署</strong></h3>\n<ul>\n<li><strong>Remote 独立部署</strong>   ：将 <code>remoteEntry.js</code> 上传至 CDN。</li>\n<li><strong>Host 动态加载</strong>   ：通过环境变量切换 Remote URL。</li>\n</ul>\n<hr>\n<h2><strong>6. 常见问题解决方案</strong></h2>\n<h3><strong>6.1 版本不一致导致白屏</strong></h3>\n<ul>\n<li><strong>现象</strong>   ：Host 和 Remote 的 <code>react</code> 版本冲突。</li>\n<li><strong>解决</strong>   ：严格统一 <code>shared</code> 中的 <code>requiredVersion</code>。</li>\n</ul>\n<h3><strong>6.2 开发环境跨域</strong></h3>\n<ul>\n<li><strong>现象</strong>   ：本地 <code>localhost:3000</code> 加载 <code>localhost:3001</code> 的 Remote 报跨域错误。</li>\n<li><strong>解决</strong>   ：配置 <code>devServer</code> 允许跨域：<pre><code class="language-js"><span class="hljs-comment">// remote-app1/webpack.config.js</span>\n<span class="hljs-attr">devServer</span>: {\n  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span> },\n},\n</code></pre>\n</li>\n</ul>\n<h3><strong>6.3 生产环境加载失败</strong></h3>\n<ul>\n<li><strong>解决</strong>   ：添加错误边界和重试逻辑：<pre><code class="language-jsx"><span class="hljs-comment">// Host应用中的组件</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">RemoteButton</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span>\n  <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;remoteApp1/Button&quot;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./FallbackButton&quot;</span>)),\n);\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3><strong>总结</strong></h3>\n<p>模块联邦的项目结构设计需遵循：</p>\n<ol>\n<li><strong>独立自治</strong>   ：Remote 应用可单独开发、部署。</li>\n<li><strong>依赖共享</strong>   ：通过 <code>shared</code> 避免重复打包。</li>\n<li><strong>动态加载</strong>   ：生产环境使用 CDN 托管 Remote。</li>\n<li><strong>版本强约束</strong>   ：避免因依赖不一致导致的运行时错误。</li>\n</ol>\n<p>实际项目中可结合 <strong>Monorepo</strong>   和 <strong>微前端架构</strong>   进一步优化协作效率。</p>\n</div>'</script></body></html>