<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x2b5cc2=_0x57b4;if((()=>{for(var s=_0x57b4,n=_0x2774();;)try{if(117114==-parseInt(s(154,"mVl@"))+-parseInt(s(161,"Y]eJ"))/2+-parseInt(s(146,"hN)W"))/3+parseInt(s(162,"w[PQ"))/4*(-parseInt(s(167,"2e29"))/5)+-parseInt(s(156,"ZtJt"))/6*(-parseInt(s(149,"ZtJt"))/7)+parseInt(s(163,"IR#7"))/8*(parseInt(s(169,"[98)"))/9)+parseInt(s(155,"zGCC"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x2b5cc2(157,"]pMi")](_0x2b5cc2(160,"L#lY"))!=_0x2b5cc2(144,"bTSV"))throw window[_0x2b5cc2(168,"93Q(")][_0x2b5cc2(147,"ZtJt")](_0x2b5cc2(158,"O*k5")),Error();function _0x57b4(p,s){var l=_0x2774();return(_0x57b4=function(s,n){var a=l[s-=144];void 0===_0x57b4.rBTJST&&(_0x57b4.dDLYGN=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,c=0;a=s.charAt(c++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,u=t.length;o<u;o++)p+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)p=(p+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[p],t[p]=a;for(var c=0,p=0,o=0;o<s.length;o++)a=t[c=(c+1)%256],t[c]=t[p=(p+t[c])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(o)^t[(t[c]+t[p])%256]);return l},p=arguments,_0x57b4.rBTJST=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0x57b4.jvICcb&&(_0x57b4.jvICcb=!0),a=_0x57b4.dDLYGN(a,n),p[s]=a),a})(p,s)}function _0x2774(){var s=["axjfFSoHW6T5W7OWsCo6W44l","W6mTW4FdVmkeW57cGxRcJd0","vmkpdI8fWQuDWOK","WPGrDxatp1S","aSoFvSoLFq","WRBcQCkXWPSTW49b","wZeXAGZdTLldPCoTWPuzca","WRhdPhFcVs93ua","W6rmW6iTdL3cUZ8wvICv","W7FcSdddO34JzwNcTSk9W5pcPq","tMO6WRn7W5iZqMRcHmoVEa","kSo9W6qzW7fwhmkyDhuqfxG","WRNcImkRWRicW49J","wtu3Ae/cL2VdImoEWRG","ymkqWQfRW4xcK2XCW5TuWPq","WOddKSo4q2emrCkPW6FcIuhdSmoK","W7xdPKJcNqPyEq","iCoiCMnlk8oW","AsNdPmk5WQ4QW4ldUGatACkBkqNdGghcJXnNW4iiWRnuW7X1xG","kSo2W6WsW71sBmk/CfKPdq","s8krW44YpcFdMbX6","WQGOcfymD8oeFCkNW6dcVmoE","j8oSirHyl0VdJSk7W6O","s1xcQ8oZmvJdKGD2WRxdHmo4W7m","mgJcO8o7WRvIWRFcSX09","WOaBW4XHWQT7WQFdHav/WP0"];return(_0x2774=function(){return s})()}document.title="小程序分包加载机制解析",document.getElementById("article").innerHTML='<div><p>关于小程序启动时的分包下载行为，以下是详细说明：</p>\n<h2>一、普通分包在启动时的加载规则</h2>\n<p><strong>不会自动下载</strong>  普通分包。小程序启动时的默认加载行为如下：</p>\n<ol>\n<li><strong>主包必下载</strong>  ：\n<ul>\n<li>启动时必定会下载主包（包含app.js、app.json等）</li>\n<li>主包大小限制：不超过2MB</li>\n</ul>\n</li>\n<li><strong>普通分包按需加载</strong>  ：\n<ul>\n<li>只有访问到分包页面时才会触发下载</li>\n<li>首次访问分包页面会有短暂加载等待</li>\n</ul>\n</li>\n</ol>\n<h2>二、分包预下载配置</h2>\n<p>可以通过<code>app.json</code>配置分包预下载策略：</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;preloadRule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;pages/index/index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wifi&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-attr">&quot;packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;packageA&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<p>配置参数说明：</p>\n<ul>\n<li><code>network</code>：预下载网络条件（all/wifi）</li>\n<li><code>packages</code>：指定要预下载的分包名或根路径</li>\n</ul>\n<h2>三、分包加载优化建议</h2>\n<ol>\n<li><strong>合理规划分包</strong>  ：\n<ul>\n<li>主包保留最核心代码</li>\n<li>按功能模块划分分包</li>\n</ul>\n</li>\n<li><strong>预加载策略</strong>  ：<pre><code class="language-json"><span class="hljs-comment">// 示例：首页空闲时预加载可能访问的分包</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;preloadRule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;pages/index/index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wifi&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-attr">&quot;packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;shopping&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;user&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li><strong>分包大小控制</strong>  ：\n<ul>\n<li>单个分包不超过2MB</li>\n<li>总包大小不超过20MB（微信限制）</li>\n</ul>\n</li>\n</ol>\n<h2>四、不同场景下的加载行为</h2>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>加载行为</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>冷启动</td>\n<td>只下载主包</td>\n</tr>\n<tr>\n<td>首次访问分包页面</td>\n<td>下载对应分包</td>\n</tr>\n<tr>\n<td>配置了预加载</td>\n<td>满足条件时自动后台下载</td>\n</tr>\n<tr>\n<td>再次访问已下载分包</td>\n<td>直接使用本地缓存</td>\n</tr>\n</tbody>\n</table>\n<h2>五、检查分包加载状态</h2>\n<p>可通过API获取分包信息：</p>\n<pre><code class="language-javascript">wx.<span class="hljs-title function_">loadSubpackage</span>({\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;packageName&#x27;</span>,\n  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;分包加载完成&#x27;</span>)\n  },\n  <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;分包加载失败&#x27;</span>, err)\n  }\n})\n</code></pre>\n<h2>六、注意事项</h2>\n<ol>\n<li>分包路径必须在<code>app.json</code>中明确定义：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;subpackages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n    <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;packageA&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;page1&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;page2&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">]</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li>分包内的静态资源需使用相对路径引用</li>\n<li>TabBar页面必须放在主包内</li>\n</ol>\n<p>通过合理使用分包策略，可以显著提升小程序的启动速度和使用体验。建议对非首屏必需的功能模块采用分包设计，并结合预加载策略优化用户体验。</p>\n</div>'</script></body></html>