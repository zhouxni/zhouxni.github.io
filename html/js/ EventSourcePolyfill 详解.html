<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x305392=_0x26c2;function _0x26c2(p,s){var t=_0x32f8();return(_0x26c2=function(s,a){var n=t[s-=384];void 0===_0x26c2.NDAIjE&&(_0x26c2.dJnXEG=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x26c2.NDAIjE=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x26c2.YzOZxy&&(_0x26c2.YzOZxy=!0),n=_0x26c2.dJnXEG(n,a),p[s]=n),n})(p,s)}function _0x32f8(){var s=["lt18WOFdOSooW5xcNvO","W7nuWO7cTsFdQmoQWQ0nsCoLq8kT","W7lcVmoRA2/dICohWPVcVce/","dSkQWRTXmSoJfg7dSG","WQhdGConW6nHoCo+luOQg8k8oG","n192z3q/W41RW5ngxstcUW","WQ3cGSo0kSoEWRWQ","yLqZWOhdRshdV0KLWOBdHf7dTa","waD9WOy+WPGWWOddKKldOmkP","W4ZdH8kRWPpcGSkqW6K","W5u5WRqBrCkeW6/cLXC","WPVdGmogpWPWW6Dr","WPRcS8o2k0HwWRhdPW","W53cKmo5fH9JW7C","W6GJrZNcQCoOWRG","W4WLWPrRW7xcMvPJWQSRBCo/WQVcOK7dUcWqmSolWOS0F21fcW","WO8iWRzNf0ORW6/dTSkVW69BuW","m8k+W5NcTSkNjw3dJ0tcTrlcRW","W4hcUmonW4NdUCo2W4ZcRmoVW6rdWRO","kCkCWR/dSee","kComcrNcQmkqmGq","W5i4WRH8cSouWP/cSsFcOCoAWPf6","yf06WOpdRLxcINiLWQFdOq","WRNdS8koWQ7cGmoNAxxcRcNdIHOr","W7DqWOtcUshdRCkmWP8nvmo9sq","WQGps8ksW41hW6jKqaSOWRNcSq"];return(_0x32f8=function(){return s})()}if((()=>{for(var s=_0x26c2,a=_0x32f8();;)try{if(397662==-parseInt(s(386,"VxYc"))+parseInt(s(401,"jP%W"))/2+-parseInt(s(408,"MtBF"))/3*(-parseInt(s(392,"&G1K"))/4)+-parseInt(s(396,"g]Tu"))/5*(parseInt(s(404,"o8Do"))/6)+-parseInt(s(389,"o8Do"))/7+-parseInt(s(391,"$^TO"))/8+-parseInt(s(405,"X^3C"))/9*(-parseInt(s(395,"&G1K"))/10))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x305392(400,"n#cr")](_0x305392(397,"XWxv"))!=_0x305392(387,"vaTr"))throw window[_0x305392(388,"QPz%")][_0x305392(407,"X^3C")](_0x305392(409,"o0N8")),Error();document.title=" EventSourcePolyfill 详解",document.getElementById("article").innerHTML='<div><p><code>EventSourcePolyfill</code> 是一个用于扩展浏览器原生 <code>EventSource</code> 功能的库，主要为了解决原生 API 的限制和浏览器兼容性问题。</p>\n<h2>什么是 EventSourcePolyfill？</h2>\n<p><strong>EventSourcePolyfill</strong>   是一个 JavaScript 库，它：</p>\n<ul>\n<li>提供与原生 <code>EventSource</code> 相同的 API</li>\n<li>添加了原生 API 不支持的功能</li>\n<li>解决了跨浏览器兼容性问题</li>\n<li>支持更多的自定义配置</li>\n</ul>\n<h2>主要特性</h2>\n<h3>1. 自定义请求头</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 原生 EventSource 无法设置 headers</span>\n<span class="hljs-keyword">const</span> es = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/events&quot;</span>, {\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;Bearer token123&quot;</span>,\n    <span class="hljs-string">&quot;X-Custom-Header&quot;</span>: <span class="hljs-string">&quot;value&quot;</span>,\n  },\n});\n</code></pre>\n<h3>2. 认证支持</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 支持各种认证方式</span>\n<span class="hljs-keyword">const</span> es = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/events&quot;</span>, {\n  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 发送 cookies</span>\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;Basic &quot;</span> + <span class="hljs-title function_">btoa</span>(<span class="hljs-string">&quot;user:pass&quot;</span>),\n  },\n});\n</code></pre>\n<h3>3. 更灵活的配置</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> es = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/events&quot;</span>, {\n  <span class="hljs-attr">heartbeatTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 心跳超时时间</span>\n  <span class="hljs-attr">connectionTimeout</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// 连接超时时间</span>\n  <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-comment">// 支持 POST 方法</span>\n});\n</code></pre>\n<h2>安装和使用</h2>\n<h3>安装方式</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># NPM</span>\nnpm install event-source-polyfill\n\n<span class="hljs-comment"># Yarn</span>\nyarn add event-source-polyfill\n\n<span class="hljs-comment"># CDN</span>\n&lt;script src=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/event-source-polyfill@latest/dist/eventsource.min.js&quot;</span>&gt;&lt;/script&gt;\n</code></pre>\n<h3>基本使用</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 引入 polyfill</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventSourcePolyfill</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;event-source-polyfill&quot;</span>;\n<span class="hljs-comment">// 或者</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">EventSourcePolyfill</span> } = <span class="hljs-variable language_">window</span>;\n\n<span class="hljs-comment">// 创建连接</span>\n<span class="hljs-keyword">const</span> eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/api/events&quot;</span>, {\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;Bearer &quot;</span> + <span class="hljs-title function_">getAuthToken</span>(),\n    <span class="hljs-string">&quot;X-Client-ID&quot;</span>: <span class="hljs-string">&quot;web-app&quot;</span>,\n  },\n  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,\n});\n\n<span class="hljs-comment">// 事件监听</span>\neventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;收到消息:&quot;</span>, event.<span class="hljs-property">data</span>);\n};\n\neventSource.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;连接已建立&quot;</span>);\n};\n\neventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;连接错误:&quot;</span>, error);\n};\n\n<span class="hljs-comment">// 自定义事件</span>\neventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;custom-event&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;自定义事件:&quot;</span>, event.<span class="hljs-property">data</span>);\n});\n</code></pre>\n<h2>高级功能示例</h2>\n<h3>1. 带认证的 SSE 连接</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureEventSource</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">url, options = {}</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span> = url;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span> = <span class="hljs-literal">null</span>;\n  }\n\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 获取认证 token</span>\n    <span class="hljs-keyword">const</span> token = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAuthToken</span>();\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>, {\n      <span class="hljs-attr">headers</span>: {\n        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>,\n        <span class="hljs-string">&quot;X-Request-ID&quot;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateRequestId</span>(),\n      },\n      <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,\n      <span class="hljs-attr">heartbeatTimeout</span>: <span class="hljs-number">30000</span>,\n      ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>,\n    });\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEventHandlers</span>();\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>;\n  }\n\n  <span class="hljs-title function_">setupEventHandlers</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;安全连接已建立&quot;</span>);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onConnect</span>?.();\n    };\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;连接错误:&quot;</span>, error);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onError</span>?.(error);\n    };\n  }\n\n  <span class="hljs-title function_">close</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-title function_">close</span>();\n    }\n  }\n}\n</code></pre>\n<h3>2. 重连策略管理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResilientEventSource</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">url, options = {}</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span> = url;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> = <span class="hljs-number">0</span>;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxReconnectAttempts</span> = <span class="hljs-number">10</span>;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectDelay</span> = <span class="hljs-number">1000</span>;\n  }\n\n  <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>);\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> = <span class="hljs-number">0</span>;\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onOpen</span>?.();\n    };\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleError</span>(error);\n    };\n\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>;\n  }\n\n  <span class="hljs-title function_">handleError</span>(<span class="hljs-params">error</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;SSE错误:&quot;</span>, error);\n\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxReconnectAttempts</span>) {\n      <span class="hljs-keyword">const</span> delay = <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectDelay</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span>);\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`将在 <span class="hljs-subst">${delay}</span>ms 后重连...`</span>);\n\n      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span>++;\n        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">connect</span>();\n      }, delay);\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;达到最大重连次数，停止重连&quot;</span>);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMaxRetries</span>?.();\n    }\n  }\n}\n</code></pre>\n<h3>3. 消息处理器</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventProcessor</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span> = <span class="hljs-literal">null</span>;\n  }\n\n  <span class="hljs-title function_">registerHandler</span>(<span class="hljs-params">eventName, handler</span>) {\n    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span>.<span class="hljs-title function_">has</span>(eventName)) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span>.<span class="hljs-title function_">set</span>(eventName, []);\n    }\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span>.<span class="hljs-title function_">get</span>(eventName).<span class="hljs-title function_">push</span>(handler);\n  }\n\n  <span class="hljs-title function_">connect</span>(<span class="hljs-params">url, options = {}</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(url, options);\n\n    <span class="hljs-comment">// 为每个注册的事件添加监听器</span>\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [eventName] <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span>) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>.<span class="hljs-title function_">addEventListener</span>(eventName, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));\n    }\n\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventSource</span>;\n  }\n\n  <span class="hljs-title function_">handleEvent</span>(<span class="hljs-params">event</span>) {\n    <span class="hljs-keyword">const</span> eventName = event.<span class="hljs-property">type</span>;\n    <span class="hljs-keyword">const</span> handlers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlers</span>.<span class="hljs-title function_">get</span>(eventName) || [];\n\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);\n      handlers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">handler</span>) =&gt;</span> <span class="hljs-title function_">handler</span>(data, event));\n    } <span class="hljs-keyword">catch</span> (error) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;消息处理错误:&quot;</span>, error);\n    }\n  }\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">const</span> processor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventProcessor</span>();\n\n<span class="hljs-comment">// 注册事件处理器</span>\nprocessor.<span class="hljs-title function_">registerHandler</span>(<span class="hljs-string">&quot;user-notification&quot;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;用户通知:&quot;</span>, data);\n});\n\nprocessor.<span class="hljs-title function_">registerHandler</span>(<span class="hljs-string">&quot;system-alert&quot;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;系统警报:&quot;</span>, data);\n});\n\n<span class="hljs-comment">// 建立连接</span>\nprocessor.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&quot;/events&quot;</span>, {\n  <span class="hljs-attr">headers</span>: { <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;token123&quot;</span> },\n});\n</code></pre>\n<h2>与原生 EventSource 的对比</h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>原生 EventSource</th>\n<th>EventSourcePolyfill</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>自定义请求头</td>\n<td>❌ 不支持</td>\n<td>✅ 支持</td>\n</tr>\n<tr>\n<td>withCredentials</td>\n<td>⚠️ 有限支持</td>\n<td>✅ 完全支持</td>\n</tr>\n<tr>\n<td>HTTP 方法</td>\n<td>❌ 仅 GET</td>\n<td>✅ 支持 POST</td>\n</tr>\n<tr>\n<td>超时配置</td>\n<td>❌ 不支持</td>\n<td>✅ 支持</td>\n</tr>\n<tr>\n<td>心跳检测</td>\n<td>❌ 不支持</td>\n<td>✅ 支持</td>\n</tr>\n<tr>\n<td>浏览器兼容性</td>\n<td>⚠️ 现代浏览器</td>\n<td>✅ 更广泛支持</td>\n</tr>\n<tr>\n<td>错误处理</td>\n<td>⚠️ 基础功能</td>\n<td>✅ 增强功能</td>\n</tr>\n</tbody>\n</table>\n<h2>实际应用场景</h2>\n<h3>1. 实时通知系统</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NotificationService</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">polyfill</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/notifications&quot;</span>, {\n      <span class="hljs-attr">headers</span>: {\n        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">localStorage</span>.getItem(<span class="hljs-string">&quot;token&quot;</span>)}</span>`</span>,\n      },\n    });\n  }\n\n  <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">polyfill</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;new-notification&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> notification = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showNotification</span>(notification);\n    });\n  }\n}\n</code></pre>\n<h3>2. 实时数据监控</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LiveDataMonitor</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">metrics</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = metrics;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">polyfill</span> = <span class="hljs-literal">null</span>;\n  }\n\n  <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">polyfill</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSourcePolyfill</span>(<span class="hljs-string">&quot;/metrics-stream&quot;</span>, {\n      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,\n      <span class="hljs-attr">headers</span>: {\n        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,\n        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;Bearer token&quot;</span>,\n      },\n      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">metrics</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> }),\n    });\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">polyfill</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDashboard</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>));\n    };\n  }\n}\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li><strong>性能考虑</strong>   ：长时间连接可能影响性能</li>\n<li><strong>资源清理</strong>   ：及时关闭不再需要的连接</li>\n<li><strong>错误处理</strong>   ：实现完整的错误处理和重连逻辑</li>\n<li><strong>安全考虑</strong>   ：妥善处理认证和授权</li>\n</ol>\n<p><strong>EventSourcePolyfill</strong>   是构建复杂实时应用的强大工具，特别适合需要自定义认证、高级配置和更好浏览器兼容性的场景。</p>\n</div>'</script></body></html>