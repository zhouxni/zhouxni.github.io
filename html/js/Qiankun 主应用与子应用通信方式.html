<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3f2e1d=_0x2753;function _0x2753(p,s){var t=_0xe911();return(_0x2753=function(s,a){var n=t[s-=407];void 0===_0x2753.XztfBS&&(_0x2753.njmoIt=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,o=0;n=s.charAt(o++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,e=l.length;c<e;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)p=(p+l[o]+a.charCodeAt(o%a.length))%256,n=l[o],l[o]=l[p],l[p]=n;for(var o=0,p=0,c=0;c<s.length;c++)n=l[o=(o+1)%256],l[o]=l[p=(p+l[o])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[o]+l[p])%256]);return t},p=arguments,_0x2753.XztfBS=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x2753.DLvBbX&&(_0x2753.DLvBbX=!0),n=_0x2753.njmoIt(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x2753,a=_0xe911();;)try{if(470267==-parseInt(s(429,"2cx["))+parseInt(s(416,"imN9"))/2+parseInt(s(427,"^]Nb"))/3*(parseInt(s(417,"kXqE"))/4)+-parseInt(s(426,"sQJ("))/5*(-parseInt(s(413,"T8]z"))/6)+-parseInt(s(424,"imN9"))/7+parseInt(s(409,"6Y5%"))/8+-parseInt(s(430,"9IuV"))/9)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x3f2e1d(412,"T$NV")](_0x3f2e1d(423,"PZO@"))!=_0x3f2e1d(428,"sQJ("))throw window[_0x3f2e1d(407,"a!nc")][_0x3f2e1d(421,"ghH]")](_0x3f2e1d(411,"UrD&")),Error();function _0xe911(){var s=["gHpcJmkkASkgCbpcSG","WRVdTLddJmkvcG00ACk2xxb5","W7mop8kqWQnOW4iTWO1kg8oD","WQmLWQRcSSkLWOzMW5G","rxxcNhatEquhCCoHmHaD","W6fLWOhcS8kg","W7ajomkvWQvVW7aVWOX+kCon","W6tcPwqiW5xdUhP1W5VcUCkTW4GW","W7yeWQhdOg/cJSktBG","DmohlfpdMLFdVG","c8o0W5hcV8kCqSkCeb7cL2nVW5m","W7tcJmo8W788WR41jmoHWO1DtW","WPFdRmkGW54OW7ZdVmoTka7dNSo1WOZcMZb5CCoNiGJdG8kMv8kzWPpdMq","W4RdQ1etA8k7zq","W4uoAhiPWQqiWRaVvNNdJq","i3itWRVcNMdcJSkBh8o9bSofza","W6GAW7tcPSk/jxVdRCoqkhRcQW","WRVdTfxdI8ksavWTECk0w1m","zSoGEabSWOr/","WRfpWORcSXr4wmor","WRXkW41jCcFdRCoBrJlcTW1T","W4jqW5O9cCk9WOPKW7lcQsvLWOe","wSoyd8oSFmk1tG","CcW7nSoKqSkTgCoVDqygW5m"];return(_0xe911=function(){return s})()}document.title="Qiankun 主应用与子应用通信方式",document.getElementById("article").innerHTML='<div><p>Qiankun 提供了多种主应用与子应用之间的通信机制，以下是主要的几种方式：</p>\n<h2>1. 基于 props 的通信</h2>\n<p>主应用可以通过 props 向子应用传递数据：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 主应用注册子应用时</span>\n<span class="hljs-title function_">registerMicroApps</span>([\n  {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;subApp&quot;</span>,\n    <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;//localhost:7100&quot;</span>,\n    <span class="hljs-attr">container</span>: <span class="hljs-string">&quot;#subapp-container&quot;</span>,\n    <span class="hljs-attr">activeRule</span>: <span class="hljs-string">&quot;/sub-app&quot;</span>,\n    <span class="hljs-attr">props</span>: {\n      <span class="hljs-comment">// 传递数据</span>\n      <span class="hljs-attr">data</span>: { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;From main app&quot;</span> },\n      <span class="hljs-comment">// 传递方法</span>\n      <span class="hljs-attr">onGlobalStateChange</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子应用触发状态变化:&quot;</span>, state);\n      },\n    },\n  },\n]);\n</code></pre>\n<p>子应用在生命周期钩子中接收：</p>\n<pre><code class="language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(props.<span class="hljs-property">data</span>); <span class="hljs-comment">// 获取主应用传递的数据</span>\n  props.<span class="hljs-title function_">onGlobalStateChange</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;init&quot;</span> }); <span class="hljs-comment">// 调用主应用传递的方法</span>\n}\n</code></pre>\n<h2>2. 全局状态管理 (initGlobalState)</h2>\n<p>Qiankun 提供了全局状态管理 API：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 主应用初始化全局状态</span>\n<span class="hljs-keyword">import</span> { initGlobalState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qiankun&quot;</span>;\n\n<span class="hljs-keyword">const</span> actions = <span class="hljs-title function_">initGlobalState</span>({\n  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;admin&quot;</span> },\n});\n\n<span class="hljs-comment">// 监听状态变化</span>\nactions.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state, prev</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;主应用收到状态变化:&quot;</span>, state, prev);\n});\n\n<span class="hljs-comment">// 子应用中获取和修改全局状态</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {\n  <span class="hljs-comment">// 监听状态变化</span>\n  props.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state, prev</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子应用收到状态变化:&quot;</span>, state, prev);\n  });\n\n  <span class="hljs-comment">// 更新状态</span>\n  props.<span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;subAppUser&quot;</span> } });\n}\n</code></pre>\n<h2>3. 自定义事件通信</h2>\n<p>通过 window 对象派发和监听自定义事件：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 主应用派发事件</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(\n  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">&quot;main-event&quot;</span>, {\n    <span class="hljs-attr">detail</span>: { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Hello from main app&quot;</span> },\n  }),\n);\n\n<span class="hljs-title function_">registerMicroApps</span>([\n  {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;sub-app&quot;</span>,\n    <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;//localhost:7100&quot;</span>,\n    <span class="hljs-attr">container</span>: <span class="hljs-string">&quot;#subapp&quot;</span>,\n    <span class="hljs-attr">activeRule</span>: <span class="hljs-string">&quot;/sub&quot;</span>,\n    <span class="hljs-attr">props</span>: {\n      <span class="hljs-comment">// ← 把想共享的东西放在这里</span>\n      <span class="hljs-attr">realWindow</span>: <span class="hljs-variable language_">window</span>, <span class="hljs-comment">// 真要全量 window 也可以</span>\n      <span class="hljs-attr">utils</span>: { axios, dayjs },\n    },\n  },\n]);\n\n<span class="hljs-comment">// 子应用监听事件</span>\nrealWindow.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;main-event&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;收到主应用事件:&quot;</span>, event.<span class="hljs-property">detail</span>);\n});\n\n<span class="hljs-comment">// 子应用派发事件</span>\nrealWindow.<span class="hljs-title function_">dispatchEvent</span>(\n  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">&quot;sub-event&quot;</span>, {\n    <span class="hljs-attr">detail</span>: { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Hello from sub app&quot;</span> },\n  }),\n);\n</code></pre>\n<h2>4. 共享依赖</h2>\n<p>通过 shared 配置共享库或状态：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 主应用配置</span>\n<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;\n<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;\n\n<span class="hljs-title function_">registerMicroApps</span>([\n  {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;subApp&quot;</span>,\n    <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;//localhost:7100&quot;</span>,\n    <span class="hljs-attr">container</span>: <span class="hljs-string">&quot;#subapp-container&quot;</span>,\n    <span class="hljs-attr">activeRule</span>: <span class="hljs-string">&quot;/sub-app&quot;</span>,\n    <span class="hljs-attr">props</span>: {\n      <span class="hljs-attr">sharedStore</span>: store,\n    },\n  },\n]);\n</code></pre>\n<h2>5. 路由参数通信</h2>\n<p>通过 URL 传递参数：</p>\n<pre><code class="language-js"><span class="hljs-comment">// 主应用导航时</span>\nhistory.<span class="hljs-title function_">pushState</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;/sub-app?param=value&quot;</span>);\n\n<span class="hljs-comment">// 子应用获取参数</span>\n<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;param&quot;</span>)); <span class="hljs-comment">// &quot;value&quot;</span>\n</code></pre>\n<h2>最佳实践建议</h2>\n<ol>\n<li>简单数据传递使用 props</li>\n<li>复杂状态管理使用 initGlobalState</li>\n<li>事件驱动场景使用自定义事件</li>\n<li>避免过度通信，保持子应用独立性</li>\n<li>考虑通信的安全性，避免敏感数据暴露</li>\n</ol>\n<p>选择哪种方式取决于你的具体场景和通信需求复杂度。</p>\n</div>'</script></body></html>