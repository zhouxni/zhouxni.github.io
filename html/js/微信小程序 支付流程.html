<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5c3f(){var n=["WPD7guZdIxamrGe","W4mcW7yKFmkDWO0G","mCkwoCkDqa","ugv3WOJcQZDPgSojvSkpWRO","vgX0WOJcP1veo8o+r8k8","W4aaW7m7zmkdWQab","fxhdNZn2W7KMW4GjW4jSzq","WPNdN8kiwCo+z0NdTfddPNVcJG","tLtcRCoBW4xdPCkutSk/WQlcVmkpEq","lhKNWRTNWOVcGqO","W5e+W4zHhmkmlW","W7JdI8o7WQhdLmoiW43dL8oAWQnqW6i","gunKWOJdJIrZCXXnaSo9","WRLlW40zm8k+WO/dO8o1W5HjW7e","W7/cL8kaWRqfW4dcUr7cOL3dHJ0+gMrwDSklg0zNbmk3qdtcKq","vmoytmkCdmkKEq8","rqZcKCo8W6feAmoXW5xdUSkiW7a","oxRdQ8oGAXdcUr9hWOpcPa","rmk0W6NcJvxdQHxcR8ozyJdcHSon","c01lpGmFWQG","W5y/W7GjDmk/amoCv8oPACkW","WPhdNSklx8o+yeVdLvZdSe/cOq","WRT4o8k9uSkNW7VdMa","pNZdQCoUANdcTWrwWQxcJLm"];return(_0x5c3f=function(){return n})()}function _0x4ba2(d,n){var e=_0x5c3f();return(_0x4ba2=function(n,o){var r=e[n-=136];void 0===_0x4ba2.tVcCpu&&(_0x4ba2.erHpIi=function(n,o){var r,t=[],d=0,e="";for(n=(n=>{for(var o,r,t="",d="",e=0,c=0;r=n.charAt(c++);~r&&(o=e%4?64*o+r:r,e++%4)&&(t+=String.fromCharCode(255&o>>(-2*e&6))))r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(var i=0,l=t.length;i<l;i++)d+="%"+("00"+t.charCodeAt(i).toString(16)).slice(-2);return decodeURIComponent(d)})(n),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)d=(d+t[c]+o.charCodeAt(c%o.length))%256,r=t[c],t[c]=t[d],t[d]=r;for(var c=0,d=0,i=0;i<n.length;i++)r=t[c=(c+1)%256],t[c]=t[d=(d+t[c])%256],t[d]=r,e+=String.fromCharCode(n.charCodeAt(i)^t[(t[c]+t[d])%256]);return e},d=arguments,_0x4ba2.tVcCpu=!0);var n=n+e[0],t=d[n];return t?r=t:(void 0===_0x4ba2.OyiqfC&&(_0x4ba2.OyiqfC=!0),r=_0x4ba2.erHpIi(r,o),d[n]=r),r})(d,n)}var _0x1d7ccd=_0x4ba2;if((()=>{for(var n=_0x4ba2,o=_0x5c3f();;)try{if(127118==+parseInt(n(147,"PZlL"))+-parseInt(n(142,"2vkX"))/2+-parseInt(n(151,"m&X@"))/3+-parseInt(n(138,"^Ij@"))/4+-parseInt(n(139,"^Ij@"))/5*(parseInt(n(136,"Dfmj"))/6)+-parseInt(n(143,"74b#"))/7+-parseInt(n(140,"Dfmj"))/8*(-parseInt(n(156,"2vkX"))/9))break;o.push(o.shift())}catch(n){o.push(o.shift())}})(),localStorage[_0x1d7ccd(145,"qqNa")](_0x1d7ccd(159,"G&WB"))!=_0x1d7ccd(137,"wGg#"))throw window[_0x1d7ccd(150,"aEk2")][_0x1d7ccd(154,"VFbU")](_0x1d7ccd(149,"&C6V")),Error();document.title="微信小程序 支付流程",document.getElementById("article").innerHTML="<div><p>微信小程序的支付流程涉及多个步骤，主要包括用户发起支付请求、后端处理支付请求、小程序前端调用支付接口、用户确认支付以及支付结果处理等环节。以下是详细的支付流程说明：</p>\n<h3>一、用户发起支付请求</h3>\n<ol>\n<li><strong>选择商品与规格</strong>  ：用户在小程序中浏览商品，选择需要的商品规格、数量等信息。</li>\n<li><strong>加入购物车或立即购买</strong>  ：用户可以将商品加入购物车，或者选择立即购买。</li>\n<li><strong>点击支付按钮</strong>  ：当用户决定购买后，点击支付按钮，触发支付流程。</li>\n</ol>\n<h3>二、后端处理支付请求</h3>\n<ol>\n<li><strong>获取用户OpenID</strong>  ：在用户发起支付请求之前，小程序需要获取用户的OpenID。这通常通过调用<code>wx.login</code>接口获取临时登录凭证（code），然后将code发送到开发者服务器，服务器通过code向微信服务器请求用户的OpenID。</li>\n<li><strong>调用统一下单接口</strong>  ：开发者服务器接收到用户的支付请求后，调用微信支付的统一下单接口，向微信支付系统请求创建支付订单。此过程中需要传递一系列参数，包括小程序的AppID、商户号、随机字符串、商品描述、商户订单号、订单总金额、用户端实际IP、接收支付结果通知的回调地址、交易类型（JSAPI表示小程序支付）以及用户的OpenID等。</li>\n<li><strong>获取预支付交易会话标识（prepay_id）</strong>  ：微信支付系统在收到参数后，会生成prepay_id，并将相关信息返回给开发者服务器。</li>\n</ol>\n<h3>三、小程序前端调用支付接口</h3>\n<ol>\n<li><strong>接收支付参数</strong>  ：开发者服务器将prepay_id及其他必要的支付参数（如时间戳、随机字符串、签名等）返回给小程序前端。</li>\n<li><strong>调用<code>wx.requestPayment</code>接口</strong>  ：小程序前端在收到这些参数后，调用<code>wx.requestPayment</code>接口，向微信支付系统发起支付请求。</li>\n</ol>\n<h3>四、用户确认支付</h3>\n<ol>\n<li><strong>展示支付界面</strong>  ：微信支付系统展示支付界面，用户需要输入支付密码或使用指纹等验证方式完成支付授权。</li>\n<li><strong>确认支付</strong>  ：用户确认支付后，微信支付系统处理支付请求。</li>\n</ol>\n<h3>五、支付结果处理</h3>\n<ol>\n<li><strong>微信支付系统发送支付结果通知</strong>  ：支付完成后，微信支付系统会将支付结果通知发送给开发者服务器配置的回调地址（notify_url）。</li>\n<li><strong>开发者服务器验证支付结果</strong>  ：开发者服务器需要验证支付结果的真实性，并根据支付结果更新订单状态。这通常包括验证通知签名的正确性、校验通知金额与订单金额是否一致等步骤。</li>\n<li><strong>小程序前端处理支付结果</strong>  ：同时，小程序前端也会收到支付结果的回调，根据支付结果进行相应的页面跳转或提示。例如，支付成功后可以跳转到支付成功页面，支付失败则可以提示用户重新支付或取消订单。</li>\n</ol>\n<h3>六、注意事项</h3>\n<ol>\n<li><strong>安全性</strong>  ：在整个支付流程中，需要确保数据传输的安全性。例如，使用HTTPS协议进行数据传输，避免敏感信息被窃取或篡改。</li>\n<li><strong>异常处理</strong>  ：需要处理支付过程中的异常情况，如支付失败、订单重复等问题。这可以通过在前端和后端都设置相应的错误处理机制来实现。</li>\n<li><strong>用户体验</strong>  ：优化支付流程的用户体验，如提供清晰的支付提示、减少支付等待时间等，可以提高用户的满意度和支付成功率。</li>\n</ol>\n</div>"</script></body></html>