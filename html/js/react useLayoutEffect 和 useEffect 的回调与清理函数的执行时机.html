<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x564c1e=_0x86ef;function _0x19ce(){var t=["r2JdMW/cMKJdHmkZc8omW7HgWQbi","mcFcLsCoWPvfWOa9r8oFWP4","vY/cTtJcJWn+W73cRmk9W5i","WOpdV3S7W4GTWRPZrmkUbW","mWhdKd/dM8ogW4tdVW","W6VdNw8nW4ldI8kNC1Pbumo5xW","tGdcM8ojWRL5WO4jW4VdN0e+W50","lXVdGc3dLG","W79ZAqldVthcRdP1WPZcSCk+WRFdK15rpcWVWOZdH8oiW63dISk1nG","omkEzmoSW5XXW6f8tSoFm8kBWOO","tG7dQ8oieMiTBJG","WOmFC1GvWPpdQSkzvCoIW7tdRq","Du7dHSk/WRdcG8k/W6tdRGZdTmoBmmkh","W4OCW59ZDmkjzCkxgW","mrWgjXGTW5FdIdS","WO0PiCoPk8oZdCk/WOnrcd52","WPXnWPTlCmkpta","WP7dKb0QWO8IguxcSxz5ur4","WO4PlmoQlmo+dSkJWRrxpsr9","WRfHW7bcWPtdTCkk","D0ZdH8k5WRlcICk2WQNdOqJdH8oLiG","WQ7dGYrOshTiW7tdImkbW77dNCkr"];return(_0x19ce=function(){return t})()}function _0x86ef(n,t){var c=_0x19ce();return(_0x86ef=function(t,o){var e=c[t-=106];void 0===_0x86ef.KcDhkj&&(_0x86ef.VMiYES=function(t,o){var e,r=[],n=0,c="";for(t=(t=>{for(var o,e,r="",n="",c=0,d=0;e=t.charAt(d++);~e&&(o=c%4?64*o+e:e,c++%4)&&(r+=String.fromCharCode(255&o>>(-2*c&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var s=0,f=r.length;s<f;s++)n+="%"+("00"+r.charCodeAt(s).toString(16)).slice(-2);return decodeURIComponent(n)})(t),d=0;d<256;d++)r[d]=d;for(d=0;d<256;d++)n=(n+r[d]+o.charCodeAt(d%o.length))%256,e=r[d],r[d]=r[n],r[n]=e;for(var d=0,n=0,s=0;s<t.length;s++)e=r[d=(d+1)%256],r[d]=r[n=(n+r[d])%256],r[n]=e,c+=String.fromCharCode(t.charCodeAt(s)^r[(r[d]+r[n])%256]);return c},n=arguments,_0x86ef.KcDhkj=!0);var t=t+c[0],r=n[t];return r?e=r:(void 0===_0x86ef.OsccUr&&(_0x86ef.OsccUr=!0),e=_0x86ef.VMiYES(e,o),n[t]=e),e})(n,t)}if((()=>{for(var t=_0x86ef,o=_0x19ce();;)try{if(576004==-parseInt(t(111,"Ow%S"))+-parseInt(t(121,"Seh%"))/2+-parseInt(t(125,"gV*B"))/3*(parseInt(t(110,"PlJi"))/4)+parseInt(t(118,"6izr"))/5+-parseInt(t(115,"6izr"))/6+-parseInt(t(117,"I]QY"))/7+parseInt(t(112,"r^vf"))/8)break;o.push(o.shift())}catch(t){o.push(o.shift())}})(),localStorage[_0x564c1e(116,"U*5x")](_0x564c1e(114,"#EQB"))!=_0x564c1e(107,"t]Wr"))throw window[_0x564c1e(126,"t]Wr")][_0x564c1e(119,"BT5J")](_0x564c1e(108,"ND]D")),Error();document.title="react useLayoutEffect 和 useEffect 的回调与清理函数的执行时机",document.getElementById("article").innerHTML='<div><p>在 React 的 commit 阶段中，<code>useLayoutEffect</code> 和 <code>useEffect</code> 的回调与清理函数的执行时机<strong>完全不同</strong>   ，具体如下：</p>\n<h3><strong>1. <code>useLayoutEffect</code></strong></h3>\n<ul>\n<li><strong>回调函数</strong>   ：组件加载和依赖项变化时在 <strong>Layout 阶段同步执行</strong>   （DOM 变更后、浏览器绘制前）。</li>\n<li><strong>清理函数</strong>   ：组件卸载和依赖项变化时时在 <strong>Mutation 阶段同步执行</strong>   （先于新的 <code>useLayoutEffect</code> 回调）；。</li>\n</ul>\n<h3><strong>2. <code>useEffect</code></strong></h3>\n<ul>\n<li><strong>回调函数</strong>   ：组件加载和依赖项变化时在 <strong>Layout 阶段完成后异步执行</strong>   （浏览器绘制后，通过 <code>requestIdleCallback</code> 或 <code>Promise.then</code> 调度）；</li>\n<li><strong>清理函数</strong>   ：组件加载和依赖项变化时在 <strong>Layout 阶段完成后异步执行</strong>   （但在浏览器下次绘制前完成）。</li>\n</ul>\n<pre><code class="language-javascript">commitBeforeMutationEffects start\ncommitBeforeMutationEffects end\ncommitMutationEffects start\ncount 同步变化 --清理\ncommitMutationEffects end\ncommitLayoutEffects start\ncount 同步变化\ncommitLayoutEffects end\ncount 变化 --清理\ncount 变化\n</code></pre>\n</div>'</script></body></html>