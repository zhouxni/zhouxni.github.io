<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1a14ad=_0x18b6;function _0x18b6(p,s){var t=_0x35c1();return(_0x18b6=function(s,a){var n=t[s-=318];void 0===_0x18b6.UFUxFu&&(_0x18b6.DYakMk=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var r=0,c=l.length;r<c;r++)p+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,r=0;r<s.length;r++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(r)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x18b6.UFUxFu=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x18b6.qOLGSN&&(_0x18b6.qOLGSN=!0),n=_0x18b6.DYakMk(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x18b6,a=_0x35c1();;)try{if(845230==+parseInt(s(326,"Q4OD"))*(parseInt(s(319,"yr!b"))/2)+-parseInt(s(334,"Xd3x"))/3+parseInt(s(322,"toK&"))/4*(parseInt(s(336,"zZWY"))/5)+-parseInt(s(335,"256Z"))/6+-parseInt(s(321,"Jg2C"))/7+-parseInt(s(327,"yLDY"))/8+parseInt(s(333,"45!O"))/9)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1a14ad(320,"zZWY")](_0x1a14ad(339,"jIGC"))!=_0x1a14ad(324,"Jg2C"))throw window[_0x1a14ad(328,"yr!b")][_0x1a14ad(331,"Lwa2")](_0x1a14ad(338,"]oHy")),Error();function _0x35c1(){var s=["WRtcQCkOrLDZWROHaSomW6Ddgq","WPtcVmk3nqDDfa","W6TWWRboomkvwW8","FSkie8oNW70zw8kcWQn3cCojimkX","W6XPWO/dHrJcICkIW54qymkkBaq","W7OeWQNdIYGAWOddIsKwtCoC","WOmyuCkmW5C9nmkOxmoAj8oGjG","WRWlW60GcCoLW7u","W7lcNmkInbJcLSoyWOWyW6C/qSkUA8o2rmoiwge1fNhcHem6qW","WOiOgv9aWRCokau","qrLUpxZdKCoDW6RdNZ/dV3va","m8k0A8kosSopW6VcR2KwW6PXWPy","W5vjeCoWWPfPBa","W6xcTmokptFdOunLW4NcKCkMwXS","m8kTWO0PaI95WQ4","W7ylWPvfvr8MWQOkW4aLyq","WQhdUmkpDNG","iSo0W5zOoca/WPZcJ8oiW4TDW54","xW3dHgdcNSoBWPO","m8kEAIFcSCkGtSkLdmk3E2/dPa","BSoRomoxdmkqWRtcSW","W61WfCklt8k/qGpdMaDlySoK"];return(_0x35c1=function(){return s})()}document.title="rollup 定义全局变量",document.getElementById("article").innerHTML='<div><p>在 Rollup 中，你可以通过多种方式定义全局变量，以便在打包后的代码中使用。常见的方法包括使用插件（如 <code>@rollup/plugin-replace</code>）或在 Rollup 配置中直接注入全局变量。以下是一些常用的方法：</p>\n<h3>方法 1: 使用 <code>@rollup/plugin-replace</code></h3>\n<p><code>@rollup/plugin-replace</code> 插件允许你在构建过程中替换代码中的特定字符串，这对于定义全局变量非常有用。</p>\n<h4>安装插件</h4>\n<p>首先，安装 <code>@rollup/plugin-replace</code>：</p>\n<pre><code class="language-sh">npm install @rollup/plugin-replace --save-dev\n</code></pre>\n<h4>配置插件</h4>\n<p>在 Rollup 配置文件中使用 <code>@rollup/plugin-replace</code> 插件：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> replace <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@rollup/plugin-replace&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/bundle.js&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;cjs&#x27;</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">replace</span>({\n      <span class="hljs-string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">&#x27;production&#x27;</span>), <span class="hljs-comment">// 定义全局变量</span>\n      <span class="hljs-attr">__VERSION__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">&#x27;1.0.0&#x27;</span>) <span class="hljs-comment">// 另一个示例</span>\n    })\n  ]\n};\n</code></pre>\n<h4>使用全局变量</h4>\n<p>在你的代码中，你可以直接使用这些全局变量：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This is the production build.&#x27;</span>);\n}\n\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Version:&#x27;</span>, __VERSION__);\n</code></pre>\n<h3>方法 2: 使用 <code>output.globals</code></h3>\n<p>如果你需要将某些外部模块视为全局变量（通常用于 UMD 或 IIFE 格式的输出），可以使用 <code>output.globals</code> 配置。</p>\n<h4>示例</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/bundle.js&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;iife&#x27;</span>,\n    <span class="hljs-attr">globals</span>: {\n      <span class="hljs-attr">jquery</span>: <span class="hljs-string">&#x27;$&#x27;</span> <span class="hljs-comment">// 将 &#x27;jquery&#x27; 模块视为全局变量 &#x27;$&#x27;</span>\n    }\n  },\n  <span class="hljs-attr">external</span>: [<span class="hljs-string">&#x27;jquery&#x27;</span>] <span class="hljs-comment">// 将 &#x27;jquery&#x27; 标记为外部依赖</span>\n};\n</code></pre>\n<h3>方法 3: 直接在代码中定义（不推荐）</h3>\n<p>虽然不推荐，但你也可以直接在代码中定义全局变量（例如，在入口文件中）。这种方法可能会导致代码难以维护和测试。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// src/main.js</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-property">myGlobalVar</span> = <span class="hljs-string">&#x27;This is a global variable&#x27;</span>;\n</code></pre>\n<h3>方法 4: 使用 <code>define</code> 插件（自定义实现）</h3>\n<p>你可以编写一个自定义插件来注入全局变量。以下是一个简单的示例：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">definePlugin</span>(<span class="hljs-params">definitions</span>) {\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;define&#x27;</span>,\n    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {\n      <span class="hljs-keyword">let</span> transformedCode = code;\n      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(definitions)) {\n        <span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`\\\\b<span class="hljs-subst">${key}</span>\\\\b`</span>, <span class="hljs-string">&#x27;g&#x27;</span>);\n        transformedCode = transformedCode.<span class="hljs-title function_">replace</span>(regex, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));\n      }\n      <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: transformedCode, <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span> };\n    }\n  };\n}\n\n<span class="hljs-comment">// 在 Rollup 配置中使用</span>\n<span class="hljs-keyword">import</span> definePlugin <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./define-plugin.js&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/bundle.js&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;cjs&#x27;</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">definePlugin</span>({\n      <span class="hljs-attr">__API_URL__</span>: <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>,\n      <span class="hljs-attr">__FEATURE_FLAG__</span>: <span class="hljs-literal">true</span>\n    })\n  ]\n};\n</code></pre>\n<h3>总结</h3>\n<ul>\n<li><strong><code>@rollup/plugin-replace</code></strong>  : 适用于简单的字符串替换，定义全局常量。</li>\n<li><strong><code>output.globals</code></strong>  : 适用于将外部模块视为全局变量。</li>\n<li><strong>自定义插件</strong>  : 适用于更复杂的全局变量注入需求。</li>\n<li><strong>直接定义</strong>  : 不推荐，除非非常简单且没有其他选择。</li>\n</ul>\n<p>选择适合你项目需求的方法来定义全局变量，以保持代码的清晰和可维护性。</p>\n</div>'</script></body></html>