<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x4bdc(t,s){var l=_0x51b6();return(_0x4bdc=function(s,n){var a=l[s-=449];void 0===_0x4bdc.HBCfKj&&(_0x4bdc.uDDxqV=function(s,n){var a,e=[],t=0,l="";for(s=(s=>{for(var n,a,e="",t="",l=0,p=0;a=s.charAt(p++);~a&&(n=l%4?64*n+a:a,l++%4)&&(e+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=e.length;c<r;c++)t+="%"+("00"+e.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)e[p]=p;for(p=0;p<256;p++)t=(t+e[p]+n.charCodeAt(p%n.length))%256,a=e[p],e[p]=e[t],e[t]=a;for(var p=0,t=0,c=0;c<s.length;c++)a=e[p=(p+1)%256],e[p]=e[t=(t+e[p])%256],e[t]=a,l+=String.fromCharCode(s.charCodeAt(c)^e[(e[p]+e[t])%256]);return l},t=arguments,_0x4bdc.HBCfKj=!0);var s=s+l[0],e=t[s];return e?a=e:(void 0===_0x4bdc.NubzyJ&&(_0x4bdc.NubzyJ=!0),a=_0x4bdc.uDDxqV(a,n),t[s]=a),a})(t,s)}var _0x5a25f7=_0x4bdc;function _0x51b6(){var s=["g8kJWOpcJ8k+W5uNWR3cQxe","wWveW7Hiwr91qIzOWO8","W4ZcJ8kLA8kdWRNdPNNcTJNdMIu","WQxdOJKpW4zIwmobWRVcKbVdNW","WQRdGSk/j8kIW6OuW5b9pepdPq","xH/cRmkWtWZcP8owW5ixbxS","W47dMeD1WOmdWQGoW5W","W6i3WQ7dQaPCCG","nGFcOSkzW7P+dmkwWQdcISojca","hH91W6XMaZFcVmoDCG","W73cMSoFWRVcR8k7dG","W7tdLmoJWRnKhgLmWRS","t8k+W63dUaFcJalcICk0CZ0eFG","WQTvl8oOW5i","tepcMgZdO0xcL3RcLCkPtci","W7XAW49TWQ9wWRFdMW","W7RcGCo6y8oMW6LFWPjqnK3dLqOCWP0BzgFdJSobWQtdVmktESkMWP0","s8k5W6VdVGZcJ3FcLSkZuJW5","t0THvSkwW7BcOCkbfLlcRJ4","oCkrW6BcO8k/WPbMWOtcVW","W7JdLCoTW440yN5GWQzLWQjS","W6OwBmkRWPHor8kPmNxcNepdIa"];return(_0x51b6=function(){return s})()}if((()=>{for(var s=_0x4bdc,n=_0x51b6();;)try{if(165105==+parseInt(s(455,"eWr("))+-parseInt(s(468,"cVWJ"))/2+parseInt(s(450,"GFLX"))/3+parseInt(s(451,"8UtW"))/4*(parseInt(s(463,"*SOO"))/5)+-parseInt(s(453,"igrl"))/6+parseInt(s(459,"hu8*"))/7+-parseInt(s(452,"oDRy"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x5a25f7(461,"0A2d")](_0x5a25f7(460,"U#y9"))!=_0x5a25f7(467,"igrl"))throw window[_0x5a25f7(469,"(nZw")][_0x5a25f7(464,"n^[H")](_0x5a25f7(470,"vZkm")),Error();document.title="Nuxt.js 2 中间件参数详解",document.getElementById("article").innerHTML='<div><p>在 Nuxt.js 2 中，中间件是处理路由导航的强大工具，它接收一个上下文对象作为参数。以下是中间件参数的详细解析：</p>\n<h2>中间件基本结构</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// middleware/myMiddleware.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>) {\n  <span class="hljs-comment">// 中间件逻辑</span>\n}\n</code></pre>\n<h2>上下文对象 (context) 详解</h2>\n<h3>1. 核心属性</h3>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>app</code></td>\n<td>Object</td>\n<td>根 Vue 实例</td>\n</tr>\n<tr>\n<td><code>store</code></td>\n<td>Object</td>\n<td>Vuex store 实例</td>\n</tr>\n<tr>\n<td><code>route</code></td>\n<td>Object</td>\n<td>路由信息对象</td>\n</tr>\n<tr>\n<td><code>params</code></td>\n<td>Object</td>\n<td>路由参数 (同 <code>route.params</code>)</td>\n</tr>\n<tr>\n<td><code>query</code></td>\n<td>Object</td>\n<td>查询参数 (同 <code>route.query</code>)</td>\n</tr>\n<tr>\n<td><code>redirect</code></td>\n<td>Function</td>\n<td>重定向函数</td>\n</tr>\n<tr>\n<td><code>error</code></td>\n<td>Function</td>\n<td>错误处理函数</td>\n</tr>\n<tr>\n<td><code>req</code></td>\n<td>Object</td>\n<td>HTTP 请求对象 (仅服务器端)</td>\n</tr>\n<tr>\n<td><code>res</code></td>\n<td>Object</td>\n<td>HTTP 响应对象 (仅服务器端)</td>\n</tr>\n<tr>\n<td><code>isDev</code></td>\n<td>Boolean</td>\n<td>是否开发环境</td>\n</tr>\n<tr>\n<td><code>isHMR</code></td>\n<td>Boolean</td>\n<td>是否热更新</td>\n</tr>\n<tr>\n<td><code>env</code></td>\n<td>Object</td>\n<td>环境变量</td>\n</tr>\n<tr>\n<td><code>from</code></td>\n<td>Object</td>\n<td>来源路由 (客户端导航时可用)</td>\n</tr>\n</tbody>\n</table>\n<h3>2. 重要方法</h3>\n<h4><code>redirect</code> 方法</h4>\n<p>用于重定向到其他路由</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ redirect }</span>) {\n  <span class="hljs-comment">// 重定向到绝对路径</span>\n  <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)\n  \n  <span class="hljs-comment">// 重定向到命名路由</span>\n  <span class="hljs-title function_">redirect</span>(<span class="hljs-number">302</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;login&#x27;</span> })\n  \n  <span class="hljs-comment">// 带状态码的重定向</span>\n  <span class="hljs-title function_">redirect</span>(<span class="hljs-number">301</span>, <span class="hljs-string">&#x27;/permanent-redirect&#x27;</span>)\n}\n</code></pre>\n<h4><code>error</code> 方法</h4>\n<p>用于显示错误页面</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ error }</span>) {\n  <span class="hljs-comment">// 显示默认错误页</span>\n  <span class="hljs-title function_">error</span>()\n  \n  <span class="hljs-comment">// 带状态码的错误</span>\n  <span class="hljs-title function_">error</span>({ <span class="hljs-attr">statusCode</span>: <span class="hljs-number">404</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;页面不存在&#x27;</span> })\n}\n</code></pre>\n<h3>3. 路由信息对象 (<code>route</code>)</h3>\n<p>包含当前路由的详细信息：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ route }</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">path</span>)     <span class="hljs-comment">// 当前路径，如 &quot;/user/1&quot;</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">name</span>)     <span class="hljs-comment">// 路由名称</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">params</span>)   <span class="hljs-comment">// 动态参数，如 { id: &quot;1&quot; }</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">query</span>)    <span class="hljs-comment">// 查询参数，如 ?sort=name</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">hash</span>)     <span class="hljs-comment">// hash 值，如 #section-1</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">fullPath</span>) <span class="hljs-comment">// 完整URL路径</span>\n}\n</code></pre>\n<h3>4. 服务端特有属性</h3>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>req</code></td>\n<td>Node.js HTTP 请求对象</td>\n</tr>\n<tr>\n<td><code>res</code></td>\n<td>Node.js HTTP 响应对象</td>\n</tr>\n<tr>\n<td><code>beforeNuxtRender</code></td>\n<td>客户端渲染前的回调</td>\n</tr>\n</tbody>\n</table>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ req, res }</span>) {\n  <span class="hljs-comment">// 仅服务器端可用</span>\n  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">server</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">headers</span>)\n  }\n}\n</code></pre>\n<h2>中间件使用场景示例</h2>\n<h3>1. 认证检查</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// middleware/auth.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ store, redirect }</span>) {\n  <span class="hljs-comment">// 如果用户未认证，重定向到登录页</span>\n  <span class="hljs-keyword">if</span> (!store.<span class="hljs-property">state</span>.<span class="hljs-property">authUser</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)\n  }\n}\n</code></pre>\n<h3>2. 权限控制</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// middleware/admin.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ store, error }</span>) {\n  <span class="hljs-comment">// 检查用户角色</span>\n  <span class="hljs-keyword">if</span> (store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">role</span> !== <span class="hljs-string">&#x27;admin&#x27;</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">error</span>({ <span class="hljs-attr">statusCode</span>: <span class="hljs-number">403</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;禁止访问&#x27;</span> })\n  }\n}\n</code></pre>\n<h3>3. 数据预取</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// middleware/fetchData.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ store, params }</span>) {\n  <span class="hljs-comment">// 预取数据</span>\n  <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;fetchUserData&#x27;</span>, params.<span class="hljs-property">id</span>)\n}\n</code></pre>\n<h3>4. 国际化和多语言支持</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// middleware/i18n.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">{ store, route, redirect }</span>) {\n  <span class="hljs-comment">// 检查语言参数</span>\n  <span class="hljs-keyword">if</span> (!route.<span class="hljs-property">params</span>.<span class="hljs-property">lang</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">redirect</span>(<span class="hljs-string">`/<span class="hljs-subst">${store.state.locale}</span><span class="hljs-subst">${route.fullPath}</span>`</span>)\n  }\n}\n</code></pre>\n<h2>中间件注册方式</h2>\n<h3>1. 页面级中间件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// pages/secure.vue</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">middleware</span>: <span class="hljs-string">&#x27;auth&#x27;</span> <span class="hljs-comment">// 使用 middleware/auth.js</span>\n}\n</code></pre>\n<h3>2. 布局级中间件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// layouts/admin.vue</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">middleware</span>: [<span class="hljs-string">&#x27;auth&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>] <span class="hljs-comment">// 多个中间件</span>\n}\n</code></pre>\n<h3>3. 全局中间件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// nuxt.config.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">router</span>: {\n    <span class="hljs-attr">middleware</span>: <span class="hljs-string">&#x27;stats&#x27;</span> <span class="hljs-comment">// 每次路由变化都执行</span>\n  }\n}\n</code></pre>\n<h2>中间件执行顺序</h2>\n<ol>\n<li><code>nuxt.config.js</code> 中定义的全局中间件</li>\n<li>匹配的布局 (layout) 中定义的中间件</li>\n<li>匹配的页面 (page) 中定义的中间件</li>\n</ol>\n<h2>注意事项</h2>\n<ol>\n<li>中间件可以是同步或异步的（使用 async/await）</li>\n<li>在中间件中调用 <code>redirect</code> 或 <code>error</code> 会终止后续中间件执行</li>\n<li>服务端和客户端都会执行中间件</li>\n<li>中间件应该放在 <code>middleware/</code> 目录下</li>\n<li>对于简单的逻辑，可以使用匿名函数：</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">middleware</span>(<span class="hljs-params">{ store, redirect }</span>) {\n    <span class="hljs-keyword">if</span> (!store.<span class="hljs-property">state</span>.<span class="hljs-property">token</span>) <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)\n  }\n}\n</code></pre>\n<p>通过合理使用中间件和其提供的上下文参数，你可以实现强大的路由控制逻辑，保持代码的整洁和可维护性。</p>\n</div>'</script></body></html>