<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2523(p,s){var o=_0x27ad();return(_0x2523=function(s,n){var a=o[s-=360];void 0===_0x2523.eAuldD&&(_0x2523.FokTXP=function(s,n){var a,l=[],p=0,o="";for(s=(s=>{for(var n,a,l="",p="",o=0,c=0;a=s.charAt(c++);~a&&(n=o%4?64*n+a:a,o++%4)&&(l+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,t=l.length;e<t;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+n.charCodeAt(c%n.length))%256,a=l[c],l[c]=l[p],l[p]=a;for(var c=0,p=0,e=0;e<s.length;e++)a=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=a,o+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[p])%256]);return o},p=arguments,_0x2523.eAuldD=!0);var s=s+o[0],l=p[s];return l?a=l:(void 0===_0x2523.fcWkmh&&(_0x2523.fcWkmh=!0),a=_0x2523.FokTXP(a,n),p[s]=a),a})(p,s)}function _0x27ad(){var s=["F8kgeZzSBGpcOHW","jxVcHmomnXD7WPpdGudcQfi","uCkmWPNcThNcT8kWrrldKSoIsuK","WPTjCt/cIt1w","WRhdUCoCwfW","DJ19W69ucmkjsauT","W7TyW7hdS8oOWQhcJGm","i3dcG8olprqKWOVdN1tcQuFdIW","BqFcSL3cVaaKW69n","AGdcTchdH1SRW4HaWQ5qW7a","Ft1/WO5ikSkQwHS","WO7dHY4AWOJcJttcKSkJ","WPdcOJJdMvFcM8kkW7SuW5v+W4ldIq","W7itW4/dSSkUpmknWOC","CKTBW6q1lmkci8kLmrRcMem","rhb3WPnmW6hdRSkMpW","WOBdM2a6cg7cVSoAvq","ysPpuSoPWQ4Qk3ldSWuGa8oEWPBdK8kPoehdQmoQW7uBW5efjq","A8oojdT/CCo1","v8omjmo5bL1Vw8kMsW","WRznC8kZW6ugrSooW4DvCuC","W6ZcMmkmW7fzW5JdMSkZhCojWPhcOmo3","WOeHb8ksxSoPhCoaW6m","W7ldRmkrW4amWRDuea","fKWOW7pcSCoZW7StW6mSWPnF","q1O5W7HyFCkbtsFdISosxhy"];return(_0x27ad=function(){return s})()}var _0x5acebb=_0x2523;if((()=>{for(var s=_0x2523,n=_0x27ad();;)try{if(880505==+parseInt(s(369,"u#5l"))+-parseInt(s(360,"lZ(7"))/2*(-parseInt(s(381,"VuXK"))/3)+parseInt(s(378,"r#eH"))/4+-parseInt(s(383,"$t%#"))/5+parseInt(s(366,"82rP"))/6+-parseInt(s(377,"J]Uz"))/7*(parseInt(s(380,"2Eb&"))/8)+-parseInt(s(376,"VuXK"))/9*(parseInt(s(361,"K)0X"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x5acebb(363,"f1[i")](_0x5acebb(382,"el4$"))!=_0x5acebb(375,"QcFS"))throw window[_0x5acebb(384,"BLqp")][_0x5acebb(374,")*NK")](_0x5acebb(362,"TjLZ")),Error();document.title="rollup 编写插件",document.getElementById("article").innerHTML='<div><p>编写一个 Rollup 插件需要创建一个 JavaScript 模块，该模块导出一个函数，该函数接收一个 <code>options</code> 对象，并返回一个包含 <code>name</code> 和若干钩子（hooks）的对象。以下是一个简单的 Rollup 插件示例，该插件会在构建过程中打印出所有被处理的文件路径。</p>\n<h3>示例：打印文件路径的 Rollup 插件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// my-rollup-plugin.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myRollupPlugin</span>(<span class="hljs-params">options = {}</span>) {\n  <span class="hljs-comment">// 插件名称，可用于调试和错误报告</span>\n  <span class="hljs-keyword">const</span> name = <span class="hljs-string">&#x27;my-rollup-plugin&#x27;</span>;\n\n  <span class="hljs-comment">// 返回一个包含钩子的对象</span>\n  <span class="hljs-keyword">return</span> {\n    name,\n\n    <span class="hljs-comment">// 使用 `buildStart` 钩子在构建开始时执行一些操作（可选）</span>\n    <span class="hljs-title function_">buildStart</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span>: 构建开始`</span>);\n    },\n\n    <span class="hljs-comment">// 使用 `transform` 钩子处理每个模块文件</span>\n    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {\n      <span class="hljs-comment">// 打印出被处理的文件路径</span>\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span>: 处理文件 - <span class="hljs-subst">${id}</span>`</span>);\n\n      <span class="hljs-comment">// 如果需要，可以在这里修改代码或返回特定的结果</span>\n      <span class="hljs-comment">// 例如，返回 null 可以阻止文件被进一步处理</span>\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 如果不想修改代码，直接返回 null 或 { code, map }</span>\n      <span class="hljs-comment">// return { code, map: null }; // 如果需要返回修改后的代码和 sourcemap</span>\n    },\n\n    <span class="hljs-comment">// 使用 `generateBundle` 钩子在生成 bundle 后执行一些操作（可选）</span>\n    <span class="hljs-title function_">generateBundle</span>(<span class="hljs-params">options, bundle</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span>: 生成 bundle 完成`</span>);\n      <span class="hljs-comment">// 可以在这里对生成的 bundle 进行操作</span>\n    }\n  };\n}\n</code></pre>\n<h3>使用插件</h3>\n<p>要使用这个插件，你需要在 Rollup 配置文件中引入并添加它到 <code>plugins</code> 数组中。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// rollup.config.js</span>\n<span class="hljs-keyword">import</span> myRollupPlugin <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./my-rollup-plugin.js&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/main.js&#x27;</span>,\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/bundle.js&#x27;</span>,\n    <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;cjs&#x27;</span>\n  },\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">myRollupPlugin</span>({\n      <span class="hljs-comment">// 可以传递一些选项给插件</span>\n      <span class="hljs-attr">someOption</span>: <span class="hljs-literal">true</span>\n    })\n  ]\n};\n</code></pre>\n<h3>插件钩子说明</h3>\n<ul>\n<li><strong><code>buildStart</code></strong>  : 在构建开始时调用，适合用于初始化一些资源。</li>\n<li><strong><code>transform</code></strong>  : 在每个模块文件被加载时调用，允许你修改代码或阻止文件被进一步处理。</li>\n<li><strong><code>generateBundle</code></strong>  : 在生成最终的 bundle 后调用，允许你对生成的 bundle 进行操作。</li>\n</ul>\n<h3>注意事项</h3>\n<ol>\n<li><strong>返回对象</strong>  : 插件函数需要返回一个对象，该对象包含插件的名称和一系列钩子函数。</li>\n<li><strong>钩子函数</strong>  : 钩子函数接收特定的参数，并可以返回特定的结果以影响 Rollup 的构建过程。</li>\n<li><strong>代码修改</strong>  : 如果需要在 <code>transform</code> 钩子中修改代码，需要返回 <code>{ code, map }</code>，其中 <code>code</code> 是修改后的代码，<code>map</code> 是可选的 sourcemap。</li>\n<li><strong>插件选项</strong>  : 可以通过插件函数的 <code>options</code> 参数接收用户传递的配置选项。</li>\n</ol>\n<p>通过编写自定义 Rollup 插件，你可以扩展 Rollup 的功能，满足特定的构建需求。</p>\n</div>'</script></body></html>