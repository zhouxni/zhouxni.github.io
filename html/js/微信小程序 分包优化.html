<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3a11(p,s){var l=_0x11b3();return(_0x3a11=function(s,n){var a=l[s-=298];void 0===_0x3a11.RjcYDe&&(_0x3a11.jALbar=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,c=0;a=s.charAt(c++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,u=t.length;o<u;o++)p+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)p=(p+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[p],t[p]=a;for(var c=0,p=0,o=0;o<s.length;o++)a=t[c=(c+1)%256],t[c]=t[p=(p+t[c])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(o)^t[(t[c]+t[p])%256]);return l},p=arguments,_0x3a11.RjcYDe=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0x3a11.tusjeo&&(_0x3a11.tusjeo=!0),a=_0x3a11.jALbar(a,n),p[s]=a),a})(p,s)}function _0x11b3(){var s=["W4pdIhiDW7b0W5pcLYFcLCkUWPi","WR0eBCk1WRZcM8kOW5xdJ8kM","cJ3dJ8okW4pdQmkmW63cS8oNySoheW4","q2LKW6tcJmk+W5ddSG","WOxdHKefWRRcIGBdMmkwzW","BSk9W5BcNCoRy3FcRazT","WOFdSYzPW41VWPldHXRcQq","smo9cIFdSCoWW5dcVHtcHbNdNG","pSkAj8kkWOWgWRbRd8ou","nCkwjmkSWPldPrBdPL7cMG","WQqbW5CRW44lWRtcIW","W5TrWPFdGx7dSSk8","q24XW6lcOmkeW63dLSkN","iu3dOXRdNhr9CG","W4aMFSkpdgCcW51JwCk2","j0ZcSutcKs1Rra0Qu8kQ","WRa+W4ZdSCktWQpcQWC8W4xcUSogxW","jCkuCxpdTwddQ8k3","qmonD8oXWQFdGXhdOLe","W63dLc/cNSkUn3pdO1tdTG","W4pcVMuIW7i","W6nJWOhcJ8oEW7pdSa","WRlcLgldMmkLsd3cVf3dUSoaWQXwlfmVBxT/smk2tfLICb4","WQlcQLL5p0S6W58","q8oEaqhcUCkjCW","pCkFk8koW5nCW7q4l8oyW6Luh8oy","qwO1WRhdISkzW7tdQ8k0t1u","k2xcMddcQguR","WQqhWOySW6qUWQ3cGv0","W43dI34EWRegW4tcLcZcUW","nSkCi8kMW63cHtVdKeNcHSofW48","W6JdOwFcOxmFmuRcO8kNfIVdPa","W4iKk8oBtf8cW6O","WPpcUYRcK3BcOcfj"];return(_0x11b3=function(){return s})()}var _0x53a206=_0x3a11;if((()=>{for(var s=_0x3a11,n=_0x11b3();;)try{if(590230==-parseInt(s(305,"@o)Z"))*(parseInt(s(312,"C5C2"))/2)+-parseInt(s(327,"K]&M"))/3*(parseInt(s(303,"2f3*"))/4)+-parseInt(s(323,"L7l("))/5*(-parseInt(s(320,"79Lz"))/6)+-parseInt(s(328,"npwE"))/7*(parseInt(s(302,"L7l("))/8)+parseInt(s(307,"5qQ2"))/9*(parseInt(s(298,"ODY$"))/10)+parseInt(s(316,"v4lv"))/11*(parseInt(s(309,"bfE3"))/12)+-parseInt(s(306,"9$$Y"))/13*(-parseInt(s(329,"*z5M"))/14))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x53a206(314,"bfE3")](_0x53a206(311,"L7l("))!=_0x53a206(313,"tlAK"))throw window[_0x53a206(310,"STwg")][_0x53a206(317,"X^q[")](_0x53a206(315,"C5C2")),Error();document.title="微信小程序 分包优化",document.getElementById("article").innerHTML='<div><p>微信小程序分包优化是一种关键的性能优化技术，旨在通过合理划分和加载子包来减少主包的体积和加载时间，提升用户体验。以下是对微信小程序分包优化的详细阐述：</p>\n<h3>一、分包的基本概念</h3>\n<ul>\n<li><strong>主包</strong>  ：包含小程序启动页面（如首页）和公共代码（如全局组件、工具类库等）。主包在用户首次打开小程序时会被下载和加载。</li>\n<li><strong>分包</strong>  ：开发者划分的独立功能模块，按需加载。例如，商品详情页、用户中心等。分包在用户访问到对应页面时才会被下载。</li>\n</ul>\n<h3>二、分包的作用</h3>\n<ul>\n<li><strong>优化加载时间</strong>  ：通过分包，可以将部分代码和资源拆分到其他子包中，减少首页的加载时间，提高用户体验。</li>\n<li><strong>提高性能</strong>  ：分包可以帮助有效减少小程序包的体积，提升小程序的加载速度。</li>\n<li><strong>便于多人开发</strong>  ：在多人开发过程中，分包可以更好地解耦代码，提高开发效率。</li>\n</ul>\n<h3>三、分包的配置方法</h3>\n<ul>\n<li>在小程序的配置文件 <code>app.json</code> 中，通过 <code>subpackages</code> 字段声明项目分包结构。每个分包需要指定 <code>root</code> 字段（分包的根目录）、<code>name</code> 字段（分包的名称，用于在代码中引用该分包）和 <code>pages</code> 字段（该分包中包含的页面）。</li>\n</ul>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n    <span class="hljs-string">&quot;pages/index/index&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 主包页面</span>\n    <span class="hljs-string">&quot;pages/logs/logs&quot;</span>\n  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;subpackages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n    <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;packageA&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 分包根目录</span>\n      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sub1&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 分包别名（可选）</span>\n      <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\n        <span class="hljs-string">&quot;pages/cart/cart&quot;</span><span class="hljs-punctuation">,</span>\n        <span class="hljs-string">&quot;pages/detail/detail&quot;</span>\n      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-attr">&quot;independent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// 是否为独立分包（默认false）</span>\n    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;packageB&quot;</span><span class="hljs-punctuation">,</span>\n      <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;pages/user/user&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">]</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>四、独立分包</h3>\n<ul>\n<li><strong>定义</strong>  ：独立分包是一种特殊类型的分包，可以独立于主包和其他分包运行。从独立分包中页面进入小程序时，不需要下载主包。</li>\n<li><strong>配置</strong>  ：在 <code>subpackages</code> 配置项中定义 <code>independent</code> 字段，并将其设置为 <code>true</code> 来声明对应分包为独立分包。</li>\n<li><strong>限制</strong>  ：独立分包中不能依赖主包和其他分包中的内容，包括 JS 文件、template、wxss、自定义组件、插件等。</li>\n</ul>\n<h3>五、分包预加载</h3>\n<ul>\n<li><strong>定义</strong>  ：分包预加载是指在访问小程序某个页面时，预先下载分包中的代码和资源，以提高用户的使用体验。</li>\n<li><strong>配置</strong>  ：在微信小程序中，分包的预下载需在 <code>app.json</code> 文件中通过 <code>preloadRule</code> 字段进行设置。<code>preloadRule</code> 是一个对象，其键值对表示在访问特定路径时进行预加载的规则。</li>\n</ul>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;preloadRule&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;pages/index/index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;all&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 在指定网络下预下载，可选值为: all（不限网络）、wifi（仅wifi下预下载）</span>\n      <span class="hljs-attr">&quot;packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;packageA&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 需要预加载的分包名或 root</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3>六、分包优化注意事项</h3>\n<ul>\n<li><strong>资源引用规则</strong>  ：主包无法直接引用分包中的资源（如图片、组件、JS 等），分包之间也不能互相引用资源。公共资源需放在主包中。</li>\n<li><strong>页面跳转</strong>  ：主包跳转到分包页面时，需使用完整路径；分包跳转到主包页面时，路径也需写完整。</li>\n<li><strong>体积限制</strong>  ：整个小程序所有分包总大小不得超过一定限制（如微信小程序为20MB），同时单个分包或主包的大小也不能超过一定限制（如微信小程序为2MB）。</li>\n<li><strong>代码压缩</strong>  ：使用代码压缩工具对分包代码进行压缩，进一步减少包体积。</li>\n</ul>\n<h3>七、实际案例与效果</h3>\n<ul>\n<li>通过合理的分包设计和预加载策略，可以显著提升微信小程序的性能。例如，某小程序在采用分包优化后，首屏加载时间从2.8秒减少到1.2秒，后续页面加载时间也显著缩短。</li>\n<li>分包优化还有助于提高小程序的开发效率和可维护性，使不同团队能够并行开发不同分包，实现按需更新。</li>\n</ul>\n</div>'</script></body></html>