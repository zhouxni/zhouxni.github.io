<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x37a9(r,s){var o=_0x1a16();return(_0x37a9=function(s,n){var a=o[s-=404];void 0===_0x37a9.gHuGVq&&(_0x37a9.VEIGIv=function(s,n){var a,t=[],r=0,o="";for(s=(s=>{for(var n,a,t="",r="",o=0,e=0;a=s.charAt(e++);~a&&(n=o%4?64*n+a:a,o++%4)&&(t+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var l=0,c=t.length;l<c;l++)r+="%"+("00"+t.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(r)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)r=(r+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[r],t[r]=a;for(var e=0,r=0,l=0;l<s.length;l++)a=t[e=(e+1)%256],t[e]=t[r=(r+t[e])%256],t[r]=a,o+=String.fromCharCode(s.charCodeAt(l)^t[(t[e]+t[r])%256]);return o},r=arguments,_0x37a9.gHuGVq=!0);var s=s+o[0],t=r[s];return t?a=t:(void 0===_0x37a9.EeLCWi&&(_0x37a9.EeLCWi=!0),a=_0x37a9.VEIGIv(a,n),r[s]=a),a})(r,s)}var _0x509402=_0x37a9;if((()=>{for(var s=_0x37a9,n=_0x1a16();;)try{if(209210==-parseInt(s(406,"6uEf"))*(parseInt(s(422,"0NzA"))/2)+parseInt(s(404,"cxS6"))/3*(-parseInt(s(419,"3n[l"))/4)+-parseInt(s(410,"hI&u"))/5+-parseInt(s(430,"^N0w"))/6+-parseInt(s(420,"b@7g"))/7*(-parseInt(s(409,"3n[l"))/8)+-parseInt(s(427,"bhn5"))/9*(-parseInt(s(425,"0NzA"))/10)+parseInt(s(416,"b@7g"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x509402(421,"6uEf")](_0x509402(407,"YZ7J"))!=_0x509402(408,"9*&$"))throw window[_0x509402(424,"JCwZ")][_0x509402(426,"vAoT")](_0x509402(414,"3n[l")),Error();function _0x1a16(){var s=["adCKW70qA8oF","W6hdLs43W77dQmoXWRZcNW","DaxcNmkdyeqLiG","xdOXW5lcN1zoW5CCrmoD","W4hcSSk0d3VdNclcSqBdS8kgW7K","W7SgivupW7RdTNe","xCogaatdQGvOrgeTkCos","W6ldGctcUL42W5G0","WPr0W6eji3ddTZxdPW","qhxdNSoArG","eSoyDXNdNmkNWPm","vs4NqCoUzSoaoSoeo3lcP30","bf1DW6W3W6xdNLHM","atlcNmkDdqjJBu1AW4/cQmoxFW","xJS9W5xcMH5MW4G6FmoxWRW","qSoatrJdJmoEW40kW5JcO8klymoBW5xdIbOTcH4xrmkSWRRcVSogwW","W4ZcTSoEheBdIgicwCkWDW","WOWwW5isqSoNESkiCmkbEg9ctq","q2rIWQvdmCkkCN7cN1RcOmog","uCoXW4vtyCoNlCkyhmo+Fq4","g8kdavNcJmowWQbGW5dcKSkJua","WOGqW5CrrCoMj8o9FmkbCMy","WRtcLcpcNgSQW50","g10xyJpcOda7gxXV","WRCiW5VdK8oHrSkjna","WPtdHmk6hmovySkOwG","gL0vzJxcQIWad29T"];return(_0x1a16=function(){return s})()}document.title="X-Frame-Options 详解",document.getElementById("article").innerHTML='<div><p><strong>X-Frame-Options</strong>   是一个 HTTP 响应头，用于控制网页是否允许被嵌入到 <code>&lt;frame&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;embed&gt;</code> 或 <code>&lt;object&gt;</code> 中，主要用于防止 <strong>点击劫持（Clickjacking）</strong>   攻击。</p>\n<hr>\n<h2><strong>1. 作用</strong></h2>\n<ul>\n<li><strong>防止恶意网站通过 iframe 嵌入你的页面</strong>  ，伪装成合法内容诱导用户操作（如点击按钮、输入密码）。</li>\n<li><strong>保护敏感页面</strong>  （如登录页、支付页）不被第三方网站嵌套。</li>\n</ul>\n<hr>\n<h2><strong>2. 可选值</strong></h2>\n<table>\n<thead>\n<tr>\n<th>选项</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>DENY</code></strong></td>\n<td><strong>完全禁止嵌入</strong>  （任何网站都不能 iframe 加载该页面）</td>\n<td><code>X-Frame-Options: DENY</code></td>\n</tr>\n<tr>\n<td><strong><code>SAMEORIGIN</code></strong></td>\n<td><strong>仅允许同源网站嵌入</strong>  （相同协议+域名+端口）</td>\n<td><code>X-Frame-Options: SAMEORIGIN</code></td>\n</tr>\n<tr>\n<td><strong><code>ALLOW-FROM uri</code></strong></td>\n<td><strong>仅允许指定域名嵌入</strong>  （已废弃，部分浏览器不支持）</td>\n<td><code>X-Frame-Options: ALLOW-FROM https://trusted.com</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>3. 在 Egg.js 中配置</strong></h2>\n<p><code>egg-security</code> 默认启用 <code>X-Frame-Options: SAMEORIGIN</code>。如需自定义：</p>\n<h3><strong>(1) 全局配置（推荐）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// config/config.default.js</span>\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">security</span> = {\n  <span class="hljs-attr">xframe</span>: {\n    <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;DENY&#x27;</span>, <span class="hljs-comment">// 或 &#x27;SAMEORIGIN&#x27;</span>\n  },\n};\n</code></pre>\n<h3><strong>(2) 动态禁用（针对特定页面）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在控制器中临时关闭</span>\n<span class="hljs-keyword">async</span> <span class="hljs-title function_">somePage</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;X-Frame-Options&#x27;</span>, <span class="hljs-string">&#x27;ALLOW-FROM https://trusted.com&#x27;</span>); <span class="hljs-comment">// 谨慎使用</span>\n  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;page&#x27;</span>);\n}\n</code></pre>\n<hr>\n<h2><strong>4. 现代替代方案：Content Security Policy (CSP)</strong></h2>\n<p><code>X-Frame-Options</code> 是旧标准，现代浏览器更推荐使用 <strong>CSP 的 <code>frame-ancestors</code> 指令</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-built_in">exports</span>.<span class="hljs-property">security</span> = {\n  <span class="hljs-attr">csp</span>: {\n    <span class="hljs-attr">policy</span>: {\n      <span class="hljs-string">&#x27;frame-ancestors&#x27;</span>: [<span class="hljs-string">&quot;&#x27;self&#x27;&quot;</span>, <span class="hljs-string">&quot;https://trusted.com&quot;</span>], <span class="hljs-comment">// 同源 + 指定域名</span>\n    },\n  },\n};\n</code></pre>\n<ul>\n<li><strong>优势</strong>  ：更灵活，支持多域名白名单。</li>\n<li><strong>兼容性</strong>  ：需确保用户浏览器支持 CSP Level 2+。</li>\n</ul>\n<hr>\n<h2><strong>5. 测试是否生效</strong></h2>\n<ol>\n<li>\n<p><strong>手动检查响应头</strong>  ：</p>\n<pre><code class="language-sh">curl -I http://your-domain.com\n</code></pre>\n<p>输出应包含：</p>\n<pre><code>X-Frame-Options: DENY\n</code></pre>\n</li>\n<li>\n<p><strong>模拟攻击测试</strong>  ：</p>\n<ul>\n<li>创建一个恶意 HTML 文件，尝试用 iframe 嵌入你的页面：<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://your-domain.com/login&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>\n</code></pre>\n</li>\n<li>如果配置了 <code>DENY</code> 或 <code>SAMEORIGIN</code>，页面将无法加载或显示空白。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h2><strong>6. 常见问题</strong></h2>\n<h3><strong>Q1: 为什么设置了 <code>ALLOW-FROM</code> 无效？</strong></h3>\n<ul>\n<li>该选项已被大多数现代浏览器废弃（如 Chrome、Firefox），改用 CSP 的 <code>frame-ancestors</code>。</li>\n</ul>\n<h3><strong>Q2: 需要和 CSP 一起用吗？</strong></h3>\n<ul>\n<li><strong>是</strong>  ！双重防护更安全：<pre><code class="language-javascript"><span class="hljs-built_in">exports</span>.<span class="hljs-property">security</span> = {\n  <span class="hljs-attr">xframe</span>: {\n    <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;DENY&#x27;</span>,\n  },\n  <span class="hljs-attr">csp</span>: {\n    <span class="hljs-attr">policy</span>: {\n      <span class="hljs-string">&#x27;frame-ancestors&#x27;</span>: <span class="hljs-string">&quot;&#x27;none&#x27;&quot;</span>, <span class="hljs-comment">// 等效于 DENY</span>\n    },\n  },\n};\n</code></pre>\n</li>\n</ul>\n<h3><strong>Q3: 如何允许部分路径被嵌入？</strong></h3>\n<ul>\n<li>在中间件中动态设置：<pre><code class="language-javascript"><span class="hljs-comment">// app/middleware/iframe_guard.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n    <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">path</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;/public/&#x27;</span>)) {\n      ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;X-Frame-Options&#x27;</span>, <span class="hljs-string">&#x27;SAMEORIGIN&#x27;</span>);\n    } <span class="hljs-keyword">else</span> {\n      ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;X-Frame-Options&#x27;</span>, <span class="hljs-string">&#x27;DENY&#x27;</span>);\n    }\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  };\n};\n</code></pre>\n</li>\n</ul>\n<hr>\n<h2><strong>7. 总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>推荐配置</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>全站禁止嵌入</strong></td>\n<td><code>X-Frame-Options: DENY</code></td>\n</tr>\n<tr>\n<td><strong>仅同源嵌入</strong></td>\n<td><code>X-Frame-Options: SAMEORIGIN</code></td>\n</tr>\n<tr>\n<td><strong>指定域名嵌入</strong></td>\n<td>CSP: <code>frame-ancestors https://trusted.com</code></td>\n</tr>\n<tr>\n<td><strong>兼容旧浏览器</strong></td>\n<td>同时设置 <code>X-Frame-Options</code> 和 CSP</td>\n</tr>\n</tbody>\n</table>\n<p><strong>最佳实践</strong>  ：</p>\n<ul>\n<li>生产环境始终启用 <code>X-Frame-Options</code> 或 CSP。</li>\n<li>优先使用 CSP 的 <code>frame-ancestors</code>（更现代、更灵活）。</li>\n</ul>\n</div>'</script></body></html>