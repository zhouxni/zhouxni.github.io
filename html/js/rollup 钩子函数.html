<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x7af5b6=_0x22e7;function _0x22e7(e,n){var r=_0x4d47();return(_0x22e7=function(n,l){var o=r[n-=126];void 0===_0x22e7.CWyNFC&&(_0x22e7.pNxZjY=function(n,l){var o,s=[],e=0,r="";for(n=(n=>{for(var l,o,s="",e="",r=0,t=0;o=n.charAt(t++);~o&&(l=r%4?64*l+o:o,r++%4)&&(s+=String.fromCharCode(255&l>>(-2*r&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var a=0,d=s.length;a<d;a++)e+="%"+("00"+s.charCodeAt(a).toString(16)).slice(-2);return decodeURIComponent(e)})(n),t=0;t<256;t++)s[t]=t;for(t=0;t<256;t++)e=(e+s[t]+l.charCodeAt(t%l.length))%256,o=s[t],s[t]=s[e],s[e]=o;for(var t=0,e=0,a=0;a<n.length;a++)o=s[t=(t+1)%256],s[t]=s[e=(e+s[t])%256],s[e]=o,r+=String.fromCharCode(n.charCodeAt(a)^s[(s[t]+s[e])%256]);return r},e=arguments,_0x22e7.CWyNFC=!0);var n=n+r[0],s=e[n];return s?o=s:(void 0===_0x22e7.CamEFo&&(_0x22e7.CamEFo=!0),o=_0x22e7.pNxZjY(o,l),e[n]=o),o})(e,n)}if((()=>{for(var n=_0x22e7,l=_0x4d47();;)try{if(237767==+parseInt(n(155,"kW@S"))*(parseInt(n(131,"4$5n"))/2)+parseInt(n(139,"PUqv"))/3+parseInt(n(152,"V(bY"))/4*(parseInt(n(126,"#sDe"))/5)+parseInt(n(148,"3]O@"))/6*(-parseInt(n(137,"k3W0"))/7)+parseInt(n(143,"yjz$"))/8+-parseInt(n(130,"C8FG"))/9*(-parseInt(n(132,"^ovb"))/10)+parseInt(n(136,"4$5n"))/11*(-parseInt(n(138,"k3W0"))/12))break;l.push(l.shift())}catch(n){l.push(l.shift())}})(),localStorage[_0x7af5b6(141,"4MYR")](_0x7af5b6(146,"*^tE"))!=_0x7af5b6(140,"%R[b"))throw window[_0x7af5b6(149,"2o&F")][_0x7af5b6(142,"4MYR")](_0x7af5b6(150,"UD0J")),Error();function _0x4d47(){var n=["zdpdPX1xke3cGGNcKx0","W67dLJFdH3hcHmk2lmoX","W7bSpCkNW5aAW5Xgmq","WPNdHCoLE3eRWQm","WP3cUSo2WQ9PwSk9WQRdImo5sq","DhC1WOtdI3pcKq","pHddL8oTEmkpEmk+","W4NcRCoxWRZcOJK9WQpdS8oNW7S","WPdcG8kayNaRWQ/dRCk5","t8oBWRFcJSo4W71RW5pcGGuK","rmoyWRtcH8o6WQjmW7dcLGC8ha","cmk2l8oBD8orWOzeW4FdM8ojmW","WQNdP1hdRCoP","W4WXkmktWP0GW7m","W5KXlmk2WOGMW7S","WOVcS3xdRCocWP9WWPPUdCo9mG","WQ/dJSo4W49PWRzxD8kv","WOVcVNxdRmopWPLeWQ5thSoVdG","mg5mk2jfWRfAWOa","WOfhWOLsW6eNWQyNuaWmDG","WRJdRXJdNIxdQsZcNq","WPX+WOPGW5munmkd","WQ0cW5T0rHxcGq3cQcDmyM7dMd7dJmoOW7VcPCofWPqxdmoygcW","WRxcTLNcVxhdSK4wW67dLmo2WQq","WOOfW5mzWRbpWPa","pb3cHCkBomoWFCkqCmkTzJO","oCoPWQGRW6NdM2OvWRlcUCoR","W5SDW74IhCoRWOpdOSoVpSo6","AXZcSmkyW7a+ggJdOeOdaq","WQ9QW7hcMYNdOZO"];return(_0x4d47=function(){return n})()}document.title="rollup 钩子函数",document.getElementById("article").innerHTML='<div><p>Rollup 插件的核心是钩子函数，这些钩子函数允许插件在 Rollup 构建的不同阶段执行特定的操作。Rollup 提供的插件钩子函数主要分为两类：<strong>构建钩子（Build Hooks）</strong>  和<strong>输出生成钩子（Output Generation Hooks）</strong>  。</p>\n<h3>构建钩子（Build Hooks）</h3>\n<p>构建钩子在构建阶段执行，由 <code>rollup.rollup(inputOptions)</code> 触发。它们主要负责在 Rollup 处理输入文件之前定位、提供和转换输入文件。以下是一些常用的构建钩子函数：</p>\n<ol>\n<li><strong><code>options</code></strong>  ：\n<ul>\n<li>在解析命令行选项后修改最终的配置对象。这对于基于环境动态调整配置非常有用。</li>\n</ul>\n</li>\n<li><strong><code>buildStart</code></strong>  ：\n<ul>\n<li>当构建开始时触发，可用于执行一些初始化工作，比如清理输出目录。</li>\n</ul>\n</li>\n<li><strong><code>resolveId</code></strong>  ：\n<ul>\n<li>在尝试加载模块前调用，可以用来重定向模块请求到其他路径，或者处理虚拟模块等场景。</li>\n</ul>\n</li>\n<li><strong><code>load</code></strong>  ：\n<ul>\n<li>当 Rollup 需要从文件系统或其他来源加载源码时会调用这个钩子。可以返回自定义内容代替实际文件的内容，适用于注入全局变量、模拟数据等情况。</li>\n</ul>\n</li>\n<li><strong><code>transform</code></strong>  ：\n<ul>\n<li>允许转换已加载的源代码。这是实现代码转译（如 Babel）、添加头部注释等操作的好地方。</li>\n</ul>\n</li>\n<li><strong><code>moduleParsed</code></strong>  ：\n<ul>\n<li>每当一个模块被完全解析之后都会调用这个钩子，这使得可以在生成图表之前对模块进行额外处理。</li>\n</ul>\n</li>\n<li><strong><code>watchChange</code></strong>  ：\n<ul>\n<li>当监听模式下检测到文件变动时触发，可用于决定是否应该重新构建整个项目还是只更新特定部分。</li>\n</ul>\n</li>\n<li><strong><code>closeBundle</code></strong>  ：\n<ul>\n<li>整个构建过程结束时调用。对于清理临时文件或者其他收尾工作很有帮助。</li>\n</ul>\n</li>\n</ol>\n<h3>输出生成钩子（Output Generation Hooks）</h3>\n<p>输出生成钩子在输出生成阶段执行，由 <code>bundle.generate(outputOptions)</code> 或 <code>bundle.write(outputOptions)</code> 触发。它们提供关于生成的包的信息，并在构建完成后立马执行。以下是一些常用的输出生成钩子函数：</p>\n<ol>\n<li><strong><code>outputOptions</code></strong>  ：\n<ul>\n<li>对输出配置进行转换。</li>\n</ul>\n</li>\n<li><strong><code>renderStart</code></strong>  ：\n<ul>\n<li>开始渲染输出时触发，适合于需要根据输出格式做不同处理的情况。</li>\n</ul>\n</li>\n<li><strong><code>generateBundle</code></strong>  ：\n<ul>\n<li>当所有文件和 chunk 已经生成完毕但还未写入磁盘时调用。可以自定义输出内容，比如删除某些 chunk 或 asset。</li>\n</ul>\n</li>\n<li><strong><code>writeBundle</code></strong>  ：\n<ul>\n<li>文件已经写入磁盘后触发。如果需要在构建完成后执行某些任务（例如运行测试），这是一个很好的时机。</li>\n</ul>\n</li>\n<li><strong><code>renderError</code></strong>  ：\n<ul>\n<li>如果在输出生成期间的任何时候发生错误，则调用此钩子。</li>\n</ul>\n</li>\n</ol>\n<h3>钩子函数执行方式</h3>\n<p>Rollup 提供了几种钩子函数的执行方式，每种方式都又分为同步或异步：</p>\n<ol>\n<li><strong><code>first</code></strong>  ：\n<ul>\n<li>如果多个插件实现了相同的钩子函数，那么会串式执行。如果其中某个的返回值不是 <code>null</code> 也不是 <code>undefined</code>，会直接终止掉后续插件。</li>\n</ul>\n</li>\n<li><strong><code>sequential</code></strong>  ：\n<ul>\n<li>如果多个插件实现了相同的钩子函数，那么会串式执行，按照使用插件的顺序从头到尾执行。如果是异步的，会等待之前处理完毕，再执行下一个插件。</li>\n</ul>\n</li>\n<li><strong><code>parallel</code></strong>  ：\n<ul>\n<li>如果多个插件实现了相同的钩子函数，那么会按照指定的插件顺序运行。如果一个钩子是异步的，其后的插件不会等待，而是并行执行。</li>\n</ul>\n</li>\n</ol>\n<h3>插件开发示例</h3>\n<p>以下是一个简单的 Rollup 插件示例，该插件会在构建过程中打印出所有被处理的文件路径：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myRollupPlugin</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my-rollup-plugin&#x27;</span>,\n    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理文件: <span class="hljs-subst">${id}</span>`</span>);\n      <span class="hljs-keyword">return</span> { code, <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span> };\n    }\n  };\n}\n</code></pre>\n<h3>总结</h3>\n<p>Rollup 插件通过钩子函数与构建过程交互，允许开发者在构建的不同阶段执行自定义操作。构建钩子和输出生成钩子分别关注于构建阶段和输出生成阶段的任务。通过合理使用这些钩子函数，可以开发出功能强大的 Rollup 插件，满足各种构建需求。</p>\n</div>'</script></body></html>