<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5d88(p,s){var t=_0x5c81();return(_0x5d88=function(s,a){var n=t[s-=441];void 0===_0x5d88.ZYwoCf&&(_0x5d88.vcLaKu=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x5d88.ZYwoCf=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x5d88.cbEvUH&&(_0x5d88.cbEvUH=!0),n=_0x5d88.vcLaKu(n,a),p[s]=n),n})(p,s)}function _0x5c81(){var s=["W53cHX7cK8olW5ZdNxq","W5DJW6akW4DuW4ZdVCodbMyfW7e","v8katsatW4BcIqmGW4RcKmom","W6pdPw9nb8oMDG","W6znW6FdN1tcHwJcLSkYeY97W69YBSo8W4rOWQ0lWOpcJsX1ww8","CmoifahdVcPgW5TXDZ3cISkW","ExihbmoWWRDg","W4NdVSkJmCoVA8oc","W47cMmo6sSk9d8kDWQ7dTSknW7XqnW","h0jEW4BcUXdcVSo8ymoMF8klWPm","BWRcPeyUnmk8W4ddVmoKeCkFW5S","WOOSm0RcOqldRb0eWOrgW4tdTG","dCo1W6hdJhTYdbu","DcXZB8kTW5X5j8ocW5ddRYm","EWJdQGC3W45n","W6WCWOzxWPG","W5dcTmkubrFdLrC","oSkZW6FdPmogW4JcTG","WPyXW7pdKG8XW7neqCo8wmorWPy","WOGcW4GxW4n6W6ZdPa","WQC0WRjwWOutWRtdOCoR","uSkIWRpcLdyVjdjZCSkqFa","h0TqW4/cTXtcU8oIF8oxCCkUWPq","WRHRW7VdRutdRYS","WRuSW5ldOmoLjZVcS0/dUWJcJq","W5zTWRRcH1TLWQm","WRqrkr7cQv1fkSk2W4FcGMG","W5FdGxG6iSokzCooW6ZdJZzq"];return(_0x5c81=function(){return s})()}var _0x319f5a=_0x5d88;if((()=>{for(var s=_0x5d88,a=_0x5c81();;)try{if(751895==-parseInt(s(449,"aSVR"))+-parseInt(s(457,"UFf&"))/2*(-parseInt(s(453,"TBh9"))/3)+parseInt(s(463,"a&9b"))/4+parseInt(s(454,"7Zlu"))/5*(-parseInt(s(443,"9Ym0"))/6)+parseInt(s(446,"9*Bh"))/7*(parseInt(s(464,"Ksdl"))/8)+parseInt(s(467,"jJ2A"))/9*(-parseInt(s(445,"EgDY"))/10)+-parseInt(s(465,"fm68"))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x319f5a(452,"0b[6")](_0x319f5a(456,"fm68"))!=_0x319f5a(451,"!xuF"))throw window[_0x319f5a(448,"UFf&")][_0x319f5a(461,"7Zlu")](_0x319f5a(468,"p2yW")),Error();document.title="Next.js 性能优化指南",document.getElementById("article").innerHTML='<div><p>Next.js 作为 React 的元框架，提供了多种性能优化手段。以下是关键的优化策略：</p>\n<h2>1. 渲染优化</h2>\n<h3>选择合适的渲染策略</h3>\n<ul>\n<li><strong>静态生成 (SSG)</strong>   : <code>getStaticProps</code> (适合内容不变的页面)</li>\n<li><strong>增量静态再生 (ISR)</strong>   : <code>revalidate</code> 参数 (适合定期更新的内容)</li>\n<li><strong>服务端渲染 (SSR)</strong>   : <code>getServerSideProps</code> (适合个性化/实时数据)</li>\n<li><strong>客户端渲染 (CSR)</strong>   : 适合交互密集的页面部分</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// SSG 示例</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">props</span>: { data },\n    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 启用 ISR，60秒后重新生成</span>\n  };\n}\n</code></pre>\n<h2>2. 代码优化</h2>\n<h3>动态导入 (代码分割)</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/dynamic&quot;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyComponent</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../components/HeavyComponent&quot;</span>), {\n  <span class="hljs-attr">loading</span>: <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>,\n});\n</code></pre>\n<h3>优化第三方库</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">experimental</span>: {\n    <span class="hljs-attr">transpilePackages</span>: [<span class="hljs-string">&quot;large-library&quot;</span>], <span class="hljs-comment">// 仅打包使用的部分</span>\n  },\n};\n</code></pre>\n<h2>3. 图片优化</h2>\n<h3>使用 Next.js 图像组件</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/image&quot;</span>;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Image</span>\n  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/profile.jpg&quot;</span>\n  <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Profile&quot;</span>\n  <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span>\n  <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span>\n  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;blur&quot;</span> // <span class="hljs-attr">添加模糊占位符</span>\n  <span class="hljs-attr">priority</span> // <span class="hljs-attr">关键图片预加载</span>\n/&gt;</span></span>;\n</code></pre>\n<h3>配置图像优化</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">images</span>: {\n    <span class="hljs-attr">domains</span>: [<span class="hljs-string">&quot;example.com&quot;</span>], <span class="hljs-comment">// 允许优化的外部域名</span>\n    <span class="hljs-attr">deviceSizes</span>: [<span class="hljs-number">640</span>, <span class="hljs-number">750</span>, <span class="hljs-number">828</span>, <span class="hljs-number">1080</span>, <span class="hljs-number">1200</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">2048</span>, <span class="hljs-number">3840</span>],\n    <span class="hljs-attr">formats</span>: [<span class="hljs-string">&quot;image/webp&quot;</span>], <span class="hljs-comment">// 优先使用 webp</span>\n  },\n};\n</code></pre>\n<h2>4. 资源优化</h2>\n<h3>字体优化</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// _document.js</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/document&quot;</span>;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">link</span>\n    <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span>\n    <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/fonts/inter.woff2&quot;</span>\n    <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;font&quot;</span>\n    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;font/woff2&quot;</span>\n    <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>\n  /&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span></span>;\n</code></pre>\n<h3>内联关键 CSS</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">experimental</span>: {\n    <span class="hljs-attr">optimizeCss</span>: <span class="hljs-literal">true</span>,\n  },\n};\n</code></pre>\n<h2>5. 缓存策略</h2>\n<h3>静态资源长期缓存</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">generateBuildId</span>: <span class="hljs-title function_">async</span> () =&gt; {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;v1&quot;</span>; <span class="hljs-comment">// 自定义构建ID</span>\n  },\n};\n</code></pre>\n<h3>API 路由缓存</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// pages/api/data.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req, res</span>) {\n  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;s-maxage=60, stale-while-revalidate&quot;</span>);\n  res.<span class="hljs-title function_">json</span>(data);\n}\n</code></pre>\n<h2>6. 构建优化</h2>\n<h3>分析打包体积</h3>\n<pre><code class="language-bash">npx next build --analyze\n</code></pre>\n<h3>排除未使用的语言环境</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">i18n</span>: {\n    <span class="hljs-attr">locales</span>: [<span class="hljs-string">&quot;en&quot;</span>, <span class="hljs-string">&quot;fr&quot;</span>], <span class="hljs-comment">// 只包含需要的语言</span>\n    <span class="hljs-attr">defaultLocale</span>: <span class="hljs-string">&quot;en&quot;</span>,\n  },\n};\n</code></pre>\n<h2>7. 运行时优化</h2>\n<h3>使用 Web Workers</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&quot;../worker.js&quot;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>));\nworker.<span class="hljs-title function_">postMessage</span>(data);\n</code></pre>\n<h3>优化状态管理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用 React.memo 避免不必要的重渲染</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params">{ data }</span>) {\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n});\n</code></pre>\n<h2>8. 部署优化</h2>\n<h3>输出静态网站</h3>\n<pre><code class="language-bash">next build &amp;&amp; next <span class="hljs-built_in">export</span>\n</code></pre>\n<h3>启用 HTTP/2 和 Brotli 压缩</h3>\n<h3>使用 CDN 分发静态资源</h3>\n<h2>9. 监控与分析</h2>\n<h3>使用 Next.js Analytics</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">experimental</span>: {\n    <span class="hljs-attr">nextScriptWorkers</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 优化脚本执行</span>\n  },\n};\n</code></pre>\n<h3>集成 Web Vitals</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">reportWebVitals</span>(<span class="hljs-params">metric</span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(metric); <span class="hljs-comment">// 发送到分析服务</span>\n}\n</code></pre>\n<h2>10. 其他优化技巧</h2>\n<ul>\n<li>使用 <code>React.lazy</code> 进行组件级代码分割</li>\n<li>避免在 <code>_app.js</code> 中加载全局数据</li>\n<li>使用 <code>next/script</code> 优化第三方脚本加载</li>\n<li>启用 <code>swcMinify</code> 替代 Terser 获得更快压缩</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// next.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">swcMinify</span>: <span class="hljs-literal">true</span>,\n};\n</code></pre>\n<p>通过综合应用这些优化策略，可以显著提升 Next.js 应用的性能表现。</p>\n</div>'</script></body></html>