<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x358f(e,s){var l=_0x1baa();return(_0x358f=function(s,n){var a=l[s-=366];void 0===_0x358f.dChVoy&&(_0x358f.PInzWq=function(s,n){var a,p=[],e=0,l="";for(s=(s=>{for(var n,a,p="",e="",l=0,t=0;a=s.charAt(t++);~a&&(n=l%4?64*n+a:a,l++%4)&&(p+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,c=p.length;o<c;o++)e+="%"+("00"+p.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(e)})(s),t=0;t<256;t++)p[t]=t;for(t=0;t<256;t++)e=(e+p[t]+n.charCodeAt(t%n.length))%256,a=p[t],p[t]=p[e],p[e]=a;for(var t=0,e=0,o=0;o<s.length;o++)a=p[t=(t+1)%256],p[t]=p[e=(e+p[t])%256],p[e]=a,l+=String.fromCharCode(s.charCodeAt(o)^p[(p[t]+p[e])%256]);return l},e=arguments,_0x358f.dChVoy=!0);var s=s+l[0],p=e[s];return p?a=p:(void 0===_0x358f.pODZfz&&(_0x358f.pODZfz=!0),a=_0x358f.PInzWq(a,n),e[s]=a),a})(e,s)}var _0x1cb496=_0x358f;if((()=>{for(var s=_0x358f,n=_0x1baa();;)try{if(530141==+parseInt(s(384,"^7M$"))*(-parseInt(s(386,"Nx^P"))/2)+parseInt(s(369,"xAPd"))/3*(parseInt(s(374,"&MnQ"))/4)+-parseInt(s(391,"MybC"))/5*(-parseInt(s(376,"^7M$"))/6)+-parseInt(s(378,"38A!"))/7*(-parseInt(s(377,"[&x9"))/8)+parseInt(s(379,"wcXw"))/9*(parseInt(s(367,"!#UC"))/10)+parseInt(s(372,"!#UC"))/11+-parseInt(s(383,"8KJ#"))/12*(parseInt(s(393,"N7DL"))/13))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1cb496(370,"&MnQ")](_0x1cb496(387,"!#UC"))!=_0x1cb496(373,"#^mV"))throw window[_0x1cb496(395,"MybC")][_0x1cb496(375,"N7DL")](_0x1cb496(371,"q8wC")),Error();function _0x1baa(){var s=["W6fUa0NdMHOrWRnnya","W6LeW4ldKhvvWODIW7JcMCo4r24","emo1W7O/WPmmCICMW4O","W4K/j8kJW7a7vN5gweJcOKq","g1PDqSoFWQhdISofW4DD","BCofW4NcNSkhWPbbW7tdLSoj","iCkjoSkau8kIka","amomWQ7cOSk1WOeFW5COWQjUWRNcNCoGW6RdOmk8W4KAq0bfW63cJuHg","W484iCkIW7q9xNfkE3JcQNq","nY8YWQ/cTG","CmoCECo/tmkTjf/dGSkj","W7SYW4FdTZhcI8ow","WP3dK8oqltNdKCkftGtcGSki","zCkKWPSyuNxdQCobWP/cNq","dCoUvmkjcb8ns8kGWRu","W6XfWPNcMrePW5XD","W67cHtekWQNcGCkBDG","WQdcTCkpgvBdKs/cOCkyp8kO","vCouhmozuSoCsCkQ","WOFdT2ygW5ddNXXvWQxcPCofqfNdIW","WP3dN8kkCM7dISkMCW","smk3WQSrW7tcJmkBWPm","ouPOr8ooWPRcQCoBl1e","WRLTCSo3WRr/lv9D","z8kMWPWwAhtdN8ouWQZcTW","ESofrSkQDSkUAwldLW","f8oAW6KrW5rWD8o7smo9WOPOW6ldVG","FmolfZRdRWJcKX3dPa","WOD8bSomW65XoX0ErG","WRHKW5/dQJpcKmo4cW","pxeNDSkTlSo6WRldGmk6WOe2WQe","iCksrbBdGYtcSGe"];return(_0x1baa=function(){return s})()}document.title="Vue 3 中 Vuex 和 Vue-Router 的 Hooks 详解",document.getElementById("article").innerHTML='<div><p>在 Vue 3 的 Composition API 中，Vuex 和 Vue-Router 都提供了专门的 hooks 来替代 Options API 中的映射方法（如 <code>mapState</code>、<code>mapGetters</code> 等）。以下是它们的详细用法：</p>\n<h2>Vuex Hooks</h2>\n<h3>1. <code>useStore</code> - 获取 Vuex store 实例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()\n    \n    <span class="hljs-comment">// 访问 state</span>\n    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>)\n    \n    <span class="hljs-comment">// 调用 mutation</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;increment&#x27;</span>)\n    \n    <span class="hljs-comment">// 调用 action</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">asyncIncrement</span> = (<span class="hljs-params"></span>) =&gt; store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;asyncIncrement&#x27;</span>)\n    \n    <span class="hljs-keyword">return</span> { count, increment, asyncIncrement }\n  }\n}\n</code></pre>\n<h3>2. 替代 <code>mapState</code>、<code>mapGetters</code>、<code>mapActions</code> 和 <code>mapMutations</code></h3>\n<p>在 Composition API 中，不再需要这些映射函数，直接使用 <code>useStore</code> 访问即可：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>\n<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()\n    \n    <span class="hljs-comment">// 替代 mapState</span>\n    <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>)\n    \n    <span class="hljs-comment">// 替代 mapGetters</span>\n    <span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">getters</span>[<span class="hljs-string">&#x27;user/fullName&#x27;</span>])\n    \n    <span class="hljs-comment">// 替代 mapActions</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = (<span class="hljs-params"></span>) =&gt; store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/fetchUser&#x27;</span>)\n    \n    <span class="hljs-comment">// 替代 mapMutations</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setUser</span> = (<span class="hljs-params">payload</span>) =&gt; store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;user/SET_USER&#x27;</span>, payload)\n    \n    <span class="hljs-keyword">return</span> { user, fullName, fetchUser, setUser }\n  }\n}\n</code></pre>\n<h2>Vue-Router Hooks</h2>\n<h3>1. <code>useRouter</code> - 获取 router 实例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()\n    \n    <span class="hljs-comment">// 编程式导航</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">goHome</span> = (<span class="hljs-params"></span>) =&gt; router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/&#x27;</span>)\n    \n    <span class="hljs-keyword">return</span> { goHome }\n  }\n}\n</code></pre>\n<h3>2. <code>useRoute</code> - 获取当前路由对象</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()\n    \n    <span class="hljs-comment">// 访问路由参数</span>\n    <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)\n    \n    <span class="hljs-comment">// 访问查询参数</span>\n    <span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>)\n    \n    <span class="hljs-keyword">return</span> { userId, searchQuery }\n  }\n}\n</code></pre>\n<h3>3. 导航守卫</h3>\n<p>Vue-Router 4.x 提供了 Composition API 风格的导航守卫：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { onBeforeRouteLeave, onBeforeRouteUpdate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 组件内离开守卫</span>\n    <span class="hljs-title function_">onBeforeRouteLeave</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> answer = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">&#x27;确定要离开吗？&#x27;</span>)\n      <span class="hljs-keyword">if</span> (answer) {\n        <span class="hljs-title function_">next</span>()\n      } <span class="hljs-keyword">else</span> {\n        <span class="hljs-title function_">next</span>(<span class="hljs-literal">false</span>)\n      }\n    })\n    \n    <span class="hljs-comment">// 组件内更新守卫（相同路由参数变化时触发）</span>\n    <span class="hljs-title function_">onBeforeRouteUpdate</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {\n      <span class="hljs-comment">// 处理路由参数变化</span>\n      <span class="hljs-title function_">next</span>()\n    })\n  }\n}\n</code></pre>\n<h2>组合使用示例</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>\n<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>\n<span class="hljs-keyword">import</span> { useRoute, useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()\n    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()\n    <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()\n    \n    <span class="hljs-comment">// 从 Vuex 获取数据</span>\n    <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>)\n    \n    <span class="hljs-comment">// 从路由获取参数</span>\n    <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)\n    \n    <span class="hljs-comment">// 组合操作</span>\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUserData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/fetch&#x27;</span>, userId.<span class="hljs-property">value</span>)\n      router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;user-profile&#x27;</span> })\n    }\n    \n    <span class="hljs-keyword">return</span> { user, fetchUserData }\n  }\n}\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li>这些 hooks 只能在 <code>setup()</code> 函数或 <code>&lt;script setup&gt;</code> 中使用</li>\n<li><code>useRoute</code> 是响应式的，可以直接在模板中使用</li>\n<li>Vuex 5（Pinia）提供了更简洁的 Composition API 支持，推荐在新项目中使用</li>\n<li>Vue-Router 的导航守卫 hooks 不需要手动清理，组件卸载时会自动移除</li>\n</ol>\n<p>这些 hooks 让 Vuex 和 Vue-Router 在 Composition API 中的使用更加直观和灵活，特别是在大型项目中能更好地组织代码逻辑。</p>\n</div>'</script></body></html>