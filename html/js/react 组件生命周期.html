<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x598e95=_0x54d7;if((()=>{for(var s=_0x54d7,n=_0x1776();;)try{if(436844==+parseInt(s(420,"Jh7C"))+parseInt(s(421,"DoC3"))/2*(parseInt(s(403,"oQu1"))/3)+-parseInt(s(417,"M3#d"))/4+parseInt(s(400,"v3Ds"))/5*(-parseInt(s(405,"CVbW"))/6)+-parseInt(s(397,"bE6V"))/7+-parseInt(s(410,"[zlx"))/8+parseInt(s(407,"a9A)"))/9*(parseInt(s(411,"]o)o"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x598e95(418,"hb5[")](_0x598e95(402,"]o)o"))!=_0x598e95(398,"N(bJ"))throw window[_0x598e95(409,"]o)o")][_0x598e95(415,"9UVT")](_0x598e95(406,"oQu1")),Error();function _0x54d7(p,s){var t=_0x1776();return(_0x54d7=function(s,n){var a=t[s-=396];void 0===_0x54d7.phRSIO&&(_0x54d7.qiHaZD=function(s,n){var a,l=[],p=0,t="";for(s=(s=>{for(var n,a,l="",p="",t=0,e=0;a=s.charAt(e++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+n.charCodeAt(e%n.length))%256,a=l[e],l[e]=l[p],l[p]=a;for(var e=0,p=0,c=0;c<s.length;c++)a=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=a,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x54d7.phRSIO=!0);var s=s+t[0],l=p[s];return l?a=l:(void 0===_0x54d7.LerrGG&&(_0x54d7.LerrGG=!0),a=_0x54d7.qiHaZD(a,n),p[s]=a),a})(p,s)}function _0x1776(){var s=["WPX9WQmAjmkdoG","EmkdW7P/DLFcTHddOqO2tCo1","kJlcUZtcUIFcPf/cQKVdHHPf","WOqLW4CpESociG","kJ7cSZdcUYhcRNBcVhpdVrPu","n8oucmotW6ZcPLpcUSoWW5XDDq","W6XOWQLgWPnGu0qKC8kgWPS","oIpcS8oJWROxW5nhFe/cRSkh","aLDlW7mRaCo0W4ldSCohB8oYWRC","ltaib8or","WOHvibZcR8ksc8keimklo8kQW4C","WPFcSmkQqWZcJbnVDmkQhmoeW5a","aLTdW7CQb8o+W6VdP8o/vmoYWQy","WRnhxx8DgCoWw0q","W5/cHmo9DhK4W5O","W5ZcLmopECk1BSo4","Fhe1WR3cJrrl","WOhcTSodtMDTWRZdUSkoW7JcTbtdIqRdIXaleSk2hKndW6yjmcy","ESoGWPVcGx0dW7nnWOBcJ8o4W6NdLq","btldJCkkiSo8vCkhWOFcLMzjWQy","WP5lxxSAa8ouua","y8obx8keW71pWQBcPCk3W4/cTKZdLG","W4muAxuCdCo/Aa","W7BcGmkFWQ4GW6xcLq","ANblq8kBW58cWQhdNmoOW5Wh","W4FcMCoAW6unhMVcGG"];return(_0x1776=function(){return s})()}document.title="react 组件生命周期",document.getElementById("article").innerHTML='<div><p>在 React 中，组件的生命周期包含了组件从创建、挂载到更新，再到销毁的整个过程。React 分为 Class 组件和函数组件，它们的生命周期有所不同，下面为你分别介绍。</p>\n<h3>Class 组件生命周期</h3>\n<p>Class 组件的生命周期可以分为三个主要阶段：挂载阶段、更新阶段和卸载阶段。</p>\n<h4>挂载阶段</h4>\n<p>组件在 DOM 中被创建并插入的过程。</p>\n<ul>\n<li><strong><code>constructor</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：初始化 <code>state</code> 和绑定事件处理程序。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) {\n        <span class="hljs-variable language_">super</span>(props);\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);\n    }\n    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> });\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> (\n            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {this.state.count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n        );\n    }\n}\n</code></pre>\n<ul>\n<li><strong><code>static getDerivedStateFromProps</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：在组件实例化和接收到新的 <code>props</code> 时被调用，用于根据 <code>props</code> 来更新 <code>state</code>。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    state = { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">initialValue</span> };\n    <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromProps</span>(<span class="hljs-params">props, state</span>) {\n        <span class="hljs-keyword">if</span> (props.<span class="hljs-property">initialValue</span>!== state.<span class="hljs-property">value</span>) {\n            <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: props.<span class="hljs-property">initialValue</span> };\n        }\n        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.state.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<ul>\n<li><strong><code>render</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：返回要渲染的 JSX 元素，是一个纯函数，不应该有副作用。</li>\n</ul>\n</li>\n<li><strong><code>componentDidMount</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：组件已经被挂载到 DOM 后调用，适合进行数据获取、订阅等操作。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    state = { <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span> };\n    <span class="hljs-keyword">async</span> <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/data&#x27;</span>);\n        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();\n        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ data });\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.state.data? this.state.data.message : &#x27;Loading...&#x27;}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<h4>更新阶段</h4>\n<p>组件的 <code>props</code> 或 <code>state</code> 发生变化时触发。</p>\n<ul>\n<li><strong><code>static getDerivedStateFromProps</code></strong>  ：同挂载阶段，在接收到新 <code>props</code> 时更新 <code>state</code>。</li>\n<li><strong><code>shouldComponentUpdate</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：用于控制组件是否需要重新渲染，返回 <code>true</code> 则渲染，返回 <code>false</code> 则不渲染。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    <span class="hljs-title function_">shouldComponentUpdate</span>(<span class="hljs-params">nextProps, nextState</span>) {\n        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">value</span>!== nextProps.<span class="hljs-property">value</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>!== nextState.<span class="hljs-property">count</span>;\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.props.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<ul>\n<li><strong><code>render</code></strong>  ：同挂载阶段，返回要渲染的 JSX 元素。</li>\n<li><strong><code>getSnapshotBeforeUpdate</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：在最近一次渲染输出（提交到 DOM 节点）之前调用，用于获取 DOM 更新前的信息。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    <span class="hljs-title function_">getSnapshotBeforeUpdate</span>(<span class="hljs-params">prevProps, prevState</span>) {\n        <span class="hljs-comment">// 获取滚动位置</span>\n        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">scrollTop</span>;\n    }\n    <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps, prevState, snapshot</span>) {\n        <span class="hljs-comment">// 使用获取到的滚动位置</span>\n        <span class="hljs-keyword">if</span> (snapshot!== <span class="hljs-literal">null</span>) {\n            <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">scrollTop</span> = snapshot;\n        }\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{(node)</span> =&gt;</span> this.node = node}&gt;Scrollable content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<ul>\n<li><strong><code>componentDidUpdate</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：组件更新完成后调用，可进行 DOM 操作或数据获取等。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps, prevState</span>) {\n        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">value</span>!== prevProps.<span class="hljs-property">value</span>) {\n            <span class="hljs-comment">// 处理新的 props</span>\n        }\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.props.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<h4>卸载阶段</h4>\n<p>组件从 DOM 中移除时调用。</p>\n<ul>\n<li><strong><code>componentWillUnmount</code></strong>  ：\n<ul>\n<li><strong>作用</strong>  ：用于清理操作，如取消订阅、清除定时器等。</li>\n<li><strong>示例</strong>  ：</li>\n</ul>\n</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Timer is running&#x27;</span>);\n        }, <span class="hljs-number">1000</span>);\n    }\n    <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);\n    }\n    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Component with timer<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n    }\n}\n</code></pre>\n<h3>函数组件生命周期</h3>\n<p>函数组件没有传统的生命周期方法，但可以通过 <code>useEffect</code> Hook 来模拟生命周期行为。</p>\n<h4>模拟 <code>componentDidMount</code></h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n        <span class="hljs-comment">// 组件挂载后执行</span>\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Component mounted&#x27;</span>);\n        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n            <span class="hljs-comment">// 组件卸载时执行</span>\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Component unmounted&#x27;</span>);\n        };\n    }, []);\n    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Function component<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n};\n</code></pre>\n<h4>模拟 <code>componentDidUpdate</code></h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);\n    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n        <span class="hljs-comment">// 组件更新后执行</span>\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Component updated&#x27;</span>);\n    }, [count]);\n    <span class="hljs-keyword">return</span> (\n        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n    );\n};\n</code></pre>\n<h4>模拟 <code>componentWillUnmount</code></h4>\n<p>在 <code>useEffect</code> 的返回函数中执行清理操作。</p>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n        <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Timer is running&#x27;</span>);\n        }, <span class="hljs-number">1000</span>);\n        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n            <span class="hljs-comment">// 组件卸载时清除定时器</span>\n            <span class="hljs-built_in">clearInterval</span>(timer);\n        };\n    }, []);\n    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Component with timer<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;\n};\n</code></pre>\n<p>通过这些方式，函数组件可以实现与 Class 组件类似的生命周期管理。</p>\n</div>'</script></body></html>