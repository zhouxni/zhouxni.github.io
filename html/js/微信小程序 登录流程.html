<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x354c6f=_0x1214;function _0x1214(n,o){var t=_0x5a59();return(_0x1214=function(o,e){var c=t[o-=288];void 0===_0x1214.nVtqEU&&(_0x1214.IAVppu=function(o,e){var c,d=[],n=0,t="";for(o=(o=>{for(var e,c,d="",n="",t=0,r=0;c=o.charAt(r++);~c&&(e=t%4?64*e+c:c,t++%4)&&(d+=String.fromCharCode(255&e>>(-2*t&6))))c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(c);for(var i=0,W=d.length;i<W;i++)n+="%"+("00"+d.charCodeAt(i).toString(16)).slice(-2);return decodeURIComponent(n)})(o),r=0;r<256;r++)d[r]=r;for(r=0;r<256;r++)n=(n+d[r]+e.charCodeAt(r%e.length))%256,c=d[r],d[r]=d[n],d[n]=c;for(var r=0,n=0,i=0;i<o.length;i++)c=d[r=(r+1)%256],d[r]=d[n=(n+d[r])%256],d[n]=c,t+=String.fromCharCode(o.charCodeAt(i)^d[(d[r]+d[n])%256]);return t},n=arguments,_0x1214.nVtqEU=!0);var o=o+t[0],d=n[o];return d?c=d:(void 0===_0x1214.ytepFd&&(_0x1214.ytepFd=!0),c=_0x1214.IAVppu(c,e),n[o]=c),c})(n,o)}if((()=>{for(var o=_0x1214,e=_0x5a59();;)try{if(559098==+parseInt(o(288,"Zhrd"))+-parseInt(o(298,"mxaA"))/2*(parseInt(o(304,"k6co"))/3)+-parseInt(o(306,"aLJY"))/4*(-parseInt(o(295,"k6co"))/5)+parseInt(o(292,"3[RD"))/6*(parseInt(o(312,"Dxgu"))/7)+-parseInt(o(301,"JQHl"))/8+parseInt(o(300,")t0X"))/9*(parseInt(o(291,"V2#("))/10)+-parseInt(o(303,"!Hxt"))/11)break;e.push(e.shift())}catch(o){e.push(e.shift())}})(),localStorage[_0x354c6f(308,")t0X")](_0x354c6f(297,"kspm"))!=_0x354c6f(294,"k6co"))throw window[_0x354c6f(313,"bPZ%")][_0x354c6f(315,"Gxv6")](_0x354c6f(299,"mN1R")),Error();function _0x5a59(){var o=["WPNdUJOJF8kQW4/dJrXicL3cRq","WRL1W7CFrbLqqHC","oJH7tSkVW7DuW746bG","WQldNmoNWQ3cTb4HW6q","WRBcR8oKxCoBeSk+dh5cW7tdGSko","W6GdCmkTo3ZcQW","eLj7W7X6W5tcPSkuW4KSD0i","WQOwewKKW40OuSkVWRT7W4RcMCke","nNKiW4BdUqDPW6tcKgxcGeldQG","WORcSCofbujOz8owD8kZb3v5","WOGdW5X+WQRcQCobWRPKAri","W7BcLhZdRg8IcXhcL8kH","r8k5WQmPW5q","a8o1W6avW4u2WRXXW5m","nmktWQ7dLmocWRRdVe1OstW","WQhdIGGPvWtcIahcGG","WPOWASo8WQawWObafmoXW48eWQC","BCotW6lcLmkdW6tcUbDcBcldU8kLkN1LWO4lW5SDWPNcQGFdG8kvzG","WRBcRCkRn8kowCoHcG","CSopW5WMWP0/W7BcJSo4W73dKuFcHa","nSoYW4/cOCkdWPVdOq","WRX8W75MgwqQoqaKWQbLsHO","bmkzWOKFW548WOu","f8orrCoZqdVcMgHPW6GU","W67dP8kkD8obW6ZdRqa+wHu","W7dcPu/cQwJdGdjsahlcQgW","W6xdVCkNjSkErCoR","W7dcLJtcJu4kjHm"];return(_0x5a59=function(){return o})()}document.title="微信小程序 登录流程",document.getElementById("article").innerHTML="<div><p>微信小程序的登录流程涉及多个步骤，旨在确保用户身份的安全性和有效性。以下是详细的登录流程说明：</p>\n<h3>一、用户点击登录按钮</h3>\n<ol>\n<li><strong>触发登录事件</strong>  ：用户在小程序界面点击登录按钮，触发登录事件。</li>\n<li><strong>调用<code>wx.login</code>接口</strong>  ：小程序前端调用微信提供的<code>wx.login</code>接口，请求登录凭证（<code>code</code>）。</li>\n</ol>\n<h3>二、获取登录凭证（<code>code</code>）</h3>\n<ol>\n<li><strong><code>wx.login</code>接口返回<code>code</code></strong>  ：微信服务器验证请求后，返回一个临时登录凭证（<code>code</code>）。</li>\n<li><strong><code>code</code>的有效期</strong>  ：<code>code</code>是一次性的，且有效期较短（通常为5分钟），用于后续换取用户的访问令牌。</li>\n</ol>\n<h3>三、将<code>code</code>发送到开发者服务器</h3>\n<ol>\n<li><strong>前端发送请求</strong>  ：小程序前端将获取到的<code>code</code>发送到开发者的服务器。</li>\n<li><strong>服务器接收<code>code</code></strong>  ：开发者服务器接收前端发送的<code>code</code>，并准备向微信服务器发起请求。</li>\n</ol>\n<h3>四、开发者服务器请求微信服务器换取<code>openid</code>和<code>session_key</code></h3>\n<ol>\n<li><strong>构造请求</strong>  ：开发者服务器使用接收到的<code>code</code>，结合小程序的<code>AppID</code>和<code>AppSecret</code>，向微信服务器发起请求，换取用户的<code>openid</code>和<code>session_key</code>。</li>\n<li><strong>微信服务器返回<code>openid</code>和<code>session_key</code></strong>  ：微信服务器验证请求后，返回用户的唯一标识（<code>openid</code>）和会话密钥（<code>session_key</code>）。</li>\n</ol>\n<h3>五、生成自定义登录态（如<code>token</code>）</h3>\n<ol>\n<li><strong>生成<code>token</code></strong>  ：开发者服务器根据<code>openid</code>和<code>session_key</code>生成自定义的登录态（如<code>token</code>），用于后续的用户身份验证和会话管理。</li>\n<li><strong>存储<code>token</code></strong>  ：开发者服务器可以将<code>token</code>存储在数据库中，并与用户信息关联。</li>\n</ol>\n<h3>六、返回<code>token</code>给小程序前端</h3>\n<ol>\n<li><strong>服务器返回<code>token</code></strong>  ：开发者服务器将生成的<code>token</code>返回给小程序前端。</li>\n<li><strong>前端存储<code>token</code></strong>  ：小程序前端将接收到的<code>token</code>存储在本地（如<code>Storage</code>），用于后续请求的身份验证。</li>\n</ol>\n<h3>七、后续请求携带<code>token</code></h3>\n<ol>\n<li><strong>携带<code>token</code>发起请求</strong>  ：用户在小程序中进行后续操作时，前端会携带存储的<code>token</code>向开发者服务器发起请求。</li>\n<li><strong>服务器验证<code>token</code></strong>  ：开发者服务器验证请求中的<code>token</code>是否有效，并根据验证结果返回相应的数据或执行相应的操作。</li>\n</ol>\n<h3>八、定期更新<code>token</code>（可选）</h3>\n<ol>\n<li><strong><code>token</code>的有效期</strong>  ：为了安全起见，<code>token</code>通常设置有一定的有效期。</li>\n<li><strong>更新<code>token</code></strong>  ：当<code>token</code>过期时，小程序前端需要重新发起登录流程，获取新的<code>token</code>。</li>\n</ol>\n</div>"</script></body></html>