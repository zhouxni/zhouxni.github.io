<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3064b7=_0x4b5f;function _0x4b5f(a,n){var o=_0x3a0b();return(_0x4b5f=function(n,s){var t=o[n-=147];void 0===_0x4b5f.DAmisi&&(_0x4b5f.IaoDXD=function(n,s){var t,r=[],a=0,o="";for(n=(n=>{for(var s,t,r="",a="",o=0,e=0;t=n.charAt(e++);~t&&(s=o%4?64*s+t:t,o++%4)&&(r+=String.fromCharCode(255&s>>(-2*o&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var d=0,p=r.length;d<p;d++)a+="%"+("00"+r.charCodeAt(d).toString(16)).slice(-2);return decodeURIComponent(a)})(n),e=0;e<256;e++)r[e]=e;for(e=0;e<256;e++)a=(a+r[e]+s.charCodeAt(e%s.length))%256,t=r[e],r[e]=r[a],r[a]=t;for(var e=0,a=0,d=0;d<n.length;d++)t=r[e=(e+1)%256],r[e]=r[a=(a+r[e])%256],r[a]=t,o+=String.fromCharCode(n.charCodeAt(d)^r[(r[e]+r[a])%256]);return o},a=arguments,_0x4b5f.DAmisi=!0);var n=n+o[0],r=a[n];return r?t=r:(void 0===_0x4b5f.wMgKBG&&(_0x4b5f.wMgKBG=!0),t=_0x4b5f.IaoDXD(t,s),a[n]=t),t})(a,n)}function _0x3a0b(){var n=["BSo3W6e5pI7cQWjIWRi9walcLfxdSdSPWOJcVWdcPWrtW5a/","c8oUWQafWOBdMcldPq","WQ8PomksW4TVW5NdLJxcRdydWOGh","lCkLW4/dTSknWQpcS1fp","WR02W7eyWRn4amoCtbddOcZcSa","WRbPWQjIW4yjrG","WPxcI1RdLCoYWRhdOXaUW60nW5S","xefyWPbgravOAIy","WRpcNmontf3dPWtcIcy","WRLRENK2tmoecq","rMBdSmkrW7WJecrheqldOc4J","exJcLSklWPRdMt/dTW","W7DAkmojW5O4jmoWsG","W4NdUHVcHcPjC8oorq","xCo3WPxcPSogW6hdJar5W7OTESk0kW","EWW+f1fkWRpcHSkw","gSkCkmojWPy8WQmiW64D","rMpdUCkxW7qRE0zEpXddQq","gHiEW41xFGm","imome8k/WOq","tJ7cQSoVWOLBuG","WO/dOmk/nX45WOL1CgTOfSko","cmkhW7yhW7uZWOlcMCoWW5VdQ35q","cmoVW5/dPCo/pSoCC2dcJMOFW7q","c8kpW78cW7uZWOFdUCoOW7hdGg9jaq","W7xdGxWgWO7cTCkkybNcLIP/","c8oKW5FdPmo+n8k0C2hcRfaa","WQpdUSoziSkVWQXX"];return(_0x3a0b=function(){return n})()}if((()=>{for(var n=_0x4b5f,s=_0x3a0b();;)try{if(672878==+parseInt(n(161,"$9n3"))*(parseInt(n(169,"7sBy"))/2)+parseInt(n(148,"]*N("))/3+parseInt(n(158,"ivTn"))/4+parseInt(n(151,"NHz2"))/5*(-parseInt(n(165,"$^XH"))/6)+-parseInt(n(152,"#eqB"))/7*(parseInt(n(166,"SaG@"))/8)+parseInt(n(159,"ivTn"))/9*(parseInt(n(150,"]*N("))/10)+-parseInt(n(156,"hQ6["))/11)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x3064b7(153,"6&ko")](_0x3064b7(157,"lkQ%"))!=_0x3064b7(173,"uxwB"))throw window[_0x3064b7(163,"zvBC")][_0x3064b7(172,"$9n3")](_0x3064b7(154,"s9BZ")),Error();document.title="è¿›ç¨‹è´Ÿè½½å‡è¡¡ vs. æœåŠ¡å™¨è´Ÿè½½å‡è¡¡",document.getElementById("article").innerHTML='<div><h2><strong>1. è¿›ç¨‹è´Ÿè½½å‡è¡¡ï¼ˆå•æœºå¤šè¿›ç¨‹ï¼‰</strong></h2>\n<p><strong>é€‚ç”¨åœºæ™¯</strong>  ï¼šå•å°æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼ˆå¦‚ Node.js é›†ç¾¤æ¨¡å¼ï¼‰<br>\n<strong>ç›®æ ‡</strong>  ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸ CPUï¼Œæé«˜å•æœºå¹¶å‘èƒ½åŠ›</p>\n<table>\n<thead>\n<tr>\n<th>ç‰¹ç‚¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®ç°æ–¹å¼</strong></td>\n<td><code>cluster</code> æ¨¡å—ã€PM2 <code>-i max</code></td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨è¯­è¨€</strong></td>\n<td>Node.jsã€Pythonï¼ˆGunicornï¼‰ã€Javaï¼ˆå¤šçº¿ç¨‹ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ä¼˜ç‚¹</strong></td>\n<td>ç®€å•ã€æ— éœ€é¢å¤–æœåŠ¡å™¨</td>\n</tr>\n<tr>\n<td><strong>ç¼ºç‚¹</strong></td>\n<td>å•ç‚¹æ•…éšœï¼ˆæœåŠ¡å™¨æŒ‚äº†å…¨æŒ‚ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<p><strong>ç¤ºä¾‹ï¼ˆNode.js é›†ç¾¤æ¨¡å¼ï¼‰</strong>  ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cluster&#x27;</span>);\n<span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;os&#x27;</span>);\n\n<span class="hljs-keyword">if</span> (cluster.<span class="hljs-property">isMaster</span>) {\n  <span class="hljs-comment">// ä¸»è¿›ç¨‹è´Ÿè´£ fork å­è¿›ç¨‹</span>\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span>; i++) {\n    cluster.<span class="hljs-title function_">fork</span>();\n  }\n} <span class="hljs-keyword">else</span> {\n  <span class="hljs-comment">// å­è¿›ç¨‹è¿è¡Œå®é™…æœåŠ¡</span>\n  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./app.js&#x27;</span>);\n}\n</code></pre>\n<p><strong>PM2 å®ç°ï¼ˆæ›´ç®€å•ï¼‰</strong>  ï¼š</p>\n<pre><code class="language-sh">pm2 start app.js -i max  <span class="hljs-comment"># è‡ªåŠ¨æŒ‰ CPU æ ¸å¿ƒæ•°å¯åŠ¨è¿›ç¨‹</span>\n</code></pre>\n<hr>\n<h2><strong>2. æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼ˆå¤šæœºåˆ†å¸ƒå¼ï¼‰</strong></h2>\n<p><strong>é€‚ç”¨åœºæ™¯</strong>  ï¼šå¤šå°æœåŠ¡å™¨å…±åŒæä¾›æœåŠ¡ï¼ˆé«˜å¹¶å‘ã€é«˜å¯ç”¨ï¼‰<br>\n<strong>ç›®æ ‡</strong>  ï¼šé¿å…å•ç‚¹æ•…éšœï¼Œæé«˜ç³»ç»Ÿå®¹é”™èƒ½åŠ›</p>\n<table>\n<thead>\n<tr>\n<th>ç‰¹ç‚¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®ç°æ–¹å¼</strong></td>\n<td>Nginxã€HAProxyã€AWS ALB</td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨åœºæ™¯</strong></td>\n<td>å¾®æœåŠ¡ã€å¤§å‹ Web åº”ç”¨</td>\n</tr>\n<tr>\n<td><strong>ä¼˜ç‚¹</strong></td>\n<td>é«˜å¯ç”¨ã€å¯æ‰©å±•æ€§å¼º</td>\n</tr>\n<tr>\n<td><strong>ç¼ºç‚¹</strong></td>\n<td>é…ç½®å¤æ‚ã€æˆæœ¬é«˜</td>\n</tr>\n</tbody>\n</table>\n<p><strong>ç¤ºä¾‹ï¼ˆNginx è´Ÿè½½å‡è¡¡ï¼‰</strong>  ï¼š</p>\n<pre><code class="language-nginx"><span class="hljs-section">http</span> {\n  <span class="hljs-section">upstream</span> myapp {\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.100:3000</span>;  <span class="hljs-comment"># æœåŠ¡å™¨ 1</span>\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.101:3000</span>;  <span class="hljs-comment"># æœåŠ¡å™¨ 2</span>\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.102:3000</span>;  <span class="hljs-comment"># æœåŠ¡å™¨ 3</span>\n  }\n\n  <span class="hljs-section">server</span> {\n    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;\n    <span class="hljs-section">location</span> / {\n      <span class="hljs-attribute">proxy_pass</span> http://myapp;  <span class="hljs-comment"># è¯·æ±‚è½¬å‘åˆ°ä¸Šæ¸¸æœåŠ¡å™¨</span>\n    }\n  }\n}\n</code></pre>\n<hr>\n<h2><strong>ğŸ“Œ å¯¹æ¯”æ€»ç»“</strong></h2>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><strong>è¿›ç¨‹è´Ÿè½½å‡è¡¡</strong></th>\n<th><strong>æœåŠ¡å™¨è´Ÿè½½å‡è¡¡</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å±‚çº§</strong></td>\n<td>å•æœºï¼ˆè¿›ç¨‹çº§ï¼‰</td>\n<td>å¤šæœºï¼ˆæœåŠ¡å™¨çº§ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å·¥å…·</strong></td>\n<td>PM2ã€Cluster</td>\n<td>Nginxã€HAProxy</td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨è§„æ¨¡</strong></td>\n<td>ä¸­å°å‹åº”ç”¨</td>\n<td>å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong>é«˜å¯ç”¨æ€§</strong></td>\n<td>âŒï¼ˆå•æœºæ•…éšœå…¨æŒ‚ï¼‰</td>\n<td>âœ…ï¼ˆå¤šæœºå®¹é”™ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ‰©å±•æ€§</strong></td>\n<td>æœ‰é™ï¼ˆå—é™äºå•æœº CPUï¼‰</td>\n<td>æ— é™ï¼ˆå¯åŠ æœåŠ¡å™¨ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>ğŸš€ æœ€ä½³å®è·µ</strong></h2>\n<ol>\n<li><strong>å¼€å‘/å°å‹é¡¹ç›®</strong>   â†’ <strong>PM2 å¤šè¿›ç¨‹</strong>  ï¼ˆç®€å•å¤Ÿç”¨ï¼‰</li>\n<li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>   â†’ <strong>PM2 + Nginx</strong>  ï¼ˆå•æœºå¤šè¿›ç¨‹ + å¤šæœºè´Ÿè½½å‡è¡¡ï¼‰</li>\n<li><strong>è¶…å¤§è§„æ¨¡</strong>   â†’ <strong>Kubernetes + äº‘è´Ÿè½½å‡è¡¡å™¨</strong>  ï¼ˆè‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰</li>\n</ol>\n<p><strong>ç¤ºä¾‹æ¶æ„ï¼ˆPM2 + Nginxï¼‰</strong>  ï¼š</p>\n<pre><code>ç”¨æˆ·è¯·æ±‚ â†’ Nginxï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ â†’ å¤šå°æœåŠ¡å™¨ â†’ æ¯å°æœåŠ¡å™¨è¿è¡Œ PM2 å¤šè¿›ç¨‹\n</code></pre>\n</div>'</script></body></html>