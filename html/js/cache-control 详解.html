<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x47ab(){var o=["dwCixmkiv8oDBSkm","dmksBKiKWPKHfCo3BuPl","W6VdN8kEWRXDoCkKWQ3cO8obWORcNG","WOTZW6dcLfTBz8kpuCk7W5DS","bCk0WP3dPaXXvG","v2lcS8k6BHFdStq","ESoFW7tcTConW4BcMSkn","pXhdJSoafriguW","xXRcTcCCBKVcI3fGyem","sCoqW7vhW6dcQSo9WPlcIG","fbCnWPhcK8olfqdcVSkMhCkSWRC","W4SKWQFdGaGmqa","dMv8u8kbBmoctq","aSoyW77cSCo6aSkCvxhcG8k2WRS","W6/dNcRdINCkWRGJa0CxWOC","yCkIWQFcVmkHWP7dJsH3","sCouW7CAWRxdUCojWQ3cRbtdMdW","W6rHWPyaoSoFWQrHWR8","WQ5iWO42DG","W6yeW4L8nXJdTCk6WPtcVmk1na","WRlcNSkat8o/pComFSo1","FSoeW6pcPmokWPxdMSomduxdMrlcOCk9W6GbW6ddImkxWQjKWOBdPSoVoCoe","WQ3cU0NcHdaRaI9b","WRxcP8k9WPZcN8kuoxy","imk2WRVcHWZdK3vGWRbDW68l","jmklWO0OemofWQBdUMZcH8kl","dwanlCoRpCoUASkTc2xdMG","WRFcNCkdoSkEwmkFt8ooWPifW77dMa","oCkgWQvjW77cVmobWQ3cKG","ACkJWQddJ8olWO3dLH1BWQbI"];return(_0x47ab=function(){return o})()}function _0x1a6e(t,o){var a=_0x47ab();return(_0x1a6e=function(o,n){var e=a[o-=377];void 0===_0x1a6e.PWSnIb&&(_0x1a6e.MGNTko=function(o,n){var e,c=[],t=0,a="";for(o=(o=>{for(var n,e,c="",t="",a=0,r=0;e=o.charAt(r++);~e&&(n=a%4?64*n+e:e,a++%4)&&(c+=String.fromCharCode(255&n>>(-2*a&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var l=0,d=c.length;l<d;l++)t+="%"+("00"+c.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(t)})(o),r=0;r<256;r++)c[r]=r;for(r=0;r<256;r++)t=(t+c[r]+n.charCodeAt(r%n.length))%256,e=c[r],c[r]=c[t],c[t]=e;for(var r=0,t=0,l=0;l<o.length;l++)e=c[r=(r+1)%256],c[r]=c[t=(t+c[r])%256],c[t]=e,a+=String.fromCharCode(o.charCodeAt(l)^c[(c[r]+c[t])%256]);return a},t=arguments,_0x1a6e.PWSnIb=!0);var o=o+a[0],c=t[o];return c?e=c:(void 0===_0x1a6e.gUFUYw&&(_0x1a6e.gUFUYw=!0),e=_0x1a6e.MGNTko(e,n),t[o]=e),e})(t,o)}var _0x1cd562=_0x1a6e;if((()=>{for(var o=_0x1a6e,n=_0x47ab();;)try{if(829917==+parseInt(o(396,"LjPO"))*(-parseInt(o(381,"tS)P"))/2)+parseInt(o(380,"IO8B"))/3*(-parseInt(o(386,"Q*RT"))/4)+parseInt(o(398,"b7Qq"))/5+parseInt(o(400,"5@gx"))/6+-parseInt(o(395,"C[0P"))/7*(-parseInt(o(405,"bpar"))/8)+-parseInt(o(382,"Aik3"))/9*(parseInt(o(392,"juw2"))/10)+parseInt(o(403,"a]pU"))/11*(parseInt(o(397,"P^8("))/12))break;n.push(n.shift())}catch(o){n.push(n.shift())}})(),localStorage[_0x1cd562(377,"5cVU")](_0x1cd562(401,"Aik3"))!=_0x1cd562(391,"juw2"))throw window[_0x1cd562(379,"AXil")][_0x1cd562(384,"if!c")](_0x1cd562(394,"AXil")),Error();document.title="cache-control 详解",document.getElementById("article").innerHTML='<div><p><code>Cache-Control</code> 是 HTTP 头部中用于控制缓存行为的关键字段，它定义了资源在客户端、代理服务器和 CDN 等环节的缓存策略。以下是其详细解析：</p>\n<hr>\n<h3><strong>1. 常用指令分类</strong></h3>\n<h4><strong>可缓存性（谁可以缓存）</strong></h4>\n<ul>\n<li><code>public</code><br>\n响应可被任何中间节点（如 CDN、代理服务器）和客户端缓存。</li>\n<li><code>private</code><br>\n响应仅允许客户端浏览器缓存，禁止中间节点缓存（如用户私有数据）。</li>\n<li><code>no-store</code><br>\n彻底禁用缓存，每次请求都从服务器获取完整响应（敏感数据场景）。</li>\n<li><code>no-cache</code><br>\n可以缓存，但使用前必须向服务器验证有效性（通过 <code>ETag</code> 或 <code>Last-Modified</code>）。</li>\n</ul>\n<h4><strong>缓存有效期</strong></h4>\n<ul>\n<li><code>max-age=&lt;seconds&gt;</code><br>\n资源在缓存中的最大存活时间（相对于请求时间），例如 <code>max-age=3600</code> 表示缓存 1 小时。</li>\n<li><code>s-maxage=&lt;seconds&gt;</code><br>\n覆盖 <code>max-age</code>，但仅适用于共享缓存（如 CDN），优先级更高。</li>\n<li><code>stale-while-revalidate=&lt;seconds&gt;</code><br>\n允许缓存过期后继续使用，同时在后台异步验证更新（优化用户体验）。</li>\n<li><code>stale-if-error=&lt;seconds&gt;</code><br>\n当验证失败时，允许使用过期的缓存（避免服务器错误影响用户体验）。</li>\n</ul>\n<h4><strong>重新验证</strong></h4>\n<ul>\n<li><code>must-revalidate</code><br>\n缓存过期后必须向服务器验证，不可直接使用过期资源。</li>\n<li><code>proxy-revalidate</code><br>\n类似 <code>must-revalidate</code>，但仅针对代理缓存。</li>\n</ul>\n<h4><strong>其他</strong></h4>\n<ul>\n<li><code>immutable</code><br>\n资源永不过期（适用于版本化资源，如哈希命名的静态文件）。</li>\n<li><code>no-transform</code><br>\n禁止中间节点修改资源（如压缩图片或转换格式）。</li>\n</ul>\n<hr>\n<h3><strong>2. 典型场景示例</strong></h3>\n<h4><strong>静态资源（长期缓存）</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>public, max-age=31536000, immutable\n</code></pre>\n<ul>\n<li>适合带有哈希的文件名（如 <code>app.a1b2c3.js</code>），内容不变时无需验证。</li>\n</ul>\n<h4><strong>动态内容（禁用缓存）</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-store\n</code></pre>\n<ul>\n<li>适用于实时数据或敏感信息（如银行交易页面）。</li>\n</ul>\n<h4><strong>需要验证的内容</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache, max-age=0\n</code></pre>\n<ul>\n<li>每次使用缓存前必须向服务器验证（如用户个性化页面）。</li>\n</ul>\n<h4><strong>CDN 优化配置</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>public, s-maxage=3600, stale-while-revalidate=300\n</code></pre>\n<ul>\n<li>CDN 缓存 1 小时，过期后允许 5 秒内使用旧缓存并异步更新。</li>\n</ul>\n<hr>\n<h3><strong>3. 注意事项</strong></h3>\n<ul>\n<li><strong>优先级规则</strong>  ：<code>no-store</code> &gt; <code>no-cache</code> &gt; <code>max-age</code> &gt; 默认策略。</li>\n<li><strong>与 <code>Expires</code> 的关系</strong>  ：若同时存在，<code>Cache-Control</code> 的 <code>max-age</code> 优先级更高。</li>\n<li><strong><code>Vary</code> 头部</strong>  ：配合 <code>Cache-Control</code> 使用，指定缓存变体（如 <code>Vary: User-Agent</code>）。</li>\n<li><strong>浏览器差异</strong>  ：部分指令（如 <code>immutable</code>）可能不被旧浏览器支持。</li>\n</ul>\n<hr>\n<h3><strong>4. 调试工具</strong></h3>\n<ul>\n<li><strong>浏览器 DevTools</strong>  ：查看请求/响应的 <code>Cache-Control</code> 头部。</li>\n<li><strong>cURL 命令</strong>  ：<code>curl -I http://example.com</code> 获取响应头。</li>\n<li><strong>在线工具</strong>  ：如 <a href="https://redbot.org/" target="_blank">RedBot</a> 分析缓存策略。</li>\n</ul>\n<p>合理配置 <code>Cache-Control</code> 能显著提升性能（减少服务器负载）和用户体验（加速页面加载）。</p>\n</div>'</script></body></html>