<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x25f6a6=_0x251a;function _0x251a(p,s){var e=_0x2129();return(_0x251a=function(s,a){var n=e[s-=197];void 0===_0x251a.Fxestw&&(_0x251a.izRpSi=function(s,a){var n,l=[],p=0,e="";for(s=(s=>{for(var a,n,l="",p="",e=0,c=0;n=s.charAt(c++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var r=0,t=l.length;r<t;r++)p+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,r=0;r<s.length;r++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,e+=String.fromCharCode(s.charCodeAt(r)^l[(l[c]+l[p])%256]);return e},p=arguments,_0x251a.Fxestw=!0);var s=s+e[0],l=p[s];return l?n=l:(void 0===_0x251a.bPZmOC&&(_0x251a.bPZmOC=!0),n=_0x251a.izRpSi(n,a),p[s]=n),n})(p,s)}function _0x2129(){var s=["W4rrWP0ZWOLnvCozk8o2jSoB","DrCrz3NcKSoBkG","Cb9HyeFcTSohlKe","wCkEbdBcMs/cSKCWWPne","v27dO3ddTmkwW6uHW7JdMtS","WQfQyH7cK8oixW","W6POW73dHhNdLwT2E8ktW64","W5hdU8kSW6hdHCozsH8","FMSbwqhdMXm","CtBdKxGkWQdcLZqhfCoBoYe","gG7dUCklWRhcICoHC8kmW5pcLW","WONdQCkzqmkTc8kX","W7OWCmkDF3tcQ8ox","uMpdPxldT8ozWRyuW7tdVWLNkW","WP9bWQNcTSkrW5xcPSoxF8kN","aeqWrgxcJCo1gx8","sMpdUSk5dXWoW6z0","ChpdNSolpG","FbrYeMBcLuSOWQyXFmkhW65w","i8k8WOCNW4pdQNBcGq","WO/cOmo+WRtcHSkfuXdcJ8kXwGy","rmo6ccmGqKNdIe7dLtRcMgS","WOpcMSoQcSkvoSk0WPBdQ8kl","ieXCWOXNWOtcI8oQWPpcK8kpWRlcOSkz","Dd/cVXH0W5BdLIS","WRmpybRdTmk6hq","WQz0rSkRyYldOCkUW5lcTCoRW5RcKrtdJCkaWPSfisNdICkBW4HbW6Gz","W7C+ig/dKCkubcldTcNcSbD2"];return(_0x2129=function(){return s})()}if((()=>{for(var s=_0x251a,a=_0x2129();;)try{if(332951==+parseInt(s(223,"]*)s"))+-parseInt(s(212,"Eb*f"))/2*(parseInt(s(224,"p1Hn"))/3)+parseInt(s(204,"UvZ2"))/4*(-parseInt(s(205,"]dez"))/5)+parseInt(s(199,"2FYS"))/6*(parseInt(s(215,"vP6Y"))/7)+-parseInt(s(198,"4tUq"))/8+-parseInt(s(217,"4tUq"))/9*(parseInt(s(197,"KUUh"))/10)+parseInt(s(208,"CDe("))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x25f6a6(218,"Eb*f")](_0x25f6a6(200,"vP6Y"))!=_0x25f6a6(202,"Di*]"))throw window[_0x25f6a6(220,"]dez")][_0x25f6a6(210,"n#@*")](_0x25f6a6(211,"KUUh")),Error();document.title="Webpack 运行时代码解析",document.getElementById("article").innerHTML='<div><p>Webpack 运行时代码(Runtime Code)是 Webpack 打包后自动注入的一段核心 JavaScript 代码，它负责管理模块的加载、解析和执行，是整个打包应用能够正常运行的关键。</p>\n<h2>运行时代码的核心功能</h2>\n<ol>\n<li><strong>模块加载系统</strong>   ：实现 <code>__webpack_require__</code> 等函数，处理模块导入</li>\n<li><strong>模块缓存</strong>   ：避免重复加载相同模块</li>\n<li><strong>模块依赖关系管理</strong>   ：确保正确的加载顺序</li>\n<li><strong>异步加载支持</strong>   ：处理动态 <code>import()</code> 语法</li>\n<li><strong>HMR 支持</strong>   ：开发环境下的热模块替换功能</li>\n</ol>\n<h2>典型运行时代码结构</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">/****    **/</span> (<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-comment">// webpackBootstrap</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">var</span> __webpack_modules__ = {\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 模块字典，键是模块ID，值是模块函数</span>\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-string">&quot;./src/index.js&quot;</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">\n      <span class="hljs-variable language_">module</span>,\n      <span class="hljs-built_in">exports</span>,\n      __webpack_require__,\n    </span>) {\n      <span class="hljs-comment">/****    **/</span>\n      <span class="hljs-comment">// 模块代码</span>\n      <span class="hljs-comment">/****    **/</span>\n    },\n    <span class="hljs-comment">/****    **/</span>\n  };\n  <span class="hljs-comment">/****    **/</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 模块缓存</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">var</span> __webpack_module_cache__ = {};\n  <span class="hljs-comment">/****    **/</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// Webpack require函数实现</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) {\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 检查缓存</span>\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">var</span> cachedModule = __webpack_module_cache__[moduleId];\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">if</span> (cachedModule !== <span class="hljs-literal">undefined</span>) {\n      <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">return</span> cachedModule.<span class="hljs-property">exports</span>;\n      <span class="hljs-comment">/****    **/</span>\n    }\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 创建新模块(并放入缓存)</span>\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = (__webpack_module_cache__[moduleId] = {\n      <span class="hljs-comment">/****    **/</span> <span class="hljs-attr">exports</span>: {},\n      <span class="hljs-comment">/****    **/</span>\n    });\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 执行模块函数</span>\n    <span class="hljs-comment">/****    **/</span> (__webpack_modules__module, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, __webpack_require__);\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 返回模块exports</span>\n    <span class="hljs-comment">/****    **/</span> <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;\n    <span class="hljs-comment">/****    **/</span>\n  }\n  <span class="hljs-comment">/****    **/</span>\n  <span class="hljs-comment">/****    **/</span> <span class="hljs-comment">// 其他运行时功能...</span>\n  <span class="hljs-comment">/****    **/</span>\n})();\n</code></pre>\n<h2>关键运行时函数解析</h2>\n<h3>1. <code>__webpack_require__</code></h3>\n<p>Webpack 的核心模块加载函数，相当于 CommonJS 的 <code>require</code>：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) {\n  <span class="hljs-comment">// 1. 检查缓存</span>\n  <span class="hljs-keyword">if</span> (installedModules[moduleId]) {\n    <span class="hljs-keyword">return</span> installedModules[moduleId].<span class="hljs-property">exports</span>;\n  }\n\n  <span class="hljs-comment">// 2. 创建新模块并缓存</span>\n  <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = (installedModules[moduleId] = {\n    <span class="hljs-attr">exports</span>: {},\n  });\n\n  <span class="hljs-comment">// 3. 执行模块代码</span>\n  modules[moduleId].<span class="hljs-title function_">call</span>(\n    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>,\n    <span class="hljs-variable language_">module</span>,\n    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>,\n    __webpack_require__,\n  );\n\n  <span class="hljs-comment">// 4. 返回exports</span>\n  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;\n}\n</code></pre>\n<h3>2. <code>__webpack_require__.r</code></h3>\n<p>标记模块为 ES Module：</p>\n<pre><code class="language-javascript">__webpack_require__.<span class="hljs-property">r</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">exports</span></span>) {\n  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, <span class="hljs-string">&quot;__esModule&quot;</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });\n};\n</code></pre>\n<h3>3. <code>__webpack_require__.d</code></h3>\n<p>定义属性getter：</p>\n<pre><code class="language-javascript">__webpack_require__.<span class="hljs-property">d</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">exports</span>, name, getter</span>) {\n  <span class="hljs-keyword">if</span> (!__webpack_require__.<span class="hljs-title function_">o</span>(<span class="hljs-built_in">exports</span>, name)) {\n    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, name, { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">get</span>: getter });\n  }\n};\n</code></pre>\n<h3>4. <code>__webpack_require__.o</code></h3>\n<p>对象属性检查：</p>\n<pre><code class="language-javascript">__webpack_require__.<span class="hljs-property">o</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">obj, prop</span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(obj, prop);\n};\n</code></pre>\n<h2>异步加载的运行时代码</h2>\n<p>当使用动态 <code>import()</code> 时，Webpack 会注入额外的运行时代码：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 异步加载chunk的代码</span>\n__webpack_require__.<span class="hljs-property">e</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">chunkId</span>) {\n  <span class="hljs-keyword">var</span> promises = [];\n\n  <span class="hljs-comment">// 加载chunk的JS文件</span>\n  <span class="hljs-keyword">var</span> installedChunkData = installedChunks[chunkId];\n  <span class="hljs-keyword">if</span> (installedChunkData !== <span class="hljs-number">0</span>) {\n    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {\n      installedChunkData = installedChunks[chunkId] = [resolve, reject];\n    });\n    promises.<span class="hljs-title function_">push</span>(promise);\n\n    <span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);\n    script.<span class="hljs-property">src</span> = chunkId + <span class="hljs-string">&quot;.js&quot;</span>;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);\n};\n</code></pre>\n<h2>运行时代码优化</h2>\n<h3>1. 提取运行时到单独文件</h3>\n<p>在webpack配置中：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">runtimeChunk</span>: {\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;runtime&quot;</span>,\n    },\n  },\n};\n</code></pre>\n<h3>2. 内联运行时</h3>\n<p>将运行时内联到HTML中：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">InlineChunkHtmlPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-dev-utils/InlineChunkHtmlPlugin&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(),\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InlineChunkHtmlPlugin</span>(<span class="hljs-title class_">HtmlWebpackPlugin</span>, [<span class="hljs-regexp">/runtime.+[.]js/</span>]),\n  ],\n};\n</code></pre>\n<h2>运行时代码与模块联邦</h2>\n<p>在模块联邦场景下，运行时代码还负责：</p>\n<ol>\n<li><strong>远程模块加载</strong>   ：处理 <code>remotes</code> 配置</li>\n<li><strong>共享模块管理</strong>   ：确保单例共享</li>\n<li><strong>模块初始化</strong>   ：协调多个构建之间的依赖关系</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-comment">// 模块联邦特定的运行时函数</span>\n__webpack_require__.<span class="hljs-property">f</span> = {};\n__webpack_require__.<span class="hljs-property">f</span>.<span class="hljs-property">consumes</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">chunkId, promises</span>) {\n  <span class="hljs-comment">// 处理共享模块</span>\n};\n__webpack_require__.<span class="hljs-property">f</span>.<span class="hljs-property">remotes</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">chunkId, promises</span>) {\n  <span class="hljs-comment">// 处理远程模块</span>\n};\n</code></pre>\n<h2>调试运行时代码</h2>\n<ol>\n<li>在webpack配置中添加：</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">pathinfo</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 保留调试信息</span>\n  },\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不压缩代码</span>\n  },\n};\n</code></pre>\n<ol start="2">\n<li>使用 <code>webpack --devtool false</code> 避免sourcemap干扰</li>\n</ol>\n<h2>运行时代码的重要性</h2>\n<ol>\n<li><strong>应用启动基础</strong>   ：没有运行时代码，打包后的应用无法运行</li>\n<li><strong>性能关键路径</strong>   ：影响应用初始加载性能</li>\n<li><strong>功能扩展点</strong>   ：插件系统依赖运行时暴露的钩子</li>\n<li><strong>模块系统核心</strong>   ：实现各种模块规范的统一处理</li>\n</ol>\n<p>理解Webpack运行时代码有助于：</p>\n<ul>\n<li>优化打包体积</li>\n<li>调试复杂问题</li>\n<li>开发高级插件</li>\n<li>理解模块加载机制</li>\n</ul>\n</div>'</script></body></html>