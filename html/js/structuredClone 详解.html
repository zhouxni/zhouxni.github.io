<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3548(){var s=["uSoyW7ddGCkpqmob","WROsxZ5FWR3cI8oFE8kXrgxdNW","nSoyhLNdSSoYWQdcHbZdL8oDb8o1","WRalW5hdQmkusqy","rSkgdW/cLbldN8o0cIVdSSk9CG","zqZdHNCGvmk+","WPFcJx0IWOWXWQnu","WP1WW7xdONqcW4lcVSklusRcMcq","WR3dM8kuWRDBW4DBWPnnWPtcQSkCjW","wCoDC8kvWPddLtxcNLFdLCokDq","osBcUf/dHHhcL10","mSoBWRpcM8oZnqDHWPa","mmoDrWxcJCklW4dcRq","W5RdV2hdJguGW7ldLM/cPSouW4JdJCk0","WQldHmoZWRWPWPdcOGO","W4axevlcM2XADCk7amojWP3cNq","qSknW6JdJ8k5DHvLWOFdGCozWRC","etlcJCkcWP/cHmoj","rSklW6JdHSk0FNX8WOddSSo0WPpcHa","W7RdPN8HyNiBg8ohW4lcUKJcN1FcGmotWOugyfCfW49UwmkCCW","W77cUSkEW61lx8omW4O","WOn+W7Pfg8oVmSooW5hcRXHoWQJdGW","vmk3WQlcH8oWcmoYWQ3cLrJdLmoH","WQxdNmkkWPSR","iSo9WORcRabHWOhcGmo5W4jFWP0U"];return(_0x3548=function(){return s})()}function _0x1b55(l,s){var e=_0x3548();return(_0x1b55=function(s,n){var a=e[s-=367];void 0===_0x1b55.CFRxFT&&(_0x1b55.vAcsEZ=function(s,n){var a,t=[],l=0,e="";for(s=(s=>{for(var n,a,t="",l="",e=0,o=0;a=s.charAt(o++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=t.length;c<r;c++)l+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),o=0;o<256;o++)t[o]=o;for(o=0;o<256;o++)l=(l+t[o]+n.charCodeAt(o%n.length))%256,a=t[o],t[o]=t[l],t[l]=a;for(var o=0,l=0,c=0;c<s.length;c++)a=t[o=(o+1)%256],t[o]=t[l=(l+t[o])%256],t[l]=a,e+=String.fromCharCode(s.charCodeAt(c)^t[(t[o]+t[l])%256]);return e},l=arguments,_0x1b55.CFRxFT=!0);var s=s+e[0],t=l[s];return t?a=t:(void 0===_0x1b55.sswagg&&(_0x1b55.sswagg=!0),a=_0x1b55.vAcsEZ(a,n),l[s]=a),a})(l,s)}var _0x3f9ba4=_0x1b55;if((()=>{for(var s=_0x1b55,n=_0x3548();;)try{if(814336==+parseInt(s(383,"rVF6"))+parseInt(s(390,"MBI5"))/2*(-parseInt(s(386,"avH!"))/3)+parseInt(s(382,"nV@x"))/4+parseInt(s(378,"*^#V"))/5+parseInt(s(376,"avH!"))/6*(-parseInt(s(379,"hsE0"))/7)+-parseInt(s(370,"Ixt("))/8+-parseInt(s(381,"ZeJD"))/9*(-parseInt(s(388,"6^pm"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3f9ba4(377,"96PE")](_0x3f9ba4(385,"MBI5"))!=_0x3f9ba4(372,"n[rH"))throw window[_0x3f9ba4(369,"7U[W")][_0x3f9ba4(391,"f82H")](_0x3f9ba4(368,"OrFL")),new Error;document.title="structuredClone è¯¦è§£",document.getElementById("article").innerHTML='<div><p><code>structuredClone()</code> æ˜¯ JavaScript ä¸­ä¸€ä¸ª<strong>åŸç”Ÿã€æ ‡å‡†åŒ–çš„æ·±å…‹éš†ï¼ˆdeep cloneï¼‰API</strong>   ï¼Œè‡ª <strong>2022 å¹´èµ·é€æ­¥è¿›å…¥ä¸»æµè¿è¡Œæ—¶ç¯å¢ƒ</strong>   ï¼Œå¹¶åœ¨ <strong>2025 å¹´å·²æˆä¸ºç°ä»£ Web å’Œ Node.js å¼€å‘ä¸­çš„æ¨èæ·±æ‹·è´æ–¹å¼</strong>   ã€‚ä»¥ä¸‹æ˜¯å¯¹è¯¥ API çš„å…¨é¢è¯¦è§£ã€‚</p>\n<hr>\n<h2>ä¸€ã€åŸºæœ¬å®šä¹‰</h2>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> cloned = <span class="hljs-title function_">structuredClone</span>(value, options?);\n</code></pre>\n<ul>\n<li><strong>ä½œç”¨</strong>   ï¼šå¯¹ä¼ å…¥çš„ <code>value</code> æ‰§è¡Œ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank">ç»“æ„åŒ–å…‹éš†ç®—æ³•ï¼ˆStructured Clone Algorithmï¼‰</a>ï¼Œç”Ÿæˆä¸€ä¸ª<strong>å®Œå…¨ç‹¬ç«‹çš„æ–°å¯¹è±¡å‰¯æœ¬</strong>   ã€‚</li>\n<li><strong>è¿”å›å€¼</strong>   ï¼šä¸åŸå¯¹è±¡ç»“æ„ç›¸åŒä½†å†…å­˜åœ°å€ä¸åŒçš„æ–°å¯¹è±¡ï¼ˆæ·±æ‹·è´ï¼‰ã€‚</li>\n<li><strong>å…¨å±€å‡½æ•°</strong>   ï¼šæ— éœ€å¯¼å…¥ï¼Œç›´æ¥è°ƒç”¨ã€‚</li>\n</ul>\n<hr>\n<h2>äºŒã€æ”¯æŒçš„æ•°æ®ç±»å‹ï¼ˆâœ… å®Œæ•´ä¿ç•™è¯­ä¹‰ï¼‰</h2>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>æ˜¯å¦æ”¯æŒ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Object</code> / <code>Array</code></td>\n<td>âœ…</td>\n<td>åŒ…æ‹¬åµŒå¥—ç»“æ„</td>\n</tr>\n<tr>\n<td><code>Date</code></td>\n<td>âœ…</td>\n<td>å…‹éš†åä»æ˜¯ <code>Date</code> å®ä¾‹</td>\n</tr>\n<tr>\n<td><code>RegExp</code></td>\n<td>âœ…</td>\n<td>ä¿ç•™ flags å’Œ source</td>\n</tr>\n<tr>\n<td><code>Map</code> / <code>Set</code></td>\n<td>âœ…</td>\n<td>å†…å®¹ä¹Ÿè¢«æ·±å…‹éš†</td>\n</tr>\n<tr>\n<td><code>ArrayBuffer</code> / <code>TypedArray</code></td>\n<td>âœ…</td>\n<td>é»˜è®¤å¤åˆ¶æ•°æ®ï¼›å¯é€‰ transfer</td>\n</tr>\n<tr>\n<td><code>Blob</code> / <code>File</code></td>\n<td>âœ…</td>\n<td>æµè§ˆå™¨ä¸­æ”¯æŒ</td>\n</tr>\n<tr>\n<td><code>ImageData</code></td>\n<td>âœ…</td>\n<td>Canvas ç›¸å…³</td>\n</tr>\n<tr>\n<td><code>Error</code> å¯¹è±¡</td>\n<td>âŒï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰</td>\n<td>åªå¤åˆ¶å¯æšä¸¾å±æ€§ï¼Œä¸ä¿ç•™åŸå‹é“¾</td>\n</tr>\n<tr>\n<td><strong>å¾ªç¯å¼•ç”¨</strong></td>\n<td>âœ…</td>\n<td>è‡ªåŠ¨å¤„ç†ï¼Œä¸ä¼šæ ˆæº¢å‡º</td>\n</tr>\n<tr>\n<td><code>undefined</code></td>\n<td>âš ï¸</td>\n<td>å±æ€§å€¼ä¸º <code>undefined</code> ä¼šè¢«å¿½ç•¥ï¼ˆå¦‚åŒ JSONï¼‰</td>\n</tr>\n<tr>\n<td><code>Symbol</code>ï¼ˆä½œä¸ºå±æ€§é”®ï¼‰</td>\n<td>âš ï¸</td>\n<td><strong>ä¸å¯æšä¸¾çš„ symbol é”®ä¼šè¢«å¿½ç•¥</strong></td>\n</tr>\n<tr>\n<td><code>Function</code></td>\n<td>âŒ</td>\n<td>è¢«å¿½ç•¥ï¼ˆä¸å¤åˆ¶ä¹Ÿä¸æŠ¥é”™ï¼‰</td>\n</tr>\n<tr>\n<td><code>WeakMap</code> / <code>WeakSet</code></td>\n<td>âŒ</td>\n<td>æŠ›å‡º <code>DataCloneError</code></td>\n</tr>\n<tr>\n<td>DOM èŠ‚ç‚¹ï¼ˆå¦‚ <code>div</code>ï¼‰</td>\n<td>âŒ</td>\n<td>æŠ›å‡ºé”™è¯¯</td>\n</tr>\n<tr>\n<td><code>Proxy</code></td>\n<td>âŒ</td>\n<td>æŠ›å‡ºé”™è¯¯</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ğŸ’¡ æ³¨æ„ï¼š<code>structuredClone</code> åŸºäº <strong>HTML è§„èŒƒä¸­çš„ç»“æ„åŒ–å…‹éš†ç®—æ³•</strong>   ï¼Œæœ€åˆç”¨äº <code>postMessage</code>ã€<code>IndexedDB</code> ç­‰åœºæ™¯ï¼Œç°åœ¨è¢«æš´éœ²ä¸ºé€šç”¨ APIã€‚</p>\n</blockquote>\n<hr>\n<h2>ä¸‰ã€æ ¸å¿ƒç‰¹æ€§è¯¦è§£</h2>\n<h3>1. <strong>çœŸæ­£çš„æ·±å…‹éš†</strong></h3>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> original = {\n  <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> },\n  <span class="hljs-attr">c</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),\n  <span class="hljs-attr">d</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]),\n};\n\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title function_">structuredClone</span>(original);\ncopy.<span class="hljs-property">a</span>.<span class="hljs-property">b</span> = <span class="hljs-number">999</span>;\ncopy.<span class="hljs-property">c</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-number">2030</span>);\n\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(original.<span class="hljs-property">a</span>.<span class="hljs-property">b</span>); <span class="hljs-comment">// 1ï¼ˆæœªå—å½±å“ï¼‰</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(original.<span class="hljs-property">c</span>.<span class="hljs-title function_">getFullYear</span>()); <span class="hljs-comment">// åŸå¹´ä»½ï¼ˆæœªå˜ï¼‰</span>\n</code></pre>\n<h3>2. <strong>è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨</strong></h3>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;root&quot;</span> };\nobj.<span class="hljs-property">self</span> = obj;\n\n<span class="hljs-keyword">const</span> clone = <span class="hljs-title function_">structuredClone</span>(obj);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(clone.<span class="hljs-property">self</span> === clone); <span class="hljs-comment">// true</span>\n</code></pre>\n<p>âœ… ä¸ä¼šæ— é™é€’å½’ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p>\n<h3>3. <strong>ä¿ç•™å†…ç½®å¯¹è±¡ç±»å‹</strong></h3>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> data = {\n  <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2025-01-01&quot;</span>),\n  <span class="hljs-attr">regex</span>: <span class="hljs-regexp">/abc/gi</span>,\n  <span class="hljs-attr">set</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]),\n  <span class="hljs-attr">map</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-string">&quot;x&quot;</span>, { <span class="hljs-attr">y</span>: <span class="hljs-number">1</span> }]]),\n};\n\n<span class="hljs-keyword">const</span> cloned = <span class="hljs-title function_">structuredClone</span>(data);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cloned.<span class="hljs-property">date</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>); <span class="hljs-comment">// true</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cloned.<span class="hljs-property">regex</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>); <span class="hljs-comment">// true</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cloned.<span class="hljs-property">set</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Set</span>); <span class="hljs-comment">// true</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cloned.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;x&quot;</span>).<span class="hljs-property">y</span>); <span class="hljs-comment">// 1ï¼ˆæ·±æ‹·è´ï¼‰</span>\n</code></pre>\n<hr>\n<h2>å››ã€å¯é€‰å‚æ•°ï¼š<code>transfer</code>ï¼ˆè½¬ç§»æ‰€æœ‰æƒï¼‰</h2>\n<p>ç”¨äº<strong>é«˜æ•ˆè½¬ç§»å¯è½¬ç§»å¯¹è±¡</strong>   ï¼ˆå¦‚ <code>ArrayBuffer</code>ï¼‰ï¼Œé¿å…å¤åˆ¶å†…å­˜ã€‚</p>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">1024</span>);\n<span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);\nview[<span class="hljs-number">0</span>] = <span class="hljs-number">255</span>;\n\n<span class="hljs-comment">// è½¬ç§» bufferï¼šåŸ buffer å¤±æ•ˆï¼Œæ–°å¯¹è±¡â€œæ¥ç®¡â€å†…å­˜</span>\n<span class="hljs-keyword">const</span> cloned = <span class="hljs-title function_">structuredClone</span>({ <span class="hljs-attr">data</span>: buffer }, { <span class="hljs-attr">transfer</span>: [buffer] });\n\n<span class="hljs-comment">// æ­¤æ—¶åŸ buffer å·²è¢«â€œæ–­å¼€â€</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(buffer.<span class="hljs-property">byteLength</span>); <span class="hljs-comment">// 0ï¼ˆåœ¨æµè§ˆå™¨ä¸­å¯èƒ½æŠ›é”™æˆ–ç½®é›¶ï¼‰</span>\n</code></pre>\n<blockquote>\n<p>ğŸ”’ <strong>é™åˆ¶</strong>   ï¼š</p>\n<ul>\n<li>åªèƒ½è½¬ç§» <code>ArrayBuffer</code>ã€<code>MessagePort</code>ã€<code>ReadableStream</code> ç­‰å¯è½¬ç§»å¯¹è±¡ã€‚</li>\n<li>è¢«è½¬ç§»çš„å¯¹è±¡åœ¨åŸä¸Šä¸‹æ–‡ä¸­<strong>ä¸å†å¯ç”¨</strong>   ã€‚</li>\n<li><code>transfer</code> æ•°ç»„ä¸­çš„å¯¹è±¡å¿…é¡»æ˜¯ <code>value</code> ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</li>\n</ul>\n</blockquote>\n<hr>\n<h2>äº”ã€é”™è¯¯å¤„ç†</h2>\n<p>å½“å°è¯•å…‹éš†ä¸æ”¯æŒçš„ç±»å‹æ—¶ï¼Œä¼šæŠ›å‡º <strong><code>DataCloneError</code></strong>   ï¼ˆDOMException å­ç±»ï¼‰ï¼š</p>\n<pre><code class="language-js"><span class="hljs-keyword">try</span> {\n  <span class="hljs-title function_">structuredClone</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>());\n} <span class="hljs-keyword">catch</span> (e) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">name</span>); <span class="hljs-comment">// &quot;DataCloneError&quot;</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">code</span>); <span class="hljs-comment">// 25ï¼ˆDOM Exception codeï¼‰</span>\n}\n</code></pre>\n<hr>\n<h2>å…­ã€æµè§ˆå™¨ &amp; Node.js æ”¯æŒæƒ…å†µï¼ˆæˆªè‡³ 2025ï¼‰</h2>\n<table>\n<thead>\n<tr>\n<th>ç¯å¢ƒ</th>\n<th>ç‰ˆæœ¬è¦æ±‚</th>\n<th>çŠ¶æ€</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Chrome</td>\n<td>â‰¥ 98</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Firefox</td>\n<td>â‰¥ 94</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Safari</td>\n<td>â‰¥ 15.4</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Edge</td>\n<td>â‰¥ 98</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>Node.js</td>\n<td>â‰¥ 17.0.0</td>\n<td>âœ…ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td>Deno</td>\n<td>â‰¥ 1.14</td>\n<td>âœ…</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ğŸ’¡ åœ¨æ—§ç‰ˆç¯å¢ƒä¸­ï¼Œå¯é€šè¿‡ polyfill æ¨¡æ‹Ÿï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚</p>\n</blockquote>\n<hr>\n<h2>ä¸ƒã€ä¸ä¼ ç»Ÿæ·±å…‹éš†æ–¹æ³•å¯¹æ¯”</h2>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•</th>\n<th>æ˜¯å¦æ·±å…‹éš†</th>\n<th>ä¿ç•™ç±»å‹</th>\n<th>å¾ªç¯å¼•ç”¨</th>\n<th>å‡½æ•°/Symbol</th>\n<th>æ€§èƒ½</th>\n<th>ä¾èµ–</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>JSON.parse(JSON.stringify())</code></td>\n<td>éƒ¨åˆ†</td>\n<td>âŒï¼ˆå…¨å˜ plain objectï¼‰</td>\n<td>âŒï¼ˆæŠ¥é”™ï¼‰</td>\n<td>âŒï¼ˆä¸¢å¤±ï¼‰</td>\n<td>å¿«</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td>Lodash <code>_.cloneDeep()</code></td>\n<td>âœ…</td>\n<td>âœ…ï¼ˆå¤§éƒ¨åˆ†ï¼‰</td>\n<td>âœ…</td>\n<td>âœ…ï¼ˆå¯é…ç½®ï¼‰</td>\n<td>ä¸­</td>\n<td>ç¬¬ä¸‰æ–¹åº“</td>\n</tr>\n<tr>\n<td>è‡ªå®šä¹‰é€’å½’</td>\n<td>å¯å®ç°</td>\n<td>éœ€æ‰‹åŠ¨å¤„ç†</td>\n<td>éœ€é¢å¤–é€»è¾‘</td>\n<td>å¯é€‰</td>\n<td>æ…¢</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><strong><code>structuredClone()</code></strong></td>\n<td>âœ…</td>\n<td>âœ…ï¼ˆæ ‡å‡†ç±»å‹ï¼‰</td>\n<td>âœ…</td>\n<td>âŒï¼ˆå®‰å…¨å¿½ç•¥ï¼‰</td>\n<td><strong>å¿«ï¼ˆå¼•æ“ä¼˜åŒ–ï¼‰</strong></td>\n<td><strong>åŸç”Ÿ</strong></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2>å…«ã€Polyfillï¼ˆå…¼å®¹æ—§ç¯å¢ƒï¼‰</h2>\n<p>ä½¿ç”¨ç¤¾åŒºæ–¹æ¡ˆï¼ˆå¦‚ <a href="https://github.com/ungap/structured-clone" target="_blank"><code>@ungap/structured-clone</code></a>ï¼‰ï¼š</p>\n<pre><code class="language-js"><span class="hljs-keyword">import</span> structuredClone <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@ungap/structured-clone&quot;</span>;\n\n<span class="hljs-comment">// æˆ–æ£€æµ‹æ˜¯å¦åŸç”Ÿæ”¯æŒ</span>\n<span class="hljs-keyword">const</span> safeStructuredClone =\n  <span class="hljs-keyword">typeof</span> structuredClone === <span class="hljs-string">&quot;function&quot;</span>\n    ? structuredClone\n    : <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)); <span class="hljs-comment">// fallbackï¼ˆæœ‰ç¼ºé™·ï¼‰</span>\n</code></pre>\n<blockquote>\n<p>âš ï¸ æ³¨æ„ï¼špolyfill æ— æ³•å®Œç¾æ¨¡æ‹Ÿæ‰€æœ‰è¡Œä¸ºï¼ˆå¦‚ <code>Map</code>ã€<code>Set</code>ã€å¾ªç¯å¼•ç”¨ç­‰ï¼‰ï¼Œä»…ä½œé™çº§ã€‚</p>\n</blockquote>\n<hr>\n<h2>ä¹ã€å…¸å‹ä½¿ç”¨åœºæ™¯</h2>\n<ol>\n<li><strong>è·¨çº¿ç¨‹é€šä¿¡å‰å…‹éš†æ•°æ®</strong>   ï¼ˆå¦‚ Workerï¼‰</li>\n<li><strong>çŠ¶æ€ç®¡ç†ä¸­åˆ›å»ºä¸å¯å˜å‰¯æœ¬</strong>   ï¼ˆReduxã€Vuex æ›¿ä»£æ–¹æ¡ˆï¼‰</li>\n<li><strong>å¤‡ä»½å¤æ‚é…ç½®å¯¹è±¡</strong></li>\n<li><strong>æµ‹è¯•ä¸­éš”ç¦»åŸå§‹æ•°æ®</strong></li>\n</ol>\n<pre><code class="language-js"><span class="hljs-comment">// React ä¸­é¿å…ç›´æ¥ä¿®æ”¹ props/state</span>\n<span class="hljs-keyword">const</span> newState = <span class="hljs-title function_">structuredClone</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">config</span>);\nnewState.<span class="hljs-property">user</span>.<span class="hljs-property">theme</span> = <span class="hljs-string">&quot;dark&quot;</span>;\n<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">config</span>: newState });\n</code></pre>\n<hr>\n<h2>åã€æ³¨æ„äº‹é¡¹</h2>\n<ul>\n<li>\n<p><strong>ä¸æ˜¯ä¸‡èƒ½çš„</strong>   ï¼šä¸èƒ½å…‹éš†å‡½æ•°ã€ç±»å®ä¾‹ï¼ˆé™¤éæ˜¯ plain objectï¼‰ã€ç§æœ‰å­—æ®µç­‰ã€‚</p>\n</li>\n<li>\n<p><strong>ç±»å®ä¾‹é—®é¢˜</strong>   ï¼š</p>\n<pre><code class="language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;\n  }\n}\n<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>);\n<span class="hljs-keyword">const</span> c = <span class="hljs-title function_">structuredClone</span>(p);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// falseï¼å˜æˆæ™®é€šå¯¹è±¡</span>\n</code></pre>\n<p>â†’ å¦‚éœ€ä¿ç•™ç±»å®ä¾‹ï¼Œä»éœ€è‡ªå®šä¹‰å…‹éš†é€»è¾‘ã€‚</p>\n</li>\n<li>\n<p><strong>æ€§èƒ½</strong>   ï¼šå¯¹äºè¶…å¤§å¯¹è±¡ï¼ˆå¦‚ &gt;100MBï¼‰ï¼Œä»å¯èƒ½é˜»å¡ä¸»çº¿ç¨‹ï¼Œå»ºè®®åœ¨ Worker ä¸­æ‰§è¡Œã€‚</p>\n</li>\n</ul>\n<hr>\n<h2>æ€»ç»“</h2>\n<p><code>structuredClone()</code> æ˜¯ JavaScript è¿ˆå‘<strong>æ ‡å‡†åŒ–æ·±å…‹éš†</strong>   çš„é‡è¦ä¸€æ­¥ï¼Œå®ƒï¼š</p>\n<ul>\n<li>âœ… åŸç”Ÿã€é«˜æ•ˆã€å®‰å…¨</li>\n<li>âœ… æ”¯æŒç°ä»£ JS æ•°æ®ç»“æ„</li>\n<li>âœ… è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨</li>\n<li>âŒ ä¸é€‚ç”¨äºå‡½æ•°ã€ç±»å®ä¾‹ã€DOM ç­‰éç»“æ„åŒ–æ•°æ®</li>\n</ul>\n<p><strong>æ¨èåœ¨æ”¯æŒç¯å¢ƒä¸­ä¼˜å…ˆä½¿ç”¨ <code>structuredClone()</code> ä»£æ›¿ <code>JSON.parse(JSON.stringify())</code> æˆ–ç¬¬ä¸‰æ–¹åº“è¿›è¡Œæ·±æ‹·è´ã€‚</strong></p>\n<p>å¦‚éœ€è¿›ä¸€æ­¥æ¢è®¨ç‰¹å®šåœºæ™¯ï¼ˆå¦‚å…‹éš†ç±»å®ä¾‹ã€ä¸ Immer å¯¹æ¯”ç­‰ï¼‰ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼</p>\n</div>'</script></body></html>