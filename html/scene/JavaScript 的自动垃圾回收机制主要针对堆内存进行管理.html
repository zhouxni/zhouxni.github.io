<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2bfa(){var s=["WP4PESoBWQ7cHG3cTSkXW47dJ8oMWQm","CCoLW4VdVLGwWRakwa4","s1ldMCkbW58DqSkiWPDHk8oN","W7X/nW/dPYm2W55vnYZdNu4","W4v2W4DGoCkAW6BdNg5aWPuRWQm","WRLTW5VdHbJcTmkyWOlcNmoXW5xdVq","m8kNWQhdO8oVW4jtA8oS","zd7dL3bYW6RcM3G","zCkGgSo9ug0RWQtdRsaViSkp","WOj7Dr/dJKfm","thHXv8k5AtlcOSkLWPHdFW","m8kDxG8b","tWGjbgCYW4Chcx3dK8kaWRO","uWVcLmoNW6q7W4m","W7X9nGZdOI10W5DdfaFdQG","afRdKCkEW4azW7VdICoMtq","WR9HWQ4AW4VdLSoRWPyqoG","WO/cPdOtWOxdPcpdSq","WRhcVWWsW7ZcPvxdGG","WPmAnLD/wLW","rH3cHmo0fmolB8oCW4ZdGNNcRGG","W4tdNfhdIexdI3HYnSop","WPOQEmoEWQdcHq7cPCkGW4ddNSomWQi","zCo3Amk9daP/","W47cVx3dJaNcSuhdTWhcHsfuu3pdTXldLd/dRX/cN8oJWOnqpCkZ","qSo6W7G8vfP2xCkAW78Bn8kl","W47cLXFcV2JdMNm","bG/cQ8oDW70pW4O"];return(_0x2bfa=function(){return s})()}function _0x3993(l,s){var o=_0x2bfa();return(_0x3993=function(s,n){var a=o[s-=495];void 0===_0x3993.zjYnpD&&(_0x3993.aYTdGx=function(s,n){var a,t=[],l=0,o="";for(s=(s=>{for(var n,a,t="",l="",o=0,r=0;a=s.charAt(r++);~a&&(n=o%4?64*n+a:a,o++%4)&&(t+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,p=t.length;e<p;e++)l+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)t[r]=r;for(r=0;r<256;r++)l=(l+t[r]+n.charCodeAt(r%n.length))%256,a=t[r],t[r]=t[l],t[l]=a;for(var r=0,l=0,e=0;e<s.length;e++)a=t[r=(r+1)%256],t[r]=t[l=(l+t[r])%256],t[l]=a,o+=String.fromCharCode(s.charCodeAt(e)^t[(t[r]+t[l])%256]);return o},l=arguments,_0x3993.zjYnpD=!0);var s=s+o[0],t=l[s];return t?a=t:(void 0===_0x3993.XhofJu&&(_0x3993.XhofJu=!0),a=_0x3993.aYTdGx(a,n),l[s]=a),a})(l,s)}var _0x2a645f=_0x3993;if((()=>{for(var s=_0x3993,n=_0x2bfa();;)try{if(832269==+parseInt(s(506,"&IRB"))*(parseInt(s(500,"NW7f"))/2)+-parseInt(s(521,"$wJv"))/3+parseInt(s(513,"LP7O"))/4+parseInt(s(519,"6KJ&"))/5*(-parseInt(s(503,"^cCq"))/6)+parseInt(s(498,")&dD"))/7+parseInt(s(499,"Y(2X"))/8*(parseInt(s(504,"x7v*"))/9)+-parseInt(s(516,"NW7f"))/10*(-parseInt(s(517,"VX2U"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x2a645f(514,"NW7f")](_0x2a645f(507,"@On0"))!=_0x2a645f(512,"FTNP"))throw window[_0x2a645f(518,"D!TQ")][_0x2a645f(510,"([Rn")](_0x2a645f(497,"6AKe")),Error();document.title="JavaScript çš„è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ä¸»è¦é’ˆå¯¹å †å†…å­˜è¿›è¡Œç®¡ç†",document.getElementById("article").innerHTML='<div><p>æ˜¯çš„ï¼JavaScript çš„ <strong>è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰æœºåˆ¶</strong>   ä¸»è¦é’ˆå¯¹ <strong>å †å†…å­˜ï¼ˆHeap Memoryï¼‰</strong>   è¿›è¡Œç®¡ç†ï¼Œè€Œ <strong>æ ˆå†…å­˜ï¼ˆStack Memoryï¼‰</strong>   åˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼ˆå¦‚å‡½æ•°è°ƒç”¨æ ˆçš„å‹æ ˆå’Œå‡ºæ ˆï¼‰ã€‚ä¸‹é¢æˆ‘ä¼šä» <strong>å›æ”¶ç›®æ ‡ã€å›æ”¶ç®—æ³•ã€å†…å­˜æ³„æ¼</strong>   ç­‰æ–¹é¢è¯¦ç»†è®²è§£ï¼Œå¹¶ç»™å‡ºå…·ä½“ç¤ºä¾‹ã€‚</p>\n<hr>\n<h2>ä¸€ã€ä¸ºä»€ä¹ˆä¸»è¦é’ˆå¯¹å †å†…å­˜ï¼Ÿ</h2>\n<h3>âœ… <strong>æ ˆå†…å­˜ vs å †å†…å­˜ çš„å›æ”¶æ–¹å¼</strong></h3>\n<table>\n<thead>\n<tr>\n<th>å†…å­˜åŒºåŸŸ</th>\n<th>å­˜å‚¨å†…å®¹</th>\n<th>å›æ”¶æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ ˆå†…å­˜</strong></td>\n<td>åŸºæœ¬ç±»å‹å€¼ã€å‡½æ•°è°ƒç”¨æ ˆå¸§</td>\n<td><strong>è‡ªåŠ¨å³æ—¶å›æ”¶</strong>   ï¼ˆå‡½æ•°æ‰§è¡Œå®Œç«‹å³é‡Šæ”¾ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å †å†…å­˜</strong></td>\n<td>å¯¹è±¡ã€æ•°ç»„ç­‰å¼•ç”¨ç±»å‹</td>\n<td><strong>åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å®šæœŸæ‰«æ</strong></td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><strong>æ ˆå†…å­˜</strong>   ï¼šå‡½æ•°æ‰§è¡Œæ—¶åˆ›å»ºï¼Œæ‰§è¡Œå®Œæ¯•ç«‹å³é‡Šæ”¾ï¼Œ<strong>ä¸¥æ ¼éµå¾ª LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰è§„åˆ™</strong>   ï¼Œæ— éœ€åƒåœ¾å›æ”¶ã€‚</li>\n<li><strong>å †å†…å­˜</strong>   ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸ç¡®å®šï¼Œå¯èƒ½è¢«å¤šä¸ªå˜é‡å¼•ç”¨ï¼Œ<strong>å¿…é¡»é€šè¿‡ GC æœºåˆ¶å›æ”¶</strong>   ã€‚</li>\n</ul>\n<hr>\n<h2>äºŒã€JavaScript çš„åƒåœ¾å›æ”¶ç®—æ³•</h2>\n<h3>1. <strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-and-Sweepï¼‰</strong>   ï¼ˆä¸»æµç®—æ³•ï¼‰</h3>\n<p><strong>æ­¥éª¤</strong>   ï¼š</p>\n<ol>\n<li><strong>æ ‡è®°</strong>   ï¼šä»æ ¹å¯¹è±¡ï¼ˆå¦‚ <code>window</code>ã€å…¨å±€å˜é‡ï¼‰å‡ºå‘ï¼Œé€’å½’æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚</li>\n<li><strong>æ¸…é™¤</strong>   ï¼šéå†å †å†…å­˜ï¼Œåˆ é™¤æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼ˆä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚</li>\n</ol>\n<p><strong>ç¤ºä¾‹</strong>   ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">let</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> }; <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobj å˜é‡åœ¨æ ˆä¸­å­˜å¼•ç”¨</span>\nobj = <span class="hljs-literal">null</span>; <span class="hljs-comment">// è§£é™¤å¼•ç”¨ï¼Œå †ä¸­çš„ { name: &#x27;Alice&#x27; } å˜æˆä¸å¯è¾¾ï¼Œä¸‹æ¬¡ GC æ—¶è¢«å›æ”¶</span>\n</code></pre>\n<h3>2. <strong>å¼•ç”¨è®¡æ•°ï¼ˆReference Countingï¼‰</strong>   ï¼ˆå·²æ·˜æ±°ï¼‰</h3>\n<p><strong>åŸç†</strong>   ï¼šè®°å½•æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼Œå½“æ¬¡æ•°å½’é›¶æ—¶å›æ”¶ã€‚<br>\n<strong>ç¼ºé™·</strong>   ï¼šæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¼•ç”¨è®¡æ•°æ— æ³•å›æ”¶ï¼‰</span>\n<span class="hljs-keyword">let</span> a = {};\n<span class="hljs-keyword">let</span> b = {};\na.<span class="hljs-property">child</span> = b; <span class="hljs-comment">// a å¼•ç”¨ b</span>\nb.<span class="hljs-property">parent</span> = a; <span class="hljs-comment">// b å¼•ç”¨ a</span>\na = b = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å³ä½¿æ‰‹åŠ¨è§£é™¤ï¼Œå¼•ç”¨è®¡æ•°ä»ä¸º 1</span>\n</code></pre>\n<h3>3. <strong>åˆ†ä»£å›æ”¶ï¼ˆGenerational Collectionï¼‰</strong>   ï¼ˆV8 å¼•æ“ä¼˜åŒ–ï¼‰</h3>\n<ul>\n<li><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong>   ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨ <strong>Scavenge ç®—æ³•</strong>   ï¼ˆå¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°å¦ä¸€åŠç©ºé—´ï¼‰ã€‚</li>\n<li><strong>è€ç”Ÿä»£ï¼ˆOld Generationï¼‰</strong>   ï¼šå­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œç”¨ <strong>æ ‡è®°-æ¸…é™¤/æ ‡è®°-æ•´ç†</strong>   ã€‚</li>\n</ul>\n<hr>\n<h2>ä¸‰ã€å“ªäº›æƒ…å†µä¼šå¯¼è‡´å †å†…å­˜æ³„æ¼ï¼Ÿ</h2>\n<h3>ğŸš¨ <strong>å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯</strong></h3>\n<h4>1. <strong>æ„å¤–çš„å…¨å±€å˜é‡</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">leak</span>(<span class="hljs-params"></span>) {\n  leakedVar = <span class="hljs-string">&quot;I am global!&quot;</span>; <span class="hljs-comment">// æœªç”¨ var/let/constï¼Œå˜æˆ window.leakedVar</span>\n}\n</code></pre>\n<h4>2. <strong>æœªæ¸…ç†çš„å®šæ—¶å™¨/äº‹ä»¶ç›‘å¬</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// å®šæ—¶å™¨æœªæ¸…é™¤</span>\n<span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {}, <span class="hljs-number">1000</span>);\n<span class="hljs-comment">// å¿˜è®° clearInterval(timer);</span>\n\n<span class="hljs-comment">// äº‹ä»¶ç›‘å¬æœªç§»é™¤</span>\nbutton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, onClick);\n<span class="hljs-comment">// å¿˜è®° removeEventListener</span>\n</code></pre>\n<h4>3. <strong>é—­åŒ…æŒæœ‰å¤–éƒ¨å˜é‡</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createClosure</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> bigData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-string">&quot;data&quot;</span>);\n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bigData[<span class="hljs-number">0</span>]); <span class="hljs-comment">// é—­åŒ…æŒæœ‰ bigDataï¼Œå³ä½¿å‡½æ•°æ‰§è¡Œå®Œä¹Ÿä¸ä¼šé‡Šæ”¾</span>\n}\n<span class="hljs-keyword">const</span> closure = <span class="hljs-title function_">createClosure</span>(); <span class="hljs-comment">// bigData ä¸€ç›´è¢«å¼•ç”¨</span>\n</code></pre>\n<h4>4. <strong>DOM å¼•ç”¨æœªé‡Šæ”¾</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> elements = {\n  <span class="hljs-attr">button</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;myButton&quot;</span>), <span class="hljs-comment">// å³ä½¿ DOM è¢«åˆ é™¤ï¼Œelements.button ä»å¼•ç”¨å®ƒ</span>\n};\n<span class="hljs-comment">// è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨ç½®ç©º elements.button = null;</span>\n</code></pre>\n<hr>\n<h2>å››ã€å¦‚ä½•æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿï¼ˆä»…è°ƒè¯•ç”¨ï¼‰</h2>\n<h3>âš ï¸ æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// æµè§ˆå™¨ç¯å¢ƒï¼ˆéæ ‡å‡† APIï¼‰</span>\n<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">global</span>.<span class="hljs-property">gc</span> === <span class="hljs-string">&quot;function&quot;</span>) {\n  <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>(); <span class="hljs-comment">// Chrome é€šè¿‡ --expose-gc å¯åŠ¨æ—¶å¯ç”¨</span>\n}\n\n<span class="hljs-comment">// Node.js ç¯å¢ƒ</span>\n<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">global</span>.<span class="hljs-property">gc</span>) {\n  <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>();\n}\n</code></pre>\n<hr>\n<h2>äº”ã€æœ€ä½³å®è·µï¼šé¿å…å†…å­˜æ³„æ¼</h2>\n<ol>\n<li><strong>åŠæ—¶è§£é™¤å¼•ç”¨</strong>   ï¼š<pre><code class="language-javascript"><span class="hljs-keyword">let</span> data = <span class="hljs-title function_">loadHugeData</span>();\n<span class="hljs-title function_">processData</span>(data);\ndata = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä½¿ç”¨åæ‰‹åŠ¨è§£é™¤</span>\n</code></pre>\n</li>\n<li><strong>ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakMap/WeakSetï¼‰</strong>   ï¼š<pre><code class="language-javascript"><span class="hljs-keyword">const</span> weakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();\nweakMap.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;temp&quot;</span>), <span class="hljs-string">&quot;info&quot;</span>); <span class="hljs-comment">// DOM ç§»é™¤åè‡ªåŠ¨å›æ”¶</span>\n</code></pre>\n</li>\n<li><strong>é¿å…æ»¥ç”¨é—­åŒ…</strong>   ï¼šç¡®ä¿é—­åŒ…å†…ä¸æŒæœ‰å¤§å¯¹è±¡ã€‚</li>\n</ol>\n<hr>\n<h2>âœ… æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>å…³é”®ç‚¹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>GC ç›®æ ‡</strong></td>\n<td>ä¸»è¦ç®¡ç†å †å†…å­˜ï¼Œæ ˆå†…å­˜ç”±ç³»ç»Ÿè‡ªåŠ¨å›æ”¶</td>\n</tr>\n<tr>\n<td><strong>å›æ”¶ç®—æ³•</strong></td>\n<td>æ ‡è®°-æ¸…é™¤ï¼ˆä¸»æµï¼‰ã€åˆ†ä»£å›æ”¶ï¼ˆV8 ä¼˜åŒ–ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å†…å­˜æ³„æ¼åœºæ™¯</strong></td>\n<td>å…¨å±€å˜é‡ã€æœªæ¸…ç†çš„å®šæ—¶å™¨/äº‹ä»¶ã€é—­åŒ…ã€DOM å¼•ç”¨</td>\n</tr>\n<tr>\n<td><strong>æ£€æµ‹å·¥å…·</strong></td>\n<td>Chrome DevTools Memory é¢æ¿ã€Node.js çš„ <code>process.memoryUsage()</code></td>\n</tr>\n<tr>\n<td><strong>ä¼˜åŒ–å»ºè®®</strong></td>\n<td>åŠæ—¶è§£é™¤å¼•ç”¨ã€ä½¿ç”¨å¼±å¼•ç”¨ã€é¿å…å¾ªç¯å¼•ç”¨</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<p>ğŸ” <strong>å¦‚æœä½ æƒ³çŸ¥é“å¦‚ä½•ç”¨ Chrome DevTools åˆ†æå†…å­˜æ³„æ¼ï¼Œæˆ–æƒ³æ·±å…¥äº†è§£ V8 çš„åƒåœ¾å›æ”¶ç»†èŠ‚ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼</strong></p>\n</div>'</script></body></html>