<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3fb520=_0x1a66;function _0x1a66(p,s){var c=_0x274d();return(_0x1a66=function(s,a){var n=c[s-=126];void 0===_0x1a66.XKESuu&&(_0x1a66.gvnNOM=function(s,a){var n,l=[],p=0,c="";for(s=(s=>{for(var a,n,l="",p="",c=0,t=0;n=s.charAt(t++);~n&&(a=c%4?64*a+n:n,c++%4)&&(l+=String.fromCharCode(255&a>>(-2*c&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,o=l.length;e<o;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)p=(p+l[t]+a.charCodeAt(t%a.length))%256,n=l[t],l[t]=l[p],l[p]=n;for(var t=0,p=0,e=0;e<s.length;e++)n=l[t=(t+1)%256],l[t]=l[p=(p+l[t])%256],l[p]=n,c+=String.fromCharCode(s.charCodeAt(e)^l[(l[t]+l[p])%256]);return c},p=arguments,_0x1a66.XKESuu=!0);var s=s+c[0],l=p[s];return l?n=l:(void 0===_0x1a66.SRwDON&&(_0x1a66.SRwDON=!0),n=_0x1a66.gvnNOM(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x1a66,a=_0x274d();;)try{if(860233==-parseInt(s(132,"GR(2"))*(parseInt(s(135,"JSp0"))/2)+parseInt(s(151,"1*v%"))/3*(-parseInt(s(126,"le3i"))/4)+parseInt(s(136,"P!&f"))/5+-parseInt(s(140,"3r)a"))/6*(-parseInt(s(137,"t@ER"))/7)+parseInt(s(144,"x0x^"))/8+parseInt(s(149,"le3i"))/9*(parseInt(s(143,"3E8H"))/10)+-parseInt(s(129,"(0l3"))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x3fb520(138,"EC)C")](_0x3fb520(131,"$4*Q"))!=_0x3fb520(148,"mGtt"))throw window[_0x3fb520(130,"DaKg")][_0x3fb520(128,"JSp0")](_0x3fb520(145,"#sy1")),Error();function _0x274d(){var s=["qeSSW58Zg8ofEG","z2HrW79KrSooW4j4WRdcLCouW4a","hCoLWRJdNmkyWP9sqv3dIvtcTG","W7O7omoFW4maaa","WOJdV1KxcdCVW7r3W5jorq","mgxdSYFdJSo7ng4","aqjxkb4XW54CWOdcGHlcQNpcUW","W7Xcj1mhWOFdONlcHNddPCkoza","W7LcAajgW6tcJKu","wKtcVbBdSaaLWP7dVr3cUv3cKW","hSo9WPlcIMhdMXpcSSoGf8oHW6qXWRHWW5r2WR1yibauWPtcNWJcGa","W4b/cWPsDx3cKq","A8oVDuyNDKfZESoA","W7hdUSkfW7Kg","WOVdJ8k3BSo0W7xcSJKaW4DsW4RdNW","W4DdWQhdJGddICo3B8kIW6VcLtdcHq","WPtcTCkqW68QahXtWQOsWRC5","FHRdNCodWRncWOeW","WO7dH8oLlCkgWRRdRX4","W4FdISkYiXlcRdTV","abWzW6S+gCoo","kYxdGr8tWPxdSsjCW7BdSCoLzXS","sfWbW7KCz0va","WOtdSgChW48EbmoKWOK","W4n/sv1lCexcThC9","r00fW5m8fSo+Fq","BNmsWOSjW7HpwColfSoSfmoH"];return(_0x274d=function(){return s})()}document.title="js JSON.parse(JSON.stringify()) 深拷贝的缺点",document.getElementById("article").innerHTML='<div><h1><code>JSON.parse(JSON.stringify())</code> 深拷贝的缺点</h1>\n<p><code>JSON.parse(JSON.stringify())</code> 是一种常用的简单深拷贝方法，但它存在许多重要的局限性，在复杂场景下可能导致问题。以下是其主要缺点：</p>\n<h2>一、数据类型丢失问题</h2>\n<h3>1. 函数属性丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = {\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John&quot;</span>,\n  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hi&quot;</span>); }\n};\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">sayHi</span>); <span class="hljs-comment">// undefined</span>\n</code></pre>\n<h3>2. Symbol 类型丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&quot;id&quot;</span>);\n<span class="hljs-keyword">const</span> obj = { [id]: <span class="hljs-number">123</span> };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy[id]); <span class="hljs-comment">// undefined</span>\n</code></pre>\n<h3>3. undefined 值丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">value</span>: <span class="hljs-literal">undefined</span> };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy); <span class="hljs-comment">// {}</span>\n</code></pre>\n<h3>4. BigInt 会抛出错误</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">large</span>: <span class="hljs-number">123n</span> }; <span class="hljs-comment">// BigInt</span>\n<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj)); <span class="hljs-comment">// 抛出 TypeError</span>\n</code></pre>\n<h2>二、特殊对象处理问题</h2>\n<h3>1. Date 对象转为字符串</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> copy.<span class="hljs-property">date</span>); <span class="hljs-comment">// &quot;string&quot; 而不是 &quot;object&quot;</span>\n</code></pre>\n<h3>2. RegExp 对象转为空对象</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/test/g</span> };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">pattern</span>); <span class="hljs-comment">// {}</span>\n</code></pre>\n<h3>3. Map/Set/WeakMap/WeakSet 丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">map</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>]]) };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">map</span>); <span class="hljs-comment">// {}</span>\n</code></pre>\n<h3>4. ArrayBuffer 和其他二进制数据丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">buffer</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>) };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">buffer</span>); <span class="hljs-comment">// {}</span>\n</code></pre>\n<h2>三、引用关系问题</h2>\n<h3>1. 循环引用导致错误</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;John&quot;</span> };\nobj.<span class="hljs-property">self</span> = obj;\n<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj)); <span class="hljs-comment">// 抛出 TypeError</span>\n</code></pre>\n<h3>2. 相同引用变为不同对象</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> child = { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> };\n<span class="hljs-keyword">const</span> parent = { <span class="hljs-attr">child1</span>: child, <span class="hljs-attr">child2</span>: child };\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(parent));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">child1</span> === copy.<span class="hljs-property">child2</span>); <span class="hljs-comment">// false (原对象中是true)</span>\n</code></pre>\n<h2>四、原型链问题</h2>\n<h3>1. 原型链完全丢失</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }\n  <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello&quot;</span>); }\n}\n<span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;John&quot;</span>);\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(john));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// false</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(copy.<span class="hljs-property">greet</span>); <span class="hljs-comment">// undefined</span>\n</code></pre>\n<h2>五、性能问题</h2>\n<h3>1. 大数据量性能低下</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 大型数组或对象处理效率低</span>\n<span class="hljs-keyword">const</span> largeArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;test&quot;</span> });\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">&quot;JSON copy&quot;</span>);\n<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(largeArray));\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">&quot;JSON copy&quot;</span>); <span class="hljs-comment">// 可能花费数百毫秒</span>\n</code></pre>\n<h2>六、替代方案</h2>\n<h3>1. 使用结构化克隆算法</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 现代浏览器支持的API</span>\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title function_">structuredClone</span>(obj); <span class="hljs-comment">// 支持更多类型但仍有限制</span>\n</code></pre>\n<h3>2. 使用 Lodash 的深拷贝</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { cloneDeep } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;\n<span class="hljs-keyword">const</span> copy = <span class="hljs-title function_">cloneDeep</span>(obj); <span class="hljs-comment">// 处理更多特殊情况</span>\n</code></pre>\n<h3>3. 自定义深拷贝函数</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj, hash = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) {\n  <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&#x27;object&#x27;</span>) <span class="hljs-keyword">return</span> obj;\n  <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(obj);\n  <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(obj);\n  <span class="hljs-keyword">if</span> (hash.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> hash.<span class="hljs-title function_">get</span>(obj);\n  \n  <span class="hljs-keyword">const</span> clone = <span class="hljs-keyword">new</span> obj.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>);\n  hash.<span class="hljs-title function_">set</span>(obj, clone);\n  \n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {\n    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {\n      clone[key] = <span class="hljs-title function_">deepClone</span>(obj[key], hash);\n    }\n  }\n  \n  <span class="hljs-keyword">return</span> clone;\n}\n</code></pre>\n<h2>总结</h2>\n<p><code>JSON.parse(JSON.stringify())</code> 的适用场景：</p>\n<ul>\n<li>简单对象（仅含基本类型、数组和普通对象）</li>\n<li>不需要保留函数、特殊对象或原型链</li>\n<li>确保没有循环引用</li>\n</ul>\n<p>不适用场景：</p>\n<ul>\n<li>包含函数、Symbol、特殊对象</li>\n<li>需要保持引用关系</li>\n<li>需要保留原型链</li>\n<li>处理大型数据结构</li>\n</ul>\n<p>在实际开发中，应根据具体需求选择合适的深拷贝方法。</p>\n</div>'</script></body></html>