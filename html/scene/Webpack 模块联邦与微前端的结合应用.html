<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x211386=_0xe6e1;function _0xe6e1(l,s){var p=_0x1220();return(_0xe6e1=function(s,n){var a=p[s-=388];void 0===_0xe6e1.WKMvXQ&&(_0xe6e1.YIqPTw=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,o=0;a=s.charAt(o++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,c=t.length;e<c;e++)l+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),o=0;o<256;o++)t[o]=o;for(o=0;o<256;o++)l=(l+t[o]+n.charCodeAt(o%n.length))%256,a=t[o],t[o]=t[l],t[l]=a;for(var o=0,l=0,e=0;e<s.length;e++)a=t[o=(o+1)%256],t[o]=t[l=(l+t[o])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(e)^t[(t[o]+t[l])%256]);return p},l=arguments,_0xe6e1.WKMvXQ=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0xe6e1.YLGeLM&&(_0xe6e1.YLGeLM=!0),a=_0xe6e1.YIqPTw(a,n),l[s]=a),a})(l,s)}if((()=>{for(var s=_0xe6e1,n=_0x1220();;)try{if(968415==-parseInt(s(391,"TsKQ"))+-parseInt(s(393,"RSS]"))/2*(parseInt(s(399,"l90A"))/3)+parseInt(s(405,"]**y"))/4*(-parseInt(s(402,"e7nZ"))/5)+parseInt(s(407,"QLOD"))/6+parseInt(s(406,"E*5L"))/7*(-parseInt(s(397,"6b6^"))/8)+parseInt(s(395,"Gspa"))/9+parseInt(s(392,"hjfv"))/10*(parseInt(s(414,"4xJf"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x211386(412,"Uq(D")](_0x211386(396,"jn8$"))!=_0x211386(398,"&Cl9"))throw window[_0x211386(394,"DCMd")][_0x211386(413,"Orjh")](_0x211386(388,"!uHc")),Error();function _0x1220(){var s=["iSoNuSoxmmo0W7xcQ1G","W5L7CSofqa","DSkcf8oNcedcPW","W6hdKfmla3lcL14sWQugra","WQbUcqNdPINcSrzcBsHg","y8kFW7FdVmkyW5dcGHnqCG","kCkueSoGn8o/W7u","WQDTaGJdOcNdHqrTssH9eW","W7ddRSoQqSoTArqZW44Peq","gCkTW41lhdWEmZKJkCk1","o8oGWRNdT8ocFmkmrIRcKCkqkmkS","WQbNaWNcH1hcMZL5CG","W6hdVhJcM8k1W4pdM8ovWRNdPtG","emkmrCo1wKKkeCkb","WPNcM8otcCorW7NdTCoLtJ4i","vcS0m8oiW5WI","WOjfW7bKlL3cPW","nmotW6JdUIlcQxbynCkdfW","WQvnWORcJWqGW7OffI4qba","omkNWR9IC8ouW6rJWQNcNSoBdqH4kmoyW4lcUmoQWPZdH1uIWP/cSmka","WRj/W57dVSkDuCoxW4lcUmoyW5xdV8kX","WPG2omkdd8o8WPpcP8kDB0O","kYH9sNBcMX9xDWFcGbK","WQboWOFcJGnuW60xdt0b","WONcG3JcUmoMv8oHa0u7Fti","nmoxW5mTc0pdL8kl","CK1FlmkyWONdLSoBW45qECotra","W6NdJmkbw8kBW77dTCopuq"];return(_0x1220=function(){return s})()}document.title="Webpack 模块联邦与微前端的结合应用",document.getElementById("article").innerHTML='<div><p>Webpack 模块联邦(Module Federation)是 Webpack 5 引入的一项革命性功能，它特别适合与微前端架构结合使用，但也可以用于其他场景。下面我将详细介绍它们的关系和典型应用方式。</p>\n<h2>模块联邦的核心概念</h2>\n<p>模块联邦允许不同的 Webpack 构建产物(通常是不同的应用)在运行时共享模块，具有以下特点：</p>\n<ol>\n<li><strong>动态模块加载</strong>   ：应用可以运行时从其他应用加载所需模块</li>\n<li><strong>共享依赖</strong>   ：避免重复加载相同依赖</li>\n<li><strong>独立部署</strong>   ：每个应用可以独立开发部署</li>\n</ol>\n<h2>与微前端架构的关系</h2>\n<h3>典型结合方式</h3>\n<ol>\n<li>\n<p><strong>作为微前端的模块共享机制</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// app1的webpack配置 (模块提供方)</span>\n<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app1&quot;</span>,\n  <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>,\n  <span class="hljs-attr">exposes</span>: {\n    <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button&quot;</span>,\n    <span class="hljs-string">&quot;./Store&quot;</span>: <span class="hljs-string">&quot;./src/store&quot;</span>,\n  },\n});\n\n<span class="hljs-comment">// app2的webpack配置 (模块消费方)</span>\n<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app2&quot;</span>,\n  <span class="hljs-attr">remotes</span>: {\n    <span class="hljs-attr">app1</span>: <span class="hljs-string">&quot;app1@http://localhost:3001/remoteEntry.js&quot;</span>,\n  },\n});\n</code></pre>\n</li>\n<li>\n<p><strong>实现微前端子应用集成</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 主应用动态加载子应用</span>\n<span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;app1/Button&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">Button</span>) =&gt;</span> {\n  <span class="hljs-comment">// 使用来自app1的Button组件</span>\n});\n</code></pre>\n</li>\n</ol>\n<h3>优势对比传统微前端方案</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>模块联邦方案</th>\n<th>传统微前端(iframe/路由分发)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>开发体验</td>\n<td>统一技术栈，热更新保持</td>\n<td>上下文隔离，开发体验割裂</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>依赖共享，无重复加载</td>\n<td>各自独立加载，资源冗余</td>\n</tr>\n<tr>\n<td>通信成本</td>\n<td>直接调用API/组件</td>\n<td>需postMessage等跨域通信</td>\n</tr>\n<tr>\n<td>样式隔离</td>\n<td>需要额外处理</td>\n<td>天然隔离</td>\n</tr>\n<tr>\n<td>部署独立性</td>\n<td>完全独立</td>\n<td>依赖主应用协调</td>\n</tr>\n</tbody>\n</table>\n<h2>实际应用场景</h2>\n<h3>1. 跨应用组件共享</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 组件提供方配置</span>\n<span class="hljs-attr">exposes</span>: {\n  <span class="hljs-string">&#x27;./Header&#x27;</span>: <span class="hljs-string">&#x27;./src/components/Header&#x27;</span>,\n  <span class="hljs-string">&#x27;./Footer&#x27;</span>: <span class="hljs-string">&#x27;./src/components/Footer&#x27;</span>\n}\n\n<span class="hljs-comment">// 组件消费方使用</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">Header</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;designSystem/Header&#x27;</span>));\n</code></pre>\n<h3>2. 状态管理共享</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 主应用暴露store</span>\n<span class="hljs-attr">exposes</span>: {\n  <span class="hljs-string">&#x27;./store&#x27;</span>: <span class="hljs-string">&#x27;./src/store&#x27;</span>\n}\n\n<span class="hljs-comment">// 子应用使用共享store</span>\n<span class="hljs-keyword">import</span> { store } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;hostApp/store&#x27;</span>;\n</code></pre>\n<h3>3. 动态路由加载</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 子应用暴露路由配置</span>\n<span class="hljs-attr">exposes</span>: {\n  <span class="hljs-string">&#x27;./routes&#x27;</span>: <span class="hljs-string">&#x27;./src/routes&#x27;</span>\n}\n\n<span class="hljs-comment">// 主应用动态聚合路由</span>\n<span class="hljs-keyword">const</span> routes = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([\n  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;app1/routes&#x27;</span>),\n  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;app2/routes&#x27;</span>)\n]);\n</code></pre>\n<h2>配置示例</h2>\n<h3>基础Webpack配置</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// webpack.config.js (提供方)</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ModuleFederationPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>).<span class="hljs-property">container</span>;\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app1&quot;</span>,\n      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>,\n      <span class="hljs-attr">exposes</span>: {\n        <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button&quot;</span>,\n      },\n      <span class="hljs-attr">shared</span>: {\n        <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n        <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n      },\n    }),\n  ],\n};\n\n<span class="hljs-comment">// webpack.config.js (消费方)</span>\n<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app2&quot;</span>,\n  <span class="hljs-attr">remotes</span>: {\n    <span class="hljs-attr">app1</span>: <span class="hljs-string">&quot;app1@http://localhost:3001/remoteEntry.js&quot;</span>,\n  },\n  <span class="hljs-attr">shared</span>: {\n    <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n    <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span> },\n  },\n});\n</code></pre>\n<h3>动态远程加载</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动态设置remote</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadRemote</span>(<span class="hljs-params">remoteName, remoteUrl</span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);\n    script.<span class="hljs-property">src</span> = remoteUrl;\n    script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-keyword">const</span> proxy = {\n        <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">request</span>) =&gt;</span> <span class="hljs-variable language_">window</span>[remoteName].<span class="hljs-title function_">get</span>(request),\n        <span class="hljs-attr">init</span>: <span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> {\n          <span class="hljs-keyword">try</span> {\n            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>[remoteName].<span class="hljs-title function_">init</span>(arg);\n          } <span class="hljs-keyword">catch</span> (e) {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Remote container already initialized&quot;</span>);\n          }\n        },\n      };\n      <span class="hljs-title function_">resolve</span>(proxy);\n    };\n    script.<span class="hljs-property">onerror</span> = reject;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);\n  });\n}\n\n<span class="hljs-comment">// 使用方式</span>\n<span class="hljs-keyword">const</span> remote = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadRemote</span>(<span class="hljs-string">&quot;app1&quot;</span>, <span class="hljs-string">&quot;http://localhost:3001/remoteEntry.js&quot;</span>);\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">Button</span> = <span class="hljs-keyword">await</span> remote.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;./Button&quot;</span>);\n</code></pre>\n<h2>最佳实践</h2>\n<ol>\n<li>\n<p><strong>版本控制</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">shared</span>: {\n  <span class="hljs-attr">react</span>: {\n    <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&#x27;^17.0.0&#x27;</span>\n  }\n}\n</code></pre>\n</li>\n<li>\n<p><strong>错误处理</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Button</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span>\n  <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;app1/Button&quot;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./components/FallbackButton&quot;</span>)),\n);\n</code></pre>\n</li>\n<li>\n<p><strong>性能优化</strong>   ：</p>\n<ul>\n<li>预加载remoteEntry</li>\n<li>使用共享依赖减少包大小</li>\n</ul>\n</li>\n<li>\n<p><strong>开发环境配置</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">remotes</span>: {\n  <span class="hljs-attr">app1</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span>\n    ? <span class="hljs-string">&quot;app1@http://localhost:3001/remoteEntry.js&quot;</span>\n    : <span class="hljs-string">&quot;app1@https://prod.com/remoteEntry.js&quot;</span>;\n}\n</code></pre>\n</li>\n</ol>\n<h2>注意事项</h2>\n<ol>\n<li>\n<p><strong>样式隔离问题</strong>   ：</p>\n<ul>\n<li>考虑使用CSS Modules或Shadow DOM</li>\n<li>或采用命名空间约定</li>\n</ul>\n</li>\n<li>\n<p><strong>TypeScript支持</strong>   ：</p>\n<pre><code class="language-json"><span class="hljs-comment">// tsconfig.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;app1/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;../app1/src/*&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li>\n<p><strong>生产环境部署</strong>   ：</p>\n<ul>\n<li>确保CDN配置正确</li>\n<li>处理跨域问题</li>\n<li>考虑版本化部署</li>\n</ul>\n</li>\n</ol>\n<p>模块联邦为微前端提供了一种更加灵活和高效的实现方式，特别适合需要深度集成的微前端场景，但也需要权衡其复杂性和对技术栈统一的要求。</p>\n</div>'</script></body></html>