<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x4c89c7=_0x1985;function _0x28e4(){var s=["ACoWW6z4WRhcIrBdIK4N","WO7dR8kCECoLW6VdQerB","aSofimkntW8hWQvCheG","zSo3W6f6W6pdTxZdN3yzxsC2","WR1taSkoWO5gdSk/dCo1ESooWQHY","WQNcTmoiW6CXkvW","WQlcSuqltJGkWPVdT8oMWQhdHW","l1pcVdddUmk9W78AzSoS","CLj7W5FcPCogA2Cz","l8o3cCouW4ZcQvnuwmkfWOmwW40","W4ZcP8klANa","WOXqWQldOw43wMNdHrj7omo8","nWa/W4VcKmogya","uCkMWPVcHmkAW4ZdQaq","WPNcH8oIW55pWRuGeSorAfC","WOzVW7VdUeFcV8kuEga","WOD3mCoBtSksva","W58UWR3dOfhdRSowaeJdVSoqoSkfW7SojrDjWPJcNHtdJ8k7kY3cTG","W7nqW5DzFa8+DCkgvCkGW5u","fqtcLCoLWOxdU8ooiCoPhv3cNmk0","WP3dVSk2WRCOWRCo","sGalyCo7tCoV","WOtdGhjtwaTPpbddP8ohW75ppW","W5VdItmXC8ktyq","WO3cMxuqySkDyCkvW6K","WPCAgmoyW41Px1ldSmoojCkHW6e","WQZdQSkWW40ghNGSWQK"];return(_0x28e4=function(){return s})()}function _0x1985(t,s){var e=_0x28e4();return(_0x1985=function(s,n){var a=e[s-=420];void 0===_0x1985.JKliLW&&(_0x1985.vMourY=function(s,n){var a,l=[],t=0,e="";for(s=(s=>{for(var n,a,l="",t="",e=0,o=0;a=s.charAt(o++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,p=l.length;c<p;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)t=(t+l[o]+n.charCodeAt(o%n.length))%256,a=l[o],l[o]=l[t],l[t]=a;for(var o=0,t=0,c=0;c<s.length;c++)a=l[o=(o+1)%256],l[o]=l[t=(t+l[o])%256],l[t]=a,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[o]+l[t])%256]);return e},t=arguments,_0x1985.JKliLW=!0);var s=s+e[0],l=t[s];return l?a=l:(void 0===_0x1985.ZQfdLz&&(_0x1985.ZQfdLz=!0),a=_0x1985.vMourY(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x1985,n=_0x28e4();;)try{if(768896==+parseInt(s(438,"o(nL"))*(-parseInt(s(429,"0I*0"))/2)+parseInt(s(445,"Tg84"))/3*(-parseInt(s(433,"UR@K"))/4)+-parseInt(s(424,")e#E"))/5*(-parseInt(s(423,"0I*0"))/6)+-parseInt(s(442,"L0B5"))/7*(parseInt(s(439,"$)K6"))/8)+parseInt(s(443,"EJmS"))/9+-parseInt(s(427,")e#E"))/10+parseInt(s(428,"rbW!"))/11)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x4c89c7(420,"8EB]")](_0x4c89c7(425,"R3uY"))!=_0x4c89c7(434,"4k!Z"))throw window[_0x4c89c7(437,"8aun")][_0x4c89c7(436,"mJBi")](_0x4c89c7(441,"$)K6")),Error();document.title="#__PURE__ 标记详解",document.getElementById("article").innerHTML='<div><p><code>/*#__PURE__*/</code> 是一个<strong>编译时标记</strong>   ，用于告知构建工具（如 Webpack、Rollup、Terser）<strong>某个函数调用或表达式是“纯”的</strong>   （无副作用），如果其返回值未被使用，则可以直接移除。</p>\n<hr>\n<h2><strong>1. 核心作用</strong></h2>\n<ul>\n<li><strong>Tree Shaking 辅助</strong>   ：帮助构建工具识别可以安全移除的代码。</li>\n<li><strong>副作用消除</strong>   ：标记无副作用的函数调用，避免被误保留。</li>\n</ul>\n<hr>\n<h2><strong>2. 使用场景</strong></h2>\n<h3><strong>(1) 标记 IIFE（立即执行函数）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 未标记：可能被保留（工具无法确定是否有副作用）</span>\n<span class="hljs-keyword">const</span> result = (<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">expensiveCalculation</span>();\n})();\n\n<span class="hljs-comment">// 标记后：如果 result 未被使用，整个 IIFE 会被移除</span>\n<span class="hljs-keyword">const</span> result = <span class="hljs-comment">/*#__PURE__*/</span> (<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">expensiveCalculation</span>();\n})();\n</code></pre>\n<h3><strong>(2) 标记构造函数或类实例化</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 未标记：可能被保留（工具不确定 new 是否有副作用）</span>\n<span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();\n\n<span class="hljs-comment">// 标记后：如果 instance 未被使用，new 操作会被移除</span>\n<span class="hljs-keyword">const</span> instance = <span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();\n</code></pre>\n<h3><strong>(3) 标记函数调用</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 未标记：工具可能保留该调用</span>\n<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">getValue</span>();\n\n<span class="hljs-comment">// 标记后：如果 value 未被使用，调用会被移除</span>\n<span class="hljs-keyword">const</span> value = <span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-title function_">getValue</span>();\n</code></pre>\n<hr>\n<h2><strong>3. 生效条件</strong></h2>\n<ul>\n<li><strong>必须用于函数调用或 <code>new</code> 表达式</strong>   ：<pre><code class="language-javascript"><span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// ✅ 有效</span>\n<span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cls</span>(); <span class="hljs-comment">// ✅ 有效</span>\n<span class="hljs-comment">/*#__PURE__*/</span> a + b; <span class="hljs-comment">// ❌ 无效（非函数调用）</span>\n</code></pre>\n</li>\n<li><strong>依赖压缩工具支持</strong>   ：\n<ul>\n<li>Webpack（通过 Terser 处理）</li>\n<li>Rollup/Vite（默认支持）</li>\n<li>需在生产模式下生效（<code>mode: \'production\'</code>）。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2><strong>4. 对比 <code>sideEffects</code></strong></h2>\n<table>\n<thead>\n<tr>\n<th><strong>特性</strong></th>\n<th><code>/*#__PURE__*/</code></th>\n<th><code>&quot;sideEffects&quot;: false</code> (package.json)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>作用范围</strong></td>\n<td>单个函数调用/表达式</td>\n<td>整个模块文件</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>局部优化</td>\n<td>全局声明模块无副作用</td>\n</tr>\n<tr>\n<td><strong>优先级</strong></td>\n<td>更高（直接标记具体代码）</td>\n<td>更低（模块级配置）</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>5. 实际示例</strong></h2>\n<h3><strong>未标记时的打包问题</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// utils.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unusedHelper</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;This is unused&quot;</span>);\n}\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> data = <span class="hljs-comment">/* 未标记 */</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;{&quot;key&quot;: &quot;value&quot;}&#x27;</span>);\n</code></pre>\n<p>即使 <code>unusedHelper</code> 未被导入，<code>JSON.parse</code> 可能因工具无法确定其纯度而被保留。</p>\n<h3><strong>标记后的优化</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// utils.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unusedHelper</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;This is unused&quot;</span>);\n}\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> data = <span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;{&quot;key&quot;: &quot;value&quot;}&#x27;</span>); <span class="hljs-comment">// 可被移除</span>\n</code></pre>\n<hr>\n<h2><strong>6. 如何验证是否生效？</strong></h2>\n<ol>\n<li><strong>生产环境构建</strong>   ：<pre><code class="language-bash">npx webpack --mode=production\n</code></pre>\n</li>\n<li><strong>检查输出代码</strong>   ：\n<ul>\n<li>搜索标记的函数调用，确认是否被移除。</li>\n</ul>\n</li>\n<li><strong>使用 Bundle Analyzer</strong>   ：<pre><code class="language-javascript"><span class="hljs-comment">// webpack.config.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">BundleAnalyzerPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-bundle-analyzer&quot;</span>);\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>()],\n};\n</code></pre>\n</li>\n</ol>\n<hr>\n<h2><strong>7. 注意事项</strong></h2>\n<ul>\n<li><strong>慎用于有副作用的代码</strong>   ：<pre><code class="language-javascript"><span class="hljs-comment">// ❌ 错误用法（副作用代码被错误标记）</span>\n<span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;This will disappear!&quot;</span>); <span class="hljs-comment">// 会被移除</span>\n</code></pre>\n</li>\n<li><strong>与 <code>@babel/plugin-transform-react-constant-elements</code> 配合</strong>   ：<br>\nReact 的常量元素优化会自动添加 <code>/*#__PURE__*/</code>。</li>\n</ul>\n<hr>\n<h2><strong>总结</strong></h2>\n<ul>\n<li><strong>何时用</strong>   ：需要手动提示工具“此代码可安全移除”时。</li>\n<li><strong>最佳实践</strong>   ：\n<ul>\n<li>对昂贵的计算、未使用的构造函数/IIFE 添加标记。</li>\n<li>结合 <code>&quot;sideEffects&quot;: false</code> 实现模块级优化。</li>\n</ul>\n</li>\n<li><strong>工具链依赖</strong>   ：确保生产环境构建且压缩工具支持（如 Terser）。</li>\n</ul>\n<p>通过合理使用 <code>/*#__PURE__*/</code>，可以进一步提升 Tree Shaking 效果，减少打包体积！</p>\n</div>'</script></body></html>