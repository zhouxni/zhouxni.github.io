<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x58b4(){var s=["iberFJ3cSCkoFG","WRuhbfzNWQZcTSoiWOz+W5C0","uaNdOKZdNtTvW5/cLcrpW73dIIO","WOqgz8kBrG","h29EW5BdICknfrK","W7uAWRNdGZZcPXPPWRHOvghdTNtdMK0LgCk3W6iknmo5EfKz","W63cKCkOWOVcVfmvrG","a8oSW4nxgConACkBWPn3WRVdNW","WQvzW7xcGN/cQ0ymWRTQwxC","WRlcOmkre8kCWQPK","xgqHohKgWQ/dN8oOh8oqW41D","W67cL8oHW53dTGruh8o7lSk5W5aqW4q","ifVcSHVcNNOQWORcRG","W5BcH8kQvv8JmG","cu0NAMtdU8k7jmoeoSonW58","cmoIW45qgmolBCkBWO5vWOZdNW","xgeHohamW7xdICoOd8oxW70","xZ1uW57dKSklbq","WPaxAmo+ESkgWR/dLSoHE8oOaG","W5ZcTCkOrfC8gq","ncFcVxTPW7PqW6lcGmkxW690","vWhdO0NdMZatWO3cNrj0W4W","hdFdV8oEqhzPW4XmWRNcR8kIba","cCkOWPW8zmkOCa","mmkIWQBdL8k3oSo2"];return(_0x58b4=function(){return s})()}function _0x53e7(e,s){var l=_0x58b4();return(_0x53e7=function(s,n){var a=l[s-=137];void 0===_0x53e7.AaaXlN&&(_0x53e7.IVsaMp=function(s,n){var a,t=[],e=0,l="";for(s=(s=>{for(var n,a,t="",e="",l=0,c=0;a=s.charAt(c++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var p=0,r=t.length;p<r;p++)e+="%"+("00"+t.charCodeAt(p).toString(16)).slice(-2);return decodeURIComponent(e)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)e=(e+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[e],t[e]=a;for(var c=0,e=0,p=0;p<s.length;p++)a=t[c=(c+1)%256],t[c]=t[e=(e+t[c])%256],t[e]=a,l+=String.fromCharCode(s.charCodeAt(p)^t[(t[c]+t[e])%256]);return l},e=arguments,_0x53e7.AaaXlN=!0);var s=s+l[0],t=e[s];return t?a=t:(void 0===_0x53e7.IsELfp&&(_0x53e7.IsELfp=!0),a=_0x53e7.IVsaMp(a,n),e[s]=a),a})(e,s)}var _0x45f067=_0x53e7;if((()=>{for(var s=_0x53e7,n=_0x58b4();;)try{if(209463==+parseInt(s(143,"yKsw"))*(-parseInt(s(140,"^15A"))/2)+parseInt(s(148,"ejQi"))/3*(-parseInt(s(158,"DS!b"))/4)+-parseInt(s(160,"lx[J"))/5+-parseInt(s(150,"oXQo"))/6+-parseInt(s(138,"s]zL"))/7*(-parseInt(s(155,"&gmE"))/8)+-parseInt(s(139,"VBI9"))/9+parseInt(s(153,"ejQi"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x45f067(141,"tc!^")](_0x45f067(154,"s]zL"))!=_0x45f067(145,"er9s"))throw window[_0x45f067(142,"&YeN")][_0x45f067(159,"G%F^")](_0x45f067(147,"oXQo")),Error();document.title="手写一个简易的 redux",document.getElementById("article").innerHTML='<div><p>下面是一个<strong>简易版 Redux</strong>   的实现，包含核心功能：</p>\n<ul>\n<li><code>createStore</code>（状态管理）</li>\n<li><code>combineReducers</code>（Reducer 合并）</li>\n<li><code>applyMiddleware</code>（中间件机制）</li>\n<li><code>bindActionCreators</code>（Action 创建器绑定）</li>\n</ul>\n<hr>\n<h2>1. <strong><code>createStore</code>（核心）</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createStore</span>(<span class="hljs-params">reducer, enhancer</span>) {\n  <span class="hljs-comment">// 如果传入了 enhancer（如 applyMiddleware），增强 store</span>\n  <span class="hljs-keyword">if</span> (enhancer) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">enhancer</span>(createStore)(reducer);\n  }\n\n  <span class="hljs-keyword">let</span> state = <span class="hljs-literal">undefined</span>;\n  <span class="hljs-keyword">const</span> listeners = [];\n\n  <span class="hljs-comment">// 获取当前状态</span>\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getState</span> = (<span class="hljs-params"></span>) =&gt; state;\n\n  <span class="hljs-comment">// 派发 Action，触发 Reducer 更新状态</span>\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">dispatch</span> = (<span class="hljs-params">action</span>) =&gt; {\n    state = <span class="hljs-title function_">reducer</span>(state, action);\n    listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>());\n  };\n\n  <span class="hljs-comment">// 订阅状态变化</span>\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">subscribe</span> = (<span class="hljs-params">listener</span>) =&gt; {\n    listeners.<span class="hljs-title function_">push</span>(listener);\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-keyword">const</span> index = listeners.<span class="hljs-title function_">indexOf</span>(listener);\n      listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);\n    };\n  };\n\n  <span class="hljs-comment">// 初始化状态</span>\n  <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;@@INIT&#x27;</span> });\n\n  <span class="hljs-keyword">return</span> { getState, dispatch, subscribe };\n}\n</code></pre>\n<hr>\n<h2>2. <strong><code>combineReducers</code>（合并 Reducers）</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">combineReducers</span>(<span class="hljs-params">reducers</span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">state = {}, action</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> newState = {};\n    <span class="hljs-keyword">let</span> hasChanged = <span class="hljs-literal">false</span>;\n    \n    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(reducers).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {\n      <span class="hljs-keyword">const</span> reducer = reducers[key];\n      <span class="hljs-keyword">const</span> prevState = state[key];\n      <span class="hljs-keyword">const</span> nextState = <span class="hljs-title function_">reducer</span>(prevState, action);\n      newState[key] = nextState;\n      hasChanged = hasChanged || nextState !== prevState;\n    });\n\n    <span class="hljs-keyword">return</span> hasChanged ? newState : state;\n  };\n}\n</code></pre>\n<hr>\n<h2>3. <strong><code>applyMiddleware</code>（中间件机制）</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">applyMiddleware</span>(<span class="hljs-params">...middlewares</span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">createStore</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">reducer</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(reducer);\n    <span class="hljs-keyword">let</span> dispatch = store.<span class="hljs-property">dispatch</span>;\n\n    <span class="hljs-comment">// 提供给中间件的 API</span>\n    <span class="hljs-keyword">const</span> middlewareAPI = {\n      <span class="hljs-attr">getState</span>: store.<span class="hljs-property">getState</span>,\n      <span class="hljs-attr">dispatch</span>: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(action),\n    };\n\n    <span class="hljs-comment">// 链式调用中间件</span>\n    <span class="hljs-keyword">const</span> chain = middlewares.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">middleware</span> =&gt;</span> <span class="hljs-title function_">middleware</span>(middlewareAPI));\n    dispatch = <span class="hljs-title function_">compose</span>(...chain)(store.<span class="hljs-property">dispatch</span>);\n\n    <span class="hljs-keyword">return</span> { ...store, dispatch };\n  };\n}\n\n<span class="hljs-comment">// 组合函数（从右到左执行）</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">compose</span>(<span class="hljs-params">...funcs</span>) {\n  <span class="hljs-keyword">return</span> funcs.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">a</span>(<span class="hljs-title function_">b</span>(...args)));\n}\n</code></pre>\n<hr>\n<h2>4. <strong><code>bindActionCreators</code>（绑定 Action 创建器）</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bindActionCreators</span>(<span class="hljs-params">actionCreators, dispatch</span>) {\n  <span class="hljs-keyword">const</span> boundActions = {};\n  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(actionCreators).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> actionCreator = actionCreators[key];\n    boundActions[key] = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">actionCreator</span>(...args));\n  });\n  <span class="hljs-keyword">return</span> boundActions;\n}\n</code></pre>\n<hr>\n<h2><strong>使用示例</strong></h2>\n<h3>定义 Reducer 和 Action</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// Reducer</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">counterReducer</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) {\n  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;INCREMENT&#x27;</span>:\n      <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;DECREMENT&#x27;</span>:\n      <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>;\n    <span class="hljs-attr">default</span>:\n      <span class="hljs-keyword">return</span> state;\n  }\n}\n\n<span class="hljs-comment">// Action Creator</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span> });\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"></span>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;DECREMENT&#x27;</span> });\n</code></pre>\n<h3>创建 Store 并测试</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 合并 Reducers（如果有多个）</span>\n<span class="hljs-keyword">const</span> rootReducer = <span class="hljs-title function_">combineReducers</span>({\n  <span class="hljs-attr">counter</span>: counterReducer,\n});\n\n<span class="hljs-comment">// 创建 Store</span>\n<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(rootReducer);\n\n<span class="hljs-comment">// 订阅状态变化</span>\nstore.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;State changed:&#x27;</span>, store.<span class="hljs-title function_">getState</span>());\n});\n\n<span class="hljs-comment">// 派发 Action</span>\nstore.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">increment</span>()); <span class="hljs-comment">// State changed: { counter: 1 }</span>\nstore.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">decrement</span>()); <span class="hljs-comment">// State changed: { counter: 0 }</span>\n</code></pre>\n<h3>使用中间件（如 Logger）</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 自定义中间件</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">logger</span> = (<span class="hljs-params">store</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">next</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Dispatching:&#x27;</span>, action);\n  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">next</span>(action);\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;New state:&#x27;</span>, store.<span class="hljs-title function_">getState</span>());\n  <span class="hljs-keyword">return</span> result;\n};\n\n<span class="hljs-comment">// 创建带中间件的 Store</span>\n<span class="hljs-keyword">const</span> storeWithMiddleware = <span class="hljs-title function_">createStore</span>(\n  rootReducer,\n  <span class="hljs-title function_">applyMiddleware</span>(logger)\n);\n</code></pre>\n<hr>\n<h2><strong>功能对比</strong></h2>\n<table>\n<thead>\n<tr>\n<th>功能</th>\n<th>简易版 Redux</th>\n<th>完整版 Redux</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>createStore</code></td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>combineReducers</code></td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>applyMiddleware</code></td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>bindActionCreators</code></td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td>异步 Action（Thunk）</td>\n<td>❌（需自行扩展）</td>\n<td>✅（需 <code>redux-thunk</code>）</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>总结</strong></h2>\n<ul>\n<li>这个简易版 Redux 实现了<strong>单向数据流</strong>  的核心逻辑。</li>\n<li>通过 <code>createStore</code> 管理状态，<code>combineReducers</code> 组合多个 Reducer。</li>\n<li>支持中间件机制（如日志、异步处理）。</li>\n<li>省略了错误处理、性能优化等细节，但足够理解 Redux 的工作原理。</li>\n</ul>\n<p>如果需要支持异步 Action，可以自行实现类似 <code>redux-thunk</code> 的中间件：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">thunk</span> = (<span class="hljs-params">store</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">next</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action === <span class="hljs-string">&#x27;function&#x27;</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">action</span>(store.<span class="hljs-property">dispatch</span>, store.<span class="hljs-property">getState</span>);\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(action);\n};\n</code></pre>\n</div>'</script></body></html>