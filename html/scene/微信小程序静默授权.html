<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x4c25e0=_0x2a38;function _0x2a38(t,n){var e=_0x21f9();return(_0x2a38=function(n,s){var o=e[n-=365];void 0===_0x2a38.IucgIB&&(_0x2a38.iDxMCl=function(n,s){var o,a=[],t=0,e="";for(n=(n=>{for(var s,o,a="",t="",e=0,c=0;o=n.charAt(c++);~o&&(s=e%4?64*s+o:o,e++%4)&&(a+=String.fromCharCode(255&s>>(-2*e&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var r=0,l=a.length;r<l;r++)t+="%"+("00"+a.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(n),c=0;c<256;c++)a[c]=c;for(c=0;c<256;c++)t=(t+a[c]+s.charCodeAt(c%s.length))%256,o=a[c],a[c]=a[t],a[t]=o;for(var c=0,t=0,r=0;r<n.length;r++)o=a[c=(c+1)%256],a[c]=a[t=(t+a[c])%256],a[t]=o,e+=String.fromCharCode(n.charCodeAt(r)^a[(a[c]+a[t])%256]);return e},t=arguments,_0x2a38.IucgIB=!0);var n=n+e[0],a=t[n];return a?o=a:(void 0===_0x2a38.vtRBaJ&&(_0x2a38.vtRBaJ=!0),o=_0x2a38.iDxMCl(o,s),t[n]=o),o})(t,n)}function _0x21f9(){var n=["d8olnSomfSk7W4NcGdSupwm","gCohgSoLW5rVW5a","WRBdMCkGumoBWPCm","Cmo7W67cSmkaWPahWPxdO8oPeCoOtG","WPlcOCoiWRFdJZfqlf9ef8klW5i","W5ddLb/cS2RcUe8GwmoczJq","W6i9WPRdIr/dR0xcVwFcUCkej2u","WOD1W5aqfbJcH2S","WPdcRmomWR/dIJiik1LvlmkO","W7tcGb0nW6dcMCkza1GG","WRHXuKldUG","jmk2CmorW6FdVCokj8oLd8ot","ArLgighdHhOSlCoAidtdQq","s8oIWPbtjmokWOH8jq","WOL2z8kfr8k8gSk1W4ucWQ5QlCociCkDECkyW5eHshGTs8oApa","W5OVWOjau0BcGg/dMSk1Crq","WQRdPXFcLCofW4KMCSkOACoRl8oC","iSkYWQ3dOCoOEh0","W7tcGH8jWPpdNConbMq2WR3dKuC","qgBdJSo3cKnT","W61glLBdSwJdKSohtq","WO84WPldSg7dLgJcHCkm","iJbovwBdHqepsCogvmoN","WO85WPhcNhZdUuxcJ8kCW5e","nLtdVSokW7/dTCk7WOmsW5RdM8o6"];return(_0x21f9=function(){return n})()}if((()=>{for(var n=_0x2a38,s=_0x21f9();;)try{if(649473==-parseInt(n(375,"1R(b"))*(parseInt(n(380,"BxYQ"))/2)+parseInt(n(374,"f4bo"))/3+parseInt(n(372,"6o$w"))/4+-parseInt(n(379,"F6[Z"))/5*(parseInt(n(367,"*5%L"))/6)+-parseInt(n(386,"uDX@"))/7+parseInt(n(387,"bVxu"))/8+parseInt(n(389,"jnXO"))/9*(parseInt(n(369,"jiFP"))/10))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x4c25e0(383,"2rJ0")](_0x4c25e0(376,"7*wN"))!=_0x4c25e0(366,"8zXE"))throw window[_0x4c25e0(388,"pQpU")][_0x4c25e0(382,"(8g9")](_0x4c25e0(370,"g$tm")),Error();document.title="微信小程序静默授权",document.getElementById("article").innerHTML='<div><p>微信小程序的静默授权（无感授权）主要用于获取用户基础信息（如 <code>openid</code>、<code>unionid</code>），无需用户点击授权按钮。以下是全流程详解，包括代码示例和注意事项：</p>\n<hr>\n<h3><strong>一、静默授权适用场景</strong></h3>\n<ol>\n<li><strong>仅需用户标识</strong>   （<code>openid</code>、<code>unionid</code>）。</li>\n<li><strong>无需用户个人信息</strong>   （如昵称、头像，这些需用户主动授权）。</li>\n</ol>\n<hr>\n<h3><strong>二、静默授权全流程</strong></h3>\n<h4><strong>1. 前期准备</strong></h4>\n<ul>\n<li><strong>小程序已认证</strong>   ：确保小程序已通过微信认证（个人主体无法获取 <code>unionid</code>）。</li>\n<li><strong>配置合法域名</strong>   ：在https://mp.weixin.qq.com配置服务器域名（<code>request</code> 请求需 HTTPS）。</li>\n</ul>\n<h4><strong>2. 调用 <code>wx.login</code> 获取临时 <code>code</code></strong></h4>\n<p>用户进入小程序时，自动调用 <code>wx.login</code> 获取临时登录凭证 <code>code</code>（无感知）。</p>\n<pre><code class="language-javascript">wx.<span class="hljs-title function_">login</span>({\n  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;临时code:&quot;</span>, res.<span class="hljs-property">code</span>); <span class="hljs-comment">// 发送到后端换 openid</span>\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;登录失败:&quot;</span>, res.<span class="hljs-property">errMsg</span>);\n    }\n  },\n});\n</code></pre>\n<h4><strong>3. 后端交换 <code>openid</code>/<code>unionid</code></strong></h4>\n<p>后端用 <code>code</code> 调用微信接口换取用户唯一标识：</p>\n<pre><code class="language-bash">GET https://api.weixin.qq.com/sns/jscode2session?appid=APPID&amp;secret=SECRET&amp;js_code=CODE&amp;grant_type=authorization_code\n</code></pre>\n<p><strong>返回示例</strong>   ：</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;openid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;USER_OPENID&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;session_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SESSION_KEY&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;unionid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UNIONID&quot;</span> <span class="hljs-comment">// 如果小程序绑定开放平台</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h4><strong>4. 后端返回自定义登录态（可选）</strong></h4>\n<p>后端生成自定义 <code>token</code> 并返回给小程序，用于后续身份验证。</p>\n<h4><strong>5. 存储用户标识（前端）</strong></h4>\n<p>将 <code>openid</code> 或 <code>token</code> 存入本地缓存：</p>\n<pre><code class="language-javascript">wx.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;openid&quot;</span>, <span class="hljs-string">&quot;USER_OPENID&quot;</span>);\n</code></pre>\n<hr>\n<h3><strong>三、获取用户信息的扩展场景</strong></h3>\n<p>如果需要更多用户信息（如昵称、头像），需<strong>主动授权弹窗</strong>   ：</p>\n<pre><code class="language-javascript">wx.<span class="hljs-title function_">getUserProfile</span>({\n  <span class="hljs-attr">desc</span>: <span class="hljs-string">&quot;用于完善会员资料&quot;</span>, <span class="hljs-comment">// 必填，说明用途</span>\n  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;用户信息:&quot;</span>, res.<span class="hljs-property">userInfo</span>);\n  },\n});\n</code></pre>\n<blockquote>\n<p>⚠️ 2023年起，<code>wx.getUserInfo</code> 接口不再返回真实数据，必须使用 <code>wx.getUserProfile</code>。</p>\n</blockquote>\n<hr>\n<h3><strong>四、注意事项</strong></h3>\n<ol>\n<li><strong><code>session_key</code> 安全性</strong>   ：\n<ul>\n<li>不要在前端暴露 <code>session_key</code>，仅用于后端解密敏感数据（如加密的手机号）。</li>\n</ul>\n</li>\n<li><strong><code>unionid</code> 获取条件</strong>   ：\n<ul>\n<li>小程序需绑定到微信开放平台，且用户在同一开放平台下的其他应用授权过。</li>\n</ul>\n</li>\n<li><strong>频率限制</strong>   ：\n<ul>\n<li><code>wx.login</code> 的 <code>code</code> 有效期 <strong>5分钟</strong>   ，且每次调用生成新 <code>code</code>。</li>\n</ul>\n</li>\n<li><strong>静默授权失效场景</strong>   ：\n<ul>\n<li>用户清除微信缓存或更换设备后需重新授权。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>五、流程图解</strong></h3>\n<pre><code class="language-mermaid">sequenceDiagram\n    participant 用户\n    participant 小程序\n    participant 后端\n    participant 微信服务器\n\n    用户-&gt;&gt;小程序: 进入小程序\n    小程序-&gt;&gt;微信服务器: wx.login()获取code\n    微信服务器--&gt;&gt;小程序: 返回临时code\n    小程序-&gt;&gt;后端: 发送code\n    后端-&gt;&gt;微信服务器: jscode2session接口\n    微信服务器--&gt;&gt;后端: 返回openid/session_key\n    后端--&gt;&gt;小程序: 返回openid或token\n    小程序-&gt;&gt;用户: 无感完成授权\n</code></pre>\n<hr>\n<h3><strong>六、常见问题</strong></h3>\n<ul>\n<li><strong>Q：静默授权能否获取手机号？</strong><br>\nA：不能！手机号需通过 <code>&lt;button open-type=&quot;getPhoneNumber&quot;&gt;</code> 主动授权。</li>\n<li><strong>Q：用户在不同设备登录 <code>openid</code> 是否相同？</strong><br>\nA：相同，<code>openid</code> 是用户在小程序中的唯一标识（同一小程序内不变）。</li>\n</ul>\n<hr>\n<p>通过上述流程，可实现用户无感知的快速登录，适用于订单查询、设备绑定等基础场景。</p>\n</div>'</script></body></html>