<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x474a(){var s=["WQZcKSkjWRaAherAWOmACG","hcRdUCooWQNdOSoPW5RcI1jD","lConWRRcJmoofg8","z8omh1PoW5qxAq","W7VdUSoYy2TvhCk5W7G","hYTauCkyn8oPW70ClCovEaC","yColxIioWRL+CSk2W5tdJmoMWPu","gcvpvCkym8koW4KWcSoGCG","fX9RW7vtEtBcVq/dP8kLW7/dQa","l8kjnxddNN7cP8o9WPpdVxtdRr4","WOJcOCkHmsbbi8k6W4VcR8kX","BCoHW4VcO8o5bSoabWrvvCoCkW","g8o+W7lcTmkvW5jg","r8kpnJzge8oCpG","jCoEW6ddSa3cPq4","W6FdHCoFWQmZWOGFCa","W6xcVmk7W7WYfsmu","r8kpq3eeu8kNg18FWOqClW","rhpdNCkWFSkmW4z7","WOVcRmoDy1XxpSk3","g8kxWQ/dPConWRbWW6mQsatdNa","qh0vbCozBCk1W6K","l8kjqdFcNd7dNmoy","frTQW7fyiMVcTrxdM8kh","DSooDSoLA8kOgCk5WR/dNmomjq","W4W5WOGbDa","gSktW4pcT8kAW7LDW60","y8kmWQNcRvNdSt/dR8kVWQJdHCkZ","DCojCJtcNNtcSmkDWPRdHKpdTIhdLCkxo8odWP8TW5BcVH3dJSknWOlcIW","eIpdPCkCtSkyW4m"];return(_0x474a=function(){return s})()}function _0xf8ba(t,s){var e=_0x474a();return(_0xf8ba=function(s,n){var a=e[s-=460];void 0===_0xf8ba.JJnpMv&&(_0xf8ba.fssKMU=function(s,n){var a,l=[],t=0,e="";for(s=(s=>{for(var n,a,l="",t="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[t],l[t]=a;for(var p=0,t=0,c=0;c<s.length;c++)a=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=a,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[t])%256]);return e},t=arguments,_0xf8ba.JJnpMv=!0);var s=s+e[0],l=t[s];return l?a=l:(void 0===_0xf8ba.NFgLsD&&(_0xf8ba.NFgLsD=!0),a=_0xf8ba.fssKMU(a,n),t[s]=a),a})(t,s)}var _0x233b3d=_0xf8ba;if((()=>{for(var s=_0xf8ba,n=_0x474a();;)try{if(247211==+parseInt(s(466,"Jh5K"))+parseInt(s(460,"6I(N"))/2*(-parseInt(s(471,"oDd^"))/3)+-parseInt(s(489,"vDxe"))/4*(-parseInt(s(478,"PR]O"))/5)+-parseInt(s(476,"jqv)"))/6+-parseInt(s(483,"9b9u"))/7*(-parseInt(s(462,"&BFU"))/8)+parseInt(s(485,"oDd^"))/9*(parseInt(s(467,"(G%t"))/10)+parseInt(s(464,"Jh5K"))/11*(-parseInt(s(472,"jqv)"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x233b3d(488,"yLyL")](_0x233b3d(463,"PR]O"))!=_0x233b3d(484,"MvM5"))throw window[_0x233b3d(480,"Jh5K")][_0x233b3d(473,"2#C]")](_0x233b3d(487,"U1YO")),Error();document.title="如何在前端解析⼆进制，流媒体、图⽚⼆进制数据怎样渲染到⻚⾯上",document.getElementById("article").innerHTML='<div><p>在前端开发中，解析和渲染二进制数据（如流媒体、图片等）是一个常见的需求。以下将详细讲解如何在前端解析二进制数据，并将其渲染到页面上。</p>\n<hr>\n<h3><strong>一、二进制数据解析基础</strong></h3>\n<h4><strong>1. 二进制数据格式</strong></h4>\n<ul>\n<li><strong>ArrayBuffer</strong>  ：\n<ul>\n<li>表示通用的、固定长度的原始二进制数据缓冲区。</li>\n<li>无法直接操作，需要通过视图（如 <code>TypedArray</code> 或 <code>DataView</code>）来读写。</li>\n</ul>\n</li>\n<li><strong>TypedArray</strong>  ：\n<ul>\n<li>用于读写 <code>ArrayBuffer</code> 的视图，提供多种数据类型（如 <code>Uint8Array</code>、<code>Int16Array</code> 等）。</li>\n</ul>\n</li>\n<li><strong>DataView</strong>  ：\n<ul>\n<li>提供更灵活的读写方式，支持不同字节序（大端、小端）。</li>\n</ul>\n</li>\n<li><strong>Blob</strong>  ：\n<ul>\n<li>表示不可变的、原始数据的类文件对象，可用于处理二进制数据（如图片、视频）。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 获取二进制数据</strong></h4>\n<ul>\n<li><strong>通过 Fetch API</strong>  ：\n<ul>\n<li>使用 <code>fetch</code> 请求资源，设置 <code>responseType</code> 为 <code>\'arraybuffer\'</code> 或 <code>\'blob\'</code>。</li>\n</ul>\n</li>\n<li><strong>通过 FileReader</strong>  ：\n<ul>\n<li>读取本地文件，使用 <code>readAsArrayBuffer</code> 或 <code>readAsDataURL</code> 方法。</li>\n</ul>\n</li>\n<li><strong>通过 WebSocket</strong>  ：\n<ul>\n<li>接收二进制数据（如 ArrayBuffer 或 Blob）。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>二、解析二进制数据</strong></h3>\n<h4><strong>1. 使用 TypedArray 解析</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.bin&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> uint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uint8Array); <span class="hljs-comment">// 输出二进制数据</span>\n  });\n</code></pre>\n<h4><strong>2. 使用 DataView 解析</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.bin&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);\n    <span class="hljs-keyword">const</span> int32Value = dataView.<span class="hljs-title function_">getInt32</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 读取小端序的 32 位整数</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(int32Value);\n  });\n</code></pre>\n<hr>\n<h3><strong>三、渲染二进制数据到页面</strong></h3>\n<h4><strong>1. 渲染图片二进制数据</strong></h4>\n<ul>\n<li><strong>通过 Blob URL</strong>  ：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.jpg&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">blob</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);\n    <span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);\n    img.<span class="hljs-property">src</span> = url;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(img);\n  });\n</code></pre>\n<ul>\n<li><strong>通过 Base64 编码</strong>  ：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.jpg&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> base64 = <span class="hljs-title function_">btoa</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer)));\n    <span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);\n    img.<span class="hljs-property">src</span> = <span class="hljs-string">`data:image/jpeg;base64,<span class="hljs-subst">${base64}</span>`</span>;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(img);\n  });\n</code></pre>\n<h4><strong>2. 渲染流媒体数据</strong></h4>\n<ul>\n<li><strong>使用 MediaSource API</strong>  ：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;MediaSource&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {\n  <span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;video&#x27;</span>);\n  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(video);\n\n  <span class="hljs-keyword">const</span> mediaSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaSource</span>();\n  video.<span class="hljs-property">src</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(mediaSource);\n\n  mediaSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;sourceopen&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> sourceBuffer = mediaSource.<span class="hljs-title function_">addSourceBuffer</span>(<span class="hljs-string">&#x27;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#x27;</span>);\n\n    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.mp4&#x27;</span>)\n      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> {\n        sourceBuffer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;updateend&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n          mediaSource.<span class="hljs-title function_">endOfStream</span>();\n          video.<span class="hljs-title function_">play</span>();\n        });\n        sourceBuffer.<span class="hljs-title function_">appendBuffer</span>(buffer);\n      });\n  });\n}\n</code></pre>\n<h4><strong>3. 渲染二进制文件（如下载）</strong></h4>\n<ul>\n<li><strong>通过 Blob 下载</strong>  ：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.pdf&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">blob</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);\n    <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;a&#x27;</span>);\n    a.<span class="hljs-property">href</span> = url;\n    a.<span class="hljs-property">download</span> = <span class="hljs-string">&#x27;example.pdf&#x27;</span>;\n    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);\n    a.<span class="hljs-title function_">click</span>();\n    a.<span class="hljs-title function_">remove</span>();\n  });\n</code></pre>\n<hr>\n<h3><strong>四、处理复杂二进制数据（如自定义协议）</strong></h3>\n<h4><strong>1. 解析自定义二进制协议</strong></h4>\n<ul>\n<li><strong>示例</strong>  ：解析包含头部和数据的二进制文件。</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.dat&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);\n    <span class="hljs-keyword">const</span> headerLength = dataView.<span class="hljs-title function_">getUint16</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 读取头部长度</span>\n    <span class="hljs-keyword">const</span> dataLength = dataView.<span class="hljs-title function_">getUint32</span>(<span class="hljs-number">2</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 读取数据长度</span>\n    <span class="hljs-keyword">const</span> dataOffset = <span class="hljs-number">6</span>; <span class="hljs-comment">// 假设头部固定为 6 字节</span>\n\n    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer, dataOffset, dataLength);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data); <span class="hljs-comment">// 输出数据部分</span>\n  });\n</code></pre>\n<h4><strong>2. 使用 WebAssembly 处理复杂数据</strong></h4>\n<ul>\n<li><strong>场景</strong>  ：当需要高性能解析时，可使用 WebAssembly。</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// 假设已编译的 WebAssembly 模块为 example.wasm</span>\n<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;example.wasm&#x27;</span>)\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">arrayBuffer</span>())\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">bytes</span> =&gt;</span> <span class="hljs-title class_">WebAssembly</span>.<span class="hljs-title function_">instantiate</span>(bytes))\n  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> instance = results.<span class="hljs-property">instance</span>;\n    <span class="hljs-keyword">const</span> memory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(instance.<span class="hljs-property">exports</span>.<span class="hljs-property">memory</span>.<span class="hljs-property">buffer</span>);\n    <span class="hljs-comment">// 调用 WebAssembly 函数处理数据</span>\n  });\n</code></pre>\n<hr>\n<h3><strong>五、性能优化与注意事项</strong></h3>\n<h4><strong>1. 性能优化</strong></h4>\n<ul>\n<li><strong>使用 Transferable Objects</strong>  ：\n<ul>\n<li>在 Web Worker 之间传输二进制数据时，使用 <code>postMessage</code> 的 transferable 对象，避免数据拷贝。</li>\n</ul>\n</li>\n<li><strong>流式处理</strong>  ：\n<ul>\n<li>对于大文件，使用流式处理（如 <code>ReadableStream</code>）减少内存占用。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 注意事项</strong></h4>\n<ul>\n<li><strong>内存管理</strong>  ：\n<ul>\n<li>使用 <code>URL.revokeObjectURL</code> 释放 Blob URL，避免内存泄漏。</li>\n</ul>\n</li>\n<li><strong>错误处理</strong>  ：\n<ul>\n<li>处理网络请求和二进制解析时的异常，确保应用稳定性。</li>\n</ul>\n</li>\n<li><strong>跨域问题</strong>  ：\n<ul>\n<li>确保服务器设置正确的 CORS 头，允许跨域请求二进制数据。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>六、总结</strong></h3>\n<ul>\n<li><strong>解析二进制数据</strong>  ：\n<ul>\n<li>使用 <code>ArrayBuffer</code>、<code>TypedArray</code> 和 <code>DataView</code> 读取和解析二进制数据。</li>\n</ul>\n</li>\n<li><strong>渲染到页面</strong>  ：\n<ul>\n<li>图片：通过 Blob URL 或 Base64 编码。</li>\n<li>流媒体：使用 <code>MediaSource API</code>。</li>\n<li>文件下载：通过 Blob 创建下载链接。</li>\n</ul>\n</li>\n<li><strong>性能与稳定性</strong>  ：\n<ul>\n<li>优化内存管理，处理异常，确保跨域请求正确配置。</li>\n</ul>\n</li>\n</ul>\n<p>通过合理选择和组合这些技术，可以在前端高效地解析和渲染二进制数据，提升应用性能和用户体验。</p>\n</div>'</script></body></html>