<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x50a43d=_0x1437;function _0x6b58(){var s=["lCkSbIyTW7hdIq","W4ldVSk5W7ey","AmkKcSkVlSolzwVcTmkeaSkSW4u","uCoeASoKD8k1W4ZcU8oxyLhcHr0nWPn4W4TfW7/cGvDjra/dMmoZ","WRBdHv/cRWemcq","W7hcKX7dTvqfbCoVW6tcK3i","W69AjKOBW4jF","guzHkSkCW6f2WQtdRtHtW4C","WPGgeSozWRZcOaqh","WRPmfMWRW4rLrG","xSkrWRGkW7z5W7CMW4abW7P6WOS","ECoLW7ddQCkAFdlcHgddVc5Z","WReyWRpcLmk6FCojmZWAWPGwcq","pv02BMXOCblcMCoCWRGc","ACoUWQdcJ2u2W7q","cmkbj8kInmk7WRtdK8oEy2BcTW","WRuBW7ldGSoPbCkUgG","x8o+ANvFW5dcTfOtgeW2","WRLDWRZcTCkeWPa+WOhcLW","wmkpW555W4bHW7hdNa","A8kHdmkVk8ooyLNcSCkva8kcW5S","i8kIWPdcGWddOeKsA8kJECon","fmkBF3xcQH3dNqRdVSoyoq","f2uEWOpdNSoOWRFcHq","cxHxtmkWWQ3dSW","tCoUbdJdPGJcKW","F8o5r1DSWQddS8odW5KYW5bT","W53dVtFcV0hdJuxdR8oOW43dLv0"];return(_0x6b58=function(){return s})()}function _0x1437(l,s){var p=_0x6b58();return(_0x1437=function(s,n){var a=p[s-=363];void 0===_0x1437.FJYHzQ&&(_0x1437.JnwGLF=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,r=0;a=s.charAt(r++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,o=t.length;e<o;e++)l+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)t[r]=r;for(r=0;r<256;r++)l=(l+t[r]+n.charCodeAt(r%n.length))%256,a=t[r],t[r]=t[l],t[l]=a;for(var r=0,l=0,e=0;e<s.length;e++)a=t[r=(r+1)%256],t[r]=t[l=(l+t[r])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(e)^t[(t[r]+t[l])%256]);return p},l=arguments,_0x1437.FJYHzQ=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x1437.kvksDk&&(_0x1437.kvksDk=!0),a=_0x1437.JnwGLF(a,n),l[s]=a),a})(l,s)}if((()=>{for(var s=_0x1437,n=_0x6b58();;)try{if(187715==-parseInt(s(364,"WtLF"))+parseInt(s(380,"8)PM"))/2+parseInt(s(373,"kFen"))/3+-parseInt(s(390,"lIgr"))/4*(-parseInt(s(363,"omv("))/5)+-parseInt(s(371,"VulX"))/6*(-parseInt(s(385,"yQK!"))/7)+parseInt(s(382,"]wpv"))/8*(-parseInt(s(381,"&G4b"))/9)+-parseInt(s(383,"l7r^"))/10*(parseInt(s(387,"omv("))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x50a43d(375,"kFen")](_0x50a43d(365,"vB#6"))!=_0x50a43d(376,"98m1"))throw window[_0x50a43d(384,"&G4b")][_0x50a43d(379,"8)PM")](_0x50a43d(378,"lIgr")),Error();document.title="Webpack 底层调优",document.getElementById("article").innerHTML='<div><p>Webpack 底层调优的核心在于 <strong>减少构建时间</strong>   、<strong>降低输出体积</strong>   和 <strong>提升运行时性能</strong>   。以下是针对 Webpack 5 的深度调优策略，涵盖配置优化、工具链选择和底层原理：</p>\n<hr>\n<h3><strong>一、构建速度优化</strong></h3>\n<h4>1. <strong>缩小文件搜索范围</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">resolve</span>: {\n    <span class="hljs-comment">// 明确指定模块搜索目录</span>\n    <span class="hljs-attr">modules</span>: [<span class="hljs-string">&quot;node_modules&quot;</span>, path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;src&quot;</span>)],\n    <span class="hljs-comment">// 优先指定扩展名（避免逐一代试）</span>\n    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.ts&quot;</span>, <span class="hljs-string">&quot;.js&quot;</span>, <span class="hljs-string">&quot;.json&quot;</span>],\n    <span class="hljs-comment">// 使用别名减少层级引用</span>\n    <span class="hljs-attr">alias</span>: {\n      <span class="hljs-string">&quot;@&quot;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;src&quot;</span>),\n    },\n  },\n  <span class="hljs-comment">// 排除不需要解析的库（如已预编译的 jQuery）</span>\n  <span class="hljs-attr">module</span>: {\n    <span class="hljs-attr">noParse</span>: <span class="hljs-regexp">/jquery|lodash/</span>,\n  },\n};\n</code></pre>\n<h4>2. <strong>多进程并行处理</strong></h4>\n<pre><code class="language-bash">npm install thread-loader -D\n</code></pre>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">module</span>: {\n    <span class="hljs-attr">rules</span>: [\n      {\n        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\\.js$/</span>,\n        <span class="hljs-attr">use</span>: [\n          {\n            <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;thread-loader&quot;</span>,\n            <span class="hljs-attr">options</span>: { <span class="hljs-attr">workers</span>: <span class="hljs-number">3</span> }, <span class="hljs-comment">// 根据 CPU 核心数调整</span>\n          },\n          <span class="hljs-string">&quot;babel-loader&quot;</span>,\n        ],\n      },\n    ],\n  },\n};\n</code></pre>\n<p><strong>替代方案</strong>   ：<code>esbuild-loader</code>（用 Rust 加速转译）。</p>\n<h4>3. <strong>缓存机制</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">cache</span>: {\n    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;filesystem&quot;</span>, <span class="hljs-comment">// Webpack 5 持久化缓存</span>\n    <span class="hljs-attr">cacheDirectory</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;.cache&quot;</span>),\n    <span class="hljs-attr">buildDependencies</span>: {\n      <span class="hljs-attr">config</span>: [__filename], <span class="hljs-comment">// 配置文件变更时缓存失效</span>\n    },\n  },\n};\n</code></pre>\n<p><strong>注意</strong>   ：结合 <code>babel-loader</code> 的 <code>cacheDirectory</code> 使用。</p>\n<hr>\n<h3><strong>二、输出体积优化</strong></h3>\n<h4>1. <strong>Tree Shaking 深度配置</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 标记未使用代码</span>\n    <span class="hljs-attr">concatenateModules</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 作用域提升</span>\n    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">minimizer</span>: [\n      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({\n        <span class="hljs-attr">terserOptions</span>: {\n          <span class="hljs-attr">compress</span>: {\n            <span class="hljs-attr">pure_funcs</span>: [<span class="hljs-string">&quot;console.log&quot;</span>], <span class="hljs-comment">// 移除指定函数</span>\n          },\n        },\n      }),\n    ],\n  },\n};\n</code></pre>\n<p><strong>验证</strong>   ：通过 <code>webpack-bundle-analyzer</code> 分析产物。</p>\n<h4>2. <strong>按需加载与代码分割</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动态导入（React 示例）</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./LazyComponent&quot;</span>));\n\n<span class="hljs-comment">// Webpack 配置</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">splitChunks</span>: {\n      <span class="hljs-attr">chunks</span>: <span class="hljs-string">&quot;all&quot;</span>,\n      <span class="hljs-attr">cacheGroups</span>: {\n        <span class="hljs-attr">vendors</span>: {\n          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\\\/]node_modules[\\\\/]/</span>,\n          <span class="hljs-attr">priority</span>: -<span class="hljs-number">10</span>,\n        },\n        <span class="hljs-attr">common</span>: {\n          <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>,\n          <span class="hljs-attr">priority</span>: -<span class="hljs-number">20</span>,\n        },\n      },\n    },\n    <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-string">&quot;single&quot;</span>, <span class="hljs-comment">// 提取 runtime 代码</span>\n  },\n};\n</code></pre>\n<h4>3. <strong>资源压缩与替代</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用 ESBuild 压缩（比 Terser 快 20 倍）</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ESBuildMinifyPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;esbuild-loader&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">minimizer</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ESBuildMinifyPlugin</span>({ <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;es2015&quot;</span> })],\n  },\n};\n</code></pre>\n<hr>\n<h3><strong>三、运行时性能优化</strong></h3>\n<h4>1. <strong>预加载关键资源</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 手动注入 &lt;link rel=&quot;preload&quot;&gt;</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">PreloadWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/preload-webpack-plugin&quot;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreloadWebpackPlugin</span>({\n      <span class="hljs-attr">rel</span>: <span class="hljs-string">&quot;preload&quot;</span>,\n      <span class="hljs-attr">include</span>: <span class="hljs-string">&quot;initial&quot;</span>,\n    }),\n  ],\n};\n</code></pre>\n<h4>2. <strong>长效缓存（Content Hash）</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">output</span>: {\n    <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;[name].[contenthash:8].js&quot;</span>,\n    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&quot;[name].[contenthash:8].chunk.js&quot;</span>,\n  },\n};\n</code></pre>\n<h4>3. <strong>排除非必要 Polyfill</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 按目标浏览器配置 browserslist</span>\n<span class="hljs-comment">// package.json</span>\n{\n  <span class="hljs-string">&quot;browserslist&quot;</span>: [<span class="hljs-string">&quot;last 2 Chrome versions&quot;</span>]\n}\n\n<span class="hljs-comment">// 或通过 @babel/preset-env 的 targets 指定</span>\n</code></pre>\n<hr>\n<h3><strong>四、底层原理与高级技巧</strong></h3>\n<h4>1. <strong>模块联邦（Module Federation）</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 微前端场景共享模块</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app1&quot;</span>,\n      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>,\n      <span class="hljs-attr">exposes</span>: {\n        <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button&quot;</span>,\n      },\n      <span class="hljs-attr">shared</span>: [<span class="hljs-string">&quot;react&quot;</span>, <span class="hljs-string">&quot;react-dom&quot;</span>],\n    }),\n  ],\n};\n</code></pre>\n<h4>2. <strong>自定义 Parser 与代码生成</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用 Rust 工具链替代部分 JS 逻辑</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">module</span>: {\n    <span class="hljs-attr">rules</span>: [\n      {\n        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\\.js$/</span>,\n        <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;esbuild-loader&quot;</span>,\n        <span class="hljs-attr">options</span>: {\n          <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;jsx&quot;</span>,\n          <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;es2015&quot;</span>,\n        },\n      },\n    ],\n  },\n};\n</code></pre>\n<h4>3. <strong>内存文件系统调优</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 开发环境下禁用写入磁盘（内存编译）</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">devServer</span>: {\n    <span class="hljs-attr">devMiddleware</span>: {\n      <span class="hljs-attr">writeToDisk</span>: <span class="hljs-literal">false</span>,\n    },\n  },\n};\n</code></pre>\n<hr>\n<h3><strong>五、监控与持续优化</strong></h3>\n<h4>1. <strong>构建分析工具</strong></h4>\n<ul>\n<li><strong>速度分析</strong>   ：<code>speed-measure-webpack-plugin</code></li>\n<li><strong>体积分析</strong>   ：<code>webpack-bundle-analyzer</code></li>\n<li><strong>依赖分析</strong>   ：<code>statoscope</code></li>\n</ul>\n<h4>2. <strong>性能追踪</strong></h4>\n<pre><code class="language-bash"><span class="hljs-comment"># 生成 JSON 格式的构建数据</span>\nwebpack --profile --json &gt; stats.json\n</code></pre>\n<p>用 <code>webpack-visualizer</code> 可视化分析。</p>\n<hr>\n<h3><strong>调优前后对比示例</strong></h3>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>优化前</th>\n<th>优化后</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>冷启动构建时间</td>\n<td>45s</td>\n<td>12s</td>\n</tr>\n<tr>\n<td>热更新速度</td>\n<td>3.2s</td>\n<td>0.8s</td>\n</tr>\n<tr>\n<td>生产包体积（gzip）</td>\n<td>1.8MB</td>\n<td>1.1MB</td>\n</tr>\n<tr>\n<td>缓存命中率</td>\n<td>30%</td>\n<td>85%</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>总结</strong></h3>\n<ol>\n<li><strong>速度优先</strong>   ：缓存 + 多进程 + 原生工具链（如 ESBuild）。</li>\n<li><strong>体积优先</strong>   ：Tree Shaking + 按需加载 + 压缩优化。</li>\n<li><strong>运行时优先</strong>   ：预加载 + 长效缓存 + 代码分割。</li>\n<li><strong>持续监控</strong>   ：通过分析工具定位瓶颈。</li>\n</ol>\n<p>根据项目阶段选择策略：<strong>开发环境重速度</strong>   ，<strong>生产环境重体积</strong>   。</p>\n</div>'</script></body></html>