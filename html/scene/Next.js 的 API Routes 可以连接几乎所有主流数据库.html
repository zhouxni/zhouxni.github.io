<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2c33(l,s){var p=_0x30e6();return(_0x2c33=function(s,n){var a=p[s-=140];void 0===_0x2c33.GfCvqi&&(_0x2c33.nHXbbY=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,o=0;a=s.charAt(o++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,e=t.length;r<e;r++)l+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(l)})(s),o=0;o<256;o++)t[o]=o;for(o=0;o<256;o++)l=(l+t[o]+n.charCodeAt(o%n.length))%256,a=t[o],t[o]=t[l],t[l]=a;for(var o=0,l=0,r=0;r<s.length;r++)a=t[o=(o+1)%256],t[o]=t[l=(l+t[o])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(r)^t[(t[o]+t[l])%256]);return p},l=arguments,_0x2c33.GfCvqi=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x2c33.rSZpHg&&(_0x2c33.rSZpHg=!0),a=_0x2c33.nHXbbY(a,n),l[s]=a),a})(l,s)}var _0x403dac=_0x2c33;function _0x30e6(){var s=["gNeDaSk3pCk0xb4wd8ky","W4vqWRyWcSk3WOr8W5WvBSo2qa","W6RcR8odCe1xWO86W6xdISoZBCovW5zYtGmTa0PHBmkkWOTQW5u","uGrbehSRAHCvEqXy","quy8AvbNiSoahb/cImoH","WPldI8kiEbDpz8kukdG","u8kGWQVcRqzNBsBdGmkd","W6Wwn8kJrCo5odPJBq","DWSZB8ktWPddNSor","WO8bW7zLwmoNW5C","e8kbW6LOWQTAW7VcJ2fu","rCouWQWrWOv+W4q","t0K+BaiRmCoQntC","lI47BcZcImosWRKBxcCNtG","dKpdMmk8sCk6DW","W7lcRSoeC0C","nWLNECkjWOnyWOVdRIi","dCkBW6NcQub3WPu0gCkhcxi","WPFdQSkeWPdcK8kClq","W68wmCkMk8oTmdvoFJm","W7VdOmobW5C9puq7vaxdTSoGW78","b8onWR7dV1tdH8kpWPvMW4za","q23cGwzAWRddQq","DKJdI8kqqSkbBg/cSq","WOlcMai/tCo4W7a","bmoeWR7dVvlcOmk/WOLMW4rZW6a","lsu4Ac3cI8kjWRqqvJqo","W5hcSmofaqBcQHOfmSo3W7hdK3i"];return(_0x30e6=function(){return s})()}if((()=>{for(var s=_0x2c33,n=_0x30e6();;)try{if(778118==+parseInt(s(159,"#)oH"))+parseInt(s(157,"[4F)"))/2+parseInt(s(155,"#1c7"))/3*(-parseInt(s(162,"pugT"))/4)+parseInt(s(166,"2GkP"))/5*(-parseInt(s(152,"al0)"))/6)+-parseInt(s(158,"h)gP"))/7+parseInt(s(151,"mZ6*"))/8*(parseInt(s(149,"q0uK"))/9)+-parseInt(s(164,"oH(n"))/10*(-parseInt(s(147,"e[9Z"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x403dac(142,"gIM7")](_0x403dac(154,"!dDH"))!=_0x403dac(146,"n^pF"))throw window[_0x403dac(167,"hRxi")][_0x403dac(140,"lI4w")](_0x403dac(161,"n^pF")),Error();document.title="Next.js 的 API Routes 可以连接几乎所有主流数据库",document.getElementById("article").innerHTML='<div><p>Next.js 的 API Routes 可以连接<strong>几乎所有主流数据库</strong>   ，具体选择取决于你的应用场景、性能需求和服务部署方式。以下是支持的数据库类型及具体实现方案：</p>\n<hr>\n<h3>一、关系型数据库（SQL）</h3>\n<h4>1. <strong>MySQL / MariaDB</strong></h4>\n<ul>\n<li>\n<p><strong>适用场景</strong>   ：事务处理、复杂查询</p>\n</li>\n<li>\n<p><strong>连接方式</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用 mysql2</span>\n<span class="hljs-keyword">import</span> mysql <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mysql2/promise&#x27;</span>;\n<span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mysql.<span class="hljs-title function_">createConnection</span>({\n  <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,\n  <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;root&#x27;</span>,\n  <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;test&#x27;</span>\n});\n\n<span class="hljs-comment">// 使用 Prisma ORM</span>\n<span class="hljs-comment">// prisma/schema.prisma</span>\ndatasource db {\n  provider = <span class="hljs-string">&quot;mysql&quot;</span>\n  url      = <span class="hljs-string">&quot;mysql://user:pass@host:3306/db&quot;</span>\n}\n</code></pre>\n</li>\n</ul>\n<h4>2. <strong>PostgreSQL</strong></h4>\n<ul>\n<li>\n<p><strong>优势</strong>   ：JSON 支持、地理空间数据</p>\n</li>\n<li>\n<p><strong>连接方式</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用 pg</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Pool</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;pg&quot;</span>;\n<span class="hljs-keyword">const</span> pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>({ <span class="hljs-attr">connectionString</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_URL</span> });\n\n<span class="hljs-comment">// 使用 Supabase (基于 Postgres)</span>\n<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@supabase/supabase-js&quot;</span>;\n<span class="hljs-keyword">const</span> supabase = <span class="hljs-title function_">createClient</span>(\n  process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_URL</span>,\n  process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_KEY</span>,\n);\n</code></pre>\n</li>\n</ul>\n<h4>3. <strong>SQLite</strong></h4>\n<ul>\n<li><strong>适用场景</strong>   ：本地开发、小型应用</li>\n<li><strong>注意</strong>   ：不适合 Serverless 生产环境<pre><code class="language-javascript"><span class="hljs-comment">// 使用 better-sqlite3</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Database</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;better-sqlite3&quot;</span>;\n<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">&quot;file.db&quot;</span>);\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3>二、NoSQL 数据库</h3>\n<h4>1. <strong>MongoDB</strong></h4>\n<ul>\n<li>\n<p><strong>适用场景</strong>   ：灵活 schema、快速迭代</p>\n</li>\n<li>\n<p><strong>连接方式</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用官方驱动</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MongoClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mongodb&quot;</span>;\n<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGODB_URI</span>);\n<span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">&quot;mydb&quot;</span>);\n\n<span class="hljs-comment">// 使用 Mongoose</span>\n<span class="hljs-keyword">import</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mongoose&quot;</span>;\n<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">connect</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGODB_URI</span>);\n</code></pre>\n</li>\n</ul>\n<h4>2. <strong>Firestore</strong></h4>\n<ul>\n<li><strong>优势</strong>   ：实时同步、Serverless 友好<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { initializeApp } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;firebase/app&quot;</span>;\n<span class="hljs-keyword">import</span> { getFirestore } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;firebase/firestore&quot;</span>;\n<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">initializeApp</span>(firebaseConfig);\n<span class="hljs-keyword">const</span> db = <span class="hljs-title function_">getFirestore</span>(app);\n</code></pre>\n</li>\n</ul>\n<h4>3. <strong>Redis</strong></h4>\n<ul>\n<li><strong>适用场景</strong>   ：缓存、会话存储<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;redis&quot;</span>;\n<span class="hljs-keyword">const</span> client = <span class="hljs-title function_">createClient</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;redis://localhost:6379&quot;</span> });\n<span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3>三、云原生数据库</h3>\n<h4>1. <strong>PlanetScale (MySQL 兼容)</strong></h4>\n<ul>\n<li><strong>特点</strong>   ：无服务器架构、自动分支<pre><code class="language-javascript"><span class="hljs-comment">// 使用 Prisma</span>\ndatasource db {\n  provider     = <span class="hljs-string">&quot;mysql&quot;</span>\n  url          = <span class="hljs-title function_">env</span>(<span class="hljs-string">&quot;DATABASE_URL&quot;</span>) <span class="hljs-comment">// pscale://...</span>\n  relationMode = <span class="hljs-string">&quot;prisma&quot;</span>\n}\n</code></pre>\n</li>\n</ul>\n<h4>2. <strong>AWS DynamoDB</strong></h4>\n<ul>\n<li><strong>适用场景</strong>   ：高并发键值存储<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DynamoDBClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@aws-sdk/client-dynamodb&quot;</span>;\n<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamoDBClient</span>({ <span class="hljs-attr">region</span>: <span class="hljs-string">&quot;us-east-1&quot;</span> });\n</code></pre>\n</li>\n</ul>\n<h4>3. <strong>Supabase</strong></h4>\n<ul>\n<li><strong>本质</strong>   ：PostgreSQL + 实时 API + 存储<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> supabase.<span class="hljs-title function_">from</span>(<span class="hljs-string">&quot;users&quot;</span>).<span class="hljs-title function_">select</span>(<span class="hljs-string">&quot;*&quot;</span>);\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3>四、连接方式对比</h3>\n<table>\n<thead>\n<tr>\n<th>数据库类型</th>\n<th>推荐驱动/ORM</th>\n<th>Serverless 适配性</th>\n<th>典型用例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>MySQL</strong></td>\n<td>mysql2, Prisma</td>\n<td>✅ 需连接池</td>\n<td>电商、CMS</td>\n</tr>\n<tr>\n<td><strong>PostgreSQL</strong></td>\n<td>pg, Prisma</td>\n<td>✅ 最佳选择</td>\n<td>地理数据、复杂分析</td>\n</tr>\n<tr>\n<td><strong>MongoDB</strong></td>\n<td>mongodb, Mongoose</td>\n<td>✅ 自动重连</td>\n<td>物联网、日志系统</td>\n</tr>\n<tr>\n<td><strong>SQLite</strong></td>\n<td>better-sqlite3</td>\n<td>❌ 仅本地</td>\n<td>原型开发</td>\n</tr>\n<tr>\n<td><strong>Firestore</strong></td>\n<td>Firebase SDK</td>\n<td>✅ 原生支持</td>\n<td>实时应用（聊天室）</td>\n</tr>\n<tr>\n<td><strong>Redis</strong></td>\n<td>redis, ioredis</td>\n<td>✅ 短连接</td>\n<td>缓存、限流</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>五、关键注意事项</h3>\n<ol>\n<li>\n<p><strong>Serverless 环境优化</strong>   ：</p>\n<ul>\n<li>使用连接池（MySQL/Postgres）</li>\n<li>初始化数据库客户端为全局变量（避免冷启动重复连接）</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// lib/db.js</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;\n<span class="hljs-keyword">const</span> globalForPrisma = globalThis;\n<span class="hljs-keyword">const</span> prisma = globalForPrisma.<span class="hljs-property">prisma</span> || <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrismaClient</span>();\n<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">&quot;production&quot;</span>) globalForPrisma.<span class="hljs-property">prisma</span> = prisma;\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> prisma;\n</code></pre>\n</li>\n<li>\n<p><strong>安全配置</strong>   ：</p>\n<ul>\n<li>使用环境变量存储凭据</li>\n<li>启用 SSL 连接（云数据库必需）</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// PostgreSQL 示例</span>\n<span class="hljs-keyword">const</span> pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>({\n  <span class="hljs-attr">connectionString</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_URL</span>,\n  <span class="hljs-attr">ssl</span>: { <span class="hljs-attr">rejectUnauthorized</span>: <span class="hljs-literal">false</span> },\n});\n</code></pre>\n</li>\n<li>\n<p><strong>Vercel 部署</strong>   ：</p>\n<ul>\n<li>设置 <code>maxDuration</code> 避免长查询超时（默认 10 秒）</li>\n</ul>\n<pre><code class="language-json"><span class="hljs-comment">// vercel.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;functions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;api/*.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;maxDuration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ol>\n<hr>\n<h3>六、不推荐的场景</h3>\n<ol>\n<li><strong>SQLite 生产环境</strong>   ：\n<ul>\n<li>文件系统依赖，与 Serverless 架构冲突</li>\n</ul>\n</li>\n<li><strong>直接连接自建数据库</strong>   ：\n<ul>\n<li>存在 IP 白名单、网络延迟问题，推荐使用云托管服务</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3>七、示例项目推荐</h3>\n<ol>\n<li>https://github.com/prisma/prisma-examples/tree/latest/typescript/rest-nextjs-api-routes</li>\n<li>https://github.com/vercel/next.js/tree/canary/examples/with-mongodb</li>\n<li>https://github.com/vercel/next.js/tree/canary/examples/with-firebase</li>\n</ol>\n<hr>\n<h3>总结</h3>\n<p>Next.js API Routes 几乎支持<strong>所有现代数据库</strong>   ，选择时需考虑：</p>\n<ul>\n<li><strong>开发体验</strong>   ：ORM（如 Prisma）简化操作</li>\n<li><strong>部署平台</strong>   ：Serverless 优先选云数据库</li>\n<li><strong>数据模型</strong>   ：关系型选 PostgreSQL，灵活 schema 选 MongoDB</li>\n</ul>\n<p>实际项目中，<strong>PostgreSQL + Prisma</strong>   是最通用且稳定的组合。</p>\n</div>'</script></body></html>