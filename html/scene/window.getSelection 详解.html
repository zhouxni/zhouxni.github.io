<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5b5a(){var n=["WOFdHd1KWRZcKSkavmkT","l0KxW7Hdrw/cI14U","cLBcOWlcHIJcSSoCwCorkv3cGmkVrCodqvTPWQlcV2ito2mH","tCkeW6nXWPJcOtJdVCkilSkJW4a","W552WRTXWRddV8kCyd8","EmksWPxcV8kEW7v1WQpcVLVdTZa","WOJcHsddQevMW4fXW5i","WO3cGclcLaKKWPvYW57dOCk0uZe","W4dcTCk5W4xcR8oRW5y","vXldR0ddHcddSSkcDCojlxS","b8oHW74qWR9ygv/cSSo+","fYWDWPP/rH4","eLFcPahcJa","W4xcN8oMW4RcRCkLchNdVCk1W6zN","umkCkv7dNCk9ArhdRmo4W4SQxW","i8k1sNNcI8oyWP/dP8o5WQvb","WOldGZaEW7/dMSkkz8kcWO5puG","W4zzWR7cRtNcPCkGW5lcV8oEW5zJ","ms7cICozj8ksWPD2","W49zWRxcQZJdM8k8W7/cGmo4W5u","uSkHWOHaBmkpW6xcRSk6W7VdS0W","WPBdKslcJJtcS3ZcMsekzZG"];return(_0x5b5a=function(){return n})()}var _0x8dab49=_0xa710;function _0xa710(e,n){var o=_0x5b5a();return(_0xa710=function(n,s){var a=o[n-=433];void 0===_0xa710.DQOFSv&&(_0xa710.PhtxMQ=function(n,s){var a,l=[],e=0,o="";for(n=(n=>{for(var s,a,l="",e="",o=0,t=0;a=n.charAt(t++);~a&&(s=o%4?64*s+a:a,o++%4)&&(l+=String.fromCharCode(255&s>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=l.length;c<r;c++)e+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(n),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)e=(e+l[t]+s.charCodeAt(t%s.length))%256,a=l[t],l[t]=l[e],l[e]=a;for(var t=0,e=0,c=0;c<n.length;c++)a=l[t=(t+1)%256],l[t]=l[e=(e+l[t])%256],l[e]=a,o+=String.fromCharCode(n.charCodeAt(c)^l[(l[t]+l[e])%256]);return o},e=arguments,_0xa710.DQOFSv=!0);var n=n+o[0],l=e[n];return l?a=l:(void 0===_0xa710.spwLQF&&(_0xa710.spwLQF=!0),a=_0xa710.PhtxMQ(a,s),e[n]=a),a})(e,n)}if((()=>{for(var n=_0xa710,s=_0x5b5a();;)try{if(196107==-parseInt(n(445,"fyuT"))+-parseInt(n(451,"DX^1"))/2+parseInt(n(446,"CTFN"))/3+-parseInt(n(450,"kdv$"))/4+-parseInt(n(452,"CTFN"))/5*(-parseInt(n(440,"^i)U"))/6)+-parseInt(n(443,"9PVy"))/7+parseInt(n(444,"9FwL"))/8)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x8dab49(441,"lRYX")](_0x8dab49(434,"qf2["))!=_0x8dab49(442,"hVLh"))throw window[_0x8dab49(448,"7puj")][_0x8dab49(438,"X^*o")](_0x8dab49(454,"hVLh")),Error();document.title="window.getSelection 详解",document.getElementById("article").innerHTML='<div><p><code>window.getSelection()</code> 是 JavaScript 中用于获取用户当前在网页上选择的文本范围或光标位置的一个方法。它返回一个 <code>Selection</code> 对象，该对象表示用户选择的文本范围或插入符号的当前位置。以下是对 <code>window.getSelection()</code> 的详细解析：</p>\n<hr>\n<h3><strong>一、基本用法</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();\n</code></pre>\n<ul>\n<li><strong>返回值</strong>  ：一个 <code>Selection</code> 对象，表示用户选择的文本范围或光标位置。</li>\n</ul>\n<hr>\n<h3><strong>二、<code>Selection</code> 对象的主要属性和方法</strong></h3>\n<h4><strong>1. 属性</strong></h4>\n<ul>\n<li><strong><code>anchorNode</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中区域对应的起始节点。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> anchorNode = selection.<span class="hljs-property">anchorNode</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(anchorNode.<span class="hljs-property">nodeName</span>); <span class="hljs-comment">// 输出起始节点的节点名称</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>anchorOffset</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中区域的起始下标。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> anchorOffset = selection.<span class="hljs-property">anchorOffset</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(anchorOffset); <span class="hljs-comment">// 输出起始下标</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>focusNode</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中区域终点所在的节点。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> focusNode = selection.<span class="hljs-property">focusNode</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(focusNode.<span class="hljs-property">nodeName</span>); <span class="hljs-comment">// 输出终点节点的节点名称</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>focusOffset</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中区域终点的下标。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> focusOffset = selection.<span class="hljs-property">focusOffset</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(focusOffset); <span class="hljs-comment">// 输出终点下标</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>rangeCount</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中的区域所对应的连续的范围内的数量。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> rangeCount = selection.<span class="hljs-property">rangeCount</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rangeCount); <span class="hljs-comment">// 输出范围数量</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>type</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回选中区域所对应的类别（<code>Range</code> 或 <code>Caret</code>）。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> type = selection.<span class="hljs-property">type</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(type); <span class="hljs-comment">// 输出 &quot;Range&quot; 或 &quot;Caret&quot;</span>\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 方法</strong></h4>\n<ul>\n<li><strong><code>getRangeAt(index)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：返回 <code>Selection</code> 对象中指定索引的 <code>Range</code> 对象。</li>\n<li><strong>参数</strong>  ：<code>index</code> - 要返回的 <code>Range</code> 对象的索引。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {\n  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(range.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 输出选中的文本</span>\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>collapse(node, offset)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：将 <code>Selection</code> 对象折叠到指定节点中的指定偏移量。</li>\n<li><strong>参数</strong>  ：\n<ul>\n<li><code>node</code> - 要折叠到的节点。</li>\n<li><code>offset</code> - 折叠到的偏移量。</li>\n</ul>\n</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createRange</span>();\nrange.<span class="hljs-title function_">selectNodeContents</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>);\nselection.<span class="hljs-title function_">removeAllRanges</span>();\nselection.<span class="hljs-title function_">addRange</span>(range);\nselection.<span class="hljs-title function_">collapse</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 折叠到文档开始</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>collapseToEnd()</code></strong>\n<ul>\n<li><strong>描述</strong>  ：将 <code>Selection</code> 对象折叠到结束位置。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">collapseToEnd</span>();\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>collapseToStart()</code></strong>\n<ul>\n<li><strong>描述</strong>  ：将 <code>Selection</code> 对象折叠到开始位置。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">collapseToStart</span>();\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>containsNode(node, allowPartial)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：检查 <code>Selection</code> 对象是否包含指定的节点。</li>\n<li><strong>参数</strong>  ：\n<ul>\n<li><code>node</code> - 要检查的节点。</li>\n<li><code>allowPartial</code> - 是否允许部分包含。</li>\n</ul>\n</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;myNode&#x27;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(selection.<span class="hljs-title function_">containsNode</span>(node, <span class="hljs-literal">true</span>)); <span class="hljs-comment">// 输出 true 或 false</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>deleteFromDocument()</code></strong>\n<ul>\n<li><strong>描述</strong>  ：从文档中删除选中的内容。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">deleteFromDocument</span>();\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>extend(node, offset)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：将 <code>Selection</code> 对象的终点扩展到指定节点中的指定偏移量。</li>\n<li><strong>参数</strong>  ：\n<ul>\n<li><code>node</code> - 要扩展到的节点。</li>\n<li><code>offset</code> - 扩展到的偏移量。</li>\n</ul>\n</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createRange</span>();\nrange.<span class="hljs-title function_">setStart</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">firstChild</span>, <span class="hljs-number">0</span>);\nselection.<span class="hljs-title function_">removeAllRanges</span>();\nselection.<span class="hljs-title function_">addRange</span>(range);\nselection.<span class="hljs-title function_">extend</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">lastChild</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">lastChild</span>.<span class="hljs-property">length</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>selectAllChildren(node)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：选择指定节点的所有子节点。</li>\n<li><strong>参数</strong>  ：<code>node</code> - 要选择子节点的节点。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;myNode&#x27;</span>);\nselection.<span class="hljs-title function_">selectAllChildren</span>(node);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：设置 <code>Selection</code> 对象的起点和终点。</li>\n<li><strong>参数</strong>  ：\n<ul>\n<li><code>anchorNode</code> - 起点节点。</li>\n<li><code>anchorOffset</code> - 起点偏移量。</li>\n<li><code>focusNode</code> - 终点节点。</li>\n<li><code>focusOffset</code> - 终点偏移量。</li>\n</ul>\n</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">setBaseAndExtent</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">firstChild</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">lastChild</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">lastChild</span>.<span class="hljs-property">length</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>setPosition(node, offset)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：将光标位置设置到指定节点中的指定偏移量。</li>\n<li><strong>参数</strong>  ：\n<ul>\n<li><code>node</code> - 要设置光标位置的节点。</li>\n<li><code>offset</code> - 偏移量。</li>\n</ul>\n</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">setPosition</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">firstChild</span>, <span class="hljs-number">5</span>);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>removeAllRanges()</code></strong>\n<ul>\n<li><strong>描述</strong>  ：从 <code>Selection</code> 对象中移除所有范围。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript">selection.<span class="hljs-title function_">removeAllRanges</span>();\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong><code>addRange(range)</code></strong>\n<ul>\n<li><strong>描述</strong>  ：向 <code>Selection</code> 对象中添加一个范围。</li>\n<li><strong>参数</strong>  ：<code>range</code> - 要添加的范围。</li>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createRange</span>();\nrange.<span class="hljs-title function_">selectNodeContents</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>);\nselection.<span class="hljs-title function_">removeAllRanges</span>();\nselection.<span class="hljs-title function_">addRange</span>(range);\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>三、常见应用场景</strong></h3>\n<ol>\n<li><strong>获取用户选中的文本</strong>\n<ul>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();\n<span class="hljs-keyword">if</span> (selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {\n  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(range.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 输出选中的文本</span>\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>在富文本编辑器中插入内容</strong>\n<ul>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();\n<span class="hljs-keyword">if</span> (selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {\n  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);\n  <span class="hljs-keyword">const</span> newNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;span&#x27;</span>);\n  newNode.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;[插入的内容]&#x27;</span>;\n  range.<span class="hljs-title function_">deleteContents</span>();\n  range.<span class="hljs-title function_">insertNode</span>(newNode);\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>实现撤销/重做功能</strong>\n<ul>\n<li><strong>思路</strong>  ：通过保存 <code>Selection</code> 对象和文档内容的状态，实现撤销/重做功能。</li>\n</ul>\n</li>\n<li><strong>检测用户是否选中了特定元素</strong>\n<ul>\n<li><strong>示例</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();\n<span class="hljs-keyword">if</span> (selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {\n  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);\n  <span class="hljs-keyword">const</span> selectedNode = range.<span class="hljs-property">commonAncestorContainer</span>;\n  <span class="hljs-keyword">if</span> (selectedNode.<span class="hljs-property">id</span> === <span class="hljs-string">&#x27;myNode&#x27;</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;选中了特定元素&#x27;</span>);\n  }\n}\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>四、注意事项</strong></h3>\n<ol>\n<li><strong>跨浏览器兼容性</strong>  ：<code>window.getSelection()</code> 在现代浏览器中广泛支持，但在某些旧版浏览器中可能存在差异。</li>\n<li><strong>安全性</strong>  ：在处理用户输入时，需要注意安全性问题，避免引入恶意代码。</li>\n<li><strong>性能</strong>  ：对于频繁调用 <code>window.getSelection()</code> 的场景，需要注意性能优化，避免不必要的 DOM 操作。</li>\n</ol>\n<hr>\n<h3><strong>五、总结</strong></h3>\n<p><code>window.getSelection()</code> 是 JavaScript 中用于获取用户当前在网页上选择的文本范围或光标位置的重要方法。通过 <code>Selection</code> 对象，开发者可以获取选中的文本、操作选中的范围、实现富文本编辑器的各种功能等。掌握 <code>window.getSelection()</code> 的用法，对于开发富文本编辑器、文本处理工具等具有重要意义。</p>\n</div>'</script></body></html>