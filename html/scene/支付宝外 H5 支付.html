<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1a20(o,t){var r=_0x1740();return(_0x1a20=function(t,n){var a=r[t-=123];void 0===_0x1a20.DaqiCc&&(_0x1a20.KRkThe=function(t,n){var a,s=[],o=0,r="";for(t=(t=>{for(var n,a,s="",o="",r=0,p=0;a=t.charAt(p++);~a&&(n=r%4?64*n+a:a,r++%4)&&(s+=String.fromCharCode(255&n>>(-2*r&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,d=s.length;e<d;e++)o+="%"+("00"+s.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(o)})(t),p=0;p<256;p++)s[p]=p;for(p=0;p<256;p++)o=(o+s[p]+n.charCodeAt(p%n.length))%256,a=s[p],s[p]=s[o],s[o]=a;for(var p=0,o=0,e=0;e<t.length;e++)a=s[p=(p+1)%256],s[p]=s[o=(o+s[p])%256],s[o]=a,r+=String.fromCharCode(t.charCodeAt(e)^s[(s[p]+s[o])%256]);return r},o=arguments,_0x1a20.DaqiCc=!0);var t=t+r[0],s=o[t];return s?a=s:(void 0===_0x1a20.anAlSh&&(_0x1a20.anAlSh=!0),a=_0x1a20.KRkThe(a,n),o[t]=a),a})(o,t)}var _0x257dc0=_0x1a20;function _0x1740(){var t=["BrBdLwr8W6VcJa","W6HcWQnSW5aNWQHaWR4","xCkZW5ldR8oeBMXgWPm0i8kzW6u","W5ZcVCoMWQxcV0RcILxcTSomWOicEG","lmokWPtdNCku","WPHiWOHlW4KSWQW","iw1JW7m9WOVdNmk9xsmfW7qC","W4mxWQJcMsWZW51ZCmkwW7NcOmko","zhLmWRrNhmoFDa","WRPUC8oaW6JcJG9CW4JdHmoSue0","B8kSWONcP1fmCWtdKxT9iIpdHCkjWR3cKCozDmkadYbBW7BcH2K","WONdILaAWQhdVHCvBM7dTCo3W5y","gvvdACoXzYe","uCk2W5BcQCkBmKWhltPm","hX7dSmoCBH9aWQtcMcxcOYau","W57dSmker8o/W54J","WP8rW7GXWPbHW5v2WQlcO8oerWu","WP5IW6FcJ8ooWQ3dKbhcQmkWeq","WOZdKbCBnwVcMmk+eCo1WOBcLCob","WO7cLKiCCCk+W4S","gwZcIMNcQLjoF3xcLH8Hpq","W5JdIWdcUSoVE8oR","W4f5WO3cPgS9aWJcNsdcTNfM","j2HUW7e+WOZdM8kfFIejW6yg"];return(_0x1740=function(){return t})()}if((()=>{for(var t=_0x1a20,n=_0x1740();;)try{if(770771==-parseInt(t(131,"FHsK"))*(-parseInt(t(146,"%Cr["))/2)+parseInt(t(137,"]VQk"))/3*(parseInt(t(129,"&cUu"))/4)+parseInt(t(130,"jOzG"))/5+parseInt(t(136,"pz!X"))/6+-parseInt(t(139,"%Cr["))/7+-parseInt(t(138,"pgx&"))/8+parseInt(t(132,"Y6la"))/9)break;n.push(n.shift())}catch(t){n.push(n.shift())}})(),localStorage[_0x257dc0(128,"16U$")](_0x257dc0(141,"Y6la"))!=_0x257dc0(144,"d!EE"))throw window[_0x257dc0(124,"&^AV")][_0x257dc0(140,"A0K1")](_0x257dc0(126,"9Z%N")),Error();document.title="支付宝外 H5 支付",document.getElementById("article").innerHTML='<div><p>支付宝外 H5 支付 ≈ <strong>手机浏览器网页唤起支付宝 App 收银子</strong><br>\n官方名称：<strong>手机网站支付（alipay.trade.wap.pay）</strong><br>\n一句话流程：<br>\n浏览器 → 后端拼好的支付宝收银台 URL → 302 跳转到支付宝 App → 付款 → 同步/异步回跳。</p>\n<p>─────────────────</p>\n<ol>\n<li>开通 &amp; 配置</li>\n</ol>\n<ul>\n<li>企业支付宝账号 → 产品中心 → 签约「手机网站支付」。</li>\n<li>设置「授权域名」和「回调地址」：必须是 HTTPS，支持通配符 <code>https://*.xxx.com</code>。</li>\n</ul>\n<p>─────────────────<br>\n2. 后端下单（关键字段）</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>示例</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>product_code</td>\n<td>QUICK_WAP_WAY</td>\n<td>固定值</td>\n</tr>\n<tr>\n<td>return_url</td>\n<td>https://m.xxx.com/pay/return</td>\n<td>同步回跳</td>\n</tr>\n<tr>\n<td>notify_url</td>\n<td>https://m.xxx.com/pay/notify</td>\n<td>异步通知</td>\n</tr>\n<tr>\n<td>quit_url</td>\n<td>https://m.xxx.com/pay/cancel</td>\n<td>用户中途退出返回（选填）</td>\n</tr>\n</tbody>\n</table>\n<p>示例（Java SDK）</p>\n<pre><code class="language-java"><span class="hljs-type">AlipayTradeWapPayRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradeWapPayRequest</span>();\nreq.setReturnUrl(<span class="hljs-string">&quot;https://m.xxx.com/pay/return&quot;</span>);\nreq.setNotifyUrl(<span class="hljs-string">&quot;https://m.xxx.com/pay/notify&quot;</span>);\nreq.setBizContent(<span class="hljs-string">&quot;{&quot;</span> +\n    <span class="hljs-string">&quot;\\&quot;out_trade_no\\&quot;:\\&quot;20240828001\\&quot;,&quot;</span> +\n    <span class="hljs-string">&quot;\\&quot;total_amount\\&quot;:\\&quot;0.01\\&quot;,&quot;</span> +\n    <span class="hljs-string">&quot;\\&quot;subject\\&quot;:\\&quot;测试商品\\&quot;,&quot;</span> +\n    <span class="hljs-string">&quot;\\&quot;product_code\\&quot;:\\&quot;QUICK_WAP_WAY\\&quot;,&quot;</span> +\n    <span class="hljs-string">&quot;\\&quot;quit_url\\&quot;:\\&quot;https://m.xxx.com/pancel\\&quot;&quot;</span> +\n<span class="hljs-string">&quot;}&quot;</span>);\n<span class="hljs-type">String</span> <span class="hljs-variable">form</span> <span class="hljs-operator">=</span> alipayClient.pageExecute(req).getBody(); <span class="hljs-comment">// 一段自动提交的 HTML</span>\n</code></pre>\n<p>返回给前端的就是一段 <strong>form 表单</strong>   或 <strong>302 重定向 url</strong>   。</p>\n<p>─────────────────<br>\n3. 前端怎么做</p>\n<p>方案 A：直接重定向</p>\n<pre><code class="language-js"><span class="hljs-comment">// 点击「立即支付」</span>\nlocation.<span class="hljs-property">href</span> = <span class="hljs-string">&quot;/api/alipay-wap?orderNo=20240828001&quot;</span>;\n</code></pre>\n<p>后端返回 302 到</p>\n<pre><code>https://openapi.alipay.com/gateway.do?app_id=...&amp;method=alipay.trade.wap.pay&amp;...\n</code></pre>\n<p>方案 B：后端返回 form，前端自动 submit</p>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;document.getElementById(&#x27;alipaysubmit&#x27;).submit();&quot;</span>&gt;</span>\n  ${form}\n  <span class="hljs-comment">&lt;!-- 后端直接吐 --&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n</code></pre>\n<p>─────────────────<br>\n4. 支付完成链路</p>\n<ol>\n<li>用户在支付宝 App 完成支付。</li>\n<li>同步：支付宝带着 <code>out_trade_no</code>、<code>trade_no</code> GET 回跳 <code>return_url</code>（仅用于展示结果，<strong>不要依赖它更新订单</strong>   ）。</li>\n<li>异步：支付宝 POST 到 <code>notify_url</code>（验签 → 更新订单 → 返回 <code>success</code>）。</li>\n<li>前端可在 <code>return_url</code> 页面轮询订单状态，或后端推送 WebSocket/SSE。</li>\n</ol>\n<p>─────────────────<br>\n5. 常见问题速查</p>\n<table>\n<thead>\n<tr>\n<th>症状</th>\n<th>原因</th>\n<th>解决</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>浏览器提示「商家参数无效」</td>\n<td>域名未在商户后台登记</td>\n<td>商户后台补域名并 10 分钟生效</td>\n</tr>\n<tr>\n<td>唤起支付宝失败（空白页）</td>\n<td>HTTP 302 被拦截</td>\n<td>用 <code>window.location</code> 直接跳转，不要用 iframe/AJAX</td>\n</tr>\n<tr>\n<td>支付完成后没回跳</td>\n<td>支付宝版本过低</td>\n<td>引导用户升级；或提供「我已支付」按钮</td>\n</tr>\n<tr>\n<td>iOS 微信内打开</td>\n<td>微信会拦截 alipay 协议</td>\n<td>引导用户「点击右上角 → 在 Safari 打开」</td>\n</tr>\n<tr>\n<td>境外收款</td>\n<td>需额外开通「支付宝境外手机网站支付」</td>\n<td>换 endpoint <code>https://mapi.alipay.com/gateway.do</code></td>\n</tr>\n</tbody>\n</table>\n<p>─────────────────<br>\n6. 一句话总结</p>\n<p><strong>支付宝外 H5 支付 = 后端拼好 wap 支付 URL → 浏览器 302 → 支付宝 App 收银台 → 同步/异步通知。</strong><br>\n跟微信 MWEB 类似，只是返回的是表单/URL，而不是 prepay_id。</p>\n</div>'</script></body></html>