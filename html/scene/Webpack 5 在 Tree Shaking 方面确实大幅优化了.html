<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1000(a,n){var t=_0x1085();return(_0x1000=function(n,s){var e=t[n-=474];void 0===_0x1000.EvNbts&&(_0x1000.uDUeEa=function(n,s){var e,o=[],a=0,t="";for(n=(n=>{for(var s,e,o="",a="",t=0,r=0;e=n.charAt(r++);~e&&(s=t%4?64*s+e:e,t++%4)&&(o+=String.fromCharCode(255&s>>(-2*t&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var c=0,l=o.length;c<l;c++)a+="%"+("00"+o.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(a)})(n),r=0;r<256;r++)o[r]=r;for(r=0;r<256;r++)a=(a+o[r]+s.charCodeAt(r%s.length))%256,e=o[r],o[r]=o[a],o[a]=e;for(var r=0,a=0,c=0;c<n.length;c++)e=o[r=(r+1)%256],o[r]=o[a=(a+o[r])%256],o[a]=e,t+=String.fromCharCode(n.charCodeAt(c)^o[(o[r]+o[a])%256]);return t},a=arguments,_0x1000.EvNbts=!0);var n=n+t[0],o=a[n];return o?e=o:(void 0===_0x1000.cbQMoD&&(_0x1000.cbQMoD=!0),e=_0x1000.uDUeEa(e,s),a[n]=e),e})(a,n)}var _0x19e0d8=_0x1000;function _0x1085(){var n=["Emk/WPzCCYpcNW","sb7cVMmHiCkLW480WQlcHZtdNqbHWQlcMCo3DCkLW6KqWQhdR8oEuW","WOZcI8k/W4HIdg9Ghaml","vWpcNSkZewhcQSoiEbBcQbK","W5ddL3NcQrFdTcFdMu8","WOqgi8ogW6ZcQaflFGddUIP/","WRqYW6COW7NcG8oNW5ddUG","nCkOWOdcSNW","WOFcHSoeWPqGiefN","fv7dUgirs8obWOuj","W4hcVuddSmk0dmkmzW","nCkjgCkYCseCv2hdPSo8","mmkdfSk2FxmRyNFdPSodWRy","vapcNmoQyZhcQSoewa","D8oTW4VdTZ06WOeMW5O1CMq","fhZdGbzHbmoBqSkyt8kpW6tcPG","vHLcvCoeW4KRW5pdM2tcSf4","gmkryxBcT10rW6ZcHJJcLmo0","D8oKW4tcHuPQWR0NW70","lmoGW5P3F3O5m8k3WQ1A","s8kDeCksth0CCmo7","umoQWQRcGmoeuSoD","omohrCkZCgO/qCot","WRDAW61hvmkvWOldPmk+WRyj","W4a6W4VdIHlcVa3cO8kYhXVdRa","WPxdPM7dUmk2a8kUra"];return(_0x1085=function(){return n})()}if((()=>{for(var n=_0x1000,s=_0x1085();;)try{if(152379==-parseInt(n(499,"YD0#"))*(-parseInt(n(497,"qQo6"))/2)+parseInt(n(495,"kiii"))/3*(parseInt(n(475,"kiii"))/4)+parseInt(n(491,"#WDH"))/5+parseInt(n(496,"zP8l"))/6+-parseInt(n(484,"&o#G"))/7+parseInt(n(486,"EyeU"))/8*(parseInt(n(489,"b*[F"))/9)+-parseInt(n(498,"xJCZ"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x19e0d8(493,"5wgJ")](_0x19e0d8(487,"b*[F"))!=_0x19e0d8(474,"1^Wc"))throw window[_0x19e0d8(477,"sZZX")][_0x19e0d8(488,"Bul8")](_0x19e0d8(494,")W9X")),Error();document.title="Webpack 5 åœ¨ Tree Shaking æ–¹é¢ç¡®å®å¤§å¹…ä¼˜åŒ–äº†",document.getElementById("article").innerHTML='<div><p>æ˜¯çš„ï¼ŒWebpack 5 åœ¨ <strong>Tree Shaking</strong>   æ–¹é¢ç¡®å®å¤§å¹…ä¼˜åŒ–äº†<strong>è‡ªåŠ¨è¯†åˆ«å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰</strong>   çš„èƒ½åŠ›ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œè€Œæ— éœ€æ‰‹åŠ¨é…ç½® <code>sideEffects</code> å­—æ®µã€‚ä»¥ä¸‹æ˜¯ Webpack 5 åœ¨ Tree Shaking æ–¹é¢çš„æ ¸å¿ƒæ”¹è¿›å’Œä¼˜åŒ–ç­–ç•¥ï¼š</p>\n<hr>\n<h2><strong>1. Webpack 5 çš„ Tree Shaking å¢å¼º</strong></h2>\n<h3><strong>(1) æ›´æ·±å…¥çš„é™æ€åˆ†æ</strong></h3>\n<p>Webpack 5 é€šè¿‡æ”¹è¿›çš„ <strong><code>innerGraph</code></strong>   ä¼˜åŒ–ï¼Œå¯ä»¥æ›´ç²¾ç¡®åœ°è¿½è¸ªæ¨¡å—å†…éƒ¨çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ï¼š</p>\n<ul>\n<li><strong>åµŒå¥—å±æ€§è®¿é—®</strong>   ï¼ˆå¦‚ <code>obj.used</code> vs <code>obj.unused</code>ï¼‰</li>\n<li><strong>æ¨¡å—å†…éƒ¨æœªä½¿ç”¨çš„å¯¼å‡º</strong>   ï¼ˆå³ä½¿å®ƒä»¬åœ¨åŒä¸€æ–‡ä»¶ä¸­ï¼‰</li>\n<li><strong>CommonJS çš„éƒ¨åˆ†é™æ€åˆ†æ</strong>   ï¼ˆå¦‚ <code>require</code> çš„ç®€å•è§£æ„ï¼‰</li>\n</ul>\n<h3><strong>(2) è‡ªåŠ¨è¯†åˆ«å‰¯ä½œç”¨</strong></h3>\n<p>Webpack 5 ä¼š<strong>è‡ªåŠ¨åˆ†æä»£ç æ˜¯å¦æœ‰å‰¯ä½œç”¨</strong>   ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li><strong>ç›´æ¥å‰¯ä½œç”¨</strong>   ï¼ˆå¦‚ <code>console.log</code>ã€<code>window.x = 1</code>ï¼‰ä¼šè¢«æ ‡è®°ï¼Œä¸ä¼šè¢« Tree Shaking ç§»é™¤ã€‚</li>\n<li><strong>çº¯å‡½æ•°è°ƒç”¨</strong>   ï¼ˆå¦‚ <code>/*#__PURE__*/</code> æ ‡è®°çš„å‡½æ•°ï¼‰ä¼šè¢«ä¼˜åŒ–ã€‚</li>\n</ul>\n<h3><strong>(3) åŠ¨æ€å¯¼å…¥çš„ Tree Shaking</strong></h3>\n<p>Webpack 5 æ”¯æŒå¯¹ <code>import()</code> åŠ¨æ€å¯¼å…¥çš„ä»£ç è¿›è¡Œ Tree Shakingï¼š</p>\n<pre><code class="language-js"><span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackExports: [&quot;used&quot;] */</span> <span class="hljs-string">&quot;./module.js&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-title function_">used</span>()); <span class="hljs-comment">// åªä¿ç•™ `used`ï¼Œç§»é™¤æœªä½¿ç”¨çš„å¯¼å‡º</span>\n</code></pre>\n<hr>\n<h2><strong>2. ä½•æ—¶ä»éœ€ <code>sideEffects</code> é…ç½®ï¼Ÿ</strong></h2>\n<p>è™½ç„¶ Webpack 5 çš„è‡ªåŠ¨åˆ†æèƒ½åŠ›å¾ˆå¼ºï¼Œä½†ä»¥ä¸‹æƒ…å†µä»éœ€æ‰‹åŠ¨é…ç½® <code>sideEffects</code>ï¼š</p>\n<h3><strong>(1) æ¨¡å—æ•´ä½“æœ‰å‰¯ä½œç”¨</strong></h3>\n<p>ä¾‹å¦‚ï¼š</p>\n<ul>\n<li><strong>CSS æ–‡ä»¶</strong>   ï¼ˆ<code>import \'./styles.css\'</code>ï¼‰</li>\n<li><strong>Polyfill æˆ–å…¨å±€åˆå§‹åŒ–è„šæœ¬</strong>   ï¼ˆ<code>import \'regenerator-runtime\'</code>ï¼‰</li>\n</ul>\n<p>éœ€è¦åœ¨ <code>package.json</code> ä¸­å£°æ˜ï¼š</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;*.css&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;*.global.js&quot;</span><span class="hljs-punctuation">]</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<p>å¦åˆ™ Webpack å¯èƒ½ä¼šè¯¯åˆ å®ƒä»¬ã€‚</p>\n<h3><strong>(2) ç¬¬ä¸‰æ–¹åº“ä¼˜åŒ–</strong></h3>\n<p>æŸäº›åº“ï¼ˆå¦‚ <code>lodash</code>ï¼‰éœ€è¦ <code>sideEffects: false</code> æ¥å¯ç”¨å®Œæ•´ Tree Shakingï¼š</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<p>å¦åˆ™ Webpack å¯èƒ½æ— æ³•ä¼˜åŒ–å…¶æœªä½¿ç”¨çš„å¯¼å‡ºã€‚</p>\n<h3><strong>(3) é¿å…è¯¯åˆ å¿…è¦ä»£ç </strong></h3>\n<p>å¦‚æœä»£ç æ¶‰åŠ<strong>åŠ¨æ€å±æ€§è®¿é—®</strong>   æˆ–<strong>å¤æ‚å‰¯ä½œç”¨</strong>   ï¼Œæ˜¾å¼å£°æ˜ <code>sideEffects</code> æ›´å®‰å…¨ã€‚</p>\n<hr>\n<h2><strong>3. å¦‚ä½•éªŒè¯ Tree Shaking æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</strong></h2>\n<h3><strong>(1) æŸ¥çœ‹ç¼–è¯‘è¾“å‡º</strong></h3>\n<p>åœ¨ <code>webpack.config.js</code> ä¸­å¯ç”¨ <code>usedExports</code>ï¼š</p>\n<pre><code class="language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">optimization</span>: {\n    <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¾ç¤ºå“ªäº›å¯¼å‡ºè¢«ä½¿ç”¨</span>\n    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç”Ÿäº§æ¨¡å¼é»˜è®¤å¯ç”¨</span>\n  },\n};\n</code></pre>\n<p>ç¼–è¯‘åï¼Œæœªä½¿ç”¨çš„ä»£ç ä¼šè¢«æ ‡è®°ä¸º <code>/* unused harmony export */</code>ã€‚</p>\n<h3><strong>(2) ä½¿ç”¨ <code>webpack-bundle-analyzer</code></strong></h3>\n<pre><code class="language-bash">npm install --save-dev webpack-bundle-analyzer\n</code></pre>\n<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span> =\n  <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-bundle-analyzer&quot;</span>).<span class="hljs-property">BundleAnalyzerPlugin</span>;\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>()],\n};\n</code></pre>\n<p>è¿è¡Œæ„å»ºåï¼Œå¯è§†åŒ–åˆ†æå“ªäº›ä»£ç è¢«ç§»é™¤ã€‚</p>\n<hr>\n<h2><strong>4. æœ€ä½³å®è·µ</strong></h2>\n<ol>\n<li><strong>ä¼˜å…ˆä¾èµ– Webpack 5 çš„è‡ªåŠ¨åˆ†æ</strong>   ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€æ‰‹åŠ¨é…ç½® <code>sideEffects</code>ã€‚</li>\n<li><strong>å¯¹ç¬¬ä¸‰æ–¹åº“</strong>   ï¼Œæ£€æŸ¥å…¶ <code>package.json</code> æ˜¯å¦æ”¯æŒ Tree Shakingï¼ˆå¦‚ <code>lodash-es</code> ä¼˜äº <code>lodash</code>ï¼‰ã€‚</li>\n<li><strong>å¯¹ CSS/å…¨å±€è„šæœ¬</strong>   ï¼Œæ˜¾å¼å£°æ˜ <code>sideEffects</code> é˜²æ­¢è¯¯åˆ ã€‚</li>\n<li><strong>ä½¿ç”¨ <code>/*#__PURE__*/</code> æ ‡è®°æ— å‰¯ä½œç”¨çš„å‡½æ•°è°ƒç”¨</strong>   ï¼š<pre><code class="language-js"><span class="hljs-keyword">const</span> result = <span class="hljs-comment">/*#__PURE__*/</span> <span class="hljs-title function_">calculate</span>(); <span class="hljs-comment">// æç¤º Webpack å¯å®‰å…¨ç§»é™¤</span>\n</code></pre>\n</li>\n<li><strong>ç”Ÿäº§æ¨¡å¼é»˜è®¤å¯ç”¨ Tree Shaking</strong>   ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚</li>\n</ol>\n<hr>\n<h2><strong>æ€»ç»“</strong></h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>Webpack 4</th>\n<th>Webpack 5</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è‡ªåŠ¨å‰¯ä½œç”¨åˆ†æ</strong></td>\n<td>è¾ƒå¼±ï¼Œä¾èµ– <code>sideEffects</code></td>\n<td><strong>å¤§å¹…å¢å¼º</strong>   ï¼Œå¯è‡ªåŠ¨è¯†åˆ«</td>\n</tr>\n<tr>\n<td><strong>åµŒå¥—å±æ€§ä¼˜åŒ–</strong></td>\n<td>ä¸æ”¯æŒ</td>\n<td><strong>æ”¯æŒ</strong>   ï¼ˆå¦‚ <code>obj.used</code> vs <code>obj.unused</code>ï¼‰</td>\n</tr>\n<tr>\n<td><strong>åŠ¨æ€å¯¼å…¥ Tree Shaking</strong></td>\n<td>æœ‰é™æ”¯æŒ</td>\n<td><strong>å®Œæ•´æ”¯æŒ</strong></td>\n</tr>\n<tr>\n<td><strong>CommonJS ä¼˜åŒ–</strong></td>\n<td>å‡ ä¹æ— ä¼˜åŒ–</td>\n<td><strong>éƒ¨åˆ†é™æ€åˆ†æ</strong></td>\n</tr>\n</tbody>\n</table>\n<p><strong>ç»“è®º</strong>   ï¼š</p>\n<ul>\n<li><strong>Webpack 5 çš„ Tree Shaking æ›´æ™ºèƒ½</strong>   ï¼Œèƒ½è‡ªåŠ¨ç§»é™¤æ›´å¤šæ— ç”¨ä»£ç ã€‚</li>\n<li><strong>ä½†ä»éœ€ <code>sideEffects</code> é…ç½®</strong>   æ¥å¤„ç† CSSã€ç¬¬ä¸‰æ–¹åº“ç­‰ç‰¹æ®Šæƒ…å†µã€‚</li>\n<li><strong>æ¨èç»“åˆ <code>webpack-bundle-analyzer</code> éªŒè¯ä¼˜åŒ–æ•ˆæœ</strong>   ã€‚</li>\n</ul>\n<p>å¦‚æœä½ çš„é¡¹ç›®å·²ç»å‡çº§åˆ° Webpack 5ï¼Œå¯ä»¥äº«å—æ›´é«˜æ•ˆçš„ Tree Shakingï¼Œä½†ä»éœ€æ³¨æ„è¾¹ç¼˜æƒ…å†µçš„æ‰‹åŠ¨ä¼˜åŒ–ã€‚ ğŸš€</p>\n</div>'</script></body></html>