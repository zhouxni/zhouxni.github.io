<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3416cb=_0x1ff3;function _0x1ff3(p,s){var r=_0x20d6();return(_0x1ff3=function(s,n){var a=r[s-=106];void 0===_0x1ff3.lzASGK&&(_0x1ff3.vVLBjZ=function(s,n){var a,l=[],p=0,r="";for(s=(s=>{for(var n,a,l="",p="",r=0,t=0;a=s.charAt(t++);~a&&(n=r%4?64*n+a:a,r++%4)&&(l+=String.fromCharCode(255&n>>(-2*r&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,o=l.length;e<o;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)p=(p+l[t]+n.charCodeAt(t%n.length))%256,a=l[t],l[t]=l[p],l[p]=a;for(var t=0,p=0,e=0;e<s.length;e++)a=l[t=(t+1)%256],l[t]=l[p=(p+l[t])%256],l[p]=a,r+=String.fromCharCode(s.charCodeAt(e)^l[(l[t]+l[p])%256]);return r},p=arguments,_0x1ff3.lzASGK=!0);var s=s+r[0],l=p[s];return l?a=l:(void 0===_0x1ff3.JZXSFs&&(_0x1ff3.JZXSFs=!0),a=_0x1ff3.vVLBjZ(a,n),p[s]=a),a})(p,s)}function _0x20d6(){var s=["W5vJW7X7C1JdPuZcLCkochqi","b8oLcYW5Emopa2K","W43dUdXeW7TWW7bTDJ3cS8kzuW","gWPqWOldGX9s","fColiu0ImCovBJLrWQ/dQW","WPBcQGVdO8oYvGiGWQS","DmoNqKVdRxpcQGqasxXArNBdVgiqDSogW4lcScpcVuBdS8kQ","WPaqxNfoWQL4WOO","W6JcMmoqWRpcQ8oIWRv4q3a","lCoSW7tcI8oGoJO6cSkYEa","WOxcJCkmW4K3cSozW6e1o8kqW7S","W6eDCCkmq8ooW5DlWPRdISkSySo3","W6exDCo4bCkNWQnQWO8","hSo5WQq0qa","WP/cQq7cVSomCtKHWO1q","WR8LWQz7sdpdQmo1amkDW7NcLWy","WOJcGCk/W7RcUCkzDmkdW4m","W7X8W67dIuWdWRldKmk1W5a","n8o4j8kDDJzRW7mxWOZdJspcOW","WOm3W4ndWQ/cUxq","W5RdSMXdW5XDBmkWW43cTCkTia","WPqVWPLlW5VdGSoLW7e8aIhdVq","jCoQhSkxWQNdPmolW77cRxnn","pCoqWQlcSmobxSkACWfy"];return(_0x20d6=function(){return s})()}if((()=>{for(var s=_0x1ff3,n=_0x20d6();;)try{if(932316==-parseInt(s(128,"#mdc"))*(-parseInt(s(116,"H&[E"))/2)+parseInt(s(113,"KtqP"))/3+-parseInt(s(122,"TEZa"))/4+-parseInt(s(109,"BccM"))/5*(-parseInt(s(119,"%[kQ"))/6)+parseInt(s(107,"n&ck"))/7+-parseInt(s(112,"ZShf"))/8*(parseInt(s(108,"mhb1"))/9)+-parseInt(s(129,"q(QS"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3416cb(106,"ztq)")](_0x3416cb(127,"@8b^"))!=_0x3416cb(124,"$y*%"))throw window[_0x3416cb(118,"WPi9")][_0x3416cb(114,"wyZP")](_0x3416cb(117,"e1*3")),Error();document.title="Vue项目中有封装过axios吗 怎么封装的",document.getElementById("article").innerHTML='<div><p>在Vue项目中，封装Axios是一个常见的做法，旨在简化HTTP请求的处理、统一配置和管理请求逻辑。以下是一个典型的Axios封装示例，以及封装的思路和步骤。</p>\n<hr>\n<h3><strong>一、为什么要封装Axios？</strong></h3>\n<ol>\n<li><strong>统一配置</strong>  ：集中管理请求的基础URL、超时时间、请求头等配置。</li>\n<li><strong>请求拦截</strong>  ：在请求发送前进行统一处理，如添加认证token、设置loading状态等。</li>\n<li><strong>响应拦截</strong>  ：在响应返回后进行统一处理，如处理错误、统一数据格式等。</li>\n<li><strong>代码复用</strong>  ：减少重复代码，提高开发效率。</li>\n</ol>\n<hr>\n<h3><strong>二、Axios封装示例</strong></h3>\n<h4><strong>1. 安装Axios</strong></h4>\n<pre><code class="language-sh">npm install axios\n</code></pre>\n<h4><strong>2. 创建Axios实例</strong></h4>\n<p>在<code>src/utils</code>目录下创建<code>request.js</code>文件，用于封装Axios。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// src/utils/request.js</span>\n<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Message</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>; <span class="hljs-comment">// 假设使用Element UI进行消息提示</span>\n<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/router&#x27;</span>; <span class="hljs-comment">// 引入路由，用于跳转登录等</span>\n\n<span class="hljs-comment">// 创建Axios实例</span>\n<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({\n  <span class="hljs-attr">baseURL</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_BASE_API</span> || <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>, <span class="hljs-comment">// 基础URL</span>\n  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// 超时时间</span>\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,\n  },\n});\n\n<span class="hljs-comment">// 请求拦截器</span>\nservice.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(\n  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {\n    <span class="hljs-comment">// 在发送请求之前做些什么，比如添加token</span>\n    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>);\n    <span class="hljs-keyword">if</span> (token) {\n      config.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Authorization&#x27;</span>] = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;\n    }\n    <span class="hljs-keyword">return</span> config;\n  },\n  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n    <span class="hljs-comment">// 对请求错误做些什么</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Request Error:&#x27;</span>, error);\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);\n  }\n);\n\n<span class="hljs-comment">// 响应拦截器</span>\nservice.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(\n  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {\n    <span class="hljs-comment">// 对响应数据做点什么，比如统一处理数据格式</span>\n    <span class="hljs-keyword">const</span> res = response.<span class="hljs-property">data</span>;\n    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> !== <span class="hljs-number">200</span>) {\n      <span class="hljs-comment">// 假设后端返回code不为200表示错误</span>\n      <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;Error&#x27;</span>);\n      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(res.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;Error&#x27;</span>));\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-keyword">return</span> res;\n    }\n  },\n  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n    <span class="hljs-comment">// 对响应错误做点什么</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Response Error:&#x27;</span>, error);\n    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {\n      <span class="hljs-keyword">const</span> status = error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>;\n      <span class="hljs-keyword">if</span> (status === <span class="hljs-number">401</span>) {\n        <span class="hljs-comment">// 未授权，跳转到登录页面</span>\n        <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Unauthorized, please login again&#x27;</span>);\n        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);\n      } <span class="hljs-keyword">else</span> {\n        <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;Request failed&#x27;</span>);\n      }\n    }\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);\n  }\n);\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service;\n</code></pre>\n<hr>\n<h3><strong>三、在Vue组件中使用封装的Axios</strong></h3>\n<p>在Vue组件中，可以直接引入封装好的Axios实例进行请求。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// src/views/Home.vue</span>\n&lt;template&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;fetchData&quot;</span>&gt;</span>Fetch Data<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>\n&lt;/template&gt;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">\n<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/request&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Home&#x27;</span>,\n  <span class="hljs-attr">methods</span>: {\n    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-keyword">try</span> {\n        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>({\n          <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/data&#x27;</span>,\n          <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>,\n        });\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Data:&#x27;</span>, response);\n      } <span class="hljs-keyword">catch</span> (error) {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Fetch Data Error:&#x27;</span>, error);\n      }\n    },\n  },\n};\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>\n</code></pre>\n<hr>\n<h3><strong>四、封装Axios的关键点</strong></h3>\n<ol>\n<li><strong>配置管理</strong>  ：\n<ul>\n<li>使用<code>axios.create</code>创建实例，便于管理不同的配置。</li>\n<li>通过环境变量（如<code>VUE_APP_BASE_API</code>）管理不同环境的API地址。</li>\n</ul>\n</li>\n<li><strong>请求拦截</strong>  ：\n<ul>\n<li>在请求发送前添加认证信息（如token）。</li>\n<li>设置loading状态，提升用户体验。</li>\n</ul>\n</li>\n<li><strong>响应拦截</strong>  ：\n<ul>\n<li>统一处理响应数据格式，如提取后端返回的数据部分。</li>\n<li>处理错误响应，如未授权时跳转到登录页面。</li>\n</ul>\n</li>\n<li><strong>错误处理</strong>  ：\n<ul>\n<li>使用Promise的<code>reject</code>机制，将错误传递给调用者。</li>\n<li>提供统一的错误提示，便于用户理解。</li>\n</ul>\n</li>\n<li><strong>代码复用</strong>  ：\n<ul>\n<li>将通用的请求逻辑封装在Axios实例中，减少重复代码。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>五、进阶封装</strong></h3>\n<ol>\n<li><strong>取消重复请求</strong>  ：\n<ul>\n<li>使用Axios的<code>CancelToken</code>或<code>AbortController</code>（在Axios 0.22.0及以上版本支持）取消重复请求。</li>\n</ul>\n</li>\n<li><strong>缓存请求结果</strong>  ：\n<ul>\n<li>对于不频繁变化的数据，可以缓存请求结果，减少不必要的网络请求。</li>\n</ul>\n</li>\n<li><strong>多实例管理</strong>  ：\n<ul>\n<li>对于不同的API服务，可以创建多个Axios实例，分别管理不同的配置。</li>\n</ul>\n</li>\n<li><strong>与Vuex结合</strong>  ：\n<ul>\n<li>在Vuex的actions中使用封装的Axios实例，便于管理异步请求和状态。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>六、总结</strong></h3>\n<p>封装Axios是Vue项目中常见的做法，通过集中管理请求配置、拦截请求和响应、统一处理错误，可以显著提高开发效率和代码的可维护性。以上示例展示了一个基本的Axios封装方式，你可以根据项目的具体需求进行扩展和优化。</p>\n</div>'</script></body></html>