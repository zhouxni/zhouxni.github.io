<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xe302(l,s){var e=_0x258a();return(_0xe302=function(s,n){var a=e[s-=330];void 0===_0xe302.kIyPER&&(_0xe302.lpMtcx=function(s,n){var a,t=[],l=0,e="";for(s=(s=>{for(var n,a,t="",l="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=t.length;c<o;c++)l+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),p=0;p<256;p++)t[p]=p;for(p=0;p<256;p++)l=(l+t[p]+n.charCodeAt(p%n.length))%256,a=t[p],t[p]=t[l],t[l]=a;for(var p=0,l=0,c=0;c<s.length;c++)a=t[p=(p+1)%256],t[p]=t[l=(l+t[p])%256],t[l]=a,e+=String.fromCharCode(s.charCodeAt(c)^t[(t[p]+t[l])%256]);return e},l=arguments,_0xe302.kIyPER=!0);var s=s+e[0],t=l[s];return t?a=t:(void 0===_0xe302.FdIfck&&(_0xe302.FdIfck=!0),a=_0xe302.lpMtcx(a,n),l[s]=a),a})(l,s)}function _0x258a(){var s=["W4RdRSk3W4JcHSkvFLq","i0tdJMTsW583uCoPWQz7W4pdUG","lmkxW519DSobzYxcKdubpG","W4iwk8kRW6CMjJu","hCo0WPldJ8oOWQ9wW6b6zIhcL8kDySkIWQLzWPr2WRGQuSopsCoCW5m","WPtcS8oGWPNdISopxhXFW6O4W4C","WPjwWQfOWO7cHmktW4ZcVNKKWOhcRG","W4CgW6qzW4VdLmog","W7xcM8kEWQlcTa","W4BcOf7dVvJdRmkjW5CfWO9N","xSoHD2ldLGOrya","qcZdPmk5mGBcSfWKEM1H","WQLRFSojBSkniwldU8oQWPZcOG","W5xdTGSJW5WsW4LuCsjVBSo8","WPlcGmo5W7PRWQ7cKK5dWP7dSey","W5ldSqiRW58wWRTXqs9WAa","emoGW5BcUtyqW4DN","cNZcP8oSzLxcUa","oxRcTmoLDexcLNe1","WRFdNmozW6hdTCkRyHb9pSkXW6i","WQldRgC0EgJcHSkHWRtdGHm","WR1dnqnZaSkpuKhcJfJdJq","WQPSd8kOh8oSi34","WPn+W6/cJ2NcQCocWQ/cU8kqWRnIW54"];return(_0x258a=function(){return s})()}var _0x5f4a71=_0xe302;if((()=>{for(var s=_0xe302,n=_0x258a();;)try{if(47e4==-parseInt(s(331,"jHzZ"))+parseInt(s(347,"DPMa"))/2+parseInt(s(348,"vVaB"))/3*(-parseInt(s(338,"vVaB"))/4)+parseInt(s(351,"eGWb"))/5+-parseInt(s(349,"vZTs"))/6+-parseInt(s(353,"YeQu"))/7*(parseInt(s(346,"#q(r"))/8)+parseInt(s(341,"*FpY"))/9)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x5f4a71(333,"9Ibx")](_0x5f4a71(344,"wE0("))!=_0x5f4a71(334,"hXLe"))throw window[_0x5f4a71(350,"jHzZ")][_0x5f4a71(343,"wE0(")](_0x5f4a71(330,"SK]O")),Error();document.title="Web Animations API 详解",document.getElementById("article").innerHTML='<div><p>Web Animations API (WAAPI) 是现代浏览器提供的强大动画接口，它结合了 CSS 动画和 JavaScript 动画的优点，提供了更精细的控制能力。以下是全面解析：</p>\n<h2>1. 核心概念</h2>\n<h3>基本结构</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> animation = element.<span class="hljs-title function_">animate</span>(keyframes, options);\n</code></pre>\n<h3>与传统方法的对比</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>CSS动画</th>\n<th>JavaScript定时器</th>\n<th>WAAPI</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>动态控制</td>\n<td>有限</td>\n<td>完全可控</td>\n<td>完全可控</td>\n</tr>\n<tr>\n<td>性能优化</td>\n<td>优秀</td>\n<td>一般</td>\n<td>优秀</td>\n</tr>\n<tr>\n<td>复杂度</td>\n<td>简单</td>\n<td>复杂</td>\n<td>中等</td>\n</tr>\n<tr>\n<td>兼容性</td>\n<td>优秀</td>\n<td>优秀</td>\n<td>现代浏览器</td>\n</tr>\n</tbody>\n</table>\n<h2>2. 关键帧 (Keyframes)</h2>\n<h3>两种定义方式</h3>\n<p><strong>数组形式（明确时间点）</strong></p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> keyframes = [\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span> },          <span class="hljs-comment">// 0%</span>\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.5</span> },        <span class="hljs-comment">// 50%</span>\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span> }           <span class="hljs-comment">// 100%</span>\n];\n</code></pre>\n<p><strong>对象形式（属性数组）</strong></p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> keyframes = {\n  <span class="hljs-attr">opacity</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>],         <span class="hljs-comment">// 0 → 1</span>\n  <span class="hljs-attr">transform</span>: [<span class="hljs-string">&#x27;scale(1)&#x27;</span>, <span class="hljs-string">&#x27;scale(1.5)&#x27;</span>]\n};\n</code></pre>\n<h3>高级关键帧特性</h3>\n<ul>\n<li><strong>偏移量控制</strong>  ：使用 <code>offset</code> 指定关键帧位置<pre><code class="language-javascript">[\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span> },\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">0.7</span> }, <span class="hljs-comment">// 70%处</span>\n  { <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span> }\n]\n</code></pre>\n</li>\n<li><strong>复合属性</strong>  ：支持所有CSS动画属性<pre><code class="language-javascript">{\n  <span class="hljs-attr">backgroundColor</span>: [<span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-string">&#x27;blue&#x27;</span>],\n  <span class="hljs-attr">transform</span>: [<span class="hljs-string">&#x27;rotate(0deg)&#x27;</span>, <span class="hljs-string">&#x27;rotate(360deg)&#x27;</span>]\n}\n</code></pre>\n</li>\n</ul>\n<h2>3. 动画选项 (Options)</h2>\n<h3>核心配置项</h3>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>类型</th>\n<th>说明</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>duration</code></td>\n<td>number</td>\n<td>动画时长(ms)</td>\n<td><code>1000</code></td>\n</tr>\n<tr>\n<td><code>delay</code></td>\n<td>number</td>\n<td>延迟时间(ms)</td>\n<td><code>500</code></td>\n</tr>\n<tr>\n<td><code>iterations</code></td>\n<td>number/Infinity</td>\n<td>重复次数</td>\n<td><code>5</code>, <code>Infinity</code></td>\n</tr>\n<tr>\n<td><code>direction</code></td>\n<td>string</td>\n<td>播放方向</td>\n<td><code>&quot;normal&quot;</code>, <code>&quot;reverse&quot;</code>, <code>&quot;alternate&quot;</code>, <code>&quot;alternate-reverse&quot;</code></td>\n</tr>\n<tr>\n<td><code>easing</code></td>\n<td>string</td>\n<td>缓动函数</td>\n<td><code>&quot;ease-in-out&quot;</code>, <code>&quot;cubic-bezier(0.42, 0, 0.58, 1)&quot;</code></td>\n</tr>\n<tr>\n<td><code>fill</code></td>\n<td>string</td>\n<td>动画外样式</td>\n<td><code>&quot;forwards&quot;</code>, <code>&quot;backwards&quot;</code>, <code>&quot;both&quot;</code>, <code>&quot;none&quot;</code></td>\n</tr>\n<tr>\n<td><code>composite</code></td>\n<td>string</td>\n<td>动画组合方式</td>\n<td><code>&quot;replace&quot;</code>, <code>&quot;add&quot;</code>, <code>&quot;accumulate&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<h3>特殊配置</h3>\n<pre><code class="language-javascript">{\n  <span class="hljs-comment">// 时间相关</span>\n  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>,  <span class="hljs-comment">// 2秒</span>\n  <span class="hljs-attr">delay</span>: <span class="hljs-number">500</span>,      <span class="hljs-comment">// 0.5秒后开始</span>\n  <span class="hljs-attr">endDelay</span>: <span class="hljs-number">1000</span>,  <span class="hljs-comment">// 动画结束后保持1秒</span>\n  \n  <span class="hljs-comment">// 循环控制</span>\n  <span class="hljs-attr">iterations</span>: <span class="hljs-title class_">Infinity</span>,  <span class="hljs-comment">// 无限循环</span>\n  <span class="hljs-attr">iterationStart</span>: <span class="hljs-number">0.5</span>,   <span class="hljs-comment">// 从中间开始</span>\n  \n  <span class="hljs-comment">// 高级缓动</span>\n  <span class="hljs-attr">easing</span>: <span class="hljs-string">&#x27;steps(4, jump-end)&#x27;</span>\n}\n</code></pre>\n<h2>4. 动画控制方法</h2>\n<h3>播放控制</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> animation = element.<span class="hljs-title function_">animate</span>(keyframes, options);\n\n<span class="hljs-comment">// 基础控制</span>\nanimation.<span class="hljs-title function_">pause</span>();\nanimation.<span class="hljs-title function_">play</span>();\nanimation.<span class="hljs-title function_">cancel</span>(); <span class="hljs-comment">// 重置为初始状态</span>\nanimation.<span class="hljs-title function_">finish</span>();  <span class="hljs-comment">// 立即跳到结束状态</span>\n\n<span class="hljs-comment">// 播放头控制</span>\nanimation.<span class="hljs-property">currentTime</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// 跳转到500ms位置</span>\nanimation.<span class="hljs-property">playbackRate</span> = <span class="hljs-number">2</span>;  <span class="hljs-comment">// 2倍速播放</span>\n</code></pre>\n<h3>状态查询</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 播放状态</span>\nanimation.<span class="hljs-property">playState</span>; <span class="hljs-comment">// &quot;running&quot;, &quot;paused&quot;, &quot;idle&quot;, &quot;finished&quot;</span>\n\n<span class="hljs-comment">// 时间信息</span>\nanimation.<span class="hljs-property">startTime</span>;\nanimation.<span class="hljs-property">currentTime</span>;\nanimation.<span class="hljs-property">timeline</span>;\n</code></pre>\n<h2>5. 事件系统</h2>\n<h3>事件监听</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动画完成</span>\nanimation.<span class="hljs-property">onfinish</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;动画完成&#x27;</span>, event);\n};\n\n<span class="hljs-comment">// 动画取消</span>\nanimation.<span class="hljs-property">oncancel</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;动画取消&#x27;</span>, event);\n};\n\n<span class="hljs-comment">// 动画移除</span>\nanimation.<span class="hljs-property">onremove</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;动画移除&#x27;</span>, event);\n};\n</code></pre>\n<h3>Promise接口</h3>\n<pre><code class="language-javascript">animation.<span class="hljs-property">finished</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;动画完成&#x27;</span>);\n}).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;动画中断&#x27;</span>, err);\n});\n</code></pre>\n<h2>6. 高级特性</h2>\n<h3>动画组合</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 顺序执行多个动画</span>\n<span class="hljs-keyword">const</span> animation1 = element.<span class="hljs-title function_">animate</span>(keyframes1, options1);\n<span class="hljs-keyword">const</span> animation2 = element.<span class="hljs-title function_">animate</span>(keyframes2, options2);\n\nanimation1.<span class="hljs-property">finished</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> animation2.<span class="hljs-title function_">play</span>());\n</code></pre>\n<h3>时间轴控制</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 创建自定义时间轴</span>\n<span class="hljs-keyword">const</span> timeline = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentTimeline</span>();\n\n<span class="hljs-comment">// 在特定时间轴运行动画</span>\nelement.<span class="hljs-title function_">animate</span>(keyframes, {\n  timeline,\n  <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>\n});\n</code></pre>\n<h3>性能优化技巧</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用will-change提示浏览器</span>\nelement.<span class="hljs-property">style</span>.<span class="hljs-property">willChange</span> = <span class="hljs-string">&#x27;transform, opacity&#x27;</span>;\n\n<span class="hljs-comment">// 动画结束后清理</span>\nanimation.<span class="hljs-property">onfinish</span> = <span class="hljs-function">() =&gt;</span> {\n  element.<span class="hljs-property">style</span>.<span class="hljs-property">willChange</span> = <span class="hljs-string">&#x27;auto&#x27;</span>;\n};\n</code></pre>\n<h2>7. 实际应用示例</h2>\n<h3>轮播图实现</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> slider = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.slider&#x27;</span>);\n<span class="hljs-keyword">const</span> slides = [...<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.slide&#x27;</span>)];\n<span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">nextSlide</span>(<span class="hljs-params"></span>) {\n  currentIndex = (currentIndex + <span class="hljs-number">1</span>) % slides.<span class="hljs-property">length</span>;\n  \n  slider.<span class="hljs-title function_">animate</span>([\n    { <span class="hljs-attr">transform</span>: <span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * <span class="hljs-number">100</span>}</span>%)`</span> }\n  ], {\n    <span class="hljs-attr">duration</span>: <span class="hljs-number">600</span>,\n    <span class="hljs-attr">easing</span>: <span class="hljs-string">&#x27;cubic-bezier(0.33, 1, 0.68, 1)&#x27;</span>,\n    <span class="hljs-attr">fill</span>: <span class="hljs-string">&#x27;forwards&#x27;</span>\n  });\n}\n\n<span class="hljs-comment">// 自动播放</span>\n<span class="hljs-keyword">const</span> autoPlay = <span class="hljs-built_in">setInterval</span>(nextSlide, <span class="hljs-number">3000</span>);\n\n<span class="hljs-comment">// 鼠标悬停暂停</span>\nslider.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mouseenter&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-built_in">clearInterval</span>(autoPlay);\n});\n\nslider.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mouseleave&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n  autoPlay = <span class="hljs-built_in">setInterval</span>(nextSlide, <span class="hljs-number">3000</span>);\n});\n</code></pre>\n<h2>8. 兼容性与Polyfill</h2>\n<h3>浏览器支持</h3>\n<ul>\n<li>Chrome 36+</li>\n<li>Firefox 48+</li>\n<li>Edge 79+</li>\n<li>Safari 13.1+</li>\n</ul>\n<h3>Polyfill方案</h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/web-animations-js@2.3.2/web-animations.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<h2>9. 调试工具</h2>\n<ul>\n<li>Chrome DevTools: Animation面板可查看WAAPI动画</li>\n<li>Firefox: Animation Inspector支持WAAPI调试</li>\n</ul>\n<h2>总结</h2>\n<p>Web Animations API 提供了：</p>\n<ol>\n<li>比CSS动画更灵活的动态控制能力</li>\n<li>比JavaScript定时器更高效的性能表现</li>\n<li>精细的动画时间轴控制</li>\n<li>完善的Promise和事件系统</li>\n</ol>\n<p>适合需要复杂交互、动态控制的动画场景，是现代Web动画的首选方案。</p>\n</div>'</script></body></html>