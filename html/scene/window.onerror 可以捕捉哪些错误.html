<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x44a2(r,s){var t=_0x184b();return(_0x44a2=function(s,n){var a=t[s-=337];void 0===_0x44a2.igjAja&&(_0x44a2.ISrifA=function(s,n){var a,l=[],r=0,t="";for(s=(s=>{for(var n,a,l="",r="",t=0,o=0;a=s.charAt(o++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,c=l.length;e<c;e++)r+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(r)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)r=(r+l[o]+n.charCodeAt(o%n.length))%256,a=l[o],l[o]=l[r],l[r]=a;for(var o=0,r=0,e=0;e<s.length;e++)a=l[o=(o+1)%256],l[o]=l[r=(r+l[o])%256],l[r]=a,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[o]+l[r])%256]);return t},r=arguments,_0x44a2.igjAja=!0);var s=s+t[0],l=r[s];return l?a=l:(void 0===_0x44a2.TTZnbf&&(_0x44a2.TTZnbf=!0),a=_0x44a2.ISrifA(a,n),r[s]=a),a})(r,s)}var _0x386562=_0x44a2;function _0x184b(){var s=["W6rzWQFcOLaNWQRcP8k2yW","BJNdICkJWP7dSXuOi8kU","W48UeeimW47dJs42W77cH8owWP0","xCozxgBcRq","DSosBmokWQ3cP8kGkq","W7WEifxdVG9EpSoYW5C","W7ufxt7dOfhdUgRcHW","y8k2r8opbfRdLq","efhcV8oEW5VdH2P3ztm","WQZdT8kJg1pcU8og","b8k6n8olWO9EWOz6vmoBWQu","W5VcLtFcRCk1tCoR","WQD8zrpcJ3pdU0P/WQHj","DCo+WQKcpcldGmktWQZcGuZdJq","WQlcP8kFW53cVmoIWQ5KWOD2CcOB","ACk5B3eYAmoqmmo4WRddSSonWOm","W6hcMCoVBH3dImkP","yvZdIJ4xqLigWQZcJmotW63dRG","rmkHdCoWmSkzs8o6","WO7cMSoqsX8vBmkWWQpcNYDSaeS","W45usmkCA8krWQlcJsaBcZ7cQmk1W4NcVSo6W4hcISkNuSkjWOJcQmk1WOi","W48ICJXXWQJcSc8","WQZcNmotysBdVCkWmmkRWQ5Njg0","nSkLbCo5k1PVW6nVW43dIXbV","jSkzW7rLb8k5W5hcTmoBW5G1v2Hl"];return(_0x184b=function(){return s})()}if((()=>{for(var s=_0x44a2,n=_0x184b();;)try{if(838201==+parseInt(s(338,"CfNy"))*(parseInt(s(339,"E*%t"))/2)+parseInt(s(356,"U(YH"))/3+-parseInt(s(342,"y5fl"))/4+-parseInt(s(346,"5Mwc"))/5+-parseInt(s(347,"bEtY"))/6*(-parseInt(s(351,"CfNy"))/7)+parseInt(s(354,"p$oH"))/8*(parseInt(s(337,"Sm!!"))/9)+-parseInt(s(348,"SeWX"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x386562(345,"6jwd")](_0x386562(360,"iSQ1"))!=_0x386562(357,"Y9Jx"))throw window[_0x386562(358,"c0up")][_0x386562(361,"[KUd")](_0x386562(349,")x&5")),Error();document.title="window.onerror 可以捕捉哪些错误",document.getElementById("article").innerHTML='<div><h3><strong><code>window.onerror</code> 可以捕获哪些错误？</strong></h3>\n<p><code>window.onerror</code> 是 JavaScript 提供的全局错误监听接口，主要用于捕获 <strong>未被 <code>try/catch</code> 处理的运行时错误</strong>  ，但它有一定的局限性。以下是它能捕获和不能捕获的错误类型：</p>\n<hr>\n<h2><strong>✅ 能捕获的错误</strong></h2>\n<h3><strong>1. JavaScript 运行时错误（同步/异步）</strong></h3>\n<ul>\n<li><strong>未定义的变量或函数</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);\n<span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// 报错：Uncaught ReferenceError: foo is not defined</span>\n</code></pre>\n<p>✅ 输出：<code>&quot;Uncaught ReferenceError: foo is not defined&quot;</code></p>\n<ul>\n<li><strong>类型错误（TypeError）</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-literal">null</span>.<span class="hljs-title function_">bar</span>(); <span class="hljs-comment">// TypeError: Cannot read property &#x27;bar&#x27; of null</span>\n</code></pre>\n<p>✅ 输出：<code>&quot;Uncaught TypeError: Cannot read property \'bar\' of null&quot;</code></p>\n<ul>\n<li><strong>语法错误（仅限动态执行，如 <code>eval</code>）</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;const x = ;&#x27;</span>); <span class="hljs-comment">// SyntaxError</span>\n</code></pre>\n<p>✅ 输出：<code>&quot;Uncaught SyntaxError: Unexpected token \';\'&quot;</code></p>\n<ul>\n<li><strong><code>setTimeout</code> / <code>setInterval</code> 中的异步错误</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-title function_">baz</span>(); <span class="hljs-comment">// ReferenceError</span>\n}, <span class="hljs-number">1000</span>);\n</code></pre>\n<p>✅ 输出：<code>&quot;Uncaught ReferenceError: baz is not defined&quot;</code></p>\n<hr>\n<h3><strong>2. 未被 <code>try/catch</code> 捕获的 <code>throw</code> 错误</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);\n<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;手动抛出错误&#x27;</span>);\n</code></pre>\n<p>✅ 输出：<code>&quot;Uncaught Error: 手动抛出错误&quot;</code></p>\n<hr>\n<h2><strong>❌ 不能捕获的错误</strong></h2>\n<h3><strong>1. 资源加载错误（图片、脚本、CSS 等）</strong></h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;not-exist.jpg&quot;</span> /&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;non-existent.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<p>❌ <strong>无法捕获</strong>  ，需使用 <code>element.onerror</code> 或 <code>window.addEventListener(\'error\', true)</code>。</p>\n<h3><strong>2. 静态语法错误（代码未执行）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> x = ; <span class="hljs-comment">// ❌ 无法捕获（代码解析阶段就报错）</span>\n</code></pre>\n<p>❌ <strong>原因</strong>  ：代码未执行，<code>window.onerror</code> 监听器未生效。</p>\n<h3><strong>3. <code>Promise</code> 未处理的 <code>rejection</code></strong></h3>\n<pre><code class="language-javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Oops!&#x27;</span>); <span class="hljs-comment">// ❌ 无法捕获</span>\n</code></pre>\n<p>❌ <strong>需改用</strong>   <code>window.onunhandledrejection</code>：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onunhandledrejection</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">reason</span>);\n</code></pre>\n<h3><strong>4. 跨域脚本的详细错误</strong></h3>\n<ul>\n<li>如果 <code>&lt;script&gt;</code> 来自不同域且未配置 CORS，浏览器会隐藏错误详情，仅返回 <code>&quot;Script error.&quot;</code>。</li>\n<li><strong>解决方案</strong>  ：</li>\n</ul>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://other-domain.com/app.js&quot;</span> <span class="hljs-attr">crossorigin</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<h3><strong>5. <code>iframe</code> 内的错误</strong></h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;child.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>\n</code></pre>\n<p>❌ <strong>需在 <code>iframe</code> 内部单独监听</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>).<span class="hljs-property">contentWindow</span>.<span class="hljs-property">onerror</span> = handler;\n</code></pre>\n<h3><strong>6. <code>try/catch</code> 已捕获的错误</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">try</span> {\n  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;已处理&#x27;</span>);\n} <span class="hljs-keyword">catch</span> (e) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); <span class="hljs-comment">// ❌ 不会触发 window.onerror</span>\n}\n</code></pre>\n<hr>\n<h2><strong>📌 <code>window.onerror</code> 的参数</strong></h2>\n<p>回调函数接收 5 个参数：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">message, source, lineno, colno, error</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;错误信息:&#x27;</span>, message); <span class="hljs-comment">// 如 &quot;Uncaught ReferenceError: foo is not defined&quot;</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;脚本路径:&#x27;</span>, source);   <span class="hljs-comment">// 错误发生的文件 URL</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;行号:&#x27;</span>, lineno);      <span class="hljs-comment">// 错误发生的行号</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;列号:&#x27;</span>, colno);       <span class="hljs-comment">// 错误发生的列号</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Error对象:&#x27;</span>, error);  <span class="hljs-comment">// 完整的 Error 对象（含 stack）</span>\n};\n</code></pre>\n<hr>\n<h2><strong>🚀 最佳实践</strong></h2>\n<h3><strong>1. 基础用法（仅监控 JS 错误）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;错误:&#x27;</span>, msg, <span class="hljs-string">&#x27;\\n堆栈:&#x27;</span>, error.<span class="hljs-property">stack</span>);\n  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 阻止默认控制台报错（可选）</span>\n};\n</code></pre>\n<h3><strong>2. 结合 <code>addEventListener</code> 监控资源错误</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 用 onerror 捕获 JS 错误</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;JS错误:&#x27;</span>, msg);\n\n<span class="hljs-comment">// 用 addEventListener 捕获资源错误</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">tagName</span> === <span class="hljs-string">&#x27;IMG&#x27;</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;图片加载失败:&#x27;</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">src</span>);\n  }\n}, <span class="hljs-literal">true</span>);\n</code></pre>\n<h3><strong>3. 上报错误到服务器</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/log-error&#x27;</span>, {\n    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,\n    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({\n      <span class="hljs-attr">message</span>: msg,\n      <span class="hljs-attr">stack</span>: error?.<span class="hljs-property">stack</span>,\n      <span class="hljs-attr">file</span>: src,\n      <span class="hljs-attr">line</span>: line,\n      <span class="hljs-attr">column</span>: col\n    })\n  });\n};\n</code></pre>\n<hr>\n<h2><strong>📊 总结表</strong></h2>\n<table>\n<thead>\n<tr>\n<th><strong>错误类型</strong></th>\n<th><strong><code>window.onerror</code> 能否捕获？</strong></th>\n<th><strong>替代方案</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JS 运行时错误（同步/异步）</td>\n<td>✅ 能</td>\n<td>-</td>\n</tr>\n<tr>\n<td>资源加载错误（图片/脚本）</td>\n<td>❌ 不能</td>\n<td><code>addEventListener(\'error\', true)</code></td>\n</tr>\n<tr>\n<td>跨域脚本错误（无 CORS）</td>\n<td>❌ 仅返回 <code>&quot;Script error.&quot;</code></td>\n<td>添加 <code>crossorigin</code> 属性</td>\n</tr>\n<tr>\n<td>静态语法错误</td>\n<td>❌ 不能</td>\n<td>无</td>\n</tr>\n<tr>\n<td><code>Promise</code> 错误</td>\n<td>❌ 不能</td>\n<td><code>onunhandledrejection</code></td>\n</tr>\n<tr>\n<td><code>iframe</code> 内错误</td>\n<td>❌ 不能</td>\n<td>在 <code>iframe</code> 内单独监听</td>\n</tr>\n<tr>\n<td><code>try/catch</code> 已处理错误</td>\n<td>❌ 不能</td>\n<td>无</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>🔹 结论</strong></h3>\n<ul>\n<li><strong><code>window.onerror</code> 主要用于捕获 JS 运行时错误</strong>  ，但无法处理资源加载、<code>Promise</code> 等错误。</li>\n<li><strong>如需完整监控</strong>  ，建议结合：\n<ul>\n<li><code>addEventListener(\'error\', true)</code>（资源错误）</li>\n<li><code>onunhandledrejection</code>（Promise 错误）</li>\n<li>跨域脚本需配置 <code>crossorigin</code>。</li>\n</ul>\n</li>\n</ul>\n</div>'</script></body></html>