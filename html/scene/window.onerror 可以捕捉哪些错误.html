<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x44a2(r,s){var t=_0x184b();return(_0x44a2=function(s,n){var a=t[s-=337];void 0===_0x44a2.igjAja&&(_0x44a2.ISrifA=function(s,n){var a,l=[],r=0,t="";for(s=(s=>{for(var n,a,l="",r="",t=0,o=0;a=s.charAt(o++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var e=0,c=l.length;e<c;e++)r+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(r)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)r=(r+l[o]+n.charCodeAt(o%n.length))%256,a=l[o],l[o]=l[r],l[r]=a;for(var o=0,r=0,e=0;e<s.length;e++)a=l[o=(o+1)%256],l[o]=l[r=(r+l[o])%256],l[r]=a,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[o]+l[r])%256]);return t},r=arguments,_0x44a2.igjAja=!0);var s=s+t[0],l=r[s];return l?a=l:(void 0===_0x44a2.TTZnbf&&(_0x44a2.TTZnbf=!0),a=_0x44a2.ISrifA(a,n),r[s]=a),a})(r,s)}var _0x386562=_0x44a2;function _0x184b(){var s=["W6rzWQFcOLaNWQRcP8k2yW","BJNdICkJWP7dSXuOi8kU","W48UeeimW47dJs42W77cH8owWP0","xCozxgBcRq","DSosBmokWQ3cP8kGkq","W7WEifxdVG9EpSoYW5C","W7ufxt7dOfhdUgRcHW","y8k2r8opbfRdLq","efhcV8oEW5VdH2P3ztm","WQZdT8kJg1pcU8og","b8k6n8olWO9EWOz6vmoBWQu","W5VcLtFcRCk1tCoR","WQD8zrpcJ3pdU0P/WQHj","DCo+WQKcpcldGmktWQZcGuZdJq","WQlcP8kFW53cVmoIWQ5KWOD2CcOB","ACk5B3eYAmoqmmo4WRddSSonWOm","W6hcMCoVBH3dImkP","yvZdIJ4xqLigWQZcJmotW63dRG","rmkHdCoWmSkzs8o6","WO7cMSoqsX8vBmkWWQpcNYDSaeS","W45usmkCA8krWQlcJsaBcZ7cQmk1W4NcVSo6W4hcISkNuSkjWOJcQmk1WOi","W48ICJXXWQJcSc8","WQZcNmotysBdVCkWmmkRWQ5Njg0","nSkLbCo5k1PVW6nVW43dIXbV","jSkzW7rLb8k5W5hcTmoBW5G1v2Hl"];return(_0x184b=function(){return s})()}if((()=>{for(var s=_0x44a2,n=_0x184b();;)try{if(838201==+parseInt(s(338,"CfNy"))*(parseInt(s(339,"E*%t"))/2)+parseInt(s(356,"U(YH"))/3+-parseInt(s(342,"y5fl"))/4+-parseInt(s(346,"5Mwc"))/5+-parseInt(s(347,"bEtY"))/6*(-parseInt(s(351,"CfNy"))/7)+parseInt(s(354,"p$oH"))/8*(parseInt(s(337,"Sm!!"))/9)+-parseInt(s(348,"SeWX"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x386562(345,"6jwd")](_0x386562(360,"iSQ1"))!=_0x386562(357,"Y9Jx"))throw window[_0x386562(358,"c0up")][_0x386562(361,"[KUd")](_0x386562(349,")x&5")),Error();document.title="window.onerror å¯ä»¥æ•æ‰å“ªäº›é”™è¯¯",document.getElementById("article").innerHTML='<div><h3><strong><code>window.onerror</code> å¯ä»¥æ•è·å“ªäº›é”™è¯¯ï¼Ÿ</strong></h3>\n<p><code>window.onerror</code> æ˜¯ JavaScript æä¾›çš„å…¨å±€é”™è¯¯ç›‘å¬æ¥å£ï¼Œä¸»è¦ç”¨äºæ•è· <strong>æœªè¢« <code>try/catch</code> å¤„ç†çš„è¿è¡Œæ—¶é”™è¯¯</strong>  ï¼Œä½†å®ƒæœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä»¥ä¸‹æ˜¯å®ƒèƒ½æ•è·å’Œä¸èƒ½æ•è·çš„é”™è¯¯ç±»å‹ï¼š</p>\n<hr>\n<h2><strong>âœ… èƒ½æ•è·çš„é”™è¯¯</strong></h2>\n<h3><strong>1. JavaScript è¿è¡Œæ—¶é”™è¯¯ï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰</strong></h3>\n<ul>\n<li><strong>æœªå®šä¹‰çš„å˜é‡æˆ–å‡½æ•°</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);\n<span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// æŠ¥é”™ï¼šUncaught ReferenceError: foo is not defined</span>\n</code></pre>\n<p>âœ… è¾“å‡ºï¼š<code>&quot;Uncaught ReferenceError: foo is not defined&quot;</code></p>\n<ul>\n<li><strong>ç±»å‹é”™è¯¯ï¼ˆTypeErrorï¼‰</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-literal">null</span>.<span class="hljs-title function_">bar</span>(); <span class="hljs-comment">// TypeError: Cannot read property &#x27;bar&#x27; of null</span>\n</code></pre>\n<p>âœ… è¾“å‡ºï¼š<code>&quot;Uncaught TypeError: Cannot read property \'bar\' of null&quot;</code></p>\n<ul>\n<li><strong>è¯­æ³•é”™è¯¯ï¼ˆä»…é™åŠ¨æ€æ‰§è¡Œï¼Œå¦‚ <code>eval</code>ï¼‰</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;const x = ;&#x27;</span>); <span class="hljs-comment">// SyntaxError</span>\n</code></pre>\n<p>âœ… è¾“å‡ºï¼š<code>&quot;Uncaught SyntaxError: Unexpected token \';\'&quot;</code></p>\n<ul>\n<li><strong><code>setTimeout</code> / <code>setInterval</code> ä¸­çš„å¼‚æ­¥é”™è¯¯</strong></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-title function_">baz</span>(); <span class="hljs-comment">// ReferenceError</span>\n}, <span class="hljs-number">1000</span>);\n</code></pre>\n<p>âœ… è¾“å‡ºï¼š<code>&quot;Uncaught ReferenceError: baz is not defined&quot;</code></p>\n<hr>\n<h3><strong>2. æœªè¢« <code>try/catch</code> æ•è·çš„ <code>throw</code> é”™è¯¯</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);\n<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯&#x27;</span>);\n</code></pre>\n<p>âœ… è¾“å‡ºï¼š<code>&quot;Uncaught Error: æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯&quot;</code></p>\n<hr>\n<h2><strong>âŒ ä¸èƒ½æ•è·çš„é”™è¯¯</strong></h2>\n<h3><strong>1. èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡ã€è„šæœ¬ã€CSS ç­‰ï¼‰</strong></h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;not-exist.jpg&quot;</span> /&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;non-existent.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<p>âŒ <strong>æ— æ³•æ•è·</strong>  ï¼Œéœ€ä½¿ç”¨ <code>element.onerror</code> æˆ– <code>window.addEventListener(\'error\', true)</code>ã€‚</p>\n<h3><strong>2. é™æ€è¯­æ³•é”™è¯¯ï¼ˆä»£ç æœªæ‰§è¡Œï¼‰</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> x = ; <span class="hljs-comment">// âŒ æ— æ³•æ•è·ï¼ˆä»£ç è§£æé˜¶æ®µå°±æŠ¥é”™ï¼‰</span>\n</code></pre>\n<p>âŒ <strong>åŸå› </strong>  ï¼šä»£ç æœªæ‰§è¡Œï¼Œ<code>window.onerror</code> ç›‘å¬å™¨æœªç”Ÿæ•ˆã€‚</p>\n<h3><strong>3. <code>Promise</code> æœªå¤„ç†çš„ <code>rejection</code></strong></h3>\n<pre><code class="language-javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Oops!&#x27;</span>); <span class="hljs-comment">// âŒ æ— æ³•æ•è·</span>\n</code></pre>\n<p>âŒ <strong>éœ€æ”¹ç”¨</strong>   <code>window.onunhandledrejection</code>ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onunhandledrejection</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">reason</span>);\n</code></pre>\n<h3><strong>4. è·¨åŸŸè„šæœ¬çš„è¯¦ç»†é”™è¯¯</strong></h3>\n<ul>\n<li>å¦‚æœ <code>&lt;script&gt;</code> æ¥è‡ªä¸åŒåŸŸä¸”æœªé…ç½® CORSï¼Œæµè§ˆå™¨ä¼šéšè—é”™è¯¯è¯¦æƒ…ï¼Œä»…è¿”å› <code>&quot;Script error.&quot;</code>ã€‚</li>\n<li><strong>è§£å†³æ–¹æ¡ˆ</strong>  ï¼š</li>\n</ul>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://other-domain.com/app.js&quot;</span> <span class="hljs-attr">crossorigin</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<h3><strong>5. <code>iframe</code> å†…çš„é”™è¯¯</strong></h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;child.html&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>\n</code></pre>\n<p>âŒ <strong>éœ€åœ¨ <code>iframe</code> å†…éƒ¨å•ç‹¬ç›‘å¬</strong>  ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>).<span class="hljs-property">contentWindow</span>.<span class="hljs-property">onerror</span> = handler;\n</code></pre>\n<h3><strong>6. <code>try/catch</code> å·²æ•è·çš„é”™è¯¯</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">try</span> {\n  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;å·²å¤„ç†&#x27;</span>);\n} <span class="hljs-keyword">catch</span> (e) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e); <span class="hljs-comment">// âŒ ä¸ä¼šè§¦å‘ window.onerror</span>\n}\n</code></pre>\n<hr>\n<h2><strong>ğŸ“Œ <code>window.onerror</code> çš„å‚æ•°</strong></h2>\n<p>å›è°ƒå‡½æ•°æ¥æ”¶ 5 ä¸ªå‚æ•°ï¼š</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">message, source, lineno, colno, error</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;é”™è¯¯ä¿¡æ¯:&#x27;</span>, message); <span class="hljs-comment">// å¦‚ &quot;Uncaught ReferenceError: foo is not defined&quot;</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è„šæœ¬è·¯å¾„:&#x27;</span>, source);   <span class="hljs-comment">// é”™è¯¯å‘ç”Ÿçš„æ–‡ä»¶ URL</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¡Œå·:&#x27;</span>, lineno);      <span class="hljs-comment">// é”™è¯¯å‘ç”Ÿçš„è¡Œå·</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;åˆ—å·:&#x27;</span>, colno);       <span class="hljs-comment">// é”™è¯¯å‘ç”Ÿçš„åˆ—å·</span>\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Errorå¯¹è±¡:&#x27;</span>, error);  <span class="hljs-comment">// å®Œæ•´çš„ Error å¯¹è±¡ï¼ˆå« stackï¼‰</span>\n};\n</code></pre>\n<hr>\n<h2><strong>ğŸš€ æœ€ä½³å®è·µ</strong></h2>\n<h3><strong>1. åŸºç¡€ç”¨æ³•ï¼ˆä»…ç›‘æ§ JS é”™è¯¯ï¼‰</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;é”™è¯¯:&#x27;</span>, msg, <span class="hljs-string">&#x27;\\nå †æ ˆ:&#x27;</span>, error.<span class="hljs-property">stack</span>);\n  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// é˜»æ­¢é»˜è®¤æ§åˆ¶å°æŠ¥é”™ï¼ˆå¯é€‰ï¼‰</span>\n};\n</code></pre>\n<h3><strong>2. ç»“åˆ <code>addEventListener</code> ç›‘æ§èµ„æºé”™è¯¯</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// ç”¨ onerror æ•è· JS é”™è¯¯</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;JSé”™è¯¯:&#x27;</span>, msg);\n\n<span class="hljs-comment">// ç”¨ addEventListener æ•è·èµ„æºé”™è¯¯</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">tagName</span> === <span class="hljs-string">&#x27;IMG&#x27;</span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;å›¾ç‰‡åŠ è½½å¤±è´¥:&#x27;</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">src</span>);\n  }\n}, <span class="hljs-literal">true</span>);\n</code></pre>\n<h3><strong>3. ä¸ŠæŠ¥é”™è¯¯åˆ°æœåŠ¡å™¨</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">msg, src, line, col, error</span>) =&gt;</span> {\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/log-error&#x27;</span>, {\n    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,\n    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({\n      <span class="hljs-attr">message</span>: msg,\n      <span class="hljs-attr">stack</span>: error?.<span class="hljs-property">stack</span>,\n      <span class="hljs-attr">file</span>: src,\n      <span class="hljs-attr">line</span>: line,\n      <span class="hljs-attr">column</span>: col\n    })\n  });\n};\n</code></pre>\n<hr>\n<h2><strong>ğŸ“Š æ€»ç»“è¡¨</strong></h2>\n<table>\n<thead>\n<tr>\n<th><strong>é”™è¯¯ç±»å‹</strong></th>\n<th><strong><code>window.onerror</code> èƒ½å¦æ•è·ï¼Ÿ</strong></th>\n<th><strong>æ›¿ä»£æ–¹æ¡ˆ</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JS è¿è¡Œæ—¶é”™è¯¯ï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰</td>\n<td>âœ… èƒ½</td>\n<td>-</td>\n</tr>\n<tr>\n<td>èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡/è„šæœ¬ï¼‰</td>\n<td>âŒ ä¸èƒ½</td>\n<td><code>addEventListener(\'error\', true)</code></td>\n</tr>\n<tr>\n<td>è·¨åŸŸè„šæœ¬é”™è¯¯ï¼ˆæ—  CORSï¼‰</td>\n<td>âŒ ä»…è¿”å› <code>&quot;Script error.&quot;</code></td>\n<td>æ·»åŠ  <code>crossorigin</code> å±æ€§</td>\n</tr>\n<tr>\n<td>é™æ€è¯­æ³•é”™è¯¯</td>\n<td>âŒ ä¸èƒ½</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code>Promise</code> é”™è¯¯</td>\n<td>âŒ ä¸èƒ½</td>\n<td><code>onunhandledrejection</code></td>\n</tr>\n<tr>\n<td><code>iframe</code> å†…é”™è¯¯</td>\n<td>âŒ ä¸èƒ½</td>\n<td>åœ¨ <code>iframe</code> å†…å•ç‹¬ç›‘å¬</td>\n</tr>\n<tr>\n<td><code>try/catch</code> å·²å¤„ç†é”™è¯¯</td>\n<td>âŒ ä¸èƒ½</td>\n<td>æ— </td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>ğŸ”¹ ç»“è®º</strong></h3>\n<ul>\n<li><strong><code>window.onerror</code> ä¸»è¦ç”¨äºæ•è· JS è¿è¡Œæ—¶é”™è¯¯</strong>  ï¼Œä½†æ— æ³•å¤„ç†èµ„æºåŠ è½½ã€<code>Promise</code> ç­‰é”™è¯¯ã€‚</li>\n<li><strong>å¦‚éœ€å®Œæ•´ç›‘æ§</strong>  ï¼Œå»ºè®®ç»“åˆï¼š\n<ul>\n<li><code>addEventListener(\'error\', true)</code>ï¼ˆèµ„æºé”™è¯¯ï¼‰</li>\n<li><code>onunhandledrejection</code>ï¼ˆPromise é”™è¯¯ï¼‰</li>\n<li>è·¨åŸŸè„šæœ¬éœ€é…ç½® <code>crossorigin</code>ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>'</script></body></html>