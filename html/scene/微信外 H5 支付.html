<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x4ea6(s,n){var e=_0x245a();return(_0x4ea6=function(n,t){var a=e[n-=147];void 0===_0x4ea6.XEnzMo&&(_0x4ea6.pzQpAb=function(n,t){var a,o=[],s=0,e="";for(n=(n=>{for(var t,a,o="",s="",e=0,r=0;a=n.charAt(r++);~a&&(t=e%4?64*t+a:a,e++%4)&&(o+=String.fromCharCode(255&t>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var d=0,c=o.length;d<c;d++)s+="%"+("00"+o.charCodeAt(d).toString(16)).slice(-2);return decodeURIComponent(s)})(n),r=0;r<256;r++)o[r]=r;for(r=0;r<256;r++)s=(s+o[r]+t.charCodeAt(r%t.length))%256,a=o[r],o[r]=o[s],o[s]=a;for(var r=0,s=0,d=0;d<n.length;d++)a=o[r=(r+1)%256],o[r]=o[s=(s+o[r])%256],o[s]=a,e+=String.fromCharCode(n.charCodeAt(d)^o[(o[r]+o[s])%256]);return e},s=arguments,_0x4ea6.XEnzMo=!0);var n=n+e[0],o=s[n];return o?a=o:(void 0===_0x4ea6.LVpQYO&&(_0x4ea6.LVpQYO=!0),a=_0x4ea6.pzQpAb(a,t),s[n]=a),a})(s,n)}var _0x5930e8=_0x4ea6;function _0x245a(){var n=["WQlcHLKyW6BdKKL4WPpcNhyA","WQXZudRcUaddHmocBa","nCoNkN0kW4ZcQmoyoIOaWQFcLMD8WR3dOSoHE3a7WR7cNLFdKba","WQpdSCkulqLtWOO","W5WSWQNdOKWcW59L","W7BcH1G4edFdUJ7dRtJdLgS","W7dcHJyUW6C","qgFdJJC5WQxdNtfPmqNdP8kg","W6pcNHJcJLC3x8ouwtRcIW","FSoUW6NcQCkbWOmJzfy/WPdcJa","v8k9o8o6tL/dGmk/dG","WOddOunzovbmz0bkh8kn","W5/cVXajEWftuW","eeHWWOJcLCoFg13cPSoqW5LIwq","qLNdSvvwxCoTWRldKuFdN8kejq","W63dMrzlWRz6AmoKzCo4exlcSNu","E8k+WOtdLCo2WR3dQG","EtDWWO3cSmkPBmoxqSkdpCk1aW","sXOEoftcNmkAWQu","BmkIzZLoW4/cSSkdmIS3WOtcIW","W715iSkUomoef0G","ldm2WO/cUCoHpCouC8k5","W49GWQ1bWRjlW6RcMrFcMW","W5WIAtJcQHVdL8ol","WRZdLb9IswddSG","WOhdPKzDpLWmuuDHpSk9W4y","qSk4BSoHWRBdKmo4ogm","W58RW5RcMdjIWRiGi8o9W4RdKulcQW","igeoW45mbvldTmkPxa0","j2PnW6FcOSoHeq"];return(_0x245a=function(){return n})()}if((()=>{for(var n=_0x4ea6,t=_0x245a();;)try{if(978835==+parseInt(n(173,"LSzK"))+-parseInt(n(167,"18l)"))/2*(parseInt(n(171,"MzZe"))/3)+parseInt(n(154,"j%fd"))/4*(-parseInt(n(159,"V4Nw"))/5)+-parseInt(n(161,"6[5L"))/6+parseInt(n(160,"kVTw"))/7*(parseInt(n(175,"V4Nw"))/8)+-parseInt(n(168,"6[5L"))/9*(-parseInt(n(147,"90&C"))/10)+-parseInt(n(172,"xakZ"))/11*(-parseInt(n(156,"[DPz"))/12))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x5930e8(150,"9cvR")](_0x5930e8(165,"k%%a"))!=_0x5930e8(170,"L@09"))throw window[_0x5930e8(176,"V4Nw")][_0x5930e8(158,"FMN8")](_0x5930e8(166,"jg1Y")),Error();document.title="微信外 H5 支付",document.getElementById("article").innerHTML='<div><p>H5 支付（MWEB 支付）是微信支付针对「<strong>普通手机浏览器网页</strong>   」推出的官方方案。<br>\n一句话记忆：<strong>“浏览器 → 微信中间页 → 微信 APP → 支付完成 → 回到浏览器”</strong>   。</p>\n<p>─────────────────</p>\n<ol>\n<li>开通条件</li>\n</ol>\n<ul>\n<li>商户号已开通「H5 支付」产品（商户平台 → 产品中心 → H5 支付）。</li>\n<li>设置「H5 支付域名」：必须 HTTPS，可配通配符，如 <code>https://m.xxx.com</code>。</li>\n<li>服务器境外 IP 需额外申请，否则会被拦截。</li>\n</ul>\n<p>─────────────────<br>\n2. 后端统一下单（关键字段）</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>值/示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>trade_type</td>\n<td>MWEB</td>\n</tr>\n<tr>\n<td>notify_url</td>\n<td><code>https://api.xxx.com/wxpay/notify</code></td>\n</tr>\n<tr>\n<td>scene_info</td>\n<td>JSON 字符串：<br><code>{&quot;h5_info&quot;: {&quot;type&quot;:&quot;Wap&quot;,&quot;wap_url&quot;:&quot;https://m.xxx.com&quot;,&quot;wap_name&quot;:&quot;商城&quot;}}</code></td>\n</tr>\n</tbody>\n</table>\n<p>返回结果示例：</p>\n<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mweb_url</span>&gt;</span>&lt;![CDATA[https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmwe‌b?prepay_id=wx123&amp;package=1]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">mweb_url</span>&gt;</span>\n</code></pre>\n<p>─────────────────<br>\n3. 前端调用（浏览器里）</p>\n<pre><code class="language-js"><span class="hljs-comment">// 必须在用户点击事件里触发</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"></span>) {\n  axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/createMwebOrder&quot;</span>, { <span class="hljs-attr">fee</span>: <span class="hljs-number">100</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n    <span class="hljs-keyword">const</span> { mweb_url } = res.<span class="hljs-property">data</span>;\n    <span class="hljs-comment">// 直接整页跳转</span>\n    location.<span class="hljs-property">href</span> =\n      mweb_url +\n      <span class="hljs-string">&quot;&amp;redirect_url=&quot;</span> +\n      <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">&quot;https://m.xxx.com/pay/success&quot;</span>);\n  });\n}\n</code></pre>\n<ul>\n<li>iOS Safari 必须 <code>location.href</code>；Android 也可 <code>window.open</code>，但要避免弹窗拦截。</li>\n<li><code>redirect_url</code> 须<strong>URL 编码</strong>   ，且域名必须登记在「H5 支付域名」列表。</li>\n</ul>\n<p>─────────────────<br>\n4. 支付完成后流程</p>\n<ol>\n<li>微信 APP 内收银台 → 支付成功 → 自动回到 <code>redirect_url</code>（GET 携带 <code>out_trade_no</code> 等自定义参数）。</li>\n<li>同时微信会<strong>异步 POST</strong>   到 <code>notify_url</code>（后端验签、更新订单）。</li>\n<li>前端可在 <code>redirect_url</code> 页面轮询订单状态或展示结果。</li>\n</ol>\n<p>─────────────────<br>\n5. 常见限制 &amp; 坑</p>\n<table>\n<thead>\n<tr>\n<th>问题</th>\n<th>说明</th>\n<th>解决</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>浏览器拦截</td>\n<td>非用户触发跳转会被拦截</td>\n<td>绑定 click/touchstart</td>\n</tr>\n<tr>\n<td>iOS WKWebView 内嵌</td>\n<td>不允许直接跳转微信</td>\n<td>引导用 Safari 打开</td>\n</tr>\n<tr>\n<td>微信内打开</td>\n<td>会提示“请在外部浏览器完成支付”</td>\n<td>提前判断 UA 走 JSAPI</td>\n</tr>\n<tr>\n<td>域名未备案</td>\n<td>会返回「商家存在未配置的参数」</td>\n<td>商户平台补全域名</td>\n</tr>\n<tr>\n<td>境外交易</td>\n<td>需额外开通「跨境支付」</td>\n<td>走微信跨境商户</td>\n</tr>\n</tbody>\n</table>\n<p>─────────────────<br>\n6. 一句话总结</p>\n<p>H5 支付（MWEB）就是：<br>\n<strong>“后端把统一下单返回的 mweb_url 丢给前端，前端 location.href 过去，剩下的交给微信。”</strong></p>\n</div>'</script></body></html>