<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x391b(r,n){var l=_0x5889();return(_0x391b=function(n,s){var o=l[n-=330];void 0===_0x391b.ACaIra&&(_0x391b.tHvfbP=function(n,s){var o,a=[],r=0,l="";for(n=(n=>{for(var s,o,a="",r="",l=0,e=0;o=n.charAt(e++);~o&&(s=l%4?64*s+o:o,l++%4)&&(a+=String.fromCharCode(255&s>>(-2*l&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var t=0,p=a.length;t<p;t++)r+="%"+("00"+a.charCodeAt(t).toString(16)).slice(-2);return decodeURIComponent(r)})(n),e=0;e<256;e++)a[e]=e;for(e=0;e<256;e++)r=(r+a[e]+s.charCodeAt(e%s.length))%256,o=a[e],a[e]=a[r],a[r]=o;for(var e=0,r=0,t=0;t<n.length;t++)o=a[e=(e+1)%256],a[e]=a[r=(r+a[e])%256],a[r]=o,l+=String.fromCharCode(n.charCodeAt(t)^a[(a[e]+a[r])%256]);return l},r=arguments,_0x391b.ACaIra=!0);var n=n+l[0],a=r[n];return a?o=a:(void 0===_0x391b.GzpVqH&&(_0x391b.GzpVqH=!0),o=_0x391b.tHvfbP(o,s),r[n]=o),o})(r,n)}var _0x1978a6=_0x391b;if((()=>{for(var n=_0x391b,s=_0x5889();;)try{if(871274==+parseInt(n(334,"!x9w"))*(-parseInt(n(347,"7)#*"))/2)+-parseInt(n(345,"(Fxr"))/3*(-parseInt(n(335,"MF6)"))/4)+parseInt(n(338,"j&b1"))/5+parseInt(n(343,"@*)r"))/6+-parseInt(n(341,"9u^z"))/7+-parseInt(n(353,"K9Pi"))/8+parseInt(n(346,"j10%"))/9)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x1978a6(337,"(Fxr")](_0x1978a6(352,"(O[3"))!=_0x1978a6(351,"N!5F"))throw window[_0x1978a6(340,"RNXn")][_0x1978a6(344,"P9h4")](_0x1978a6(331,"Oq9o")),Error();function _0x5889(){var n=["W4LYCbVdQfNdUG","zSkqW4KNWPDAySkiW6rop8kCW6u","W4ZcJmkltCkcc8oLWPbbmJ/cRa","x8oxpLhcJCojW5FcJG","WO/dVSkQsSk3W6GCxCk8W4PqESkn","nmkBnSocWRJcMdJcRqddH8ogWRe","BmkoW6ajzuhcKZJcOmkwW6lcO8o6wG","EqZcH8ksWQ92W5K","WPWVn2tcQq/dS8kfW5hcMSoYW60","dhHKB8kko24clINdMmkIW5m","W7NcHxrVzdLvWOlcNCkSiCkY","aSkiBqxdJCkuWORdKGqovfRdVsC","DSoNASk8W5VdPCoi","WP3cMmosxrnilxRdIIzVu2e","WRddKCkiW7xdVG","f8o0WOpcOc3dRuyisW","puqvWOrkpSkfW7ddIvjilmo+","p1/dHCoiW7OHWOZcHCo1W61FW7hdLq","WQmGkmkYWQCZW58foCksW4WlWPq1WQxcG8oQW4JcUMVdKdm/BmoqAa","E8kCbCo+WOhcL8kZW5HzDtlcGSkX","fHS8W5NdUMrmW7i/WP/cKmomEq","A8kzgcfGW5NdSW","WQddVSotvGtcHfz3","eH9aWRNcNIKaW7S"];return(_0x5889=function(){return n})()}document.title="vite 请求资源文件",document.getElementById("article").innerHTML='<div><p>在 Vite 开发环境中，<code>import imgUrl from \'./logo.png\'</code> 和 <code>document.getElementById(\'logo\').src = imgUrl</code> 这一过程<strong>实际上只触发一次图片请求</strong>  ，不会导致重复请求。具体机制如下：</p>\n<h3>一、Vite 的模块处理流程</h3>\n<ol>\n<li>\n<p><strong>静态导入解析</strong><br>\n当 Vite 解析 <code>import imgUrl from \'./logo.png\'</code> 时，会将其转换为一个<strong>特殊的模块请求</strong>  （如 <code>/src/logo.png?vite-import</code>）。</p>\n</li>\n<li>\n<p><strong>首次请求：获取模块定义</strong><br>\n浏览器请求该模块时，Vite 返回一个导出 URL 的 JS 模块：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// Vite 返回的模块内容</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;/src/logo.png&quot;</span>;\n</code></pre>\n<p>此时 <code>imgUrl</code> 的值为 <code>/src/logo.png</code>。</p>\n</li>\n<li>\n<p><strong>二次请求：加载图片资源</strong><br>\n当 <code>&lt;img src={imgUrl} /&gt;</code> 渲染时，浏览器根据 <code>imgUrl</code> 的值请求 <code>/src/logo.png</code>，Vite 拦截该请求并返回图片内容。</p>\n</li>\n</ol>\n<h3>二、为什么不会重复请求？</h3>\n<p>关键在于 Vite 将图片导入转换为<strong>模块请求</strong>  ，而非直接加载图片：</p>\n<ol>\n<li><strong>第一次请求</strong>  的是 JS 模块（内容为图片 URL），MIME 类型为 <code>application/javascript</code>。</li>\n<li><strong>第二次请求</strong>  才是真正的图片资源（<code>image/png</code>）。</li>\n</ol>\n<p>两次请求的路径和内容类型不同，因此不会重复加载图片。</p>\n<h3>三、示例说明</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 原始代码</span>\n<span class="hljs-keyword">import</span> imgUrl <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./logo.png&#x27;</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(imgUrl); <span class="hljs-comment">// &quot;/src/logo.png&quot;</span>\n\n<span class="hljs-comment">// DOM 中使用</span>\n<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;logo&#x27;</span>).<span class="hljs-property">src</span> = imgUrl;\n</code></pre>\n<ol>\n<li>\n<p><strong>模块请求</strong>  （浏览器发起）：</p>\n<pre><code>GET /src/logo.png?vite-import HTTP/1.1\nContent-Type: application/javascript\n</code></pre>\n<p>Vite 返回：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;/src/logo.png&quot;</span>;\n</code></pre>\n</li>\n<li>\n<p><strong>图片请求</strong>  （浏览器渲染时发起）：</p>\n<pre><code>GET /src/logo.png HTTP/1.1\nContent-Type: image/png\n</code></pre>\n<p>Vite 返回图片二进制数据。</p>\n</li>\n</ol>\n<h3>四、生产环境的行为</h3>\n<p>在生产环境中，流程更为直观：</p>\n<ol>\n<li><code>import imgUrl from \'./logo.png\'</code> 中的 <code>imgUrl</code> 被替换为打包后的静态路径（如 <code>/assets/logo.12345.png</code>）。</li>\n<li>浏览器直接请求该静态资源，无需 Vite 中间层。</li>\n</ol>\n<h3>五、避免重复请求的优化</h3>\n<ol>\n<li><strong>使用缓存头</strong><br>\nVite 在开发环境中默认设置 <code>Cache-Control: no-cache</code>，确保文件修改后立即生效。生产环境中会启用长期缓存（<code>max-age=31536000</code>）。</li>\n<li><strong>动态导入</strong><br>\n对于非关键资源，可使用动态导入减少初始请求：<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: imgUrl } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./logo.png&#x27;</span>);\n  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;logo&#x27;</span>).<span class="hljs-property">src</span> = imgUrl;\n}\n</code></pre>\n</li>\n</ol>\n<h3>六、总结</h3>\n<p>Vite 的处理机制确保了：</p>\n<ol>\n<li><strong>模块请求</strong>  （返回 URL）和<strong>资源请求</strong>  （返回图片内容）是两个不同的请求。</li>\n<li>图片资源仅在 DOM 渲染时被请求一次，不会重复加载。</li>\n<li>这种设计既符合 ESM 规范，又保持了资源加载的高效性。</li>\n</ol>\n<p>因此，你的代码不会导致浏览器重复请求图片资源。</p>\n</div>'</script></body></html>