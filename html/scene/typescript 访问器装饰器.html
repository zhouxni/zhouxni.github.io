<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x191525=_0x23ab;function _0x23ab(p,s){var t=_0x3049();return(_0x23ab=function(s,a){var n=t[s-=340];void 0===_0x23ab.Vvvjfw&&(_0x23ab.EkXjuL=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x23ab.Vvvjfw=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x23ab.zvkwAD&&(_0x23ab.zvkwAD=!0),n=_0x23ab.EkXjuL(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x23ab,a=_0x3049();;)try{if(916992==+parseInt(s(347,"C)3o"))+parseInt(s(352,"Wb1D"))/2*(parseInt(s(348,"Fkfi"))/3)+parseInt(s(343,"tTCQ"))/4*(parseInt(s(346,"M1$L"))/5)+-parseInt(s(365,"q)lf"))/6*(-parseInt(s(359,"bbVJ"))/7)+parseInt(s(366,"@YUv"))/8+-parseInt(s(354,"cMdZ"))/9+-parseInt(s(340,"C)3o"))/10*(parseInt(s(345,"B4aX"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x191525(367,"bbVJ")](_0x191525(357,"9TrL"))!=_0x191525(364,"@cd&"))throw window[_0x191525(349,"4tYn")][_0x191525(341,"sxf9")](_0x191525(361,"cMdZ")),Error();function _0x3049(){var s=["W6X+W7SqcGFcHSodicxcLtO","oHDthNdcGJ7cS8oZEchcOSocWP4","CMpdQmkvWQRcOSofgfnhWPBcNSoRvrRdOuOfW4OIrmk9WRBcM8o3WP0","W77cLvSwW7yfW57dIrVdQ8k2WPnl","rSooW7CIlvNdHCo3jtZdKHa","W69UW6RcQmoD","gmoSW7PoWRNdHCkqCq","gSkuWPBdVNxcG8kRWQmEW4bIW5BdOSkK","WRKIWR1Os1VcRq","BSkDmKRcMmkfWO4PWQK","csZdSXCBDCkI","WRyubZFcTxzyW5tcN8oUW48S","qSoblmo0WQ4bWO7dGa","l2KAb2OOvmot","W5RdUWbDcSo5fmo7WO7cKmoLAW","tmoOWQK/WQpdKSozgdFdTmkdwCkm","yCkDnbNdNmoHWO04WRWdtCo2","jCkIpZtcN0rTzLyAdvC","WQ0vW4RdL8k6W79cWRu","bCoeqLmmW4hcHrxcI8owlSk9W7W","rSoAWRZcTg3dRH4cpCkdi08","W6hdRxSCW7KpEmkA","vSofW6VcJ2bYoe99WRKThW","lI/cR8osW6dcQSozCNX4WOdcVCo/","W77cLrPVWOLoWQFdUa","W6L0W7Lct2RcPCoYiq","WOCUW4/cJ8oHoGOxlW","hCoKW6fgWRFdISkICW"];return(_0x3049=function(){return s})()}document.title="typescript 访问器装饰器",document.getElementById("article").innerHTML='<div><p>在 TypeScript 中，<strong>访问器装饰器（Accessor Decorators）</strong>   是一种特殊类型的装饰器，用于修饰类的访问器（getter 和 setter）。访问器装饰器允许你在访问或修改类的属性时，添加额外的逻辑，比如验证、日志记录或计算属性值。</p>\n<h3><strong>访问器装饰器的基本用法</strong></h3>\n<ul>\n<li><strong>装饰器</strong>  ：是一种特殊类型的声明，它能够被附加到类声明、方法、访问器、属性或参数上。</li>\n<li><strong>访问器</strong>  ：包括 <code>getter</code> 和 <code>setter</code>，用于自定义访问和修改类属性的行为。</li>\n</ul>\n<h3><strong>语法</strong></h3>\n<p>访问器装饰器的语法如下：</p>\n<pre><code class="language-typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {\n  <span class="hljs-meta">@decoratorName</span>\n  <span class="hljs-keyword">get</span> <span class="hljs-title function_">propertyName</span>(): <span class="hljs-title class_">Type</span> {\n    <span class="hljs-comment">// getter logic</span>\n  }\n\n  <span class="hljs-meta">@decoratorName</span>\n  <span class="hljs-keyword">set</span> <span class="hljs-title function_">propertyName</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-title class_">Type</span></span>) {\n    <span class="hljs-comment">// setter logic</span>\n  }\n}\n</code></pre>\n<h3><strong>示例：使用访问器装饰器</strong></h3>\n<h4><strong>1. 创建访问器装饰器</strong></h4>\n<p>首先，我们需要定义一个装饰器函数。装饰器函数接收以下参数：</p>\n<ul>\n<li><strong>target</strong>  ：类的原型对象。</li>\n<li><strong>propertyKey</strong>  ：被装饰的属性的名称。</li>\n<li><strong>descriptor</strong>  ：属性的描述符对象。</li>\n</ul>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LogAccess</span>(<span class="hljs-params"><span class="hljs-attr">target</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">propertyKey</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">descriptor</span>: <span class="hljs-title class_">PropertyDescriptor</span></span>) {\n  <span class="hljs-keyword">const</span> originalGetter = descriptor.<span class="hljs-property">get</span>;\n  <span class="hljs-keyword">const</span> originalSetter = descriptor.<span class="hljs-property">set</span>;\n\n  <span class="hljs-comment">// 修饰 getter</span>\n  descriptor.<span class="hljs-property">get</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Getting value of <span class="hljs-subst">${propertyKey}</span>`</span>);\n    <span class="hljs-keyword">return</span> originalGetter ? originalGetter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>) : <span class="hljs-literal">undefined</span>;\n  };\n\n  <span class="hljs-comment">// 修饰 setter</span>\n  descriptor.<span class="hljs-property">set</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Setting value of <span class="hljs-subst">${propertyKey}</span> to <span class="hljs-subst">${value}</span>`</span>);\n    <span class="hljs-keyword">if</span> (originalSetter) {\n      originalSetter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, value);\n    }\n  };\n}\n</code></pre>\n<h4><strong>2. 应用装饰器到访问器</strong></h4>\n<pre><code class="language-typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {\n  <span class="hljs-keyword">private</span> <span class="hljs-attr">_name</span>: <span class="hljs-built_in">string</span>;\n\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = name;\n  }\n\n  <span class="hljs-meta">@LogAccess</span>\n  <span class="hljs-keyword">get</span> <span class="hljs-title function_">name</span>(): <span class="hljs-built_in">string</span> {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span>;\n  }\n\n  <span class="hljs-meta">@LogAccess</span>\n  <span class="hljs-keyword">set</span> <span class="hljs-title function_">name</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = value;\n  }\n}\n\n<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出：Getting value of name \\n Alice</span>\nperson.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Bob&quot;</span>;      <span class="hljs-comment">// 输出：Setting value of name to Bob</span>\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出：Getting value of name \\n Bob</span>\n</code></pre>\n<h3><strong>解释</strong></h3>\n<ol>\n<li><strong><code>LogAccess</code> 装饰器</strong>  ：\n<ul>\n<li>修饰了 <code>getter</code> 和 <code>setter</code>，在访问或修改属性时打印日志。</li>\n<li>保留了原有的 <code>getter</code> 和 <code>setter</code> 逻辑，通过调用 <code>originalGetter</code> 和 <code>originalSetter</code> 实现。</li>\n</ul>\n</li>\n<li><strong><code>Person</code> 类</strong>  ：\n<ul>\n<li>使用 <code>@LogAccess</code> 装饰器修饰了 <code>name</code> 属性的 <code>getter</code> 和 <code>setter</code>。</li>\n<li>每次访问或修改 <code>name</code> 属性时，都会触发装饰器中的逻辑。</li>\n</ul>\n</li>\n</ol>\n<h3><strong>注意事项</strong></h3>\n<ul>\n<li><strong>装饰器执行顺序</strong>  ：如果有多个装饰器应用于同一个访问器，它们会按照从下到上的顺序执行（即栈的顺序）。</li>\n<li><strong>装饰器工厂</strong>  ：装饰器可以是一个返回装饰器函数的工厂函数，允许传递参数。</li>\n<li><strong>实验性特性</strong>  ：装饰器目前是 TypeScript 的实验性特性，需要在 <code>tsconfig.json</code> 中启用 <code>experimentalDecorators</code> 选项。</li>\n</ul>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;experimentalDecorators&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h3><strong>装饰器工厂示例</strong></h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LogAccessWithMessage</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-attr">target</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">propertyKey</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">descriptor</span>: <span class="hljs-title class_">PropertyDescriptor</span></span>) {\n    <span class="hljs-keyword">const</span> originalGetter = descriptor.<span class="hljs-property">get</span>;\n    <span class="hljs-keyword">const</span> originalSetter = descriptor.<span class="hljs-property">set</span>;\n\n    descriptor.<span class="hljs-property">get</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${message}</span> - Getting value of <span class="hljs-subst">${propertyKey}</span>`</span>);\n      <span class="hljs-keyword">return</span> originalGetter ? originalGetter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>) : <span class="hljs-literal">undefined</span>;\n    };\n\n    descriptor.<span class="hljs-property">set</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span></span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${message}</span> - Setting value of <span class="hljs-subst">${propertyKey}</span> to <span class="hljs-subst">${value}</span>`</span>);\n      <span class="hljs-keyword">if</span> (originalSetter) {\n        originalSetter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, value);\n      }\n    };\n  };\n}\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonWithMessage</span> {\n  <span class="hljs-keyword">private</span> <span class="hljs-attr">_name</span>: <span class="hljs-built_in">string</span>;\n\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = name;\n  }\n\n  <span class="hljs-meta">@LogAccessWithMessage</span>(<span class="hljs-string">&quot;Person Name Access&quot;</span>)\n  <span class="hljs-keyword">get</span> <span class="hljs-title function_">name</span>(): <span class="hljs-built_in">string</span> {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span>;\n  }\n\n  <span class="hljs-meta">@LogAccessWithMessage</span>(<span class="hljs-string">&quot;Person Name Access&quot;</span>)\n  <span class="hljs-keyword">set</span> <span class="hljs-title function_">name</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = value;\n  }\n}\n\n<span class="hljs-keyword">const</span> personWithMessage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonWithMessage</span>(<span class="hljs-string">&quot;Alice&quot;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(personWithMessage.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出：Person Name Access - Getting value of name \\n Alice</span>\npersonWithMessage.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Bob&quot;</span>;      <span class="hljs-comment">// 输出：Person Name Access - Setting value of name to Bob</span>\n</code></pre>\n<h3><strong>总结</strong></h3>\n<ul>\n<li><strong>访问器装饰器</strong>  ：用于修饰类的 <code>getter</code> 和 <code>setter</code>，在访问或修改属性时添加额外逻辑。</li>\n<li><strong>装饰器函数</strong>  ：接收 <code>target</code>、<code>propertyKey</code> 和 <code>descriptor</code> 参数，可以修改或扩展原有的访问器行为。</li>\n<li><strong>装饰器工厂</strong>  ：允许装饰器接收参数，返回实际的装饰器函数。</li>\n<li><strong>启用装饰器</strong>  ：需要在 <code>tsconfig.json</code> 中启用 <code>experimentalDecorators</code> 选项。</li>\n</ul>\n<p>访问器装饰器是 TypeScript 中强大的工具，可以用于实现属性访问的日志记录、验证、计算等高级功能。</p>\n</div>'</script></body></html>