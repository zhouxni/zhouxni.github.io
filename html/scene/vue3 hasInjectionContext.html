<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x16f1(){var n=["WQeYW5utWOldVYP7","W7NcQCoFz2hcICkZdW","txFdIhZdO8oXWRqp","stxcTZBdSCoiWOzkWOhcQ8kRWR0","W7/cKxtcRSoXWO7cLez0wCkoFq","W5u9W41lbw5J","emkvsCkNWPlcGKZcMHyiW5ddIq0","rgtdQgpcP8ktWPu","aXTqWQ3cM8oBW5RcUmk4jXJdVvC1","W7nXW7BdSuKCFrf9g8kzh8o+","WRnlWQhdGCkzWOJcNxZcGSo5n3pdJSk1WQJdTv/cO2u9W6JcJWX9ghW","w8opm8knWQK","WQXZWRlcRflcIwjOW7hcL0S","qmkWgcxdLGxcQmoUdhFdHSoi","vSoHuSkZWRFcPSkoda","omodtxGrW74v","tI7dHKBcOK1hjmkMwmoRk8ksea","vCoNlCoxW4JdNCoPm39rWPBdV8os","WPuawHVdGCkDW7ldIJpdT8oaqW","WQe2W5mvWP7dJbLB","lSk4DgNdKmoEW4C","W6f1vSkakNldTmohrZRdH8kGlW","WPbOWOKvvJ1EWRLdsCosiq","WQPXWRhcPftdJ0zTW6RcIuFdLW","W6jscKZcG8oAW5FdQce"];return(_0x16f1=function(){return n})()}var _0x131a6d=_0x3789;function _0x3789(t,n){var o=_0x16f1();return(_0x3789=function(n,s){var a=o[n-=433];void 0===_0x3789.SzkxuP&&(_0x3789.zPHtGR=function(n,s){var a,e=[],t=0,o="";for(n=(n=>{for(var s,a,e="",t="",o=0,c=0;a=n.charAt(c++);~a&&(s=o%4?64*s+a:a,o++%4)&&(e+=String.fromCharCode(255&s>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var l=0,r=e.length;l<r;l++)t+="%"+("00"+e.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(t)})(n),c=0;c<256;c++)e[c]=c;for(c=0;c<256;c++)t=(t+e[c]+s.charCodeAt(c%s.length))%256,a=e[c],e[c]=e[t],e[t]=a;for(var c=0,t=0,l=0;l<n.length;l++)a=e[c=(c+1)%256],e[c]=e[t=(t+e[c])%256],e[t]=a,o+=String.fromCharCode(n.charCodeAt(l)^e[(e[c]+e[t])%256]);return o},t=arguments,_0x3789.SzkxuP=!0);var n=n+o[0],e=t[n];return e?a=e:(void 0===_0x3789.mrOGZP&&(_0x3789.mrOGZP=!0),a=_0x3789.zPHtGR(a,s),t[n]=a),a})(t,n)}if((()=>{for(var n=_0x3789,s=_0x16f1();;)try{if(240928==-parseInt(n(453,"%fTG"))*(parseInt(n(440,"xb8#"))/2)+-parseInt(n(445,"C^qi"))/3+-parseInt(n(450,"[amv"))/4+parseInt(n(456,"J@4M"))/5+parseInt(n(442,"C^qi"))/6*(parseInt(n(446,"@[mC"))/7)+-parseInt(n(434,"&T&E"))/8+-parseInt(n(443,"NmU^"))/9*(-parseInt(n(444,"Cr3k"))/10))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x131a6d(448,"cS4J")](_0x131a6d(452,"@[mC"))!=_0x131a6d(439,"5I56"))throw window[_0x131a6d(454,"KP7Y")][_0x131a6d(433,"[amv")](_0x131a6d(438,"fNOD")),Error();document.title="vue3 hasInjectionContext",document.getElementById("article").innerHTML='<div><p>在 Vue 3 中，<strong><code>hasInjectionContext()</code></strong>   是一个用于检查当前代码是否处于<strong>依赖注入上下文（Injection Context）</strong>   中的工具函数。它可以帮助你确定当前环境是否支持 <code>provide</code>/<code>inject</code> 或访问其他 Vue 的依赖注入 API。</p>\n<hr>\n<h3><strong>作用</strong></h3>\n<p><code>hasInjectionContext()</code> 返回一个布尔值：</p>\n<ul>\n<li><strong><code>true</code></strong>   ：当前代码在 Vue 的依赖注入上下文中（例如组件 <code>setup</code> 函数内、生命周期钩子等）。</li>\n<li><strong><code>false</code></strong>   ：当前代码不在注入上下文中（例如异步回调、普通函数、非 Vue 环境）。</li>\n</ul>\n<hr>\n<h3><strong>使用场景</strong></h3>\n<ol>\n<li><strong>安全地使用 <code>inject</code></strong>   ：<br>\n在不确定当前环境是否支持依赖注入时，可以用 <code>hasInjectionContext()</code> 检查，避免调用 <code>inject()</code> 时抛出错误。</li>\n<li><strong>开发工具或库</strong>   ：<br>\n在编写通用工具函数时，可能需要判断当前是否处于 Vue 上下文中。</li>\n</ol>\n<hr>\n<h3><strong>示例代码</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { hasInjectionContext, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeInject</span>(<span class="hljs-params">key</span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasInjectionContext</span>()) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">inject</span>(key);\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;当前不在 Vue 注入上下文中！&#x27;</span>);\n    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;\n  }\n}\n\n<span class="hljs-comment">// 在组件 setup 中使用（返回 true）</span>\n<span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hasInjectionContext</span>()); <span class="hljs-comment">// true</span>\n  <span class="hljs-title function_">safeInject</span>(<span class="hljs-string">&#x27;some-key&#x27;</span>); <span class="hljs-comment">// 正常注入</span>\n}\n\n<span class="hljs-comment">// 在异步回调中（可能返回 false）</span>\n<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hasInjectionContext</span>()); <span class="hljs-comment">// false</span>\n  <span class="hljs-title function_">safeInject</span>(<span class="hljs-string">&#x27;some-key&#x27;</span>); <span class="hljs-comment">// 警告</span>\n}, <span class="hljs-number">1000</span>);\n</code></pre>\n<hr>\n<h3><strong>为什么需要它？</strong></h3>\n<p>Vue 的依赖注入（如 <code>inject()</code>）必须在一个<strong>有效的注入上下文</strong>   中调用（通常是组件实例的 <code>setup</code> 阶段）。如果在无效上下文中调用 <code>inject()</code>，Vue 会抛出错误。<code>hasInjectionContext()</code> 提供了一种安全的检查机制。</p>\n<hr>\n<h3><strong>注意事项</strong></h3>\n<ul>\n<li>该 API 从 <strong>Vue 3.3+</strong>   开始提供（确保你的 Vue 版本足够新）。</li>\n<li>即使返回 <code>true</code>，也可能因调用时机问题导致 <code>inject()</code> 失败（例如在异步代码中组件已卸载）。</li>\n</ul>\n<hr>\n<h3><strong>替代方案</strong></h3>\n<p>如果你无法使用 Vue 3.3+，可以通过 <code>getCurrentInstance()</code> 间接判断：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { getCurrentInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">hasContext</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> !!<span class="hljs-title function_">getCurrentInstance</span>();\n}\n</code></pre>\n<p>但 <code>hasInjectionContext()</code> 是更准确的实现，推荐优先使用它。</p>\n</div>'</script></body></html>