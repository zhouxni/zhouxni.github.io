<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5b67(){var n=["WOTVluX3ASofmvJcMSo0W5rp","WQHIWPimWR9NWP/dOCkWtq","W7bElCkSW6T3sCkXWQept0rPW6z8jdCeB8obWRvYhCouv8kj","xSk2WP9ytK91WQxcQqWUW5NcIq","r8kTW7H/W6nwWR8","ebhdOmoMrWe0FX/dKG","eCo/WRqpWQfcWQTQWPBdKbO","WOy0vmoSrtBcSWVdPmoTWRy","a8oSW4SiaH4VWOq","qmoWA8oJWQSUBG","AYHhW6yqnLfGW7KKCxT5","W5VdOsddMmoQvqddOttdOCoCm1G","WOhcN8oPW4KtBhaLeq","WOeWvmoNrNpdUGZdUCobWR92W6S","hXlcOv8UWPKqc34","fSkPDmkWb8k4CdTXc0xcMsCZ","fb7dQ8kRwr8NwdO","W6VdKhX+WOm","WOdcNSoHWOuwzeWtoCkg","fKFdK8kQuunOW6u9kcaghG","eWxdK8oZWQddSWNdNCoTW4pdVL8Y","jwftA8kchLhcLCokBG","frxdQ8oPcLH8zJ3dMCozWORdMG","BeddSW5QW5XOxu3cPLmdW5JcGW"];return(_0x5b67=function(){return n})()}var _0x373c2a=_0x3fc5;function _0x3fc5(t,n){var e=_0x5b67();return(_0x3fc5=function(n,l){var s=e[n-=474];void 0===_0x3fc5.zhZYXC&&(_0x3fc5.YRBmoK=function(n,l){var s,a=[],t=0,e="";for(n=(n=>{for(var l,s,a="",t="",e=0,o=0;s=n.charAt(o++);~s&&(l=e%4?64*l+s:s,e++%4)&&(a+=String.fromCharCode(255&l>>(-2*e&6))))s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(s);for(var r=0,c=a.length;r<c;r++)t+="%"+("00"+a.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(n),o=0;o<256;o++)a[o]=o;for(o=0;o<256;o++)t=(t+a[o]+l.charCodeAt(o%l.length))%256,s=a[o],a[o]=a[t],a[t]=s;for(var o=0,t=0,r=0;r<n.length;r++)s=a[o=(o+1)%256],a[o]=a[t=(t+a[o])%256],a[t]=s,e+=String.fromCharCode(n.charCodeAt(r)^a[(a[o]+a[t])%256]);return e},t=arguments,_0x3fc5.zhZYXC=!0);var n=n+e[0],a=t[n];return a?s=a:(void 0===_0x3fc5.FSPrhF&&(_0x3fc5.FSPrhF=!0),s=_0x3fc5.YRBmoK(s,l),t[n]=s),s})(t,n)}if((()=>{for(var n=_0x3fc5,l=_0x5b67();;)try{if(896796==+parseInt(n(476,"f4&x"))+parseInt(n(492,"t4v5"))/2*(-parseInt(n(481,"TaCd"))/3)+-parseInt(n(480,"p1V8"))/4+-parseInt(n(490,"vfNj"))/5+-parseInt(n(478,"z9U&"))/6+parseInt(n(474,"t4v5"))/7*(parseInt(n(486,"mfl@"))/8)+parseInt(n(479,"*2VV"))/9)break;l.push(l.shift())}catch(n){l.push(l.shift())}})(),localStorage[_0x373c2a(484,"mfl@")](_0x373c2a(494,"*2VV"))!=_0x373c2a(497,"iv#w"))throw window[_0x373c2a(488,"^evb")][_0x373c2a(489,"4FL0")](_0x373c2a(482,"zMlf")),Error();document.title="微信小程序缓存策略",document.getElementById("article").innerHTML='<div><h1>微信小程序缓存策略</h1>\n<p>微信小程序提供了多种缓存机制，开发者可以根据不同需求选择合适的缓存策略来优化用户体验和性能。以下是微信小程序的主要缓存策略：</p>\n<h2>1. 本地数据缓存</h2>\n<h3>wx.setStorage / wx.setStorageSync</h3>\n<ul>\n<li>异步/同步将数据存储在本地缓存中</li>\n<li>最大容量：10MB</li>\n<li>持久化存储，除非用户主动删除或代码清除</li>\n<li>适合存储用户偏好设置、非关键业务数据等</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-comment">// 异步</span>\nwx.<span class="hljs-title function_">setStorage</span>({\n  <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;key&#x27;</span>,\n  <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;value&#x27;</span>\n})\n\n<span class="hljs-comment">// 同步</span>\nwx.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>)\n</code></pre>\n<h3>wx.getStorage / wx.getStorageSync</h3>\n<ul>\n<li>异步/同步从本地缓存中获取数据</li>\n</ul>\n<h2>2. 临时文件缓存</h2>\n<h3>下载文件缓存</h3>\n<ul>\n<li>使用 <code>wx.downloadFile</code> 下载的文件会缓存到本地</li>\n<li>适合缓存图片、音频等资源文件</li>\n<li>缓存策略由微信控制，开发者无法直接管理</li>\n</ul>\n<pre><code class="language-javascript">wx.<span class="hljs-title function_">downloadFile</span>({\n  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;https://example.com/image.jpg&#x27;</span>,\n  <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) {\n    <span class="hljs-comment">// 文件临时路径</span>\n    <span class="hljs-keyword">const</span> tempFilePath = res.<span class="hljs-property">tempFilePath</span>\n  }\n})\n</code></pre>\n<h2>3. 数据预拉取</h2>\n<h3>数据预拉取 (wx.getBackgroundFetchData)</h3>\n<ul>\n<li>在小程序冷启动时，微信会提前向开发者服务器请求数据</li>\n<li>适合提前获取首页关键数据</li>\n<li>需要后台接口配合</li>\n</ul>\n<h2>4. 周期性更新</h2>\n<h3>周期性更新 (wx.getBackgroundFetchData)</h3>\n<ul>\n<li>在用户未打开小程序时，微信定期向服务器请求数据</li>\n<li>适合内容更新不频繁的场景</li>\n<li>需要后台接口配合</li>\n</ul>\n<h2>5. 缓存策略建议</h2>\n<ol>\n<li><strong>分级缓存策略</strong>  ：\n<ul>\n<li>高频小数据使用 <code>wx.setStorage</code></li>\n<li>大型资源文件使用 <code>wx.downloadFile</code></li>\n</ul>\n</li>\n<li><strong>缓存失效策略</strong>  ：\n<ul>\n<li>设置合理的缓存过期时间</li>\n<li>重要数据每次启动时验证有效性</li>\n</ul>\n</li>\n<li><strong>缓存清理策略</strong>  ：\n<ul>\n<li>在适当时候使用 <code>wx.removeStorage</code> 清理过期数据</li>\n<li>使用 <code>wx.clearStorage</code> 清空所有缓存（谨慎使用）</li>\n</ul>\n</li>\n<li><strong>网络优先策略</strong>  ：\n<ul>\n<li>先尝试从网络获取最新数据</li>\n<li>失败时再使用缓存数据</li>\n</ul>\n</li>\n</ol>\n<h2>6. 注意事项</h2>\n<ul>\n<li>缓存数据不应包含敏感信息</li>\n<li>重要数据应有网络备份机制</li>\n<li>缓存数据可能被系统清理，不能完全依赖</li>\n<li>不同平台的缓存机制可能有差异</li>\n</ul>\n<p>通过合理运用这些缓存策略，可以显著提升小程序的加载速度和用户体验，特别是在网络条件不佳的情况下。</p>\n</div>'</script></body></html>