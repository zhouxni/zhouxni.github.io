<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1201fc=_0xe3db;function _0xe3db(p,s){var t=_0x57bc();return(_0xe3db=function(s,a){var n=t[s-=293];void 0===_0xe3db.MqBRzA&&(_0xe3db.YUuDwk=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,o=0;n=s.charAt(o++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,e=l.length;c<e;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),o=0;o<256;o++)l[o]=o;for(o=0;o<256;o++)p=(p+l[o]+a.charCodeAt(o%a.length))%256,n=l[o],l[o]=l[p],l[p]=n;for(var o=0,p=0,c=0;c<s.length;c++)n=l[o=(o+1)%256],l[o]=l[p=(p+l[o])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[o]+l[p])%256]);return t},p=arguments,_0xe3db.MqBRzA=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0xe3db.ZRCYam&&(_0xe3db.ZRCYam=!0),n=_0xe3db.YUuDwk(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0xe3db,a=_0x57bc();;)try{if(940857==-parseInt(s(310,"y(bN"))*(-parseInt(s(309,"KYd5"))/2)+parseInt(s(298,"irDO"))/3*(-parseInt(s(307,"L2NG"))/4)+-parseInt(s(305,"09QU"))/5*(parseInt(s(299,"53R#"))/6)+parseInt(s(311,"[APF"))/7*(-parseInt(s(297,"oYjU"))/8)+-parseInt(s(302,"Bu8$"))/9+parseInt(s(313,"AgUZ"))/10+-parseInt(s(295,"W76r"))/11*(-parseInt(s(296,"W(eC"))/12))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1201fc(293,"3uZn")](_0x1201fc(318,"L2NG"))!=_0x1201fc(303,"uMf5"))throw window[_0x1201fc(306,"y(bN")][_0x1201fc(301,"2PV%")](_0x1201fc(308,"y5fB")),Error();function _0x57bc(){var s=["dmoVktugu8ohW5NdSLHiWRZcJmk9","xrZcLmkEW43dVCoBn8o/","WR8fFYKwWO1aza3cPuhcRCkv","W4BcNSoBz8kJlSkeW6fI","vqhcJSolWOxdM8ojjq","WQhcKK4xiYNcOs/dK19GW5ddGCof","WPRcImk/B8oSfSkU","ys0LstHNWR4","WQpcLGvnzMNdUe8","xWtdTSkWW7/cS8k/qSk8W4GGWP4obG","ySoyrSkEqH/cSG","W6fuW7hcGCkhA8kr","W6xdI3dcVCoSWO95W6G","g8o4nCkRWQq8W6NdV17cNbVcJNy","xSoNcby/fxe","W554W7FcHIC0iu/dUemFW5zS","xmk5F8oGW6W","wbpcKmoCWRxcUmodhCo0W5imWP4","W5FcSCkOgCoxwLVcOmkmWORcVre","WOVdLmoTfmoVa00o","WRBdImklmSoKzmo9W6j2o8oSWQv3","oSkqWRZdM8klkdVdL8kGW4i4o8kXE8omFLWxCSkYW6RdICouWPldOCkl","W6pdPLRcLmkvW5SZm0S","W5BcISk3qmoHig8KWQ0p","CY3dTL/cMmkjWQSfW4VdQZSzwq","AsBdShhcILRdLCo/WO0sfmk/WPy","wHRcLmozWRNcVSk7tmomW4ugWRtcQvy","hCkZcHGQbNRcNG"];return(_0x57bc=function(){return s})()}document.title="webpack Hook 拦截",document.getElementById("article").innerHTML='<div><p>你说得对，我提供的两种方法确实在核心思路上是相似的，都是通过 <code>intercept</code> 方法来拦截 hook 执行并统计耗时。让我重新整理并提供几种不同的实现方式，展示不同的技术思路：</p>\n<h2>方法一：基于 Hook 拦截的通用方案（改进版）</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HookTimePlugin</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hookStats</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();\n  }\n\n  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {\n    <span class="hljs-comment">// 拦截 compiler 所有 hooks</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapHooks</span>(compiler.<span class="hljs-property">hooks</span>);\n\n    <span class="hljs-comment">// 拦截 compilation hooks</span>\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapHooks</span>(compilation.<span class="hljs-property">hooks</span>);\n    });\n\n    <span class="hljs-comment">// 输出统计结果</span>\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">printStatistics</span>();\n    });\n  }\n\n  <span class="hljs-title function_">wrapHooks</span>(<span class="hljs-params">hooks</span>) {\n    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(hooks).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">hookName</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> hook = hooks[hookName];\n      <span class="hljs-keyword">if</span> (!hook.<span class="hljs-property">intercept</span>) <span class="hljs-keyword">return</span>;\n\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hookStats</span>.<span class="hljs-title function_">set</span>(hookName, { <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> });\n\n      hook.<span class="hljs-title function_">intercept</span>({\n        <span class="hljs-attr">register</span>: <span class="hljs-function">(<span class="hljs-params">tapInfo</span>) =&gt;</span> {\n          <span class="hljs-keyword">const</span> originalFn = tapInfo.<span class="hljs-property">fn</span>;\n          tapInfo.<span class="hljs-property">fn</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {\n            <span class="hljs-keyword">const</span> start = process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>();\n            <span class="hljs-keyword">try</span> {\n              <span class="hljs-keyword">return</span> originalFn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);\n            } <span class="hljs-keyword">finally</span> {\n              <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Number</span>(process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>() - start) / <span class="hljs-number">1e6</span>;\n              <span class="hljs-keyword">const</span> stats = <span class="hljs-variable language_">this</span>.<span class="hljs-property">hookStats</span>.<span class="hljs-title function_">get</span>(hookName);\n              stats.<span class="hljs-property">totalTime</span> += duration;\n              stats.<span class="hljs-property">count</span>++;\n            }\n          };\n          <span class="hljs-keyword">return</span> tapInfo;\n        },\n      });\n    });\n  }\n\n  <span class="hljs-title function_">printStatistics</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;\\n=== Webpack Hook Execution Statistics ===&quot;</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(\n      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hookStats</span>.<span class="hljs-title function_">entries</span>())\n        .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span> - a[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span>)\n        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[name, { totalTime, count }]</span>) =&gt;</span> ({\n          <span class="hljs-title class_">Hook</span>: name,\n          <span class="hljs-string">&quot;Total (ms)&quot;</span>: totalTime.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-string">&quot;Avg (ms)&quot;</span>: (totalTime / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(count, <span class="hljs-number">1</span>)).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-title class_">Calls</span>: count,\n        })),\n    );\n  }\n}\n</code></pre>\n<h2>方法二：基于 Proxy 的全局拦截方案</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HookTimePlugin</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createHookProxy</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">createHookProxy</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);\n  }\n\n  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {\n    <span class="hljs-comment">// 使用 Proxy 包装整个 hooks 对象</span>\n    compiler.<span class="hljs-property">hooks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createHookProxy</span>(compiler.<span class="hljs-property">hooks</span>, <span class="hljs-string">&quot;compiler&quot;</span>);\n\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {\n      compilation.<span class="hljs-property">hooks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createHookProxy</span>(\n        compilation.<span class="hljs-property">hooks</span>,\n        <span class="hljs-string">&quot;compilation&quot;</span>,\n      );\n    });\n\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">printStats</span>();\n    });\n  }\n\n  <span class="hljs-title function_">createHookProxy</span>(<span class="hljs-params">hooks, context</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(hooks, {\n      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, prop</span>) =&gt;</span> {\n        <span class="hljs-keyword">const</span> hook = target[prop];\n        <span class="hljs-keyword">if</span> (!hook || <span class="hljs-keyword">typeof</span> hook !== <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> hook;\n\n        <span class="hljs-comment">// 已经包装过的直接返回</span>\n        <span class="hljs-keyword">if</span> (hook.<span class="hljs-property">__wrapped__</span>) <span class="hljs-keyword">return</span> hook;\n\n        <span class="hljs-keyword">const</span> wrappedHook = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapHook</span>(hook, <span class="hljs-string">`<span class="hljs-subst">${context}</span>.<span class="hljs-subst">${prop}</span>`</span>);\n        wrappedHook.<span class="hljs-property">__wrapped__</span> = <span class="hljs-literal">true</span>;\n        <span class="hljs-keyword">return</span> wrappedHook;\n      },\n    });\n  }\n\n  <span class="hljs-title function_">wrapHook</span>(<span class="hljs-params">hook, fullName</span>) {\n    <span class="hljs-keyword">if</span> (!hook.<span class="hljs-property">tap</span> || !hook.<span class="hljs-property">call</span>) <span class="hljs-keyword">return</span> hook;\n\n    <span class="hljs-keyword">const</span> stats = { <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">set</span>(fullName, stats);\n\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(hook, {\n      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, prop</span>) =&gt;</span> {\n        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&quot;call&quot;</span>) {\n          <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {\n            <span class="hljs-keyword">const</span> start = process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>();\n            <span class="hljs-keyword">try</span> {\n              <span class="hljs-keyword">return</span> target.<span class="hljs-title function_">call</span>(...args);\n            } <span class="hljs-keyword">finally</span> {\n              <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Number</span>(process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>() - start) / <span class="hljs-number">1e6</span>;\n              stats.<span class="hljs-property">totalTime</span> += duration;\n              stats.<span class="hljs-property">count</span>++;\n            }\n          };\n        }\n        <span class="hljs-keyword">return</span> target[prop];\n      },\n    });\n  }\n\n  <span class="hljs-title function_">printStats</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;\\n=== Webpack Hook Execution Statistics (Proxy) ===&quot;</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(\n      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">entries</span>())\n        .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span> - a[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span>)\n        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[name, { totalTime, count }]</span>) =&gt;</span> ({\n          <span class="hljs-title class_">Hook</span>: name,\n          <span class="hljs-string">&quot;Total (ms)&quot;</span>: totalTime.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-string">&quot;Avg (ms)&quot;</span>: (totalTime / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(count, <span class="hljs-number">1</span>)).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-title class_">Calls</span>: count,\n        })),\n    );\n  }\n}\n</code></pre>\n<h2>方法三：基于 Monkey-patching 的核心方法替换</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HookTimePlugin</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span> = <span class="hljs-literal">null</span>;\n  }\n\n  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">patchTapable</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">collectHooks</span>(compiler.<span class="hljs-property">hooks</span>, <span class="hljs-string">&quot;compiler&quot;</span>);\n\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">collectHooks</span>(compilation.<span class="hljs-property">hooks</span>, <span class="hljs-string">&quot;compilation&quot;</span>);\n    });\n\n    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&quot;HookTimePlugin&quot;</span>, <span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">restoreTapable</span>();\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">printStatistics</span>();\n    });\n  }\n\n  <span class="hljs-title function_">patchTapable</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> tapable = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;tapable&quot;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span> = tapable.<span class="hljs-property">Hook</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">tap</span>;\n\n    tapable.<span class="hljs-property">Hook</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">tap</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">name, fn</span>) {\n      <span class="hljs-keyword">const</span> <span class="hljs-title function_">wrappedFn</span> = (<span class="hljs-params">...args</span>) =&gt; {\n        <span class="hljs-keyword">const</span> start = process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>();\n        <span class="hljs-keyword">try</span> {\n          <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);\n        } <span class="hljs-keyword">finally</span> {\n          <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Number</span>(process.<span class="hljs-property">hrtime</span>.<span class="hljs-title function_">bigint</span>() - start) / <span class="hljs-number">1e6</span>;\n          <span class="hljs-keyword">const</span> hookName = <span class="hljs-variable language_">this</span>.<span class="hljs-property">constructor</span>.<span class="hljs-property">name</span>;\n          <span class="hljs-keyword">const</span> stats = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">get</span>(hookName) || { <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };\n          stats.<span class="hljs-property">totalTime</span> += duration;\n          stats.<span class="hljs-property">count</span>++;\n          <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">set</span>(hookName, stats);\n        }\n      };\n      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name, wrappedFn);\n    };\n  }\n\n  <span class="hljs-title function_">collectHooks</span>(<span class="hljs-params">hooks, context</span>) {\n    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(hooks).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">hookName</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> hook = hooks[hookName];\n      <span class="hljs-keyword">if</span> (hook &amp;&amp; hook.<span class="hljs-property">tap</span>) {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">`<span class="hljs-subst">${context}</span>.<span class="hljs-subst">${hookName}</span>`</span>, { <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> });\n      }\n    });\n  }\n\n  <span class="hljs-title function_">restoreTapable</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span>) {\n      <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;tapable&quot;</span>).<span class="hljs-property">Hook</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">tap</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalTap</span>;\n    }\n  }\n\n  <span class="hljs-title function_">printStatistics</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;\\n=== Webpack Hook Execution Statistics (Monkey-patch) ===&quot;</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(\n      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">entries</span>())\n        .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span> - a[<span class="hljs-number">1</span>].<span class="hljs-property">totalTime</span>)\n        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[name, { totalTime, count }]</span>) =&gt;</span> ({\n          <span class="hljs-title class_">Hook</span>: name,\n          <span class="hljs-string">&quot;Total (ms)&quot;</span>: totalTime.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-string">&quot;Avg (ms)&quot;</span>: (totalTime / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(count, <span class="hljs-number">1</span>)).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),\n          <span class="hljs-title class_">Calls</span>: count,\n        })),\n    );\n  }\n}\n</code></pre>\n<h2>三种方法对比</h2>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>技术手段</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Hook拦截</td>\n<td>使用Tapable的intercept API</td>\n<td>官方支持，稳定性高</td>\n<td>不能拦截所有类型的Hook</td>\n</tr>\n<tr>\n<td>Proxy包装</td>\n<td>使用ES6 Proxy</td>\n<td>可以拦截所有hook访问</td>\n<td>可能影响性能，Proxy兼容性要求</td>\n</tr>\n<tr>\n<td>Monkey-patch</td>\n<td>修改Tapable原型</td>\n<td>最全面的拦截</td>\n<td>侵入性强，可能影响其他插件</td>\n</tr>\n</tbody>\n</table>\n<p>建议根据实际需求选择：</p>\n<ul>\n<li>开发环境调试：方法一（Hook拦截）</li>\n<li>全面统计分析：方法三（Monkey-patch）</li>\n<li>现代浏览器环境：方法二（Proxy）</li>\n</ul>\n</div>'</script></body></html>