<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3d8c(l,s){var p=_0x57cf();return(_0x3d8c=function(s,n){var a=p[s-=342];void 0===_0x3d8c.RcOObN&&(_0x3d8c.CqQtHd=function(s,n){var a,t=[],l=0,p="";for(s=(s=>{for(var n,a,t="",l="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(t+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,c=t.length;o<c;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)l=(l+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[l],t[l]=a;for(var e=0,l=0,o=0;o<s.length;o++)a=t[e=(e+1)%256],t[e]=t[l=(l+t[e])%256],t[l]=a,p+=String.fromCharCode(s.charCodeAt(o)^t[(t[e]+t[l])%256]);return p},l=arguments,_0x3d8c.RcOObN=!0);var s=s+p[0],t=l[s];return t?a=t:(void 0===_0x3d8c.XunbgH&&(_0x3d8c.XunbgH=!0),a=_0x3d8c.CqQtHd(a,n),l[s]=a),a})(l,s)}function _0x57cf(){var s=["WO7dR2ldLX1ts8kVwai2W6/dGG","W6bWW7/cSCoBdLpcImoGyZOMW5y","bmkOoCoKW6lcJCkhjftdP0utBSkixmkdWQqRWOJdVGNcL8o2zHma","bCkpW5CEC3v7Ca","oCohWQWnmuJcPaLqeIWqcG","W6u9WQJcNc/dImoPjKZdThZdTq","W4b8WOnTFXdcHSoV","W4ddLSk5WQxdMCk6WRldRa","FhLWWODGrs8GWOJcISohW7xcJW","AbmPWR4iruxcQmoT","W6u/WQVcNcJdISkjmh7dNM7dTCka","WO3dR2ddLrPAtSk0tHuBW7FdSW","WQrZWRpcNCoaWRy5WP0","ntbKlSkMBSooW6q","WRFcUftcQbJcVXNdRmkbWPVcN8kTW5O","W5VcHCofprnQBa","W6PLW5pdSmozb8o6WPeDW6tcTs1j","W4hdP1JcGCo6nLq","nfTehhlcNmkusSotWRHQjfm","oSokWQypnKdcPHLCeGeniW","W4xdLSopW7tcM8ocW4FdQ31numojja","FSkfW7fzWOi","WOSdamkNWPruWO9h","WROLCCkeo8oeW4hcP8kNjCkOWRm","Dxq6W5avnLew","WPHxWQjuqqjPCSoduSozW4RdMa"];return(_0x57cf=function(){return s})()}var _0x1ea5fd=_0x3d8c;if((()=>{for(var s=_0x3d8c,n=_0x57cf();;)try{if(629656==+parseInt(s(349,"ZlzP"))+-parseInt(s(348,"d3Kh"))/2+-parseInt(s(345,"M6Fc"))/3+-parseInt(s(350,"hG)l"))/4*(parseInt(s(344,"&KWY"))/5)+parseInt(s(364,"[JxG"))/6+parseInt(s(357,"jv61"))/7*(-parseInt(s(363,"d3Kh"))/8)+-parseInt(s(342,"MAa0"))/9*(-parseInt(s(352,"MAa0"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1ea5fd(359,"Sedv")](_0x1ea5fd(353,"iEpe"))!=_0x1ea5fd(365,"ZuEz"))throw window[_0x1ea5fd(347,"M%CK")][_0x1ea5fd(361,"3qu5")](_0x1ea5fd(346,"yU29")),Error();document.title="Vite 模块联邦实现方案",document.getElementById("article").innerHTML='<div><p>Vite 本身不直接提供类似 Webpack 模块联邦(Module Federation)的内置功能，但可以通过插件或特定配置实现类似效果。以下是 Vite 生态中实现模块联邦的几种方案：</p>\n<h2>1. 使用 vite-plugin-federation 插件</h2>\n<p>这是目前最成熟的 Vite 模块联邦解决方案，由原 Webpack 模块联邦作者开发。</p>\n<h3>安装配置</h3>\n<pre><code class="language-bash">npm install @originjs/vite-plugin-federation --save-dev\n</code></pre>\n<h3>基础配置示例</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vite&quot;</span>;\n<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@originjs/vite-plugin-federation&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">federation</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;host-app&quot;</span>, <span class="hljs-comment">// 应用名称</span>\n      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>, <span class="hljs-comment">// 远程入口文件</span>\n      <span class="hljs-comment">// 作为模块提供方配置</span>\n      <span class="hljs-attr">exposes</span>: {\n        <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button.vue&quot;</span>,\n        <span class="hljs-string">&quot;./Store&quot;</span>: <span class="hljs-string">&quot;./src/store/index.js&quot;</span>,\n      },\n      <span class="hljs-comment">// 作为模块消费方配置</span>\n      <span class="hljs-attr">remotes</span>: {\n        <span class="hljs-attr">remote_app</span>: <span class="hljs-string">&quot;http://localhost:5001/assets/remoteEntry.js&quot;</span>,\n      },\n      <span class="hljs-comment">// 共享依赖</span>\n      <span class="hljs-attr">shared</span>: [<span class="hljs-string">&quot;vue&quot;</span>, <span class="hljs-string">&quot;pinia&quot;</span>, <span class="hljs-string">&quot;vue-router&quot;</span>],\n    }),\n  ],\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;esnext&quot;</span>, <span class="hljs-comment">// 必须使用ESM格式</span>\n    <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 调试时建议关闭minify</span>\n    <span class="hljs-attr">cssCodeSplit</span>: <span class="hljs-literal">false</span>,\n  },\n});\n</code></pre>\n<h3>特点</h3>\n<ul>\n<li>几乎 1:1 复刻 Webpack 模块联邦功能</li>\n<li>支持 Vue、React 等主流框架</li>\n<li>生产环境可用</li>\n<li>支持 HMR 热更新</li>\n</ul>\n<h2>2. 纯 ESM 动态导入方案</h2>\n<p>Vite 原生支持 ES 模块，可以利用浏览器原生 <code>import()</code> 实现简单模块共享：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动态加载远程模块</span>\n<span class="hljs-keyword">const</span> remoteModule = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;http://other-server.com/module.js&quot;</span>);\n\n<span class="hljs-comment">// 使用模块</span>\nremoteModule.<span class="hljs-title function_">exportedFunction</span>();\n</code></pre>\n<h3>优缺点</h3>\n<p><strong>优点</strong>   ：</p>\n<ul>\n<li>无需额外插件</li>\n<li>符合现代浏览器标准</li>\n</ul>\n<p><strong>缺点</strong>   ：</p>\n<ul>\n<li>缺乏版本管理和依赖共享</li>\n<li>需要处理跨域问题</li>\n<li>没有 Webpack 模块联邦的完整功能</li>\n</ul>\n<h2>3. 使用 Vite 构建库模式</h2>\n<p>通过构建为库再动态加载：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// vite.config.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">build</span>: {\n    <span class="hljs-attr">lib</span>: {\n      <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./src/main.js&quot;</span>,\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;MyLib&quot;</span>,\n      <span class="hljs-attr">fileName</span>: <span class="hljs-string">&quot;my-lib&quot;</span>,\n    },\n  },\n});\n</code></pre>\n<p>然后其他应用通过 <code>&lt;script&gt;</code> 标签或动态导入加载：</p>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://other-server.com/my-lib.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">\n  <span class="hljs-comment">// 使用全局变量</span>\n  <span class="hljs-title class_">MyLib</span>.<span class="hljs-title function_">doSomething</span>();\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n</code></pre>\n<h2>对比 Webpack 模块联邦</h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>Webpack 模块联邦</th>\n<th>Vite 模块联邦方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>原生支持</td>\n<td>是</td>\n<td>需插件</td>\n</tr>\n<tr>\n<td>开发体验</td>\n<td>优秀</td>\n<td>良好</td>\n</tr>\n<tr>\n<td>HMR 支持</td>\n<td>完整支持</td>\n<td>部分支持</td>\n</tr>\n<tr>\n<td>生产环境稳定性</td>\n<td>高</td>\n<td>中</td>\n</tr>\n<tr>\n<td>共享依赖优化</td>\n<td>完善</td>\n<td>有限</td>\n</tr>\n<tr>\n<td>构建速度</td>\n<td>慢</td>\n<td>快</td>\n</tr>\n<tr>\n<td>生态系统</td>\n<td>丰富</td>\n<td>成长中</td>\n</tr>\n</tbody>\n</table>\n<h2>最佳实践建议</h2>\n<ol>\n<li>\n<p><strong>明确共享边界</strong>   ：</p>\n<ul>\n<li>仅共享真正需要复用的组件/逻辑</li>\n<li>避免过度共享导致耦合</li>\n</ul>\n</li>\n<li>\n<p><strong>版本管理</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">shared</span>: {\n  <span class="hljs-attr">vue</span>: {\n    <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&#x27;^3.2.0&#x27;</span>,\n    <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>\n  }\n}\n</code></pre>\n</li>\n<li>\n<p><strong>错误处理</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">try</span> {\n  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;remote_app/Button&quot;</span>);\n} <span class="hljs-keyword">catch</span> (err) {\n  <span class="hljs-comment">// 加载失败处理</span>\n}\n</code></pre>\n</li>\n<li>\n<p><strong>性能优化</strong>   ：</p>\n<ul>\n<li>预加载远程入口文件</li>\n</ul>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;modulepreload&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://remote/app/remoteEntry.js&quot;</span> /&gt;</span>\n</code></pre>\n<ul>\n<li>使用 HTTP/2 多路复用</li>\n</ul>\n</li>\n<li>\n<p><strong>开发环境配置</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">remotes</span>: {\n  <span class="hljs-attr">remote_app</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>\n    ? <span class="hljs-string">&quot;https://prod.com/remoteEntry.js&quot;</span>\n    : <span class="hljs-string">&quot;http://localhost:5001/remoteEntry.js&quot;</span>;\n}\n</code></pre>\n</li>\n</ol>\n<h2>完整示例：Vue 微前端应用</h2>\n<h3>主机应用配置</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// host-app/vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vite&quot;</span>;\n<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@vitejs/plugin-vue&quot;</span>;\n<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@originjs/vite-plugin-federation&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">vue</span>(),\n    <span class="hljs-title function_">federation</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;host-app&quot;</span>,\n      <span class="hljs-attr">remotes</span>: {\n        <span class="hljs-attr">remote_app</span>: <span class="hljs-string">&quot;http://localhost:5001/assets/remoteEntry.js&quot;</span>,\n      },\n      <span class="hljs-attr">shared</span>: [<span class="hljs-string">&quot;vue&quot;</span>, <span class="hljs-string">&quot;vue-router&quot;</span>, <span class="hljs-string">&quot;pinia&quot;</span>],\n    }),\n  ],\n});\n</code></pre>\n<h3>远程应用配置</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// remote-app/vite.config.js</span>\n<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vite&quot;</span>;\n<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@vitejs/plugin-vue&quot;</span>;\n<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@originjs/vite-plugin-federation&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">vue</span>(),\n    <span class="hljs-title function_">federation</span>({\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;remote-app&quot;</span>,\n      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>,\n      <span class="hljs-attr">exposes</span>: {\n        <span class="hljs-string">&quot;./Header&quot;</span>: <span class="hljs-string">&quot;./src/components/Header.vue&quot;</span>,\n        <span class="hljs-string">&quot;./Footer&quot;</span>: <span class="hljs-string">&quot;./src/components/Footer.vue&quot;</span>,\n      },\n      <span class="hljs-attr">shared</span>: [<span class="hljs-string">&quot;vue&quot;</span>],\n    }),\n  ],\n});\n</code></pre>\n<h3>主机应用使用远程组件</h3>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript">\n  <span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;\n\n  <span class="hljs-keyword">const</span> <span class="hljs-title class_">RemoteHeader</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span>\n    <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;remote_app/Header&quot;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./components/LocalHeader&quot;</span>)),\n  );\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">RemoteHeader</span> /&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li>\n<p><strong>开发服务器配置</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">server</span>: {\n  <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">headers</span>: {\n    <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>\n  }\n}\n</code></pre>\n</li>\n<li>\n<p><strong>生产部署问题</strong>   ：</p>\n<ul>\n<li>确保远程入口文件路径正确</li>\n<li>处理 CDN 和缓存策略</li>\n</ul>\n</li>\n<li>\n<p><strong>TypeScript 支持</strong>   ：</p>\n<pre><code class="language-json"><span class="hljs-comment">// tsconfig.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;remote_app/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;../remote-app/src/*&quot;</span><span class="hljs-punctuation">]</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li>\n<p><strong>样式隔离</strong>   ：</p>\n<ul>\n<li>使用 CSS Scope 或 CSS Modules</li>\n<li>或采用命名空间约定</li>\n</ul>\n</li>\n</ol>\n<p>Vite 的模块联邦方案虽然不如 Webpack 的成熟，但在开发体验和构建速度上有明显优势，适合对构建速度要求高的现代微前端项目。随着生态发展，Vite 的模块联邦能力正在快速完善。</p>\n</div>'</script></body></html>