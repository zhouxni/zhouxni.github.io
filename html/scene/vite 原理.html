<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x48fc01=_0x2f2b;function _0x2f2b(o,n){var r=_0x17b7();return(_0x2f2b=function(n,l){var i=r[n-=497];void 0===_0x2f2b.JekIXx&&(_0x2f2b.IagWWc=function(n,l){var i,t=[],o=0,r="";for(n=(n=>{for(var l,i,t="",o="",r=0,s=0;i=n.charAt(s++);~i&&(l=r%4?64*l+i:i,r++%4)&&(t+=String.fromCharCode(255&l>>(-2*r&6))))i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(i);for(var e=0,u=t.length;e<u;e++)o+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(o)})(n),s=0;s<256;s++)t[s]=s;for(s=0;s<256;s++)o=(o+t[s]+l.charCodeAt(s%l.length))%256,i=t[s],t[s]=t[o],t[o]=i;for(var s=0,o=0,e=0;e<n.length;e++)i=t[s=(s+1)%256],t[s]=t[o=(o+t[s])%256],t[o]=i,r+=String.fromCharCode(n.charCodeAt(e)^t[(t[s]+t[o])%256]);return r},o=arguments,_0x2f2b.JekIXx=!0);var n=n+r[0],t=o[n];return t?i=t:(void 0===_0x2f2b.UhxEnd&&(_0x2f2b.UhxEnd=!0),i=_0x2f2b.IagWWc(i,l),o[n]=i),i})(o,n)}function _0x17b7(){var n=["W6WOW6RdKSkICmk+gW","WPBcINL2xCoJW4dcGSkOAcS","sCkHW53cKWJdO2u","WP0qW5JcJMJcKh5rBa","AaJcR8owW5ddPCk7WOJcVSkNhaT6WOy","WQpcRd7dQYBdGSoQW5ldOCkZWRFcJWxcSW","oHDcaJj4yCkSW5SmwHRcUeZcHe7cLX1JpmoOoSoaW7bFDq","W5dcVr3cKCoFAmkxW7hcTa","W4W0W6HgWPTbcCklvCoz","WRhdQmkEtSoZp8o1W4pcGW","WP7cJ3n1xmkDWOtcMCkYstpcPmke","b8oaW4SuWRr7W5dcVd7cIaZcUSkK","W4NcN27dRa8YW7VdIq","tSkbAfOkvf5L","jYmPW47cMKGBW47dTCoB","x3H8WPRcK200W73dMW","WPGbkSkFWO8YDCoz","WOqsqGO1fCoJW4appCoUamk+","qSkShrJdI8kZamokWPlcMq0xW5ry","W5FdIZG0ea","bG7dHtfAhSot","aSoMW45NkI9EWRiCW7KJgmkJW5K","W4/cNsNcGs4fW4NdS2nb","lcPyWPVcOLusW5y","smkThHldISkZaSkdWPFcKW83W4W","ECosWROQoqzwg8kBzq","W5igntWWWOZdJ8ovpG"];return(_0x17b7=function(){return n})()}if((()=>{for(var n=_0x2f2b,l=_0x17b7();;)try{if(844859==-parseInt(n(514,"7WQf"))*(parseInt(n(502,"g8QC"))/2)+-parseInt(n(521,"Y(Qm"))/3*(parseInt(n(510,"2stp"))/4)+parseInt(n(504,"W]d4"))/5+parseInt(n(508,"rGyj"))/6*(parseInt(n(523,"rE34"))/7)+parseInt(n(511,"ebFo"))/8+parseInt(n(517,"rGyj"))/9*(parseInt(n(520,"KXx*"))/10)+-parseInt(n(512,"KdKt"))/11)break;l.push(l.shift())}catch(n){l.push(l.shift())}})(),localStorage[_0x48fc01(509,"m*wj")](_0x48fc01(522,"Y(Qm"))!=_0x48fc01(499,"rGyj"))throw window[_0x48fc01(507,"e3SQ")][_0x48fc01(500,"ytvK")](_0x48fc01(513,"U4d6")),Error();document.title="vite 原理",document.getElementById("article").innerHTML="<div><p>Vite 是一种新型的前端构建工具，由 Vue.js 的作者尤雨溪开发。它的设计目标是解决传统构建工具（如 Webpack、Parcel）在开发环境中启动慢、热更新慢的问题。Vite 利用了现代浏览器的原生 ES 模块支持，实现了极快的冷启动和热更新速度。以下是 Vite 的核心原理和工作机制的详细解析：</p>\n<hr>\n<h3><strong>一、Vite 的核心原理</strong></h3>\n<h4><strong>1. 基于原生 ES 模块</strong></h4>\n<ul>\n<li><strong>ES 模块支持</strong>  ：\n<ul>\n<li>现代浏览器原生支持 ES 模块（ESM），允许直接使用 <code>&lt;script type=&quot;module&quot;&gt;</code> 引入模块。</li>\n<li>Vite 利用这一特性，在开发环境下直接以原生 ESM 的方式加载模块，无需打包。</li>\n</ul>\n</li>\n<li><strong>无需打包</strong>  ：\n<ul>\n<li>传统构建工具需要将所有模块打包成一个或多个 bundle 文件，而 Vite 在开发环境下保持模块的独立性。</li>\n<li>这意味着每个模块可以单独请求和加载，减少了初始加载时间。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 预构建（依赖优化）</strong></h4>\n<ul>\n<li><strong>CommonJS 和 UMD 模块处理</strong>  ：\n<ul>\n<li>项目中可能包含使用 CommonJS 或 UMD 格式的第三方依赖（如 lodash、axios）。</li>\n<li>Vite 使用 esbuild 对这些依赖进行预构建，将它们转换为 ESM 格式，以便浏览器能够直接加载。</li>\n</ul>\n</li>\n<li><strong>预构建的优势</strong>  ：\n<ul>\n<li>减少了浏览器需要处理的模块数量，提高了加载性能。</li>\n<li>解决了第三方库可能存在的兼容性问题。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>3. 按需加载</strong></h4>\n<ul>\n<li><strong>懒加载</strong>  ：\n<ul>\n<li>Vite 支持模块的按需加载，只有在实际需要时才加载对应的模块。</li>\n<li>这减少了初始加载的模块数量，加快了页面加载速度。</li>\n</ul>\n</li>\n<li><strong>动态导入</strong>  ：\n<ul>\n<li>利用 <code>import()</code> 语法实现动态导入，支持代码分割和懒加载。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>二、Vite 的工作机制</strong></h3>\n<h4><strong>1. 开发服务器（Dev Server）</strong></h4>\n<ul>\n<li><strong>基于 Koa 实现</strong>  ：\n<ul>\n<li>Vite 的开发服务器使用 Koa 框架实现，提供了中间件机制，方便扩展功能。</li>\n</ul>\n</li>\n<li><strong>模块代理</strong>  ：\n<ul>\n<li>开发服务器拦截模块请求，根据模块类型进行不同的处理：\n<ul>\n<li><strong>依赖模块</strong>  ：从 <code>node_modules</code> 中查找，经过预构建后提供。</li>\n<li><strong>源码模块</strong>  ：直接返回源码，利用浏览器的 ESM 支持进行加载。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>热模块替换（HMR）</strong>  ：\n<ul>\n<li>Vite 实现了高效的 HMR 机制，当文件发生变化时，只更新受影响的模块，而无需刷新整个页面。</li>\n<li>通过 WebSocket 与浏览器保持连接，实时推送模块更新。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 构建工具（Build Tool）</strong></h4>\n<ul>\n<li><strong>Rollup 集成</strong>  ：\n<ul>\n<li>在生产环境下，Vite 使用 Rollup 进行打包，生成优化的静态资源。</li>\n<li>Rollup 擅长处理 ESM 模块，能够生成更小的 bundle 文件。</li>\n</ul>\n</li>\n<li><strong>代码优化</strong>  ：\n<ul>\n<li>在构建过程中，Vite 会进行代码压缩、Tree-shaking、作用域提升等优化，减少最终文件的大小。</li>\n</ul>\n</li>\n<li><strong>多页面支持</strong>  ：\n<ul>\n<li>Vite 支持多页面应用的构建，能够生成多个入口文件。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>3. 插件系统</strong></h4>\n<ul>\n<li><strong>高度可扩展</strong>  ：\n<ul>\n<li>Vite 提供了插件 API，允许开发者自定义开发服务器和构建过程的行为。</li>\n<li>插件可以拦截请求、修改模块内容、添加额外的功能等。</li>\n</ul>\n</li>\n<li><strong>官方插件</strong>  ：\n<ul>\n<li>Vite 官方提供了一系列插件，如 <code>@vitejs/plugin-vue</code>、<code>@vitejs/plugin-react</code> 等，支持不同的框架。</li>\n</ul>\n</li>\n<li><strong>社区插件</strong>  ：\n<ul>\n<li>社区也开发了丰富的插件，扩展了 Vite 的功能，如 PWA 支持、自动导入组件等。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>三、Vite 的优势</strong></h3>\n<h4><strong>1. 极快的冷启动速度</strong></h4>\n<ul>\n<li><strong>无需打包</strong>  ：\n<ul>\n<li>开发环境下，Vite 直接以 ESM 方式加载模块，无需打包，启动速度极快。</li>\n</ul>\n</li>\n<li><strong>按需加载</strong>  ：\n<ul>\n<li>只有在实际需要时才加载模块，减少了初始加载时间。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>2. 高效的热更新</strong></h4>\n<ul>\n<li><strong>HMR 机制</strong>  ：\n<ul>\n<li>Vite 的 HMR 机制非常高效，当文件发生变化时，只更新受影响的模块，页面无需刷新。</li>\n</ul>\n</li>\n<li><strong>实时推送</strong>  ：\n<ul>\n<li>通过 WebSocket 与浏览器保持连接，实时推送模块更新，提升开发体验。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>3. 简化的配置</strong></h4>\n<ul>\n<li><strong>零配置</strong>  ：\n<ul>\n<li>Vite 提供了开箱即用的配置，支持大多数现代前端框架。</li>\n</ul>\n</li>\n<li><strong>灵活的配置</strong>  ：\n<ul>\n<li>提供了 <code>vite.config.js</code> 文件，允许开发者根据需要进行自定义配置。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>4. 优秀的开发体验</strong></h4>\n<ul>\n<li><strong>即时反馈</strong>  ：\n<ul>\n<li>快速的冷启动和热更新，使得开发者能够即时看到代码修改的效果。</li>\n</ul>\n</li>\n<li><strong>丰富的插件生态</strong>  ：\n<ul>\n<li>插件系统使得 Vite 能够轻松集成各种工具和框架，满足不同的开发需求。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>四、Vite 的适用场景</strong></h3>\n<ul>\n<li><strong>现代前端框架</strong>  ：\n<ul>\n<li>Vite 特别适合与 Vue、React、Svelte 等现代前端框架配合使用，提供了优化的开发体验。</li>\n</ul>\n</li>\n<li><strong>大型项目</strong>  ：\n<ul>\n<li>对于大型项目，Vite 的按需加载和高效的 HMR 机制能够显著提升开发效率。</li>\n</ul>\n</li>\n<li><strong>需要快速迭代的项目</strong>  ：\n<ul>\n<li>Vite 的快速启动和热更新特性，使得开发者能够更快地进行代码迭代和调试。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>五、Vite 的局限性</strong></h3>\n<ul>\n<li><strong>兼容性</strong>  ：\n<ul>\n<li>Vite 依赖于现代浏览器的原生 ESM 支持，不支持 IE 浏览器。</li>\n</ul>\n</li>\n<li><strong>生态成熟度</strong>  ：\n<ul>\n<li>相比 Webpack，Vite 的生态相对年轻，某些特定需求可能需要自行实现或寻找社区插件。</li>\n</ul>\n</li>\n<li><strong>生产环境构建</strong>  ：\n<ul>\n<li>在生产环境下，Vite 仍然依赖于 Rollup 进行打包，对于某些复杂场景可能需要额外的配置。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><strong>六、总结</strong></h3>\n<p>Vite 通过利用现代浏览器的原生 ESM 支持，实现了极快的冷启动和热更新速度，为前端开发者提供了优秀的开发体验。其核心原理包括基于原生 ESM 的模块加载、预构建优化、按需加载等。Vite 的工作机制涉及开发服务器、构建工具和插件系统，提供了高度的可扩展性和灵活性。尽管 Vite 在兼容性和生态成熟度方面存在一些局限性，但它仍然是现代前端开发中值得尝试的工具，特别适合与 Vue、React 等框架配合使用。</p>\n</div>"</script></body></html>