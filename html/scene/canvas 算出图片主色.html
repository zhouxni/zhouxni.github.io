<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x2de4(){var s=["W6/cGmkOExnzx8oxWOq","WOWup8o+wCk0xa","W4DgFmkHamoNufddRSk0W4rW","ytOdWPT3WPSunKKlpvHr","W6avW5qmvGVcUSkmW5uGhri","W7ddJar0W7PuWR4","W6pcItqxWR/cNYFcLa","W7vsW63dV8ocAGrrWP5UpmkV","B8oFWOv7bYf2WOJcQsGBWQCmW6u","drLpWOCWCmoxn2hdR2ddKG","WRRdOSoUpCotWRXKngGSWQ7dKNC","W7/cKYqfWRi","W4rUW5tcJHhcM2a","A8oFWOD5aYCIW6dcPrelWOq","W5/cHZlcMSoEwN7cNCoj","W4FcIJTaWRilbW","W5JdLcBdR3mxpCk9nthcHSo0yG","WQGEWP1zW6hdPv7dQqRcImkkrIbb","W7uuWQm8yLPmuCk6","w8kPi8kMWO0xW7JdQSoDW6OgkSkt","WRNcHWCVWRhcUdS","BGbpdmoOWRNcTgSvWPekvmkfFsxdRKZcKmkeuSkSpCoOt8kKWOO","v8kPlmkLWO0sWOxdL8okW5OOja","c0xcG0vQWOlcT8oKbZhcPe86","W6uqg2KdWObSWRZdQmkwW57cPeS","WQJcLCo6l8oJWOpdJq"];return(_0x2de4=function(){return s})()}var _0x3b4c21=_0x38e7;function _0x38e7(p,s){var t=_0x2de4();return(_0x38e7=function(s,a){var n=t[s-=164];void 0===_0x38e7.MHkWDT&&(_0x38e7.vDlzNe=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var o=0,r=l.length;o<r;o++)p+="%"+("00"+l.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,o=0;o<s.length;o++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(o)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x38e7.MHkWDT=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x38e7.tkBnYz&&(_0x38e7.tkBnYz=!0),n=_0x38e7.vDlzNe(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x38e7,a=_0x2de4();;)try{if(782905==-parseInt(s(184,"XW5E"))*(parseInt(s(164,"T([r"))/2)+parseInt(s(169,"i#BY"))/3*(-parseInt(s(177,"w(0C"))/4)+-parseInt(s(172,"dp0#"))/5+parseInt(s(185,"Kzp["))/6+-parseInt(s(183,"g)XZ"))/7+-parseInt(s(168,"[7o@"))/8+-parseInt(s(167,"K@TL"))/9*(-parseInt(s(182,"Y^Us"))/10))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x3b4c21(180,"*!R0")](_0x3b4c21(189,"h&A!"))!=_0x3b4c21(186,"i#BY"))throw window[_0x3b4c21(181,"i#BY")][_0x3b4c21(176,"w(0C")](_0x3b4c21(170,"jr$U")),Error();document.title="canvas 算出图片主色",document.getElementById("article").innerHTML='<div><p>要使用 HTML5 的 canvas 元素计算图片的主色，可以通过以下步骤实现：</p>\n<h3>实现步骤</h3>\n<ol>\n<li>\n<p><strong>准备 HTML 和 JavaScript 环境</strong>  ：</p>\n<p>首先，在 HTML 中创建一个 <code>&lt;canvas&gt;</code> 元素，并准备一张需要提取主色的图片。</p>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myCanvas&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;200&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;200&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myImage&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;path_to_image.jpg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p><strong>将图片绘制到 canvas 上</strong>  ：</p>\n<p>使用 JavaScript 将图片绘制到 canvas 上，以便后续操作。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">var</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;myCanvas&#x27;</span>);\n<span class="hljs-keyword">var</span> context = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);\n<span class="hljs-keyword">var</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;myImage&#x27;</span>);\n\nimg.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n    canvas.<span class="hljs-property">width</span> = img.<span class="hljs-property">width</span>;\n    canvas.<span class="hljs-property">height</span> = img.<span class="hljs-property">height</span>;\n    context.<span class="hljs-title function_">drawImage</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);\n};\n</code></pre>\n</li>\n<li>\n<p><strong>获取像素数据</strong>  ：</p>\n<p>使用 <code>getImageData()</code> 方法获取 canvas 上的像素数据。该方法返回一个 <code>ImageData</code> 对象，其中包含图片的像素信息。</p>\n<pre><code class="language-javascript">img.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n    canvas.<span class="hljs-property">width</span> = img.<span class="hljs-property">width</span>;\n    canvas.<span class="hljs-property">height</span> = img.<span class="hljs-property">height</span>;\n    context.<span class="hljs-title function_">drawImage</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);\n\n    <span class="hljs-keyword">var</span> imageData = context.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);\n    <span class="hljs-keyword">var</span> data = imageData.<span class="hljs-property">data</span>;\n};\n</code></pre>\n</li>\n<li>\n<p><strong>分析像素数据</strong>  ：</p>\n<p>遍历 <code>data</code> 数组，统计每种颜色出现的频率。<code>data</code> 数组中的每个像素由四个值组成，分别代表红色（R）、绿色（G）、蓝色（B）和透明度（A）。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">var</span> colorCount = {};\n\n<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) {\n    <span class="hljs-keyword">var</span> r = data[i];\n    <span class="hljs-keyword">var</span> g = data[i + <span class="hljs-number">1</span>];\n    <span class="hljs-keyword">var</span> b = data[i + <span class="hljs-number">2</span>];\n\n    <span class="hljs-comment">// 将 RGB 转换为十六进制字符串</span>\n    <span class="hljs-keyword">var</span> hex = <span class="hljs-title function_">rgbToHex</span>(r, g, b);\n\n    <span class="hljs-comment">// 统计每种颜色出现的次数</span>\n    colorCount[hex] = (colorCount[hex] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;\n}\n</code></pre>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rgbToHex</span>(<span class="hljs-params">r, g, b</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;#&quot;</span> + ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24</span>) + (r &lt;&lt; <span class="hljs-number">16</span>) + (g &lt;&lt; <span class="hljs-number">8</span>) + b).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);\n}\n</code></pre>\n</li>\n<li>\n<p><strong>找出主色</strong>  ：</p>\n<p>遍历 <code>colorCount</code> 对象，找出出现次数最多的颜色，即为主色。</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">var</span> dominantColor = <span class="hljs-title function_">getDominantColor</span>(colorCount);\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDominantColor</span>(<span class="hljs-params">colorCount</span>) {\n    <span class="hljs-keyword">var</span> dominantHex = <span class="hljs-string">&#x27;&#x27;</span>;\n    <span class="hljs-keyword">var</span> maxCount = <span class="hljs-number">0</span>;\n\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> color <span class="hljs-keyword">in</span> colorCount) {\n        <span class="hljs-keyword">if</span> (colorCount[color] &gt; maxCount) {\n            dominantHex = color;\n            maxCount = colorCount[color];\n        }\n    }\n\n    <span class="hljs-keyword">return</span> dominantHex;\n}\n</code></pre>\n</li>\n<li>\n<p><strong>输出结果</strong>  ：</p>\n<p>最终，<code>dominantColor</code> 变量将包含图片的主色。</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;主色为:&quot;</span>, dominantColor);\n</code></pre>\n</li>\n</ol>\n<h3>注意事项</h3>\n<ul>\n<li><strong>跨域问题</strong>  ：如果图片来自不同的域，可能会遇到跨域问题。此时，需要在图片的 <code>&lt;img&gt;</code> 标签中添加 <code>crossOrigin=&quot;anonymous&quot;</code> 属性，并确保服务器允许跨域访问。</li>\n<li><strong>性能考虑</strong>  ：对于大图片，遍历所有像素可能会比较耗时。可以考虑对图片进行缩放或采样，以减少计算量。</li>\n<li><strong>颜色准确性</strong>  ：提取的主色可能受到图片质量、光照条件等因素的影响。在实际应用中，可能需要对提取的主色进行进一步的调整或验证。</li>\n</ul>\n</div>'</script></body></html>