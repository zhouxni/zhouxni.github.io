<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1aea6f=_0x1ce3;function _0x311b(){var s=["ovaFl8kHqmkf","oCokFMT1W5alWPSTa1ztW5W","A8oQW6JdPcW/eG","E8kZv8k3WQK+Fq","q8oYoCoUWP/dRmkI","Ef3cV8kWxq3dLSoBWQVcTaH5","g8o6W6tcRxilquRdPK7dUmo4WOJcNWtcLSkhW7ZcOw1pW4xcVt3cRCoc","C8kEW6GBfmovWRzJeGDVW45Z","kCoflSo7WOBcQGRcQv52Da","WRRcHWlcVmowfLpcRZVdRty","CCkDW5P8W6JdK0ldQSkQ","lCoUeColW65PieLGjCoYWPVdQG","x09bW5BcMmoLhCoXWO9gW4Xq","zKLyoaStWOBcMmo9","FmkwW5C6WRlcTJFdMSkve2f4kW","zmkDkJ8YWOTuWPW","eaDzjtZdRmo6wb0","l8oKemokW6rJyM5gnmozWPK","zSo/dhyxuSk5fSkNi2n9","tCofW4FdSWdcOmkNW77cRt8X","WRRdLueoWPxcNSkvn8kXWPSYtYW","WQpcVSoFsxZdLIbfwColjCo5AG","WRbqdISCWRldTW","WQtdPcT4lW","WOddSLvSi8obzG","eaDuzgddUSoTDZrTWOC"];return(_0x311b=function(){return s})()}function _0x1ce3(l,s){var e=_0x311b();return(_0x1ce3=function(s,n){var a=e[s-=426];void 0===_0x1ce3.UeKMLD&&(_0x1ce3.eWzRAT=function(s,n){var a,t=[],l=0,e="";for(s=(s=>{for(var n,a,t="",l="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,c=t.length;r<c;r++)l+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(l)})(s),p=0;p<256;p++)t[p]=p;for(p=0;p<256;p++)l=(l+t[p]+n.charCodeAt(p%n.length))%256,a=t[p],t[p]=t[l],t[l]=a;for(var p=0,l=0,r=0;r<s.length;r++)a=t[p=(p+1)%256],t[p]=t[l=(l+t[p])%256],t[l]=a,e+=String.fromCharCode(s.charCodeAt(r)^t[(t[p]+t[l])%256]);return e},l=arguments,_0x1ce3.UeKMLD=!0);var s=s+e[0],t=l[s];return t?a=t:(void 0===_0x1ce3.IiTKPN&&(_0x1ce3.IiTKPN=!0),a=_0x1ce3.eWzRAT(a,n),l[s]=a),a})(l,s)}if((()=>{for(var s=_0x1ce3,n=_0x311b();;)try{if(205684==-parseInt(s(436,"IF8j"))*(parseInt(s(443,"]POd"))/2)+parseInt(s(435,"9Kww"))/3+parseInt(s(439,"VZ#*"))/4*(-parseInt(s(444,"HM8i"))/5)+-parseInt(s(428,"eB&j"))/6+parseInt(s(434,"eB&j"))/7+-parseInt(s(433,"zpDR"))/8*(parseInt(s(451,"x$k@"))/9)+parseInt(s(431,"x)A8"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1aea6f(446,"eB&j")](_0x1aea6f(430,"o*k)"))!=_0x1aea6f(440,"K9j1"))throw window[_0x1aea6f(432,"HM8i")][_0x1aea6f(447,"c4L7")](_0x1aea6f(449,"uKYN")),Error();document.title="PerformanceObserver 可监测的页面性能指标详解",document.getElementById("article").innerHTML='<div><p>PerformanceObserver API 是现代浏览器提供的强大性能监测工具，可以实时捕获各种页面性能指标。以下是它能够监测的主要性能指标分类及具体实现方法：</p>\n<h2>一、核心性能指标</h2>\n<h3>1. 加载时序指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标名称</th>\n<th>API 类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>navigation</code></td>\n<td><code>navigation</code></td>\n<td>整页导航的详细时间节点</td>\n</tr>\n<tr>\n<td><code>resource</code></td>\n<td><code>resource</code></td>\n<td>所有资源加载耗时</td>\n</tr>\n<tr>\n<td><code>paint</code></td>\n<td><code>paint</code></td>\n<td>绘制相关指标</td>\n</tr>\n</tbody>\n</table>\n<p><strong>监测代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测导航和资源加载</span>\n<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(entry.<span class="hljs-property">entryType</span>, entry.<span class="hljs-property">name</span>, entry.<span class="hljs-property">startTime</span>);\n  });\n});\nobserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: [<span class="hljs-string">&quot;navigation&quot;</span>, <span class="hljs-string">&quot;resource&quot;</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n</code></pre>\n<h3>2. 关键渲染指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标名称</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>first-paint</code></td>\n<td><code>paint</code></td>\n<td>首次绘制（任何像素点）</td>\n</tr>\n<tr>\n<td><code>first-contentful-paint</code></td>\n<td><code>paint</code></td>\n<td>首次内容绘制</td>\n</tr>\n<tr>\n<td><code>largest-contentful-paint</code></td>\n<td><code>largest-contentful-paint</code></td>\n<td>最大内容绘制</td>\n</tr>\n</tbody>\n</table>\n<p><strong>实现代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测绘制指标</span>\n<span class="hljs-keyword">const</span> paintObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${entry.name}</span>: <span class="hljs-subst">${entry.startTime}</span>ms`</span>);\n  });\n});\npaintObserver.<span class="hljs-title function_">observe</span>({\n  <span class="hljs-attr">type</span>: [<span class="hljs-string">&quot;paint&quot;</span>, <span class="hljs-string">&quot;largest-contentful-paint&quot;</span>],\n  <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span>,\n});\n</code></pre>\n<h2>二、用户体验指标</h2>\n<h3>1. 交互响应指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>first-input-delay</code></td>\n<td><code>first-input</code></td>\n<td>首次输入延迟</td>\n</tr>\n<tr>\n<td><code>event-timing</code></td>\n<td><code>event</code></td>\n<td>所有事件的时间消耗</td>\n</tr>\n</tbody>\n</table>\n<p><strong>监测代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测交互延迟</span>\n<span class="hljs-keyword">const</span> interactionObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(\n      <span class="hljs-string">`<span class="hljs-subst">${entry.name}</span>延迟: <span class="hljs-subst">${entry.processingStart - entry.startTime}</span>ms`</span>,\n    );\n  });\n});\ninteractionObserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: [<span class="hljs-string">&quot;first-input&quot;</span>, <span class="hljs-string">&quot;event&quot;</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n</code></pre>\n<h3>2. 布局稳定性指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>layout-shift</code></td>\n<td><code>layout-shift</code></td>\n<td>累积布局偏移分数</td>\n</tr>\n</tbody>\n</table>\n<p><strong>实现代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测布局偏移</span>\n<span class="hljs-keyword">const</span> layoutObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-keyword">if</span> (!entry.<span class="hljs-property">hadRecentInput</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`布局偏移: <span class="hljs-subst">${entry.value}</span>`</span>);\n    }\n  });\n});\nlayoutObserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;layout-shift&quot;</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n</code></pre>\n<h2>三、资源性能指标</h2>\n<h3>1. 资源加载指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>各种资源加载</td>\n<td><code>resource</code></td>\n<td>脚本、样式、图片等加载耗时</td>\n</tr>\n<tr>\n<td><code>longtask</code></td>\n<td><code>longtask</code></td>\n<td>长任务监控</td>\n</tr>\n</tbody>\n</table>\n<p><strong>监测代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测资源加载和长任务</span>\n<span class="hljs-keyword">const</span> resourceObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${entry.name}</span>加载耗时: <span class="hljs-subst">${entry.duration}</span>ms`</span>);\n  });\n});\nresourceObserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: [<span class="hljs-string">&quot;resource&quot;</span>, <span class="hljs-string">&quot;longtask&quot;</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n</code></pre>\n<h2>四、高级监测指标</h2>\n<h3>1. 内存使用指标</h3>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>memory</code></td>\n<td><code>memory</code></td>\n<td>内存使用情况（部分浏览器支持）</td>\n</tr>\n</tbody>\n</table>\n<p><strong>实现代码</strong>   ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 监测内存使用</span>\n<span class="hljs-keyword">const</span> memoryObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  <span class="hljs-keyword">const</span> entry = list.<span class="hljs-title function_">getEntries</span>()[<span class="hljs-number">0</span>];\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`内存使用: <span class="hljs-subst">${entry.jsHeapSizeLimit - entry.jsHeapSizeFree}</span>`</span>);\n});\nmemoryObserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;memory&quot;</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n</code></pre>\n<h3>2. 自定义指标</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 自定义指标监测</span>\n<span class="hljs-keyword">const</span> customObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n  list.<span class="hljs-title function_">getEntries</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`自定义指标[<span class="hljs-subst">${entry.name}</span>]: <span class="hljs-subst">${entry.startTime}</span>`</span>);\n  });\n});\ncustomObserver.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: [<span class="hljs-string">&quot;mark&quot;</span>, <span class="hljs-string">&quot;measure&quot;</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n\n<span class="hljs-comment">// 创建自定义标记</span>\nperformance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&quot;custom-start&quot;</span>);\n<span class="hljs-comment">// ...执行某些操作...</span>\nperformance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">&quot;custom-end&quot;</span>);\nperformance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">&quot;custom-operation&quot;</span>, <span class="hljs-string">&quot;custom-start&quot;</span>, <span class="hljs-string">&quot;custom-end&quot;</span>);\n</code></pre>\n<h2>五、完整监测方案</h2>\n<h3>1. 综合监测实现</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitor</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = [];\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = {};\n  }\n\n  <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;paint&quot;</span>, [<span class="hljs-string">&quot;first-paint&quot;</span>, <span class="hljs-string">&quot;first-contentful-paint&quot;</span>]);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;largest-contentful-paint&quot;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;layout-shift&quot;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;first-input&quot;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;resource&quot;</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupObserver</span>(<span class="hljs-string">&quot;longtask&quot;</span>);\n  }\n\n  <span class="hljs-title function_">setupObserver</span>(<span class="hljs-params">type, whiteList = []</span>) {\n    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {\n      list\n        .<span class="hljs-title function_">getEntries</span>()\n        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span>\n          whiteList.<span class="hljs-property">length</span> ? whiteList.<span class="hljs-title function_">includes</span>(entry.<span class="hljs-property">name</span>) : <span class="hljs-literal">true</span>,\n        )\n        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {\n          <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>[entry.<span class="hljs-property">name</span> || type] = entry;\n          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportMetrics</span>();\n        });\n    });\n\n    observer.<span class="hljs-title function_">observe</span>({ type, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">push</span>(observer);\n  }\n\n  <span class="hljs-title function_">reportMetrics</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">sendBeacon</span>) {\n      navigator.<span class="hljs-title function_">sendBeacon</span>(<span class="hljs-string">&quot;/analytics&quot;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>));\n    }\n  }\n\n  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">observer</span>) =&gt;</span> observer.<span class="hljs-title function_">disconnect</span>());\n  }\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">const</span> monitor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMonitor</span>();\nmonitor.<span class="hljs-title function_">init</span>();\n<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;beforeunload&quot;</span>, <span class="hljs-function">() =&gt;</span> monitor.<span class="hljs-title function_">destroy</span>());\n</code></pre>\n<h3>2. 各浏览器支持情况</h3>\n<table>\n<thead>\n<tr>\n<th>指标类型</th>\n<th>Chrome</th>\n<th>Firefox</th>\n<th>Safari</th>\n<th>Edge</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>paint</code></td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>largest-contentful-paint</code></td>\n<td>✅</td>\n<td>❌</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>layout-shift</code></td>\n<td>✅</td>\n<td>❌</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>first-input</code></td>\n<td>✅</td>\n<td>❌</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>resource</code></td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>longtask</code></td>\n<td>✅</td>\n<td>❌</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n<tr>\n<td><code>memory</code></td>\n<td>✅</td>\n<td>❌</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n</tbody>\n</table>\n<h2>六、最佳实践建议</h2>\n<ol>\n<li><strong>按需监测</strong>   ：根据业务需求选择关键指标</li>\n<li><strong>尽早初始化</strong>   ：在 <code>&lt;head&gt;</code> 中加载监测代码</li>\n<li><strong>缓冲数据</strong>   ：使用 <code>buffered: true</code> 获取历史数据</li>\n<li><strong>合理采样</strong>   ：对高频指标进行采样上报</li>\n<li><strong>错误处理</strong>   ：添加 try-catch 避免监测代码影响主流程</li>\n</ol>\n<p>通过 PerformanceObserver API，开发者可以全面掌握页面性能表现，为性能优化提供数据支撑。建议优先关注 <code>LCP</code>、<code>FID</code>、<code>CLS</code> 等核心用户体验指标。</p>\n</div>'</script></body></html>