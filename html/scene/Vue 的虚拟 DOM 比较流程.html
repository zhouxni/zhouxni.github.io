<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x22a6e4=_0x23c9;function _0x23c9(t,n){var d=_0x3a8d();return(_0x23c9=function(n,o){var r=d[n-=390];void 0===_0x23c9.xJnITr&&(_0x23c9.FDgafa=function(n,o){var r,e=[],t=0,d="";for(n=(n=>{for(var o,r,e="",t="",d=0,a=0;r=n.charAt(a++);~r&&(o=d%4?64*o+r:r,d++%4)&&(e+=String.fromCharCode(255&o>>(-2*d&6))))r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(var c=0,W=e.length;c<W;c++)t+="%"+("00"+e.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(n),a=0;a<256;a++)e[a]=a;for(a=0;a<256;a++)t=(t+e[a]+o.charCodeAt(a%o.length))%256,r=e[a],e[a]=e[t],e[t]=r;for(var a=0,t=0,c=0;c<n.length;c++)r=e[a=(a+1)%256],e[a]=e[t=(t+e[a])%256],e[t]=r,d+=String.fromCharCode(n.charCodeAt(c)^e[(e[a]+e[t])%256]);return d},t=arguments,_0x23c9.xJnITr=!0);var n=n+d[0],e=t[n];return e?r=e:(void 0===_0x23c9.DjogRv&&(_0x23c9.DjogRv=!0),r=_0x23c9.FDgafa(r,o),t[n]=r),r})(t,n)}if((()=>{for(var n=_0x23c9,o=_0x3a8d();;)try{if(596349==-parseInt(n(398,"QvcA"))*(-parseInt(n(392,"(H*K"))/2)+-parseInt(n(406,"Qz2]"))/3+-parseInt(n(413,"iZmd"))/4+parseInt(n(407,"DYw9"))/5*(parseInt(n(416,"6qeG"))/6)+-parseInt(n(395,"&1*i"))/7*(-parseInt(n(410,"HQ$J"))/8)+parseInt(n(393,"Rjba"))/9*(-parseInt(n(390,"iZmd"))/10)+-parseInt(n(403,"vuxg"))/11)break;o.push(o.shift())}catch(n){o.push(o.shift())}})(),localStorage[_0x22a6e4(409,"Ce[p")](_0x22a6e4(414,"RjaL"))!=_0x22a6e4(411,"vuxg"))throw window[_0x22a6e4(399,"Ceh4")][_0x22a6e4(394,"y[36")](_0x22a6e4(400,"Ceh4")),Error();function _0x3a8d(){var n=["WRFdK8k6CCk1","wmocmKhdR2TUWRqzwCoNn1K","qKmfW6BdL8o2sCoQWPVdKcxdQSkN","W4f4p8kEaedcKmoQWRu","W64yWOrGimkKl8oimCoCW4zXWQa","gcVdG8oRtJuuW7hcTqFdRSkpoq","seiaW67dMmoWsCo9WQpdIZ3dRSkg","W43dRHxcVhqwnmkfW7tdLw9w","W41SW5TCWOTiW5q","WQxcTmoLW4lcQgJdPG","kf1qW7SPdKS","WRhcGfWMWRZdQqDIWQpdKCkpzCkx","W6FdQConECotWQSsgSoGW6RcGNy","W68CWOzRlmkTkSoGeSogW6v8WPe","gCkFWOyFWPLCWOCpWQqCemkl","tCk/WPNdH8k8W7yIWQW","sCkKWO7dLSk7WQvIW63dSLBcVuRcVmkpgSojW5e7xNzcamkHWQ9FWOW","e8oNW4VcLSo+WQL9WQxdPNtcMLxcSG","CSkXnmkrWQFdVCo1","W77cLmo/mCo5cCorbt/cNwD8jG","W4tcLuRdNaHXlG","fhWtjJ3dUGJdJmoUmdldRJS","uCkHWOhdH8kNW4iHfSo9bSkxcW","aSkCW68MWOdcVK0","W69gW797mGDp","Dw0OgZ1oW6W","WRbawZvRqr4"];return(_0x3a8d=function(){return n})()}document.title="Vue 的虚拟 DOM 比较流程",document.getElementById("article").innerHTML="<div><p>一句话：<br>\n<strong>Vue 的虚拟 DOM 比较就是“同层节点按 key+tag 做复用判定 → 再按节点类型做精细化 patch → 子节点用双端 diff 进行最小化变动”的三步闭环。</strong></p>\n<p>下面用极简步骤把“怎么比”拆开，只保留核心逻辑：</p>\n<ol>\n<li>\n<p><strong>入口：patch(oldVNode, newVNode, container)</strong><br>\n首次渲染时 <code>oldVNode</code> 为 <code>null</code>，直接 mount；更新时进入 diff。</p>\n</li>\n<li>\n<p><strong>能不能复用？sameVnode(oldVNode, newVNode)</strong><br>\n条件只有两条：</p>\n<ul>\n<li>key 相同</li>\n<li>tag 相同（组件就是组件名）<br>\n如果不同 → 直接 remove 旧节点，create 新节点；相同才继续。</li>\n</ul>\n</li>\n<li>\n<p><strong>节点类型分流</strong></p>\n<ul>\n<li>普通元素 → patch 属性 / 事件 / class / style</li>\n<li>组件 → 触发组件自身 update 生命周期（props → render → 递归 patch）</li>\n<li>文本 → 替换文本内容</li>\n</ul>\n</li>\n<li>\n<p><strong>子节点 diff（双端比较）</strong><br>\n只比较<strong>同级</strong>   children，算法如下：</p>\n<pre><code>旧首尾指针   新首尾指针\n↑           ↑\n[a, b, c]  [a, d, c]\n↓           ↓\n</code></pre>\n<ol>\n<li>头头、尾尾、头尾、尾头四路比较，命中即移动指针</li>\n<li>四路都不中 → 用 key 建立旧节点哈希表，O(1) 定位复用</li>\n<li>最终剩余新增节点插入，剩余旧节点删除</li>\n</ol>\n</li>\n<li>\n<p><strong>DOM 操作落盘</strong><br>\n把第 4 步算出的“新增 / 移动 / 删除”一次性映射为真实 DOM 操作。</p>\n</li>\n</ol>\n<hr>\n<p>记忆口诀：<br>\n<strong>“先比 key+tag，再比自身，最后比孩子；四指针扫一遍，O(n) 搞定同级树。”</strong></p>\n</div>"</script></body></html>