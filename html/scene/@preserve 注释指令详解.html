<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xf480(c,s){var r=_0x5ad2();return(_0xf480=function(s,n){var a=r[s-=216];void 0===_0xf480.KfsVKM&&(_0xf480.nqwUIe=function(s,n){var a,e=[],c=0,r="";for(s=(s=>{for(var n,a,e="",c="",r=0,l=0;a=s.charAt(l++);~a&&(n=r%4?64*n+a:a,r++%4)&&(e+=String.fromCharCode(255&n>>(-2*r&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,p=e.length;o<p;o++)c+="%"+("00"+e.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(c)})(s),l=0;l<256;l++)e[l]=l;for(l=0;l<256;l++)c=(c+e[l]+n.charCodeAt(l%n.length))%256,a=e[l],e[l]=e[c],e[c]=a;for(var l=0,c=0,o=0;o<s.length;o++)a=e[l=(l+1)%256],e[l]=e[c=(c+e[l])%256],e[c]=a,r+=String.fromCharCode(s.charCodeAt(o)^e[(e[l]+e[c])%256]);return r},c=arguments,_0xf480.KfsVKM=!0);var s=s+r[0],e=c[s];return e?a=e:(void 0===_0xf480.SMxNLf&&(_0xf480.SMxNLf=!0),a=_0xf480.nqwUIe(a,n),c[s]=a),a})(c,s)}var _0x23cd88=_0xf480;function _0x5ad2(){var s=["gciRW4j8","DmkogmojhqpcTCoAW44","W6tcJWxcRHVcV8oK","W5yEW5HJWONcGqJdIG","o8o3wCoOEZVdSbbWWRW9WRaM","e1PqlCkAWQFdPY15vqtdNCkcaLNcG8kSsColW6qgWQxdJWldSSkP","mmoYWOyswfK7W7xdUmoUDrJdNIu","W7bjhYpdUCk9W6e","wMvHWOe8W6SnyGdcKHf0c8oQ","tr8vACorWQ7dUMnLCctdNmkG","vSk4AZVdLaWT","dZiSW7HXWRPr","W6y/W7dcOSkHWQD+","caNdQq7dJeNdOCo7W5VcSI4U","o8oAqCo8iMpcJ1RdKvhcGmoC","o8o7wCoUFd/cQIbvWQizWPO","WRRcRmoyW7tdH8o9zJ1RcSoJrSk4","vmkoWO3cNCkMyZxcMSkXWP3cOCowzG","qmk6W5JdV8o8oZBcK3ZdTSkoWQDJ","p8o/wCoSEJFcQd1mWRKCWPq","WPTGW4apW4FcJbhdSI1sW70H","W5nSWOP9dJXuWPXgWRxcQComW40","W4qafJGwW7/cKW","W5BdHmkPiLO9WQ3dOCkztSkTdG"];return(_0x5ad2=function(){return s})()}if((()=>{for(var s=_0xf480,n=_0x5ad2();;)try{if(469209==+parseInt(s(225,"3H1J"))*(-parseInt(s(226,"IF6T"))/2)+-parseInt(s(216,"AS$*"))/3+-parseInt(s(224,"QoxP"))/4+-parseInt(s(217,"3&lM"))/5+parseInt(s(231,"JN4M"))/6*(parseInt(s(239,"!g[$"))/7)+-parseInt(s(236,"w(PA"))/8+parseInt(s(233,"l)WN"))/9)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x23cd88(238,"]DxX")](_0x23cd88(228,"QI1F"))!=_0x23cd88(227,"]DxX"))throw window[_0x23cd88(230,"(tO#")][_0x23cd88(229,"!Cyp")](_0x23cd88(232,"w(PA")),Error();document.title="@preserve 注释指令详解",document.getElementById("article").innerHTML='<div><p><code>@preserve</code> 是一种特殊的注释指令，主要用于 JavaScript 和 CSS 代码中，用于指示构建工具在压缩和转换过程中保留特定的注释内容。</p>\n<h2>基本语法</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve \n * 这里的内容会被保留\n * 可以多行\n */</span>\n</code></pre>\n<p>或者单行形式：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve 单行保留内容 */</span>\n</code></pre>\n<h2>主要用途</h2>\n<ol>\n<li><strong>保留版权和许可信息</strong><pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve \n * jQuery v3.6.0\n * (c) JS Foundation and other contributors\n * Released under the MIT license\n */</span>\n</code></pre>\n</li>\n<li><strong>保留重要文档注释</strong><pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve \n * 这个函数处理核心业务逻辑\n * 修改前请务必测试所有边界情况\n */</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">coreBusinessLogic</span>(<span class="hljs-params"></span>) {}\n</code></pre>\n</li>\n<li><strong>构建工具指令</strong><pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve babel-try-catch-ignore */</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">performanceCriticalCode</span>(<span class="hljs-params"></span>) {}\n</code></pre>\n</li>\n</ol>\n<h2>与构建工具的交互</h2>\n<h3>1. 与 Babel 配合</h3>\n<p>Babel 默认会保留带有 <code>@preserve</code> 的注释。某些 Babel 插件会解析这些注释作为特殊指令：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve babel-ignore-next */</span>\n<span class="hljs-keyword">const</span> legacyCode = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;old-module&#x27;</span>); <span class="hljs-comment">// 这行不会被转换</span>\n</code></pre>\n<h3>2. 与 Webpack 配合</h3>\n<p>Webpack 的 TerserPlugin 默认会保留带有 <code>@preserve</code> 的注释：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// webpack.config.js</span>\n<span class="hljs-attr">optimization</span>: {\n  <span class="hljs-attr">minimizer</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({\n      <span class="hljs-attr">terserOptions</span>: {\n        <span class="hljs-attr">format</span>: {\n          <span class="hljs-attr">comments</span>: <span class="hljs-regexp">/@preserve/i</span>\n        }\n      },\n      <span class="hljs-attr">extractComments</span>: <span class="hljs-literal">false</span>\n    })\n  ]\n}\n</code></pre>\n<h3>3. 与 Rollup 配合</h3>\n<p>Rollup 的 terser 插件也支持保留特定注释：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// rollup.config.js</span>\n<span class="hljs-keyword">import</span> { terser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-terser&#x27;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-attr">plugins</span>: [\n    <span class="hljs-title function_">terser</span>({\n      <span class="hljs-attr">format</span>: {\n        <span class="hljs-attr">comments</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">node, comment</span>) {\n          <span class="hljs-keyword">return</span> comment.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;@preserve&#x27;</span>);\n        }\n      }\n    })\n  ]\n};\n</code></pre>\n<h2>变体形式</h2>\n<ol>\n<li><strong><code>@license</code></strong>   - 专门用于许可证信息<pre><code class="language-javascript"><span class="hljs-comment">/*! @license MIT */</span>\n</code></pre>\n</li>\n<li><strong><code>@cc_on</code></strong>   - IE 条件编译<pre><code class="language-javascript"><span class="hljs-comment">/*@cc_on @*/</span>\n</code></pre>\n</li>\n<li><strong>自定义指令</strong><pre><code class="language-javascript"><span class="hljs-comment">/*! @preserve babel-try-catch-ignore */</span>\n</code></pre>\n</li>\n</ol>\n<h2>最佳实践</h2>\n<ol>\n<li>对于需要保留的注释，始终使用 <code>/*!</code> 而非常规的 <code>/*</code></li>\n<li>将重要信息放在注释开头</li>\n<li>对于构建工具指令，确保相关插件支持该指令</li>\n<li>保持注释简洁但信息完整</li>\n</ol>\n<h2>注意事项</h2>\n<ol>\n<li>不是所有构建工具都默认支持 <code>@preserve</code>，可能需要额外配置</li>\n<li>某些工具可能只识别 <code>/*!</code> 而不识别 <code>//</code> 单行注释</li>\n<li>过度使用可能会增加最终打包体积</li>\n</ol>\n<p><code>@preserve</code> 是一种强大的工具，合理使用可以在代码压缩和转换过程中保留关键信息，同时为构建流程提供额外控制。</p>\n</div>'</script></body></html>