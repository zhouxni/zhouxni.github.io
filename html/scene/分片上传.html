<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x326b(t,s){var e=_0x3a04();return(_0x326b=function(s,n){var a=e[s-=439];void 0===_0x326b.xhVJCs&&(_0x326b.VmSFWC=function(s,n){var a,l=[],t=0,e="";for(s=(s=>{for(var n,a,l="",t="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[t],l[t]=a;for(var p=0,t=0,c=0;c<s.length;c++)a=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=a,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[t])%256]);return e},t=arguments,_0x326b.xhVJCs=!0);var s=s+e[0],l=t[s];return l?a=l:(void 0===_0x326b.hXdwDs&&(_0x326b.hXdwDs=!0),a=_0x326b.VmSFWC(a,n),t[s]=a),a})(t,s)}function _0x3a04(){var s=["oGlcJ0qRWQ3dO8oUcSoJmMxdUW","F8kxW7NcPItcHhy","l8kCWPxdG0SwmCopy8k+WOTJWPW","W5BcTmkHpmkFW6JdJXXeWP1VnK0","oGJcJuOQWQ7dPmoFnCooc2xdHG","a8ksWP/dOttcL3G2FW","W5H9W6ymxmkRWRxdTCk/yhKomq","WPRdRh1dWPdcJX/dVIZdImoEWOqR","WRJdSCk8WRNcSbNcJ8kBW5tcN0WzWOa","W6L0W4tdGSoFDmoIW6LDW67cOxe","W7q2smoSCLxdVCoc","W5xcSvpcI8oWgSktW5tcSaRcNbhdHa","wGNcRtTwW6dcPfRdGbddUW","WRtdLIBdJ8koW6RdTGvoWQNcMmk5","W6XofSoqn8oPWRi","W7lcG8kiWRiH","WRpdSCk5WR/cTXhcI8klW63cOLeTWOm","W7aTx8o9DqBcVCkdWRxcPaWhW5vSWOZcS8kYWPyGuH0oF8kfiCk5","W50CWRrqpmoXW4G","WPVdQh9bWPNcHrZdJZVdNSoUWPy8","DmkPWP7dOr7cJNG","teeCWQ/cJSofW7ddG8kgrSo8"];return(_0x3a04=function(){return s})()}var _0x4a86a3=_0x326b;if((()=>{for(var s=_0x326b,n=_0x3a04();;)try{if(715948==+parseInt(s(458,"4B0%"))+-parseInt(s(452,"BOeY"))/2+-parseInt(s(442,"BOeY"))/3+parseInt(s(448,"lsxk"))/4+parseInt(s(457,"VdrZ"))/5*(parseInt(s(443,"[BXs"))/6)+parseInt(s(445,"8jCa"))/7+parseInt(s(447,"E&oG"))/8)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x4a86a3(459,"I7%r")](_0x4a86a3(450,"[BXs"))!=_0x4a86a3(460,"FLX5"))throw window[_0x4a86a3(455,"dz*$")][_0x4a86a3(446,"HrQi")](_0x4a86a3(440,"dz*$")),Error();document.title="分片上传",document.getElementById("article").innerHTML='<div><p>前端分片上传是一种将大文件切分成多个小块（分片）并逐块上传到服务器的方法。这种方法可以解决大文件上传时网络不稳定或上传速度慢的问题，提高上传的成功率和效率。以下是前端分片上传的详细解释和实现步骤：</p>\n<h3>分片上传的优点</h3>\n<ol>\n<li><strong>提高成功率</strong>  ：即使某一块上传失败，只需要重试该分片，不必重新上传整个文件。</li>\n<li><strong>支持断点续传</strong>  ：可以在中断后从上次上传的位置继续。</li>\n<li><strong>减少带宽占用</strong>  ：可以根据网络状况灵活调整上传速度。</li>\n</ol>\n<h3>实现步骤</h3>\n<ol>\n<li><strong>文件选择与校验</strong>\n<ul>\n<li>用户选择需要上传的文件后，前端获取文件的基本信息，如文件大小、文件格式等。</li>\n<li>对文件进行校验，确保文件符合上传规范（如文件大小限制、文件格式要求等）。</li>\n</ul>\n</li>\n<li><strong>文件切片</strong>\n<ul>\n<li>使用JavaScript的<code>File</code> API中的<code>slice</code>方法将文件切分成多个小块。</li>\n<li>每个小块的大小可以根据实际情况设定，通常为几MB到几十MB不等。</li>\n</ul>\n</li>\n<li><strong>分片上传</strong>\n<ul>\n<li>逐个上传每个分片。可以使用<code>XMLHttpRequest</code>对象或<code>Fetch API</code>向服务器发送每个分片。</li>\n<li>在发送每个分片时，通常需要携带一些额外信息，如分片索引、分片大小、文件唯一标识等，以便服务器能够正确处理和合并分片。</li>\n</ul>\n</li>\n<li><strong>服务端处理</strong>\n<ul>\n<li>服务器接收到每个分片后，将其保存到硬盘或内存中。</li>\n<li>当所有分片都上传完毕后，服务器将所有分片组合成一个完整的文件。</li>\n</ul>\n</li>\n<li><strong>进度显示与错误处理</strong>\n<ul>\n<li>在上传过程中，前端可以实时显示上传进度，以便用户了解上传状态。</li>\n<li>如果某个分片上传失败，前端可以重试该分片，或者提示用户重新上传整个文件。</li>\n</ul>\n</li>\n</ol>\n<h3>示例代码</h3>\n<p>以下是一个简单的前端分片上传示例代码，使用<code>XMLHttpRequest</code>对象进行分片上传：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFileInChunks</span>(<span class="hljs-params">file, url, chunkSize = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>) {\n    <span class="hljs-keyword">const</span> totalSize = file.<span class="hljs-property">size</span>;\n    <span class="hljs-keyword">let</span> start = <span class="hljs-number">0</span>;\n    <span class="hljs-keyword">let</span> end = chunkSize;\n    <span class="hljs-keyword">let</span> chunkIndex = <span class="hljs-number">0</span>;\n\n    <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadChunk</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-keyword">if</span> (start &gt;= totalSize) {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Upload complete!&#x27;</span>);\n            <span class="hljs-keyword">return</span>;\n        }\n\n        end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start + chunkSize, totalSize);\n        <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(start, end);\n\n        <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();\n        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, url, <span class="hljs-literal">true</span>);\n        xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;application/octet-stream&#x27;</span>);\n        xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Chunk-Index&#x27;</span>, chunkIndex);\n        xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Chunk-Size&#x27;</span>, end - start);\n\n        xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {\n                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Chunk <span class="hljs-subst">${chunkIndex}</span> uploaded successfully.`</span>);\n                start = end;\n                chunkIndex++;\n                <span class="hljs-title function_">uploadChunk</span>();\n            } <span class="hljs-keyword">else</span> {\n                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Chunk <span class="hljs-subst">${chunkIndex}</span> upload failed.`</span>);\n            }\n        };\n\n        xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {\n            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Chunk <span class="hljs-subst">${chunkIndex}</span> upload failed.`</span>);\n        };\n\n        xhr.<span class="hljs-title function_">send</span>(chunk);\n    }\n\n    <span class="hljs-title function_">uploadChunk</span>();\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input[type=&quot;file&quot;]&#x27;</span>);\nfileInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {\n    <span class="hljs-keyword">const</span> file = event.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];\n    <span class="hljs-keyword">if</span> (file) {\n        <span class="hljs-title function_">uploadFileInChunks</span>(file, <span class="hljs-string">&#x27;/upload&#x27;</span>);\n    }\n});\n</code></pre>\n<h3>注意事项</h3>\n<ol>\n<li><strong>分片大小</strong>  ：分片大小应根据网络状况和服务器处理能力进行合理设置。</li>\n<li><strong>文件唯一标识</strong>  ：为了确保不同文件的分片不会混淆，每个文件应有一个唯一标识。</li>\n<li><strong>断点续传</strong>  ：实现断点续传时，需要在本地保存已上传的分片信息，并在上传时传递给服务器。</li>\n<li><strong>错误处理</strong>  ：需要处理各种可能的错误情况，如网络错误、服务器错误等，并提供相应的用户提示。</li>\n</ol>\n</div>'</script></body></html>