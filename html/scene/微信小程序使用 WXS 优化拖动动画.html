<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1e73bb=_0x5989;function _0x546b(){var s=["BmkHcqpdLCo2achcJ2nWWPOdBq","hItdR8oXB2VcKSoulxpdUSoNW6C","W5VdT8olWRxdGtPMa0e","E8o3WQhdO3yTiI7dL8o+cG","rmovD8kklCkAWRBcKSkcCvi","kSoPWP1UlSosgd3dGG","WRzzh8oGW4tcS8kxWOHyyCkuW6hdUG","W5xcG0Lde8kcfZtdHbnxWRj1ze4Eamo7W7/cH8ksWRJdPSkCqau","tmocWQVdV8k1WObTWPziW6mGWRxdPW","WPJcLCoOdmosugOxk8ozWO/dUSoK","W6mRwZxcKetcGNRcUYVcLW","WPbgWQFdTmkqW4tdJ8oeW67cKSoj","W5VdImkGvSkccJW","ymkpWRNdIZm9CwqKdLWLWQO","ymoFW4BcMM54aG","WPVcMmoOvCkZkHqlbW","mSkjW7xdMSoirtddUCoBW4OuWQVcSq","rJldSmoaWPRcSmoOAG7dLdRdU0Hw","WP9bWQ3dV8ktWPZcJCovW7FcKCowWOXJ","sL3dNCkvW6yDWR8","kCoPWPnzp8osbG3dVG","tutcHCkZW7BcQ0XFmG","AmotWQxcImkph2NdKa","WPVcM8oLdmoxug4Dn8ouWOBdKCoo","x2dcRCkXia","WOHRWOpcLmkTBKa"];return(_0x546b=function(){return s})()}function _0x5989(t,s){var p=_0x546b();return(_0x5989=function(s,n){var a=p[s-=140];void 0===_0x5989.rinucj&&(_0x5989.nMEEol=function(s,n){var a,l=[],t=0,p="";for(s=(s=>{for(var n,a,l="",t="",p=0,e=0;a=s.charAt(e++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=l.length;c<r;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)t=(t+l[e]+n.charCodeAt(e%n.length))%256,a=l[e],l[e]=l[t],l[t]=a;for(var e=0,t=0,c=0;c<s.length;c++)a=l[e=(e+1)%256],l[e]=l[t=(t+l[e])%256],l[t]=a,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[t])%256]);return p},t=arguments,_0x5989.rinucj=!0);var s=s+p[0],l=t[s];return l?a=l:(void 0===_0x5989.rzOJcf&&(_0x5989.rzOJcf=!0),a=_0x5989.nMEEol(a,n),t[s]=a),a})(t,s)}if((()=>{for(var s=_0x5989,n=_0x546b();;)try{if(461572==-parseInt(s(146,"k%Ii"))*(-parseInt(s(148,"R62["))/2)+parseInt(s(144,"!#tI"))/3+parseInt(s(149,"ZpFn"))/4*(-parseInt(s(158,"Prq8"))/5)+-parseInt(s(162,"!#tI"))/6*(-parseInt(s(157,"GkW4"))/7)+parseInt(s(163,"(yVO"))/8+parseInt(s(156,"!#tI"))/9+-parseInt(s(164,"(s@("))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1e73bb(140,"2qcI")](_0x1e73bb(142,"FSXR"))!=_0x1e73bb(145,"R62["))throw window[_0x1e73bb(143,"(yVO")][_0x1e73bb(159,"!#tI")](_0x1e73bb(154,")gMR")),Error();document.title="微信小程序使用 WXS 优化拖动动画",document.getElementById("article").innerHTML='<div><p>WXS 是优化小程序拖动动画性能的强大工具，因为它运行在视图层，可以避免逻辑层和视图层之间的频繁通信。下面详细介绍如何使用 WXS 优化拖动动画。</p>\n<h2>一、WXS 拖动动画原理</h2>\n<ol>\n<li><strong>性能优势</strong>  ：\n<ul>\n<li>直接在视图层处理触摸事件，减少通信损耗</li>\n<li>避免频繁的 <code>setData</code> 调用</li>\n<li>实现更流畅的动画效果</li>\n</ul>\n</li>\n<li><strong>实现思路</strong>  ：\n<ul>\n<li>使用 WXS 处理 <code>touchstart</code>、<code>touchmove</code> 和 <code>touchend</code> 事件</li>\n<li>在 WXS 中计算元素位移</li>\n<li>通过 <code>transform</code> 实现平滑动画</li>\n</ul>\n</li>\n</ol>\n<h2>二、基础实现方案</h2>\n<h3>1. 创建 WXS 文件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// drag.wxs</span>\n<span class="hljs-keyword">var</span> startX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> startY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> translateX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> translateY = <span class="hljs-number">0</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchstart</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  startX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;\n  startY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;\n  \n  <span class="hljs-comment">// 获取当前transform值</span>\n  <span class="hljs-keyword">var</span> currentStyle = ownerInstance.<span class="hljs-title function_">getComputedStyle</span>([<span class="hljs-string">&#x27;transform&#x27;</span>]);\n  <span class="hljs-keyword">var</span> transform = currentStyle.<span class="hljs-property">transform</span>;\n  <span class="hljs-keyword">if</span> (transform) {\n    <span class="hljs-keyword">var</span> matrix = transform.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/matrix\\((.+)\\)/</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;, &#x27;</span>);\n    translateX = <span class="hljs-built_in">parseFloat</span>(matrix[<span class="hljs-number">4</span>]) || <span class="hljs-number">0</span>;\n    translateY = <span class="hljs-built_in">parseFloat</span>(matrix[<span class="hljs-number">5</span>]) || <span class="hljs-number">0</span>;\n  }\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchmove</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-keyword">var</span> deltaX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - startX;\n  <span class="hljs-keyword">var</span> deltaY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - startY;\n  \n  <span class="hljs-comment">// 应用新transform</span>\n  ownerInstance.<span class="hljs-title function_">setStyle</span>({\n    <span class="hljs-attr">transform</span>: <span class="hljs-string">&#x27;translate(&#x27;</span> + (translateX + deltaX) + <span class="hljs-string">&#x27;px, &#x27;</span> + (translateY + deltaY) + <span class="hljs-string">&#x27;px)&#x27;</span>\n  });\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchend</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-comment">// 拖动结束后的处理，如回弹效果等</span>\n}\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">touchstart</span>: touchstart,\n  <span class="hljs-attr">touchmove</span>: touchmove,\n  <span class="hljs-attr">touchend</span>: touchend\n};\n</code></pre>\n<h3>2. 在 WXML 中使用</h3>\n<pre><code class="language-wxml">&lt;wxs src=&quot;./drag.wxs&quot; module=&quot;drag&quot; /&gt;\n&lt;view\n  class=&quot;draggable-box&quot;\n  bindtouchstart=&quot;{{drag.touchstart}}&quot;\n  bindtouchmove=&quot;{{drag.touchmove}}&quot;\n  bindtouchend=&quot;{{drag.touchend}}&quot;\n&gt;\n  可拖动元素\n&lt;/view&gt;\n</code></pre>\n<h3>3. 添加样式</h3>\n<pre><code class="language-css"><span class="hljs-selector-class">.draggable-box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#07C160</span>;\n  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease-out;\n  <span class="hljs-attribute">will-change</span>: transform;\n}\n</code></pre>\n<h2>三、高级优化技巧</h2>\n<h3>1. 添加边界限制</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在drag.wxs中添加</span>\n<span class="hljs-keyword">var</span> minX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> maxX = <span class="hljs-number">300</span>;\n<span class="hljs-keyword">var</span> minY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> maxY = <span class="hljs-number">500</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchmove</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-keyword">var</span> deltaX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - startX;\n  <span class="hljs-keyword">var</span> deltaY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - startY;\n  \n  <span class="hljs-keyword">var</span> newX = translateX + deltaX;\n  <span class="hljs-keyword">var</span> newY = translateY + deltaY;\n  \n  <span class="hljs-comment">// 边界检查</span>\n  newX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minX, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxX, newX));\n  newY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minY, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxY, newY));\n  \n  ownerInstance.<span class="hljs-title function_">setStyle</span>({\n    <span class="hljs-attr">transform</span>: <span class="hljs-string">&#x27;translate(&#x27;</span> + newX + <span class="hljs-string">&#x27;px, &#x27;</span> + newY + <span class="hljs-string">&#x27;px)&#x27;</span>\n  });\n}\n</code></pre>\n<h3>2. 实现惯性滑动</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在drag.wxs中添加</span>\n<span class="hljs-keyword">var</span> lastTime = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> lastX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> lastY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> velocityX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> velocityY = <span class="hljs-number">0</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchmove</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-keyword">var</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();\n  <span class="hljs-keyword">var</span> deltaTime = now - lastTime;\n  \n  <span class="hljs-keyword">if</span> (deltaTime &gt; <span class="hljs-number">0</span>) {\n    velocityX = (event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - lastX) / deltaTime;\n    velocityY = (event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - lastY) / deltaTime;\n  }\n  \n  lastX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;\n  lastY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;\n  lastTime = now;\n  \n  <span class="hljs-comment">// 原有拖动逻辑...</span>\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchend</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-comment">// 惯性滑动</span>\n  <span class="hljs-keyword">var</span> decay = <span class="hljs-number">0.95</span>; <span class="hljs-comment">// 衰减系数</span>\n  <span class="hljs-keyword">var</span> threshold = <span class="hljs-number">0.1</span>; <span class="hljs-comment">// 停止阈值</span>\n  \n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(velocityX) &gt; threshold || <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(velocityY) &gt; threshold) {\n      translateX += velocityX * <span class="hljs-number">16</span>;\n      translateY += velocityY * <span class="hljs-number">16</span>;\n      \n      <span class="hljs-comment">// 边界检查</span>\n      translateX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minX, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxX, translateX));\n      translateY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minY, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxY, translateY));\n      \n      ownerInstance.<span class="hljs-title function_">setStyle</span>({\n        <span class="hljs-attr">transform</span>: <span class="hljs-string">&#x27;translate(&#x27;</span> + translateX + <span class="hljs-string">&#x27;px, &#x27;</span> + translateY + <span class="hljs-string">&#x27;px)&#x27;</span>\n      });\n      \n      velocityX *= decay;\n      velocityY *= decay;\n      \n      ownerInstance.<span class="hljs-title function_">requestAnimationFrame</span>(animate);\n    }\n  }\n  \n  ownerInstance.<span class="hljs-title function_">requestAnimationFrame</span>(animate);\n}\n</code></pre>\n<h3>3. 使用 change:prop 优化性能</h3>\n<pre><code class="language-wxml">&lt;wxs module=&quot;drag&quot; src=&quot;./drag.wxs&quot;&gt;&lt;/wxs&gt;\n&lt;view \n  change:prop=&quot;{{drag.onChange}}&quot;\n  prop=&quot;{{dragData}}&quot;\n  class=&quot;draggable&quot;\n  bindtouchstart=&quot;{{drag.touchstart}}&quot;\n  bindtouchmove=&quot;{{drag.touchmove}}&quot;\n  bindtouchend=&quot;{{drag.touchend}}&quot;\n&gt;&lt;/view&gt;\n</code></pre>\n<p>在 WXS 中：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">onChange</span>(<span class="hljs-params">newValue, oldValue, ownerInstance, instance</span>) {\n  <span class="hljs-comment">// 当dragData变化时执行</span>\n  <span class="hljs-comment">// 可以在这里处理状态同步等逻辑</span>\n}\n</code></pre>\n<h2>四、性能对比</h2>\n<table>\n<thead>\n<tr>\n<th>方案</th>\n<th>帧率(FPS)</th>\n<th>CPU占用</th>\n<th>通信损耗</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>纯JS实现</td>\n<td>30-45</td>\n<td>高</td>\n<td>高</td>\n</tr>\n<tr>\n<td>WXS基础实现</td>\n<td>50-55</td>\n<td>中</td>\n<td>低</td>\n</tr>\n<tr>\n<td>WXS优化实现(带惯性)</td>\n<td>55-60</td>\n<td>中低</td>\n<td>极低</td>\n</tr>\n</tbody>\n</table>\n<h2>五、注意事项</h2>\n<ol>\n<li><strong>WXS限制</strong>  ：\n<ul>\n<li>不能直接调用小程序API</li>\n<li>不能使用ES6+语法</li>\n<li>不能访问外部JavaScript变量</li>\n</ul>\n</li>\n<li><strong>兼容性问题</strong>  ：\n<ul>\n<li>某些低版本Android设备上WXS性能可能不如预期</li>\n<li>复杂的WXS脚本可能在iOS上表现更好</li>\n</ul>\n</li>\n<li><strong>调试技巧</strong>  ：\n<ul>\n<li>使用 <code>console.log</code> 输出调试信息</li>\n<li>在开发者工具的WXML面板中查看WXS模块状态</li>\n<li>使用性能面板监控动画帧率</li>\n</ul>\n</li>\n</ol>\n<h2>六、完整示例</h2>\n<pre><code class="language-wxml">&lt;!-- index.wxml --&gt;\n&lt;wxs src=&quot;./drag.wxs&quot; module=&quot;drag&quot; /&gt;\n&lt;view class=&quot;container&quot;&gt;\n  &lt;view\n    class=&quot;draggable-box&quot;\n    bindtouchstart=&quot;{{drag.touchstart}}&quot;\n    bindtouchmove=&quot;{{drag.touchmove}}&quot;\n    bindtouchend=&quot;{{drag.touchend}}&quot;\n  &gt;\n    拖动我\n  &lt;/view&gt;\n&lt;/view&gt;\n</code></pre>\n<pre><code class="language-javascript"><span class="hljs-comment">// drag.wxs</span>\n<span class="hljs-keyword">var</span> startX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> startY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> translateX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> translateY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> lastTime = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> lastX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> lastY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> velocityX = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> velocityY = <span class="hljs-number">0</span>;\n<span class="hljs-keyword">var</span> minX = -<span class="hljs-number">100</span>;\n<span class="hljs-keyword">var</span> maxX = <span class="hljs-number">300</span>;\n<span class="hljs-keyword">var</span> minY = -<span class="hljs-number">100</span>;\n<span class="hljs-keyword">var</span> maxY = <span class="hljs-number">500</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchstart</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  startX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;\n  startY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;\n  lastX = startX;\n  lastY = startY;\n  lastTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();\n  \n  <span class="hljs-keyword">var</span> currentStyle = ownerInstance.<span class="hljs-title function_">getComputedStyle</span>([<span class="hljs-string">&#x27;transform&#x27;</span>]);\n  <span class="hljs-keyword">var</span> transform = currentStyle.<span class="hljs-property">transform</span>;\n  <span class="hljs-keyword">if</span> (transform) {\n    <span class="hljs-keyword">var</span> matrix = transform.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/matrix\\((.+)\\)/</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;, &#x27;</span>);\n    translateX = <span class="hljs-built_in">parseFloat</span>(matrix[<span class="hljs-number">4</span>]) || <span class="hljs-number">0</span>;\n    translateY = <span class="hljs-built_in">parseFloat</span>(matrix[<span class="hljs-number">5</span>]) || <span class="hljs-number">0</span>;\n  }\n  \n  <span class="hljs-comment">// 停止任何正在进行的动画</span>\n  ownerInstance.<span class="hljs-title function_">cancelAnimationFrame</span>();\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchmove</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  <span class="hljs-keyword">var</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();\n  <span class="hljs-keyword">var</span> deltaTime = now - lastTime;\n  \n  <span class="hljs-keyword">if</span> (deltaTime &gt; <span class="hljs-number">0</span>) {\n    velocityX = (event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - lastX) / deltaTime * <span class="hljs-number">1000</span>;\n    velocityY = (event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - lastY) / deltaTime * <span class="hljs-number">1000</span>;\n  }\n  \n  <span class="hljs-keyword">var</span> deltaX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - startX;\n  <span class="hljs-keyword">var</span> deltaY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - startY;\n  \n  <span class="hljs-keyword">var</span> newX = translateX + deltaX;\n  <span class="hljs-keyword">var</span> newY = translateY + deltaY;\n  \n  <span class="hljs-comment">// 边界检查</span>\n  newX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minX, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxX, newX));\n  newY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minY, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxY, newY));\n  \n  ownerInstance.<span class="hljs-title function_">setStyle</span>({\n    <span class="hljs-attr">transform</span>: <span class="hljs-string">&#x27;translate(&#x27;</span> + newX + <span class="hljs-string">&#x27;px, &#x27;</span> + newY + <span class="hljs-string">&#x27;px)&#x27;</span>,\n    <span class="hljs-attr">transition</span>: <span class="hljs-string">&#x27;none&#x27;</span>\n  });\n  \n  lastX = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;\n  lastY = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;\n  lastTime = now;\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">touchend</span>(<span class="hljs-params">event, ownerInstance</span>) {\n  translateX += event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - startX;\n  translateY += event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - startY;\n  \n  <span class="hljs-comment">// 边界检查</span>\n  translateX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minX, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxX, translateX));\n  translateY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minY, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxY, translateY));\n  \n  <span class="hljs-keyword">var</span> decay = <span class="hljs-number">0.95</span>;\n  <span class="hljs-keyword">var</span> threshold = <span class="hljs-number">5</span>;\n  \n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(velocityX) &gt; threshold || <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(velocityY) &gt; threshold) {\n      translateX += velocityX * <span class="hljs-number">0.016</span>;\n      translateY += velocityY * <span class="hljs-number">0.016</span>;\n      \n      <span class="hljs-comment">// 边界检查并反弹</span>\n      <span class="hljs-keyword">if</span> (translateX &lt; minX) {\n        translateX = minX;\n        velocityX = -velocityX * <span class="hljs-number">0.5</span>;\n      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (translateX &gt; maxX) {\n        translateX = maxX;\n        velocityX = -velocityX * <span class="hljs-number">0.5</span>;\n      }\n      \n      <span class="hljs-keyword">if</span> (translateY &lt; minY) {\n        translateY = minY;\n        velocityY = -velocityY * <span class="hljs-number">0.5</span>;\n      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (translateY &gt; maxY) {\n        translateY = maxY;\n        velocityY = -velocityY * <span class="hljs-number">0.5</span>;\n      }\n      \n      ownerInstance.<span class="hljs-title function_">setStyle</span>({\n        <span class="hljs-attr">transform</span>: <span class="hljs-string">&#x27;translate(&#x27;</span> + translateX + <span class="hljs-string">&#x27;px, &#x27;</span> + translateY + <span class="hljs-string">&#x27;px)&#x27;</span>,\n        <span class="hljs-attr">transition</span>: <span class="hljs-string">&#x27;none&#x27;</span>\n      });\n      \n      velocityX *= decay;\n      velocityY *= decay;\n      \n      ownerInstance.<span class="hljs-title function_">requestAnimationFrame</span>(animate);\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-comment">// 动画结束，添加过渡效果</span>\n      ownerInstance.<span class="hljs-title function_">setStyle</span>({\n        <span class="hljs-attr">transition</span>: <span class="hljs-string">&#x27;transform 0.3s ease-out&#x27;</span>\n      });\n    }\n  }\n  \n  ownerInstance.<span class="hljs-title function_">requestAnimationFrame</span>(animate);\n}\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">touchstart</span>: touchstart,\n  <span class="hljs-attr">touchmove</span>: touchmove,\n  <span class="hljs-attr">touchend</span>: touchend\n};\n</code></pre>\n<pre><code class="language-css"><span class="hljs-comment">/* index.wxss */</span>\n<span class="hljs-selector-class">.container</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;\n  <span class="hljs-attribute">position</span>: relative;\n}\n\n<span class="hljs-selector-class">.draggable-box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#07C160</span>;\n  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;\n  <span class="hljs-attribute">display</span>: flex;\n  <span class="hljs-attribute">justify-content</span>: center;\n  <span class="hljs-attribute">align-items</span>: center;\n  <span class="hljs-attribute">color</span>: white;\n  <span class="hljs-attribute">will-change</span>: transform;\n  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease-out;\n  <span class="hljs-attribute">position</span>: absolute;\n  <span class="hljs-attribute">top</span>: <span class="hljs-number">200px</span>;\n  <span class="hljs-attribute">left</span>: <span class="hljs-number">50px</span>;\n}\n</code></pre>\n<p>这个完整示例实现了：</p>\n<ol>\n<li>平滑的拖动效果</li>\n<li>边界限制</li>\n<li>惯性滑动</li>\n<li>边界反弹效果</li>\n<li>高性能的动画实现</li>\n</ol>\n<p>通过 WXS 实现的拖动动画相比纯 JavaScript 实现可以显著提高性能，特别是在低端设备上表现更为明显。</p>\n</div>'</script></body></html>