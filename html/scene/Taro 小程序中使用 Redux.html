<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1c28cc=_0xd90d;function _0xd90d(p,s){var l=_0x5726();return(_0xd90d=function(s,n){var a=l[s-=409];void 0===_0xd90d.nYHwrJ&&(_0xd90d.MNqyTh=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,e=0;a=s.charAt(e++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=t.length;c<r;c++)p+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)p=(p+t[e]+n.charCodeAt(e%n.length))%256,a=t[e],t[e]=t[p],t[p]=a;for(var e=0,p=0,c=0;c<s.length;c++)a=t[e=(e+1)%256],t[e]=t[p=(p+t[e])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(c)^t[(t[e]+t[p])%256]);return l},p=arguments,_0xd90d.nYHwrJ=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0xd90d.CvpCEw&&(_0xd90d.CvpCEw=!0),a=_0xd90d.MNqyTh(a,n),p[s]=a),a})(p,s)}if((()=>{for(var s=_0xd90d,n=_0x5726();;)try{if(204171==-parseInt(s(422,"lc*@"))+parseInt(s(420,"KQNs"))/2*(parseInt(s(416,"mfmZ"))/3)+-parseInt(s(433,")f7*"))/4+-parseInt(s(425,"l23P"))/5+-parseInt(s(417,"bb%A"))/6+parseInt(s(412,"R9Sr"))/7*(parseInt(s(429,"utKv"))/8)+-parseInt(s(418,"lc*@"))/9*(-parseInt(s(421,"lc*@"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1c28cc(411,"Um5f")](_0x1c28cc(426,"lc*@"))!=_0x1c28cc(419,"BWmO"))throw window[_0x1c28cc(431,"QaOH")][_0x1c28cc(413,"%6(Q")](_0x1c28cc(428,"Q(fS")),Error();function _0x5726(){var s=["WOXilxddLCkzWQbLWQ7cLSk9zW","W7qUpmoQxh9LW5K","qSkDlrxdGfJdG0PC","pLFcVmozsCkUWP47zaHBf8kJ","WPBcHd5EwGybW5lcI8o1","WPrhE8o6o8kBWQxdM2FdPGNcKMC","oNiUw8oJpvuiuxK","uaCKWRRcRZOd","lv/dRCo+wmognCknD08","w8oDW69BWRvAW6K","WP3cHtjBmZqtW7lcRmoiWOa","h8onx2JdRSo9W5HImhbLWOFcJW","cCk/DmkIa3pdMt5hrq","WRSOdv/dICoNfCkUW4NcJsFdPCo8","wmk6A8oFW5CxaeStWO9S","jstcISofWOa","WRvRW4tcGLZdPSkRWRzC","xSkZA8oCWQiCm3a6WO4","wmk9z8oyW5b4a3WVWRLUfG","u8oaW49KDLiRW6bxuSkksWu","WRJdQepdMXiPtSosW4RcGG","sYLIWQ3dOmk+W6ZcJtyIi2TT","k8oOmCkjWPC9ih0G","g8onxwtcJCkXWQ5Fp30","W4zRW4C7EMjVxcRdPCoMWRlcJsxdMcmEytTPW6NdJmoklYGo","W7VdQSotDCoZk2Tnhe8"];return(_0x5726=function(){return s})()}document.title="Taro 小程序中使用 Redux",document.getElementById("article").innerHTML='<div><p>Redux 是 React 生态中最流行的状态管理工具，Taro 对其提供了官方支持。以下是 Taro + 小程序 + Redux 的详细使用方法和优化建议。</p>\n<hr>\n<p><strong>1. 安装与配置</strong><br>\n<strong>(1) 安装依赖</strong></p>\n<pre><code class="language-sh">npm install @tarojs/redux @tarojs/redux-h5 redux react-redux redux-thunk\n<span class="hljs-comment"># 或</span>\nyarn add @tarojs/redux @tarojs/redux-h5 redux react-redux redux-thunk\n</code></pre>\n<p><strong>(2) 配置 Redux (Store 初始化)</strong><br>\n在项目根目录创建 <code>store/index.js</code>：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createStore, applyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>\n<span class="hljs-keyword">import</span> thunk <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-thunk&#x27;</span> <span class="hljs-comment">// 支持异步 action</span>\n<span class="hljs-keyword">import</span> rootReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./reducers&#x27;</span>\n\n<span class="hljs-comment">// 创建 Store</span>\n<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(rootReducer, <span class="hljs-title function_">applyMiddleware</span>(thunk))\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store\n</code></pre>\n<p><strong>(3) 在 Taro 中注入 Store</strong><br>\n修改 <code>app.jsx</code>：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Provider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/redux&#x27;</span>\n<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span>\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Taro.Component</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span>\n        {/* 你的页面组件 */}\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>\n    )\n  }\n}\n</code></pre>\n<hr>\n<p><strong>2. 定义 Reducer 和 Action</strong><br>\n<strong>(1) Reducer 示例</strong><br>\n创建 <code>reducers/counter.js</code>：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> initialState = {\n  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">counterReducer</span>(<span class="hljs-params">state = initialState, action</span>) {\n  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;INCREMENT&#x27;</span>:\n      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }\n    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;DECREMENT&#x27;</span>:\n      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }\n    <span class="hljs-attr">default</span>:\n      <span class="hljs-keyword">return</span> state\n  }\n}\n</code></pre>\n<p>合并 Reducers (<code>reducers/index.js</code>)：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { combineReducers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>\n<span class="hljs-keyword">import</span> counter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./counter&#x27;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">combineReducers</span>({\n  counter\n})\n</code></pre>\n<p><strong>(2) Action 示例</strong><br>\n同步 Action：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// actions/counter.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span> })\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"></span>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;DECREMENT&#x27;</span> })\n</code></pre>\n<p>异步 Action（需 <code>redux-thunk</code>）：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">asyncIncrement</span> = (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">dispatch</span>) =&gt;</span> {\n    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">increment</span>()) <span class="hljs-comment">// 调用同步 action</span>\n    }, <span class="hljs-number">1000</span>)\n  }\n}\n</code></pre>\n<hr>\n<p><strong>3. 在组件中使用 Redux</strong><br>\n<strong>(1) 类组件：connect 绑定</strong></p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/redux&#x27;</span>\n<span class="hljs-keyword">import</span> { increment, asyncIncrement } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../actions/counter&#x27;</span>\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Taro.Component</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { count, increment, asyncIncrement } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>\n    <span class="hljs-keyword">return</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>+1<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{asyncIncrement}</span>&gt;</span>Async +1<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>\n    )\n  }\n}\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">mapStateToProps</span> = (<span class="hljs-params">state</span>) =&gt; ({\n  <span class="hljs-attr">count</span>: state.<span class="hljs-property">counter</span>.<span class="hljs-property">count</span>\n})\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">mapDispatchToProps</span> = (<span class="hljs-params">dispatch</span>) =&gt; ({\n  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">increment</span>()),\n  <span class="hljs-attr">asyncIncrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">asyncIncrement</span>())\n})\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="hljs-title class_">Counter</span>)\n</code></pre>\n<p><strong>(2) 函数组件：useSelector 和 useDispatch</strong></p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useSelector, useDispatch } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/redux-h5&#x27;</span>\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">counter</span>.<span class="hljs-property">count</span>)\n  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>()\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch(increment())}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>\n  )\n}\n</code></pre>\n<hr>\n<p><strong>4. 性能优化</strong><br>\n<strong>(1) 避免频繁更新</strong></p>\n<ul>\n<li>使用 <code>reselect</code> 缓存计算属性：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reselect&#x27;</span>\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectCount</span> = state =&gt; state.<span class="hljs-property">counter</span>.<span class="hljs-property">count</span>\n<span class="hljs-keyword">const</span> doubleCount = <span class="hljs-title function_">createSelector</span>(\n  [selectCount],\n  <span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count * <span class="hljs-number">2</span>\n)\n</code></pre>\n<p><strong>(2) 减少不必要的渲染</strong></p>\n<ul>\n<li>\n<p>类组件：继承 <code>PureComponent</code> 或实现 <code>shouldComponentUpdate</code>。</p>\n</li>\n<li>\n<p>函数组件：使用 <code>React.memo</code>：</p>\n</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoizedComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Counter</span>)\n</code></pre>\n<p><strong>(3) 按需加载 Redux</strong></p>\n<ul>\n<li>在大型项目中，可使用 <code>redux-dynamic-modules</code> 动态注入 Reducer。</li>\n</ul>\n<hr>\n<p><strong>5. 常见问题</strong><br>\n<strong>Q1: Redux 数据更新了但视图不渲染？</strong></p>\n<ul>\n<li>确保未直接修改 state（如 <code>state.count = 1</code>），必须返回新对象。</li>\n</ul>\n<p><strong>Q2: 如何在小程序中持久化 Redux 数据？</strong></p>\n<ul>\n<li>使用 <code>redux-persist</code> + 小程序的 <code>Storage</code>：</li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { persistStore, persistReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-persist&#x27;</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/taro&#x27;</span>\n\n<span class="hljs-keyword">const</span> persistConfig = {\n  <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;root&#x27;</span>,\n  <span class="hljs-attr">storage</span>: {\n    <span class="hljs-attr">getItem</span>: <span class="hljs-title class_">Taro</span>.<span class="hljs-property">getStorageSync</span>,\n    <span class="hljs-attr">setItem</span>: <span class="hljs-title class_">Taro</span>.<span class="hljs-property">setStorageSync</span>,\n    <span class="hljs-attr">removeItem</span>: <span class="hljs-title class_">Taro</span>.<span class="hljs-property">removeStorageSync</span>\n  }\n}\n</code></pre>\n<p><strong>Q3: Taro 的 <code>@tarojs/redux</code> 和 <code>react-redux</code> 有什么区别？</strong></p>\n<ul>\n<li><code>@tarojs/redux</code> 是 Taro 对 <code>react-redux</code> 的适配版，兼容小程序环境。</li>\n</ul>\n<hr>\n<p><strong>总结</strong></p>\n<table>\n<thead>\n<tr>\n<th>步骤</th>\n<th>关键点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>安装</td>\n<td><code>@tarojs/redux</code> + <code>redux-thunk</code></td>\n</tr>\n<tr>\n<td>配置 Store</td>\n<td>通过 <code>Provider</code> 注入到 Taro 根组件</td>\n</tr>\n<tr>\n<td>定义 Reducer</td>\n<td>使用 <code>combineReducers</code> 合并多个 reducer</td>\n</tr>\n<tr>\n<td>组件绑定</td>\n<td>类组件用 <code>connect</code>，函数组件用 <code>useSelector/useDispatch</code></td>\n</tr>\n<tr>\n<td>优化</td>\n<td>避免频繁更新、使用 <code>reselect</code> 和 <code>React.memo</code></td>\n</tr>\n</tbody>\n</table>\n<p>通过 Redux 可以高效管理 Taro 小程序的全局状态，但需注意性能优化和正确使用不可变数据。</p>\n</div>'</script></body></html>