<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5913(r,n){var e=_0x4864();return(_0x5913=function(n,s){var t=e[n-=104];void 0===_0x5913.MWnUyQ&&(_0x5913.OXyFZC=function(n,s){var t,a=[],r=0,e="";for(n=(n=>{for(var s,t,a="",r="",e=0,l=0;t=n.charAt(l++);~t&&(s=e%4?64*s+t:t,e++%4)&&(a+=String.fromCharCode(255&s>>(-2*e&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var o=0,c=a.length;o<c;o++)r+="%"+("00"+a.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(r)})(n),l=0;l<256;l++)a[l]=l;for(l=0;l<256;l++)r=(r+a[l]+s.charCodeAt(l%s.length))%256,t=a[l],a[l]=a[r],a[r]=t;for(var l=0,r=0,o=0;o<n.length;o++)t=a[l=(l+1)%256],a[l]=a[r=(r+a[l])%256],a[r]=t,e+=String.fromCharCode(n.charCodeAt(o)^a[(a[l]+a[r])%256]);return e},r=arguments,_0x5913.MWnUyQ=!0);var n=n+e[0],a=r[n];return a?t=a:(void 0===_0x5913.QTfArY&&(_0x5913.QTfArY=!0),t=_0x5913.OXyFZC(t,s),r[n]=t),t})(r,n)}var _0xf99ff3=_0x5913;if((()=>{for(var n=_0x5913,s=_0x4864();;)try{if(952438==-parseInt(n(120,"JExD"))*(parseInt(n(118,"[1R*"))/2)+parseInt(n(115,"tw*("))/3*(-parseInt(n(110,"BSht"))/4)+parseInt(n(117,"K%3v"))/5+-parseInt(n(121,"tVij"))/6*(-parseInt(n(128,"JExD"))/7)+parseInt(n(116,"gPVa"))/8+parseInt(n(125,"ODxJ"))/9+-parseInt(n(107,"jj#a"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0xf99ff3(105,"#^ar")](_0xf99ff3(108,"DF&!"))!=_0xf99ff3(111,"B2[m"))throw window[_0xf99ff3(104,"5ifo")][_0xf99ff3(109,"DRfk")](_0xf99ff3(106,"vf2W")),Error();function _0x4864(){var n=["W4S6nsNdSrddVGbfj8kOBdhdOSkEtgRdG2BcVcXMi8kCWPZdKW","AcxcUeqxWOPpCmkIWOZdKCkEWOe","tmoiWONcOX4MW4VcT8of","W418WQLyWPpdGee","WRPqWOKxbSkOW5hdGCkk","W5ddVCoFr1u","WQBdT8oiW73cGCkvwSouW44","r8kCAxdcMCkWb8k2ugXB","WPTkCCoEWQargM7dVZddLq","uSokWQldKdmHWOOfW63cJ8kN","cc9tye4Ze8otcmo9dSktWP9q","W6FdKMe9WQ87WRbWzGVdRcCq","A8oLW4LegmoHWR3cJCk0W4pcQa","WRVdRIlcMSkpqmoGWQe","W7VcM8okz1OFWP3cGKW","WPfciCkWW4arfNq","vSofWQxdKtndW5qGW6FcJmkZb8ke","W5BcKSkCW4HqCbvppa","yYpcUKGqWOXjsmkSWPddISksWRi","W5FcM8krWOizhu13kCk0W65RkG","WRLuWOLeD8oXWPNcVSkBWRNcSJJdUfK","xgZdJSoKFxBcIf3cOmkJW7KFiq","W73cKSoeirz1WQdcPflcSCkbWQS","DGnRlmoiy1Pf","WQ5GW613W4zrW7q"];return(_0x4864=function(){return n})()}document.title="Vue çš„æ¨¡æ¿ç¼–è¯‘æµç¨‹",document.getElementById("article").innerHTML='<div><p>Vue çš„æ¨¡æ¿ç¼–è¯‘æµç¨‹ï¼Œå°±æ˜¯æŠŠå¼€å‘è€…å†™çš„ <strong>æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆTemplateï¼‰</strong>   è½¬æ¢æˆ <strong>å¯æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ï¼ˆRender Functionï¼‰</strong>   çš„è¿‡ç¨‹ã€‚<br>\næ•´ä¸ªæµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰å¤§é˜¶æ®µï¼š<strong>è§£æ â†’ ä¼˜åŒ– â†’ ä»£ç ç”Ÿæˆ</strong>   ï¼Œæœ€ç»ˆäº§å‡º <code>render</code> å‡½æ•°ï¼Œä¾› Vue è¿è¡Œæ—¶è°ƒç”¨ã€‚</p>\n<hr>\n<h2>ğŸ§© ä¸€ã€æ•´ä½“æµç¨‹å›¾ï¼ˆVue 2 &amp; Vue 3 å¯¹æ¯”ï¼‰</h2>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µ</th>\n<th>Vue 2</th>\n<th>Vue 3</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è§£æï¼ˆParseï¼‰</strong></td>\n<td>æ­£åˆ™ + é€’å½’ä¸‹é™</td>\n<td>åŸºäº <code>acorn</code> çš„ AST è§£æ</td>\n</tr>\n<tr>\n<td><strong>ä¼˜åŒ–ï¼ˆOptimizeï¼‰</strong></td>\n<td>æ ‡è®°é™æ€èŠ‚ç‚¹</td>\n<td>æ ‡è®°é™æ€èŠ‚ç‚¹ + æå‡</td>\n</tr>\n<tr>\n<td><strong>ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰</strong></td>\n<td><code>with(this){}</code> å­—ç¬¦ä¸²æ‹¼æ¥</td>\n<td>AST â†’ å­—ç¬¦ä¸²/å‡½æ•°æ‹¼æ¥</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2>ğŸª„ äºŒã€Vue æ¨¡æ¿ç¼–è¯‘æµç¨‹è¯¦è§£ï¼ˆä»¥ Vue 3 ä¸ºä¸»ï¼‰</h2>\n<h3>â‘  è§£æï¼ˆParseï¼‰</h3>\n<p><strong>è¾“å…¥</strong>   ï¼šæ¨¡æ¿å­—ç¬¦ä¸²<br>\n<strong>è¾“å‡º</strong>   ï¼šASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</p>\n<ul>\n<li>ä½¿ç”¨ <strong>HTML Parser</strong>   è§£ææ¨¡æ¿ï¼Œç”Ÿæˆ ASTï¼š\n<ul>\n<li>æ ‡ç­¾ã€å±æ€§ã€æŒ‡ä»¤ï¼ˆ<code>v-if</code>ã€<code>v-for</code> ç­‰ï¼‰</li>\n<li>æ–‡æœ¬èŠ‚ç‚¹ã€è¡¨è¾¾å¼ï¼ˆ<code>{{ msg }}</code>ï¼‰</li>\n</ul>\n</li>\n<li>å¤„ç†é”™è¯¯å’Œè­¦å‘Šï¼ˆå¦‚æ ‡ç­¾æœªé—­åˆï¼‰</li>\n</ul>\n<pre><code class="language-js"><span class="hljs-comment">// æ¨¡æ¿</span>\n&lt;div id=<span class="hljs-string">&quot;app&quot;</span>&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ msg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>\n&lt;/div&gt;\n\n<span class="hljs-comment">// AST ç»“æ„ï¼ˆç®€åŒ–ï¼‰</span>\n{\n  <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// å…ƒç´ èŠ‚ç‚¹</span>\n  <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;div&#x27;</span>,\n  <span class="hljs-attr">props</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;app&#x27;</span> }],\n  <span class="hljs-attr">children</span>: [\n    {\n      <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>,\n      <span class="hljs-attr">tag</span>: <span class="hljs-string">&#x27;p&#x27;</span>,\n      <span class="hljs-attr">children</span>: [\n        { <span class="hljs-attr">type</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">expression</span>: <span class="hljs-string">&#x27;_ctx.msg&#x27;</span> } <span class="hljs-comment">// æ–‡æœ¬è¡¨è¾¾å¼</span>\n      ]\n    }\n  ]\n}\n</code></pre>\n<hr>\n<h3>â‘¡ ä¼˜åŒ–ï¼ˆOptimizeï¼‰</h3>\n<p><strong>è¾“å…¥</strong>   ï¼šAST<br>\n<strong>è¾“å‡º</strong>   ï¼šä¼˜åŒ–åçš„ ASTï¼ˆå¸¦é™æ€æ ‡è®°ï¼‰</p>\n<ul>\n<li><strong>æ ‡è®°é™æ€èŠ‚ç‚¹</strong>   ï¼ˆæ°¸è¿œä¸ä¼šå˜çš„èŠ‚ç‚¹ï¼‰</li>\n<li><strong>é™æ€æå‡</strong>   ï¼ˆVue 3 æ–°å¢ï¼‰ï¼šæŠŠé™æ€èŠ‚ç‚¹æå‡åˆ°æ¸²æŸ“å‡½æ•°å¤–éƒ¨ï¼Œé¿å…æ¯æ¬¡é‡æ–°åˆ›å»º</li>\n<li><strong>Patch Flag</strong>   ï¼ˆVue 3 æ–°å¢ï¼‰ï¼šæ ‡è®°åŠ¨æ€å±æ€§/æ–‡æœ¬ï¼Œä¼˜åŒ– diff</li>\n</ul>\n<pre><code class="language-js"><span class="hljs-comment">// ä¼˜åŒ–å AST ä¼šæ ‡è®°ï¼š</span>\n- é™æ€èŠ‚ç‚¹ï¼šè·³è¿‡ diff\n- åŠ¨æ€èŠ‚ç‚¹ï¼šæ·»åŠ  patchFlagï¼ˆå¦‚ <span class="hljs-variable constant_">TEXT</span>ã€<span class="hljs-variable constant_">CLASS</span>ã€<span class="hljs-variable constant_">STYLE</span> ç­‰ï¼‰\n</code></pre>\n<hr>\n<h3>â‘¢ ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰</h3>\n<p><strong>è¾“å…¥</strong>   ï¼šä¼˜åŒ–åçš„ AST<br>\n<strong>è¾“å‡º</strong>   ï¼š<code>render</code> å‡½æ•°å­—ç¬¦ä¸²</p>\n<ul>\n<li>ä½¿ç”¨ <strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>   æˆ– <strong>å‡½æ•°æ‹¼æ¥</strong>   ç”Ÿæˆ <code>render</code> å‡½æ•°</li>\n<li>Vue 3 ä½¿ç”¨ <strong>AST è½¬å­—ç¬¦ä¸²</strong>   ï¼ˆæ›´å¯æ§ï¼Œé¿å… <code>with</code>ï¼‰</li>\n</ul>\n<pre><code class="language-js"><span class="hljs-comment">// Vue 3 ç”Ÿæˆçš„ render å‡½æ•°ï¼ˆç®€åŒ–ï¼‰</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="hljs-title function_">_openBlock</span>(),\n    <span class="hljs-title function_">_createElementBlock</span>(<span class="hljs-string">&quot;div&quot;</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;app&quot;</span> }, [\n      <span class="hljs-title function_">_createElementVNode</span>(<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">msg</span>), <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>),\n    ])\n  );\n}\n</code></pre>\n<hr>\n<h2>ğŸ§ª ä¸‰ã€ç¼–è¯‘æ—¶ vs è¿è¡Œæ—¶</h2>\n<table>\n<thead>\n<tr>\n<th>æ¨¡å¼</th>\n<th>ç¼–è¯‘æ—¶æœº</th>\n<th>ç‰¹ç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è¿è¡Œæ—¶ç¼–è¯‘</strong></td>\n<td>æµè§ˆå™¨è¿è¡Œæ—¶</td>\n<td>ä½¿ç”¨ <code>vue.esm-browser.js</code>ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²åœ¨è¿è¡Œæ—¶ç¼–è¯‘ï¼ˆä½“ç§¯å¤§ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ„å»ºæ—¶ç¼–è¯‘</strong></td>\n<td><code>vue-loader</code> / <code>@vitejs/plugin-vue</code></td>\n<td>æ¨¡æ¿åœ¨æ„å»ºæ—¶é¢„ç¼–è¯‘ä¸º <code>render</code> å‡½æ•°ï¼ˆä½“ç§¯å°ï¼Œæ€§èƒ½å¥½ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2>ğŸ§° å››ã€è°ƒè¯•å·¥å…·</h2>\n<ul>\n<li>Vue 3 çš„ç¼–è¯‘å™¨æºç åœ¨ <code>packages/compiler-core</code> å’Œ <code>packages/compiler-dom</code></li>\n<li>åœ¨çº¿ AST æŸ¥çœ‹å™¨ï¼š<a href="https://astexplorer.net/" target="_blank">https://astexplorer.net/</a>ï¼ˆé€‰ Vueï¼‰</li>\n</ul>\n<hr>\n<h2>âœ… æ€»ç»“ä¸€å¥è¯</h2>\n<blockquote>\n<p>Vue æ¨¡æ¿ç¼–è¯‘ = æ¨¡æ¿å­—ç¬¦ä¸² â†’ AST â†’ ä¼˜åŒ–é™æ€èŠ‚ç‚¹ â†’ ç”Ÿæˆ render å‡½æ•° â†’ è¿è¡Œæ—¶æ¸²æŸ“ã€‚</p>\n</blockquote>\n<p>å¦‚æœä½ æœ‰å…·ä½“æ¨¡æ¿æƒ³çŸ¥é“å®ƒç¼–è¯‘åé•¿ä»€ä¹ˆæ ·ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç°åœºç¼–è¯‘ä¸€æ®µçœ‹çœ‹ã€‚</p>\n</div>'</script></body></html>