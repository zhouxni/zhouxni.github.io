<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1370(l,s){var e=_0x5209();return(_0x1370=function(s,n){var a=e[s-=139];void 0===_0x1370.oksInz&&(_0x1370.CbtEZE=function(s,n){var a,p=[],l=0,e="";for(s=(s=>{for(var n,a,p="",l="",e=0,t=0;a=s.charAt(t++);~a&&(n=e%4?64*n+a:a,e++%4)&&(p+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=p.length;c<r;c++)l+="%"+("00"+p.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),t=0;t<256;t++)p[t]=t;for(t=0;t<256;t++)l=(l+p[t]+n.charCodeAt(t%n.length))%256,a=p[t],p[t]=p[l],p[l]=a;for(var t=0,l=0,c=0;c<s.length;c++)a=p[t=(t+1)%256],p[t]=p[l=(l+p[t])%256],p[l]=a,e+=String.fromCharCode(s.charCodeAt(c)^p[(p[t]+p[l])%256]);return e},l=arguments,_0x1370.oksInz=!0);var s=s+e[0],p=l[s];return p?a=p:(void 0===_0x1370.UdBoYs&&(_0x1370.UdBoYs=!0),a=_0x1370.CbtEZE(a,n),l[s]=a),a})(l,s)}var _0x3a4e33=_0x1370;function _0x5209(){var s=["W6WLtu5MWQ8/bSkyWP/dN3JcHG","W6PeBmkjC0bDqdtdL8kUi3a","W6qckJCWdSkigG","W7tdJLJdOqNdPCohmc3cR8kIWOHT","peBdPCotW7BcJIL/WRqmd2q","Eq7dOCoRW4fueG","D8ooW7TDxNVdQYpdJ8o7q8oA","pKX9eSoGyI1NW5a","W69fA8klC0C3ssldG8kska","WPhdJNdcIJ5oWPq7xqZdLLq","amkJtSkGWRSBW5nLW55amCkJW4JdOCoiW5PUiIBcNSo7W4/dTwRdMmob","dmkxqCkMbclcKKLnFSo6W4RdUq","BmkhxCoaW4rOdmo/m8kfxCoM","WPxdIxpcJJTaW5GbvJJdJMpdVW","Bvyiq8kyWRuvWPRdSZhcGmoQ","BHOVfeO","W69VW5rJkMCTofVdUuFdNW","nCo7vSoVW6bdgG","WPmYWQOFACo1W6/dGMTzW5ufW7W","eJZdSSkrpG4Pc8kRWRVcVmkb"];return(_0x5209=function(){return s})()}if((()=>{for(var s=_0x1370,n=_0x5209();;)try{if(259942==-parseInt(s(158,"LR79"))+parseInt(s(148,"GQ2Y"))/2+parseInt(s(157,"]s51"))/3+parseInt(s(150,"e#Dq"))/4+-parseInt(s(143,"y$q4"))/5+parseInt(s(151,"ltry"))/6+-parseInt(s(140,"&)yl"))/7)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3a4e33(144,"Df2t")](_0x3a4e33(146,"Tz2^"))!=_0x3a4e33(154,"l#EM"))throw window[_0x3a4e33(141,"]n%t")][_0x3a4e33(156,"X9zF")](_0x3a4e33(149,"CYlG")),Error();document.title="处理Vue文件的Babel AST",document.getElementById("article").innerHTML='<div><p>处理Vue文件的Babel AST遍历需要结合Vue特定的解析方式，因为Vue文件包含多种语言块（template、script、style）。以下是具体步骤和示例代码：</p>\n<h3>1. <strong>解析Vue文件结构</strong></h3>\n<p>Vue文件需要先用<code>@vue/compiler-sfc</code>解析为SFC（单文件组件）结构，再分别处理各个语言块：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { parse } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/compiler-sfc&#x27;</span>);\n<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);\n<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);\n\n<span class="hljs-comment">// 读取Vue文件并解析为SFC结构</span>\n<span class="hljs-keyword">const</span> source = fs.<span class="hljs-title function_">readFileSync</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;Component.vue&#x27;</span>), <span class="hljs-string">&#x27;utf8&#x27;</span>);\n<span class="hljs-keyword">const</span> { descriptor } = <span class="hljs-title function_">parse</span>(source);\n\n<span class="hljs-comment">// descriptor包含：</span>\n<span class="hljs-comment">// - descriptor.script：JS/TS代码块</span>\n<span class="hljs-comment">// - descriptor.template：HTML模板</span>\n<span class="hljs-comment">// - descriptor.styles：CSS样式块</span>\n</code></pre>\n<h3>2. <strong>处理JavaScript/TypeScript代码块</strong></h3>\n<p>使用Babel处理<code>script</code>部分：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/parser&#x27;</span>);\n<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/traverse&#x27;</span>).<span class="hljs-property">default</span>;\n\n<span class="hljs-keyword">if</span> (descriptor.<span class="hljs-property">script</span>) {\n  <span class="hljs-keyword">const</span> scriptContent = descriptor.<span class="hljs-property">script</span>.<span class="hljs-property">content</span>;\n  \n  <span class="hljs-comment">// 解析为Babel AST</span>\n  <span class="hljs-keyword">const</span> ast = parser.<span class="hljs-title function_">parse</span>(scriptContent, {\n    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&#x27;module&#x27;</span>,\n    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;jsx&#x27;</span>, <span class="hljs-string">&#x27;typescript&#x27;</span>] <span class="hljs-comment">// 根据项目添加插件</span>\n  });\n  \n  <span class="hljs-comment">// 遍历AST（示例：查找所有method定义）</span>\n  <span class="hljs-title function_">traverse</span>(ast, {\n    <span class="hljs-title class_">MethodDefinition</span>(path) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Found method:&#x27;</span>, path.<span class="hljs-property">node</span>.<span class="hljs-property">key</span>.<span class="hljs-property">name</span>);\n    }\n  });\n}\n</code></pre>\n<h3>3. <strong>处理Vue模板（可选）</strong></h3>\n<p>使用<code>@vue/compiler-dom</code>解析模板：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { compileTemplate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/compiler-dom&#x27;</span>);\n\n<span class="hljs-keyword">if</span> (descriptor.<span class="hljs-property">template</span>) {\n  <span class="hljs-keyword">const</span> templateContent = descriptor.<span class="hljs-property">template</span>.<span class="hljs-property">content</span>;\n  \n  <span class="hljs-comment">// 编译模板为渲染函数</span>\n  <span class="hljs-keyword">const</span> { ast } = <span class="hljs-title function_">compileTemplate</span>({\n    <span class="hljs-attr">source</span>: templateContent\n  });\n  \n  <span class="hljs-comment">// 遍历模板AST（示例：查找所有div标签）</span>\n  <span class="hljs-keyword">function</span> <span class="hljs-title function_">walk</span>(<span class="hljs-params">node</span>) {\n    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span> &amp;&amp; node.<span class="hljs-property">tag</span> === <span class="hljs-string">&#x27;div&#x27;</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Found div in template&#x27;</span>);\n    }\n    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">children</span>) {\n      node.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(walk);\n    }\n  }\n  \n  <span class="hljs-title function_">walk</span>(ast);\n}\n</code></pre>\n<h3>4. <strong>完整示例：遍历Vue文件所有部分</strong></h3>\n<p>下面是一个完整的脚本，演示如何遍历Vue文件的JavaScript代码和模板：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { parse } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/compiler-sfc&#x27;</span>);\n<span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/parser&#x27;</span>);\n<span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/traverse&#x27;</span>).<span class="hljs-property">default</span>;\n<span class="hljs-keyword">const</span> { compileTemplate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/compiler-dom&#x27;</span>);\n<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);\n<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">processVueFile</span>(<span class="hljs-params">filePath</span>) {\n  <span class="hljs-keyword">const</span> source = fs.<span class="hljs-title function_">readFileSync</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);\n  <span class="hljs-keyword">const</span> { descriptor } = <span class="hljs-title function_">parse</span>(source);\n\n  <span class="hljs-comment">// 处理script部分</span>\n  <span class="hljs-keyword">if</span> (descriptor.<span class="hljs-property">script</span>) {\n    <span class="hljs-keyword">const</span> scriptContent = descriptor.<span class="hljs-property">script</span>.<span class="hljs-property">content</span>;\n    <span class="hljs-keyword">const</span> ast = parser.<span class="hljs-title function_">parse</span>(scriptContent, {\n      <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&#x27;module&#x27;</span>,\n      <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;jsx&#x27;</span>, <span class="hljs-string">&#x27;typescript&#x27;</span>]\n    });\n\n    <span class="hljs-title function_">traverse</span>(ast, {\n      <span class="hljs-title class_">MethodDefinition</span>(path) {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Method in script: <span class="hljs-subst">${path.node.key.name}</span>`</span>);\n      }\n    });\n  }\n\n  <span class="hljs-comment">// 处理template部分</span>\n  <span class="hljs-keyword">if</span> (descriptor.<span class="hljs-property">template</span>) {\n    <span class="hljs-keyword">const</span> templateContent = descriptor.<span class="hljs-property">template</span>.<span class="hljs-property">content</span>;\n    <span class="hljs-keyword">const</span> { ast } = <span class="hljs-title function_">compileTemplate</span>({ <span class="hljs-attr">source</span>: templateContent });\n\n    <span class="hljs-keyword">function</span> <span class="hljs-title function_">walk</span>(<span class="hljs-params">node</span>) {\n      <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span> &amp;&amp; node.<span class="hljs-property">tag</span>) {\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Tag in template: <span class="hljs-subst">${node.tag}</span>`</span>);\n      }\n      <span class="hljs-keyword">if</span> (node.<span class="hljs-property">children</span>) {\n        node.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(walk);\n      }\n    }\n\n    <span class="hljs-title function_">walk</span>(ast);\n  }\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-title function_">processVueFile</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;src/components/MyComponent.vue&#x27;</span>));\n</code></pre>\n<h3>关键依赖</h3>\n<p>确保安装以下依赖：</p>\n<pre><code class="language-sh">npm install @vue/compiler-sfc @babel/parser @babel/traverse @vue/compiler-dom\n</code></pre>\n<h3>注意事项</h3>\n<ol>\n<li><strong>模板AST差异</strong>  ：Vue模板AST结构与Babel JS AST不同，需要使用Vue编译器API处理。</li>\n<li><strong>TypeScript支持</strong>  ：如果项目使用TypeScript，需添加<code>@babel/plugin-transform-typescript</code>插件。</li>\n<li><strong>插件生态</strong>  ：可结合<code>@babel/core</code>和Babel插件进行更复杂的转换。</li>\n</ol>\n<p>通过这种方式，你可以全面遍历Vue文件的各个部分并进行自定义处理。</p>\n</div>'</script></body></html>