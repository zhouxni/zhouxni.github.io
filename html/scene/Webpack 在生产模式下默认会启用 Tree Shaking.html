<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x125122=_0x3c8f;if((()=>{for(var n=_0x3c8f,s=_0x5696();;)try{if(759338==+parseInt(n(172,"NJ)m"))*(parseInt(n(180,"snj2"))/2)+parseInt(n(175,"P[py"))/3*(parseInt(n(169,"a8k&"))/4)+parseInt(n(164,"H83Z"))/5*(parseInt(n(159,"Tc66"))/6)+-parseInt(n(168,"0NE^"))/7+-parseInt(n(158,"a8k&"))/8+parseInt(n(181,"8Dfu"))/9+parseInt(n(178,"ncdh"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x125122(160,"ig*A")](_0x125122(166,"TEVc"))!=_0x125122(179,"Qk$z"))throw window[_0x125122(174,"0NE^")][_0x125122(183,"Ne(!")](_0x125122(171,"a8k&")),Error();function _0x3c8f(t,n){var e=_0x5696();return(_0x3c8f=function(n,s){var a=e[n-=158];void 0===_0x3c8f.DwsxLN&&(_0x3c8f.rOleZj=function(n,s){var a,o=[],t=0,e="";for(n=(n=>{for(var s,a,o="",t="",e=0,l=0;a=n.charAt(l++);~a&&(s=e%4?64*s+a:a,e++%4)&&(o+=String.fromCharCode(255&s>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,c=o.length;r<c;r++)t+="%"+("00"+o.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(n),l=0;l<256;l++)o[l]=l;for(l=0;l<256;l++)t=(t+o[l]+s.charCodeAt(l%s.length))%256,a=o[l],o[l]=o[t],o[t]=a;for(var l=0,t=0,r=0;r<n.length;r++)a=o[l=(l+1)%256],o[l]=o[t=(t+o[l])%256],o[t]=a,e+=String.fromCharCode(n.charCodeAt(r)^o[(o[l]+o[t])%256]);return e},t=arguments,_0x3c8f.DwsxLN=!0);var n=n+e[0],o=t[n];return o?a=o:(void 0===_0x3c8f.dStKjm&&(_0x3c8f.dStKjm=!0),a=_0x3c8f.rOleZj(a,s),t[n]=a),a})(t,n)}function _0x5696(){var n=["xSknqSoYbSk0W68u","WQ/cSSo2W6ldOfRcJmoZkCkMWQ8","aMPtqLxdPmoL","fM4OWOtdQmoTW4zXy8opFXnW","aXCSiHJcT8k9jMm2W43cNmom","tCotAKhcGq","W7POW7VcV8k6eam","jX0tAstcISkkW4rQoqvuW60","W5j+uCk6d8kdW5y","C3/dI1TQtvy","W6ejW4GDzaJcVrDEWPWukCkp","W7z8ef09WRBdUa","faj2gmkwsSoK","WRTzcHr4hYldQG","W6VcLZK+hJ4KWP7cJw5f","cLJdHSoLaHxdVmk0W74VD8kc","WQxdK8k8krdcG8ohwmomCCkeWOu","ASkLjSoGwmoJWPxdJSorWQhcSGGs","W6eTWOD1cmoiWPVcKM4","a8oqeCkRsSoRW6eFhL4BW54","cSotfCkJqSoRWRiRkwOvW6jx","W6CjWOjDowpdRs0","WQtdK8k9lbhcJSktyCozESkMWQ4B","WRTfWOvyiqRcQLbqWOWkbmkCgmoyASkytXjtWPulW6lcMmkvBq","h20SWOZdOmoTWPvfvmo7Cs8","jv93BSoMWQ0TzCoxtYlcQxy"];return(_0x5696=function(){return n})()}document.title="Webpack åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹é»˜è®¤ä¼šå¯ç”¨ Tree Shaking",document.getElementById("article").innerHTML='<div><p><strong>Webpack åœ¨ç”Ÿäº§æ¨¡å¼ï¼ˆ<code>mode: \'production\'</code>ï¼‰ä¸‹é»˜è®¤ä¼šå¯ç”¨ Tree Shaking</strong>   ï¼Œä½†å®ƒçš„æ•ˆæœå–å†³äºä½ çš„ä»£ç å’Œé…ç½®æ˜¯å¦ç¬¦åˆ Tree Shaking çš„æ¡ä»¶ã€‚å…³é”®åœ¨äºï¼š</p>\n<hr>\n<h3><strong>1. Webpack ç”Ÿäº§æ¨¡å¼é»˜è®¤å¯ç”¨ Tree Shaking</strong></h3>\n<ul>\n<li><strong><code>mode: \'production\'</code> ä¼šè‡ªåŠ¨å¯ç”¨ Tree Shaking</strong>   ï¼ˆé€šè¿‡ <code>TerserPlugin</code> å’Œ <code>optimization.usedExports</code>ï¼‰ã€‚</li>\n<li><strong>ä½† Tree Shaking æ˜¯å¦ç”Ÿæ•ˆï¼Œè¿˜å–å†³äºä»¥ä¸‹æ¡ä»¶</strong>   ï¼š\n<ol>\n<li><strong>ä»£ç å¿…é¡»æ˜¯ ESMï¼ˆ<code>import/export</code>ï¼‰</strong>   ï¼Œè€Œä¸æ˜¯ CommonJSï¼ˆ<code>require</code>ï¼‰ã€‚</li>\n<li><strong><code>package.json</code> ä¸­çš„ <code>sideEffects</code> é…ç½®</strong>   ï¼ˆé»˜è®¤æ˜¯ <code>true</code>ï¼Œå³ä¿å®ˆæ¨¡å¼ï¼‰ã€‚</li>\n<li><strong>æ²¡æœ‰å…¶ä»–å·¥å…·ï¼ˆå¦‚ Babelï¼‰ç ´å ESM ç»“æ„</strong>   ã€‚</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h3><strong>2. ä¸ºä»€ä¹ˆä½ çš„ä»£ç å¯èƒ½æ²¡æœ‰è¢« Tree Shakingï¼Ÿ</strong></h3>\n<h4><strong>åŸå›  1ï¼š<code>sideEffects</code> é»˜è®¤æ˜¯ <code>true</code>ï¼ˆä¿å®ˆæ¨¡å¼ï¼‰</strong></h4>\n<ul>\n<li><strong>é»˜è®¤è¡Œä¸º</strong>   ï¼šWebpack å‡è®¾æ‰€æœ‰æ–‡ä»¶å¯èƒ½æœ‰å‰¯ä½œç”¨ï¼Œå› æ­¤ä¸ä¼šæ¿€è¿›åˆ é™¤ä»£ç ã€‚</li>\n<li><strong>è§£å†³æ–¹æ¡ˆ</strong>   ï¼šæ˜¾å¼å£°æ˜ <code>sideEffects: false</code> æˆ–æ ‡è®°å…·ä½“å‰¯ä½œç”¨æ–‡ä»¶ï¼š<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// æ‰€æœ‰æ–‡ä»¶æ— å‰¯ä½œç”¨ï¼ˆå¤§èƒ†å‰”é™¤ï¼‰</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\næˆ–<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;*.css&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;src/polyfill.js&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// ä»…æ ‡è®°æœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>åŸå›  2ï¼šä»£ç ä¸æ˜¯çº¯ ESM</strong></h4>\n<ul>\n<li><strong>CommonJS æ— æ³•è¢« Tree Shaking</strong>   ï¼š<pre><code class="language-javascript"><span class="hljs-comment">// âŒ æ— æ³• Tree Shakingï¼ˆåŠ¨æ€ä¾èµ–ï¼‰</span>\n<span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./utils&quot;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(utils.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));\n</code></pre>\n</li>\n<li><strong>è§£å†³æ–¹æ¡ˆ</strong>   ï¼šæ”¹ç”¨ ESMï¼š<pre><code class="language-javascript"><span class="hljs-comment">// âœ… å¯è¢« Tree Shaking</span>\n<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils&quot;</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));\n</code></pre>\n</li>\n</ul>\n<h4><strong>åŸå›  3ï¼šBabel è½¬è¯‘ç ´åäº† ESM</strong></h4>\n<ul>\n<li>å¦‚æœ Babel å°† <code>import/export</code> è½¬è¯‘ä¸º CommonJSï¼ŒTree Shaking å¤±æ•ˆã€‚</li>\n<li><strong>è§£å†³æ–¹æ¡ˆ</strong>   ï¼šåœ¨ Babel é…ç½®ä¸­ä¿ç•™ ESMï¼š<pre><code class="language-javascript"><span class="hljs-comment">// babel.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">presets</span>: [\n    [<span class="hljs-string">&quot;@babel/preset-env&quot;</span>, { <span class="hljs-attr">modules</span>: <span class="hljs-literal">false</span> }], <span class="hljs-comment">// å…³é”®ï¼ä¿ç•™ ESM</span>\n  ],\n};\n</code></pre>\n</li>\n</ul>\n<h4><strong>åŸå›  4ï¼šç¬¬ä¸‰æ–¹åº“ä¸æ”¯æŒ Tree Shaking</strong></h4>\n<ul>\n<li>ä¾‹å¦‚ï¼š<code>lodash</code> é»˜è®¤æ˜¯ CommonJSï¼Œéœ€æ”¹ç”¨ <code>lodash-es</code>ï¼š<pre><code class="language-javascript"><span class="hljs-comment">// âœ… ä½¿ç”¨ ESM ç‰ˆæœ¬</span>\n<span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash-es&quot;</span>;\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3><strong>3. å¦‚ä½•éªŒè¯ Tree Shaking æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</strong></h3>\n<h4><strong>æ–¹æ³• 1ï¼šæ£€æŸ¥æ‰“åŒ…åçš„ä»£ç </strong></h4>\n<ol>\n<li>è¿è¡Œç”Ÿäº§æ„å»ºï¼š<pre><code class="language-bash">webpack --mode=production\n</code></pre>\n</li>\n<li>åœ¨è¾“å‡ºæ–‡ä»¶ä¸­æœç´¢ <code>unused harmony export</code>ï¼Œå¦‚æœå­˜åœ¨åˆ™è¯´æ˜ Webpack æ ‡è®°äº†æœªä½¿ç”¨çš„ä»£ç ï¼Œä½†å¯èƒ½å› å‰¯ä½œç”¨æœªè¢«åˆ é™¤ã€‚</li>\n</ol>\n<h4><strong>æ–¹æ³• 2ï¼šä½¿ç”¨ <code>webpack-bundle-analyzer</code></strong></h4>\n<pre><code class="language-bash">npx webpack-bundle-analyzer stats.json\n</code></pre>\n<p>æ£€æŸ¥æœªä½¿ç”¨çš„æ¨¡å—æ˜¯å¦è¢«æ‰“åŒ…ã€‚</p>\n<hr>\n<h3><strong>4. å…³é”®ç»“è®º</strong></h3>\n<table>\n<thead>\n<tr>\n<th>æƒ…å†µ</th>\n<th>Tree Shaking æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</th>\n<th>è§£å†³æ–¹æ¡ˆ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>mode: \'production\'</code> + ESM ä»£ç  + <code>sideEffects: false</code></strong></td>\n<td>âœ… å®Œå…¨ç”Ÿæ•ˆ</td>\n<td>ç†æƒ³é…ç½®</td>\n</tr>\n<tr>\n<td><strong><code>sideEffects</code> æœªè®¾ç½®ï¼ˆé»˜è®¤ <code>true</code>ï¼‰</strong></td>\n<td>âŒ ä¿å®ˆæ¨¡å¼ï¼Œå¯èƒ½ä¸ç”Ÿæ•ˆ</td>\n<td>æ˜¾å¼è®¾ç½® <code>sideEffects</code></td>\n</tr>\n<tr>\n<td><strong>ä»£ç æ˜¯ CommonJS</strong></td>\n<td>âŒ å®Œå…¨ä¸ç”Ÿæ•ˆ</td>\n<td>æ”¹ç”¨ ESM</td>\n</tr>\n<tr>\n<td><strong>Babel è½¬è¯‘ä¸º CommonJS</strong></td>\n<td>âŒ å¤±æ•ˆ</td>\n<td>é…ç½® <code>{ modules: false }</code></td>\n</tr>\n<tr>\n<td><strong>ç¬¬ä¸‰æ–¹åº“æ˜¯ CommonJS</strong></td>\n<td>âŒ å¤±æ•ˆ</td>\n<td>æ¢ç”¨ ESM ç‰ˆæœ¬ï¼ˆå¦‚ <code>lodash-es</code>ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>5. æœ€ä½³å®è·µ</strong></h3>\n<ol>\n<li><strong>å§‹ç»ˆä½¿ç”¨ <code>mode: \'production\'</code></strong>   ã€‚</li>\n<li><strong>åœ¨ <code>package.json</code> ä¸­æ˜ç¡®è®¾ç½® <code>sideEffects</code></strong>   ï¼š<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// æˆ–ç²¾å‡†æ ‡è®°å‰¯ä½œç”¨æ–‡ä»¶</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li><strong>ç¡®ä¿ä»£ç æ˜¯çº¯ ESM</strong>   ï¼ˆé¿å… <code>require</code> å’Œå…¨å±€å‰¯ä½œç”¨ï¼‰ã€‚</li>\n<li><strong>éªŒè¯æ‰“åŒ…ç»“æœ</strong>   ï¼ˆé€šè¿‡åˆ†æå·¥å…·æˆ–æ£€æŸ¥è¾“å‡ºä»£ç ï¼‰ã€‚</li>\n</ol>\n<hr>\n<h3><strong>æ€»ç»“</strong></h3>\n<ul>\n<li><strong>Webpack ç”Ÿäº§æ¨¡å¼é»˜è®¤å°è¯• Tree Shaking</strong>   ï¼Œä½†å®é™…æ•ˆæœä¾èµ–ä»£ç ç»“æ„å’Œé…ç½®ã€‚</li>\n<li><strong>é»˜è®¤çš„ <code>sideEffects: true</code> æ˜¯å®‰å…¨ä¿å®ˆçš„</strong>   ï¼Œå¯èƒ½è®©ä½ è¯¯ä»¥ä¸º Tree Shaking æ²¡ç”Ÿæ•ˆã€‚</li>\n<li><strong>é€šè¿‡æ­£ç¡®é…ç½®å’Œä»£ç è§„èŒƒï¼Œå¯ä»¥æœ€å¤§åŒ– Tree Shaking çš„æ•ˆæœ</strong>   ï¼Œæ˜¾è‘—å‡å°‘æ‰“åŒ…ä½“ç§¯ï¼ ğŸš€</li>\n</ul>\n</div>'</script></body></html>