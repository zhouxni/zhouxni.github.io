<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x125122=_0x3c8f;if((()=>{for(var n=_0x3c8f,s=_0x5696();;)try{if(759338==+parseInt(n(172,"NJ)m"))*(parseInt(n(180,"snj2"))/2)+parseInt(n(175,"P[py"))/3*(parseInt(n(169,"a8k&"))/4)+parseInt(n(164,"H83Z"))/5*(parseInt(n(159,"Tc66"))/6)+-parseInt(n(168,"0NE^"))/7+-parseInt(n(158,"a8k&"))/8+parseInt(n(181,"8Dfu"))/9+parseInt(n(178,"ncdh"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x125122(160,"ig*A")](_0x125122(166,"TEVc"))!=_0x125122(179,"Qk$z"))throw window[_0x125122(174,"0NE^")][_0x125122(183,"Ne(!")](_0x125122(171,"a8k&")),Error();function _0x3c8f(t,n){var e=_0x5696();return(_0x3c8f=function(n,s){var a=e[n-=158];void 0===_0x3c8f.DwsxLN&&(_0x3c8f.rOleZj=function(n,s){var a,o=[],t=0,e="";for(n=(n=>{for(var s,a,o="",t="",e=0,l=0;a=n.charAt(l++);~a&&(s=e%4?64*s+a:a,e++%4)&&(o+=String.fromCharCode(255&s>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,c=o.length;r<c;r++)t+="%"+("00"+o.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(n),l=0;l<256;l++)o[l]=l;for(l=0;l<256;l++)t=(t+o[l]+s.charCodeAt(l%s.length))%256,a=o[l],o[l]=o[t],o[t]=a;for(var l=0,t=0,r=0;r<n.length;r++)a=o[l=(l+1)%256],o[l]=o[t=(t+o[l])%256],o[t]=a,e+=String.fromCharCode(n.charCodeAt(r)^o[(o[l]+o[t])%256]);return e},t=arguments,_0x3c8f.DwsxLN=!0);var n=n+e[0],o=t[n];return o?a=o:(void 0===_0x3c8f.dStKjm&&(_0x3c8f.dStKjm=!0),a=_0x3c8f.rOleZj(a,s),t[n]=a),a})(t,n)}function _0x5696(){var n=["xSknqSoYbSk0W68u","WQ/cSSo2W6ldOfRcJmoZkCkMWQ8","aMPtqLxdPmoL","fM4OWOtdQmoTW4zXy8opFXnW","aXCSiHJcT8k9jMm2W43cNmom","tCotAKhcGq","W7POW7VcV8k6eam","jX0tAstcISkkW4rQoqvuW60","W5j+uCk6d8kdW5y","C3/dI1TQtvy","W6ejW4GDzaJcVrDEWPWukCkp","W7z8ef09WRBdUa","faj2gmkwsSoK","WRTzcHr4hYldQG","W6VcLZK+hJ4KWP7cJw5f","cLJdHSoLaHxdVmk0W74VD8kc","WQxdK8k8krdcG8ohwmomCCkeWOu","ASkLjSoGwmoJWPxdJSorWQhcSGGs","W6eTWOD1cmoiWPVcKM4","a8oqeCkRsSoRW6eFhL4BW54","cSotfCkJqSoRWRiRkwOvW6jx","W6CjWOjDowpdRs0","WQtdK8k9lbhcJSktyCozESkMWQ4B","WRTfWOvyiqRcQLbqWOWkbmkCgmoyASkytXjtWPulW6lcMmkvBq","h20SWOZdOmoTWPvfvmo7Cs8","jv93BSoMWQ0TzCoxtYlcQxy"];return(_0x5696=function(){return n})()}document.title="Webpack 在生产模式下默认会启用 Tree Shaking",document.getElementById("article").innerHTML='<div><p><strong>Webpack 在生产模式（<code>mode: \'production\'</code>）下默认会启用 Tree Shaking</strong>   ，但它的效果取决于你的代码和配置是否符合 Tree Shaking 的条件。关键在于：</p>\n<hr>\n<h3><strong>1. Webpack 生产模式默认启用 Tree Shaking</strong></h3>\n<ul>\n<li><strong><code>mode: \'production\'</code> 会自动启用 Tree Shaking</strong>   （通过 <code>TerserPlugin</code> 和 <code>optimization.usedExports</code>）。</li>\n<li><strong>但 Tree Shaking 是否生效，还取决于以下条件</strong>   ：\n<ol>\n<li><strong>代码必须是 ESM（<code>import/export</code>）</strong>   ，而不是 CommonJS（<code>require</code>）。</li>\n<li><strong><code>package.json</code> 中的 <code>sideEffects</code> 配置</strong>   （默认是 <code>true</code>，即保守模式）。</li>\n<li><strong>没有其他工具（如 Babel）破坏 ESM 结构</strong>   。</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h3><strong>2. 为什么你的代码可能没有被 Tree Shaking？</strong></h3>\n<h4><strong>原因 1：<code>sideEffects</code> 默认是 <code>true</code>（保守模式）</strong></h4>\n<ul>\n<li><strong>默认行为</strong>   ：Webpack 假设所有文件可能有副作用，因此不会激进删除代码。</li>\n<li><strong>解决方案</strong>   ：显式声明 <code>sideEffects: false</code> 或标记具体副作用文件：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// 所有文件无副作用（大胆剔除）</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n或<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;*.css&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;src/polyfill.js&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 仅标记有副作用的文件</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>原因 2：代码不是纯 ESM</strong></h4>\n<ul>\n<li><strong>CommonJS 无法被 Tree Shaking</strong>   ：<pre><code class="language-javascript"><span class="hljs-comment">// ❌ 无法 Tree Shaking（动态依赖）</span>\n<span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./utils&quot;</span>);\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(utils.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));\n</code></pre>\n</li>\n<li><strong>解决方案</strong>   ：改用 ESM：<pre><code class="language-javascript"><span class="hljs-comment">// ✅ 可被 Tree Shaking</span>\n<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils&quot;</span>;\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));\n</code></pre>\n</li>\n</ul>\n<h4><strong>原因 3：Babel 转译破坏了 ESM</strong></h4>\n<ul>\n<li>如果 Babel 将 <code>import/export</code> 转译为 CommonJS，Tree Shaking 失效。</li>\n<li><strong>解决方案</strong>   ：在 Babel 配置中保留 ESM：<pre><code class="language-javascript"><span class="hljs-comment">// babel.config.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">presets</span>: [\n    [<span class="hljs-string">&quot;@babel/preset-env&quot;</span>, { <span class="hljs-attr">modules</span>: <span class="hljs-literal">false</span> }], <span class="hljs-comment">// 关键！保留 ESM</span>\n  ],\n};\n</code></pre>\n</li>\n</ul>\n<h4><strong>原因 4：第三方库不支持 Tree Shaking</strong></h4>\n<ul>\n<li>例如：<code>lodash</code> 默认是 CommonJS，需改用 <code>lodash-es</code>：<pre><code class="language-javascript"><span class="hljs-comment">// ✅ 使用 ESM 版本</span>\n<span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash-es&quot;</span>;\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3><strong>3. 如何验证 Tree Shaking 是否生效？</strong></h3>\n<h4><strong>方法 1：检查打包后的代码</strong></h4>\n<ol>\n<li>运行生产构建：<pre><code class="language-bash">webpack --mode=production\n</code></pre>\n</li>\n<li>在输出文件中搜索 <code>unused harmony export</code>，如果存在则说明 Webpack 标记了未使用的代码，但可能因副作用未被删除。</li>\n</ol>\n<h4><strong>方法 2：使用 <code>webpack-bundle-analyzer</code></strong></h4>\n<pre><code class="language-bash">npx webpack-bundle-analyzer stats.json\n</code></pre>\n<p>检查未使用的模块是否被打包。</p>\n<hr>\n<h3><strong>4. 关键结论</strong></h3>\n<table>\n<thead>\n<tr>\n<th>情况</th>\n<th>Tree Shaking 是否生效？</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>mode: \'production\'</code> + ESM 代码 + <code>sideEffects: false</code></strong></td>\n<td>✅ 完全生效</td>\n<td>理想配置</td>\n</tr>\n<tr>\n<td><strong><code>sideEffects</code> 未设置（默认 <code>true</code>）</strong></td>\n<td>❌ 保守模式，可能不生效</td>\n<td>显式设置 <code>sideEffects</code></td>\n</tr>\n<tr>\n<td><strong>代码是 CommonJS</strong></td>\n<td>❌ 完全不生效</td>\n<td>改用 ESM</td>\n</tr>\n<tr>\n<td><strong>Babel 转译为 CommonJS</strong></td>\n<td>❌ 失效</td>\n<td>配置 <code>{ modules: false }</code></td>\n</tr>\n<tr>\n<td><strong>第三方库是 CommonJS</strong></td>\n<td>❌ 失效</td>\n<td>换用 ESM 版本（如 <code>lodash-es</code>）</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>5. 最佳实践</strong></h3>\n<ol>\n<li><strong>始终使用 <code>mode: \'production\'</code></strong>   。</li>\n<li><strong>在 <code>package.json</code> 中明确设置 <code>sideEffects</code></strong>   ：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// 或精准标记副作用文件</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n<li><strong>确保代码是纯 ESM</strong>   （避免 <code>require</code> 和全局副作用）。</li>\n<li><strong>验证打包结果</strong>   （通过分析工具或检查输出代码）。</li>\n</ol>\n<hr>\n<h3><strong>总结</strong></h3>\n<ul>\n<li><strong>Webpack 生产模式默认尝试 Tree Shaking</strong>   ，但实际效果依赖代码结构和配置。</li>\n<li><strong>默认的 <code>sideEffects: true</code> 是安全保守的</strong>   ，可能让你误以为 Tree Shaking 没生效。</li>\n<li><strong>通过正确配置和代码规范，可以最大化 Tree Shaking 的效果</strong>   ，显著减少打包体积！ 🚀</li>\n</ul>\n</div>'</script></body></html>