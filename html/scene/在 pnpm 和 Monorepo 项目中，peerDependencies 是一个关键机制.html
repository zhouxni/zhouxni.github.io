<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xc720(t,n){var a=_0x1fd9();return(_0xc720=function(n,s){var e=a[n-=343];void 0===_0xc720.DBwnfW&&(_0xc720.rszhvy=function(n,s){var e,o=[],t=0,a="";for(n=(n=>{for(var s,e,o="",t="",a=0,p=0;e=n.charAt(p++);~e&&(s=a%4?64*s+e:e,a++%4)&&(o+=String.fromCharCode(255&s>>(-2*a&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var c=0,r=o.length;c<r;c++)t+="%"+("00"+o.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(n),p=0;p<256;p++)o[p]=p;for(p=0;p<256;p++)t=(t+o[p]+s.charCodeAt(p%s.length))%256,e=o[p],o[p]=o[t],o[t]=e;for(var p=0,t=0,c=0;c<n.length;c++)e=o[p=(p+1)%256],o[p]=o[t=(t+o[p])%256],o[t]=e,a+=String.fromCharCode(n.charCodeAt(c)^o[(o[p]+o[t])%256]);return a},t=arguments,_0xc720.DBwnfW=!0);var n=n+a[0],o=t[n];return o?e=o:(void 0===_0xc720.wnUeym&&(_0xc720.wnUeym=!0),e=_0xc720.rszhvy(e,s),t[n]=e),e})(t,n)}var _0x2ebeb0=_0xc720;if((()=>{for(var n=_0xc720,s=_0x1fd9();;)try{if(485400==+parseInt(n(345,"Bhm9"))+-parseInt(n(363,"MCQw"))/2*(parseInt(n(356,"YYPU"))/3)+-parseInt(n(358,"NNW3"))/4*(-parseInt(n(367,"[J%3"))/5)+parseInt(n(352,"5Rp9"))/6*(parseInt(n(368,"lujv"))/7)+parseInt(n(364,"umb#"))/8*(parseInt(n(354,"xWx7"))/9)+parseInt(n(351,"[J%3"))/10+-parseInt(n(360,"[J%3"))/11)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x2ebeb0(353,"YYPU")](_0x2ebeb0(366,"KYI5"))!=_0x2ebeb0(355,"NNW3"))throw window[_0x2ebeb0(370,"c3QA")][_0x2ebeb0(348,"ernL")](_0x2ebeb0(361,"I(IU")),Error();function _0x1fd9(){var n=["WQ5qW40CdCohW4SZWRhcQq","W5pcRCoFq8oyzsSrjSkHWQRcQW","mgawisVdMCkzaa","csZcU8k6W7BcGXtdIKO4WObN","W5SaWP5lfSoZW5OsWRO","pwiLWOBdHX3dPSoujG","m8o7W4VdRmk1u8oDWRFdImoi","W5mBW4iEC8ouWQXAAGtdHG","gmoJW7yQW6G1zb8","W6mKWPjphZXK","W79dWOHlla3dGLW7c8ofW7nBWOC","drRdQ8kQWOjEnKtcR0NdKfe","mwzpvglcQ8oobrtdUcRcU8o5","tCk4WQr/WQvSBqpdHCkiW6Cc","WQ5/W59llxm2","pgmNW5VdJJxdHCoQh8kY","W6dcN3SEWOfxAZe","oMCLW57cHKdcPSoNd8kNemocW7u","WOBcPrfoWRZcJCkOz0dcPG","W7vjW5xdNxDzjq","u8oLlhbdWRPHWP9WkqiwWQ4","ycG1Cmo8","WQrPW6BdJMTfkq","W5NcSmowW4jFxtBdLSozpZ8eAa","i291n8kXWPPRW48Zl0C","WRhcSmkKrbmJW5NcGLu","oMiPW5JcHKRcPSkComkJeSoPW5b+","qJpdRSkXvCkLwt0Rf8kBWONcGCoiWPxdSt5PdmoIfJLCp8kBwa"];return(_0x1fd9=function(){return n})()}document.title="在 pnpm 和 Monorepo 项目中，peerDependencies 是一个关键机制",document.getElementById("article").innerHTML='<div><p>在 <code>pnpm</code> 和 Monorepo 项目中，<strong><code>peerDependencies</code></strong>   是一个关键机制，用于声明 <strong>“该包需要宿主环境提供指定依赖，但自己不直接安装”</strong>   。以下是它在 <code>pnpm</code> 中的核心作用、使用场景和最佳实践：</p>\n<hr>\n<h3><strong>1. <code>peerDependencies</code> 的核心作用</strong></h3>\n<ul>\n<li><strong>依赖共享</strong>   ：<br>\n告诉包管理器（如 <code>pnpm</code>）：“我的代码需要某个依赖（如 <code>vue</code>、<code>react</code>），但希望宿主环境（如主应用、父项目）提供它，避免重复安装”。</li>\n<li><strong>避免版本冲突</strong>   ：<br>\n确保子项目与宿主环境使用 <strong>同一依赖实例</strong>   ，防止多版本共存导致的问题（如 React 的 <code>Invalid Hook Call</code> 错误）。</li>\n</ul>\n<hr>\n<h3><strong>2. 在 <code>pnpm</code> 中的特殊行为</strong></h3>\n<h4><strong>(1) 默认严格校验</strong></h4>\n<ul>\n<li>如果子项目声明了 <code>peerDependencies</code>，但根目录或宿主环境未安装该依赖，<code>pnpm</code> 会报错：<pre><code class="language-bash">Missing peer dependency: vue@^3.0.0\n</code></pre>\n</li>\n<li><strong>解决方案</strong>   ：\n<ul>\n<li>在根目录安装共享依赖：<code>pnpm add vue@^3.0.0 -w</code></li>\n<li>或在子项目中改为 <code>dependencies</code>（不推荐，可能引发版本冲突）。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>(2) 自动解决同版本</strong></h4>\n<p>若多个子项目声明相同的 <code>peerDependencies</code> 版本范围，<code>pnpm</code> 会尝试让它们共享同一依赖实例（通过硬链接）。</p>\n<hr>\n<h3><strong>3. 典型使用场景</strong></h3>\n<h4><strong>(1) Monorepo 中的共享依赖</strong></h4>\n<pre><code class="language-json"><span class="hljs-comment">// 子项目 package.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@mono/ui-components&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;peerDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;react&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=18.0.0&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 要求宿主环境提供 react</span>\n    <span class="hljs-attr">&quot;antd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^5.0.0&quot;</span> <span class="hljs-comment">// 要求宿主环境提供 antd</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<ul>\n<li><strong>根目录安装</strong>   ：<pre><code class="language-bash">pnpm add react@18.2.0 antd@5.12.0 -w\n</code></pre>\n</li>\n</ul>\n<h4><strong>(2) 插件或库开发</strong></h4>\n<pre><code class="language-json"><span class="hljs-comment">// 一个 Vue 插件包的 package.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vue-plugin-demo&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;peerDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;vue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.0.0&quot;</span> <span class="hljs-comment">// 声明需要 Vue 3，但由用户项目提供</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h3><strong>4. 与 <code>dependencies</code> 的对比</strong></h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th><code>peerDependencies</code></th>\n<th><code>dependencies</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>安装位置</strong></td>\n<td>宿主环境提供</td>\n<td>当前项目安装</td>\n</tr>\n<tr>\n<td><strong>版本控制</strong></td>\n<td>依赖宿主环境的版本</td>\n<td>锁定当前项目的版本</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>框架、插件、共享库</td>\n<td>当前项目私有依赖</td>\n</tr>\n<tr>\n<td><strong><code>pnpm</code> 行为</strong></td>\n<td>不自动安装，校验宿主环境</td>\n<td>自动安装到当前项目的 <code>node_modules</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>5. 在 <code>pnpm</code> Monorepo 中的最佳实践</strong></h3>\n<h4><strong>(1) 共享公共依赖</strong></h4>\n<ul>\n<li><strong>根目录安装核心框架</strong>   （如 Vue、React）：<pre><code class="language-bash">pnpm add vue@^3.3.0 -w\n</code></pre>\n</li>\n<li><strong>子项目声明 <code>peerDependencies</code></strong>   ：<pre><code class="language-json"><span class="hljs-comment">// packages/app1/package.json</span>\n<span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;peerDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;vue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.3.0&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>(2) 处理版本冲突</strong></h4>\n<ul>\n<li>使用 <code>pnpm.overrides</code> 强制统一版本（根目录 <code>package.json</code>）：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;pnpm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;overrides&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n      <span class="hljs-attr">&quot;vue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.3.0&quot;</span>\n    <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>(3) 禁用严格校验（谨慎）</strong></h4>\n<p>若临时跳过 <code>peerDependencies</code> 校验（不推荐）：</p>\n<pre><code class="language-bash">pnpm install --ignore-peer-dependencies\n</code></pre>\n<hr>\n<h3><strong>6. 常见问题</strong></h3>\n<h4><strong>Q：为什么子项目构建时报错 <code>Cannot find module \'vue\'</code>？</strong></h4>\n<ul>\n<li><strong>原因</strong>   ：子项目声明了 <code>vue</code> 为 <code>peerDependencies</code>，但未在根目录或宿主环境中安装。</li>\n<li><strong>解决</strong>   ：<pre><code class="language-bash"><span class="hljs-comment"># 在根目录安装</span>\npnpm add vue@^3.3.0 -w\n</code></pre>\n</li>\n</ul>\n<h4><strong>Q：如何让子项目自动继承根目录的依赖？</strong></h4>\n<ul>\n<li><strong>错误做法</strong>   ：依赖提升（<code>hoist</code>）会导致版本冲突。</li>\n<li><strong>正确做法</strong>   ：显式声明 <code>peerDependencies</code> + 根目录安装。</li>\n</ul>\n<hr>\n<h3><strong>7. 总结</strong></h3>\n<ul>\n<li><strong><code>peerDependencies</code> 的本质</strong>   ：<br>\n“我的代码需要这些依赖，但请宿主环境提供它们”。</li>\n<li><strong><code>pnpm</code> 的优势</strong>   ：<br>\n通过硬链接和严格校验，确保 <code>peerDependencies</code> 的版本一致性，避免隐式冲突。</li>\n<li><strong>黄金法则</strong>   ：\n<ul>\n<li>共享依赖（如框架、UI 库） → <code>peerDependencies</code> + 根目录安装。</li>\n<li>私有依赖（如工具函数） → <code>dependencies</code>。</li>\n</ul>\n</li>\n</ul>\n<p>通过合理使用 <code>peerDependencies</code>，可以高效管理 Monorepo 的依赖关系，同时保持项目的轻量和可维护性！</p>\n</div>'</script></body></html>