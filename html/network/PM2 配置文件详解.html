<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x51c6db=_0x3d60;if((()=>{for(var s=_0x3d60,n=_0x31d4();;)try{if(744083==-parseInt(s(438,"@zD%"))*(-parseInt(s(420,"1j^5"))/2)+parseInt(s(414,"z4Gh"))/3*(-parseInt(s(427,"MwyP"))/4)+parseInt(s(440,"iA*R"))/5+-parseInt(s(413,"uY(6"))/6+-parseInt(s(437,"H6]a"))/7*(parseInt(s(423,"@*5K"))/8)+-parseInt(s(435,"bPpr"))/9*(-parseInt(s(422,"bPpr"))/10)+-parseInt(s(430,"4ha["))/11*(-parseInt(s(424,"2Y5F"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x51c6db(421,"Fa5D")](_0x51c6db(432,"J*Z2"))!=_0x51c6db(439,"y(3N"))throw window[_0x51c6db(417,"Ls%#")][_0x51c6db(433,"Z1eH")](_0x51c6db(428,"2Y5F")),Error();function _0x3d60(o,s){var p=_0x31d4();return(_0x3d60=function(s,n){var t=p[s-=413];void 0===_0x3d60.yZZntc&&(_0x3d60.nVOAwv=function(s,n){var t,a=[],o=0,p="";for(s=(s=>{for(var n,t,a="",o="",p=0,l=0;t=s.charAt(l++);~t&&(n=p%4?64*n+t:t,p++%4)&&(a+=String.fromCharCode(255&n>>(-2*p&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var e=0,c=a.length;e<c;e++)o+="%"+("00"+a.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(o)})(s),l=0;l<256;l++)a[l]=l;for(l=0;l<256;l++)o=(o+a[l]+n.charCodeAt(l%n.length))%256,t=a[l],a[l]=a[o],a[o]=t;for(var l=0,o=0,e=0;e<s.length;e++)t=a[l=(l+1)%256],a[l]=a[o=(o+a[l])%256],a[o]=t,p+=String.fromCharCode(s.charCodeAt(e)^a[(a[l]+a[o])%256]);return p},o=arguments,_0x3d60.yZZntc=!0);var s=s+p[0],a=o[s];return a?t=a:(void 0===_0x3d60.iXbsmq&&(_0x3d60.iXbsmq=!0),t=_0x3d60.nVOAwv(t,n),o[s]=t),t})(o,s)}function _0x31d4(){var s=["W6HYvvtdHCo6W5hdLmol","nCoNW5ldGYr6gfzjktbdWRu","WQpcHh/dLvtdGcvSlvRcLW","WPZdG8ooWOqDW7bFW7/cHSk+","W5ddNepdSSoFWQNcTq","W4T2xmoKs8o2W5i7","W6bxW65FWOToCCk4WPLgWRe","BbJdNCkDW6GaWQ/cSCoKW58","Amk4tISgWPtcNW","cmkFs8kYW7pcLay","WQtdMmkNoSkBWQCGW4ZcNhC","W5pcLGVcK8kVW7dcUYzBqmkhWOG","E8o9qvDmybmDda","smopA2SslmofeWOaamotxW","xSocdCkZW5dcNHSBWRC","WR3dR8kybSk3tmoQEW","jSk8b0LzhKz9pNNdVgVcLmkWWONdI8oQkCk7CgX7ob9uDq","u8k8W4DtpSkIWOpcUM7cMJnZ","emkEWO3cUmo1hCoQWO/dQ8keW7G","WPT0dSogw3f+WRm","W6WVk8oTFffeWQpdOW","WQ8If1BdGSoDW44","AXZdNCkFWRjmW6RcJSobW5tdQqJcVq","WQtdL8kMoCkLWPeDW4xcMxK","WRpdHv7dIHVdLmk5zhddMCozW7W","W6PEW6ddNSkqtCkyydm","lxTfWQ4ijmotW6BdSSkgjmkF","DtpcIgWO","WPJdJSomWOv/WOOHW5NcNmkBW6tcL3C","WOGMWPqUW5RcL317wmoPAG"];return(_0x31d4=function(){return s})()}document.title="PM2 配置文件详解",document.getElementById("article").innerHTML='<div><p>PM2 是 Node.js 应用的生产级进程管理器，通过配置文件可以精细控制应用运行方式。以下是 PM2 配置文件的全面解析：</p>\n<h2>1. 基础配置文件结构</h2>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">apps</span>: [{\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;app&quot;</span>,             <span class="hljs-comment">// 应用名称</span>\n    <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;./app.js&quot;</span>,      <span class="hljs-comment">// 入口文件</span>\n    <span class="hljs-attr">instances</span>: <span class="hljs-string">&quot;max&quot;</span>,        <span class="hljs-comment">// 实例数量</span>\n    <span class="hljs-attr">exec_mode</span>: <span class="hljs-string">&quot;cluster&quot;</span>,    <span class="hljs-comment">// 集群模式</span>\n    <span class="hljs-attr">env</span>: {                  <span class="hljs-comment">// 环境变量</span>\n      <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;development&quot;</span>\n    },\n    <span class="hljs-attr">env_production</span>: {       <span class="hljs-comment">// 生产环境变量</span>\n      <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;production&quot;</span>\n    }\n  }]\n}\n</code></pre>\n<h2>2. 核心配置项详解</h2>\n<h3>应用配置</h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>说明</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>name</code></td>\n<td>应用名称</td>\n<td><code>&quot;my-app&quot;</code></td>\n</tr>\n<tr>\n<td><code>script</code></td>\n<td>启动脚本路径</td>\n<td><code>&quot;./server.js&quot;</code></td>\n</tr>\n<tr>\n<td><code>args</code></td>\n<td>传递给脚本的参数</td>\n<td><code>[&quot;--port&quot;, &quot;3000&quot;]</code></td>\n</tr>\n<tr>\n<td><code>interpreter</code></td>\n<td>解释器</td>\n<td><code>&quot;node@14.17.0&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<h3>实例管理</h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>说明</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>instances</code></td>\n<td>实例数量</td>\n<td><code>4</code> 或 <code>&quot;max&quot;</code></td>\n</tr>\n<tr>\n<td><code>exec_mode</code></td>\n<td>执行模式</td>\n<td><code>&quot;cluster&quot;</code>/<code>&quot;fork&quot;</code></td>\n</tr>\n<tr>\n<td><code>watch</code></td>\n<td>文件变化重启</td>\n<td><code>true</code>/<code>false</code></td>\n</tr>\n<tr>\n<td><code>ignore_watch</code></td>\n<td>忽略监控的文件</td>\n<td><code>[&quot;node_modules&quot;]</code></td>\n</tr>\n</tbody>\n</table>\n<h3>资源控制</h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>说明</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>max_memory_restart</code></td>\n<td>内存限制重启</td>\n<td><code>&quot;500M&quot;</code></td>\n</tr>\n<tr>\n<td><code>cron_restart</code></td>\n<td>定时重启</td>\n<td><code>&quot;0 3 * * *&quot;</code></td>\n</tr>\n<tr>\n<td><code>restart_delay</code></td>\n<td>重启延迟(ms)</td>\n<td><code>5000</code></td>\n</tr>\n</tbody>\n</table>\n<h3>日志管理</h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>说明</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>log_date_format</code></td>\n<td>日志时间格式</td>\n<td><code>&quot;YYYY-MM-DD HH:mm&quot;</code></td>\n</tr>\n<tr>\n<td><code>error_file</code></td>\n<td>错误日志路径</td>\n<td><code>&quot;./logs/err.log&quot;</code></td>\n</tr>\n<tr>\n<td><code>out_file</code></td>\n<td>标准输出日志路径</td>\n<td><code>&quot;./logs/out.log&quot;</code></td>\n</tr>\n<tr>\n<td><code>merge_logs</code></td>\n<td>合并日志</td>\n<td><code>true</code></td>\n</tr>\n<tr>\n<td><code>log_type</code></td>\n<td>日志类型</td>\n<td><code>&quot;json&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<h2>3. 高级配置</h2>\n<h3>环境变量管理</h3>\n<pre><code class="language-javascript"><span class="hljs-attr">env</span>: {\n  <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;development&quot;</span>,\n  <span class="hljs-attr">PORT</span>: <span class="hljs-number">3000</span>\n},\n<span class="hljs-attr">env_production</span>: {\n  <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;production&quot;</span>,\n  <span class="hljs-attr">PORT</span>: <span class="hljs-number">80</span>\n}\n</code></pre>\n<h3>集群配置</h3>\n<pre><code class="language-javascript"><span class="hljs-attr">instances</span>: <span class="hljs-string">&quot;max&quot;</span>,           <span class="hljs-comment">// 使用所有CPU核心</span>\n<span class="hljs-attr">exec_mode</span>: <span class="hljs-string">&quot;cluster&quot;</span>,       <span class="hljs-comment">// 集群模式</span>\n<span class="hljs-attr">instance_var</span>: <span class="hljs-string">&quot;INSTANCE_ID&quot;</span> <span class="hljs-comment">// 实例环境变量名</span>\n</code></pre>\n<h3>健康检查</h3>\n<pre><code class="language-javascript"><span class="hljs-attr">listen_timeout</span>: <span class="hljs-number">8000</span>,       <span class="hljs-comment">// 应用启动超时(ms)</span>\n<span class="hljs-attr">wait_ready</span>: <span class="hljs-literal">true</span>,           <span class="hljs-comment">// 等待ready信号</span>\n<span class="hljs-attr">kill_timeout</span>: <span class="hljs-number">10000</span>         <span class="hljs-comment">// 优雅退出超时</span>\n</code></pre>\n<h2>4. 完整配置示例</h2>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">apps</span>: [{\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;api-server&quot;</span>,\n    <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;./src/server.js&quot;</span>,\n    <span class="hljs-attr">args</span>: <span class="hljs-string">&quot;--port 8080&quot;</span>,\n    \n    <span class="hljs-comment">// 集群模式</span>\n    <span class="hljs-attr">instances</span>: <span class="hljs-number">4</span>,\n    <span class="hljs-attr">exec_mode</span>: <span class="hljs-string">&quot;cluster&quot;</span>,\n    \n    <span class="hljs-comment">// 环境变量</span>\n    <span class="hljs-attr">env</span>: {\n      <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;development&quot;</span>,\n      <span class="hljs-attr">DEBUG</span>: <span class="hljs-string">&quot;app:*&quot;</span>\n    },\n    <span class="hljs-attr">env_production</span>: {\n      <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&quot;production&quot;</span>,\n      <span class="hljs-attr">DATABASE_URL</span>: <span class="hljs-string">&quot;postgres://user:pass@host:5432/db&quot;</span>\n    },\n    \n    <span class="hljs-comment">// 资源限制</span>\n    <span class="hljs-attr">max_memory_restart</span>: <span class="hljs-string">&quot;1G&quot;</span>,\n    <span class="hljs-attr">max_restarts</span>: <span class="hljs-number">10</span>,\n    \n    <span class="hljs-comment">// 日志配置</span>\n    <span class="hljs-attr">log_date_format</span>: <span class="hljs-string">&quot;YYYY-MM-DD HH:mm Z&quot;</span>,\n    <span class="hljs-attr">error_file</span>: <span class="hljs-string">&quot;/var/log/api/err.log&quot;</span>,\n    <span class="hljs-attr">out_file</span>: <span class="hljs-string">&quot;/var/log/api/out.log&quot;</span>,\n    <span class="hljs-attr">merge_logs</span>: <span class="hljs-literal">true</span>,\n    \n    <span class="hljs-comment">// 高级选项</span>\n    <span class="hljs-attr">watch</span>: <span class="hljs-literal">false</span>,\n    <span class="hljs-attr">ignore_watch</span>: [<span class="hljs-string">&quot;node_modules&quot;</span>, <span class="hljs-string">&quot;*.log&quot;</span>],\n    <span class="hljs-attr">autorestart</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">restart_delay</span>: <span class="hljs-number">5000</span>,\n    <span class="hljs-attr">min_uptime</span>: <span class="hljs-string">&quot;10s&quot;</span>,\n    \n    <span class="hljs-comment">// 监控</span>\n    <span class="hljs-attr">vizion</span>: <span class="hljs-literal">true</span>\n  }, {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;worker&quot;</span>,\n    <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;./worker.js&quot;</span>,\n    <span class="hljs-attr">instances</span>: <span class="hljs-number">2</span>\n  }]\n}\n</code></pre>\n<h2>5. 使用技巧</h2>\n<h3>多应用配置</h3>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">apps</span>: [\n    { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;web&quot;</span>, <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;web.js&quot;</span> },\n    { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;worker&quot;</span>, <span class="hljs-attr">script</span>: <span class="hljs-string">&quot;worker.js&quot;</span> }\n  ]\n}\n</code></pre>\n<h3>环境特定配置</h3>\n<pre><code class="language-sh">pm2 start ecosystem.config.js --<span class="hljs-built_in">env</span> production\n</code></pre>\n<h3>常用命令</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 启动配置</span>\npm2 start ecosystem.config.js\n\n<span class="hljs-comment"># 查看列表</span>\npm2 list\n\n<span class="hljs-comment"># 监控资源</span>\npm2 monit\n\n<span class="hljs-comment"># 查看日志</span>\npm2 logs\n\n<span class="hljs-comment"># 重启所有应用</span>\npm2 restart all\n\n<span class="hljs-comment"># 删除应用</span>\npm2 delete app-name\n</code></pre>\n<h2>6. 最佳实践</h2>\n<ol>\n<li><strong>为生产环境单独配置</strong>  ：使用<code>env_production</code>区分环境变量</li>\n<li><strong>限制资源使用</strong>  ：设置<code>max_memory_restart</code>防止内存泄漏</li>\n<li><strong>合理配置日志</strong>  ：使用日志轮转避免磁盘占满</li>\n<li><strong>使用集群模式</strong>  ：充分利用多核CPU性能</li>\n<li><strong>设置监控</strong>  ：配合<code>pm2 monit</code>实时观察应用状态</li>\n</ol>\n<p>PM2 的配置文件提供了对 Node.js 应用的精细控制，合理配置可以显著提高应用的稳定性和性能。</p>\n</div>'</script></body></html>