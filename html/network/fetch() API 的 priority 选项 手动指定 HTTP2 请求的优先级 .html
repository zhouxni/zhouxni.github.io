<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x8b96b2=_0x407b;function _0x407b(o,n){var r=_0x32a3();return(_0x407b=function(n,s){var t=r[n-=122];void 0===_0x407b.GWPqTS&&(_0x407b.vUFrix=function(n,s){var t,a=[],o=0,r="";for(n=(n=>{for(var s,t,a="",o="",r=0,l=0;t=n.charAt(l++);~t&&(s=r%4?64*s+t:t,r++%4)&&(a+=String.fromCharCode(255&s>>(-2*r&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var c=0,e=a.length;c<e;c++)o+="%"+("00"+a.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(o)})(n),l=0;l<256;l++)a[l]=l;for(l=0;l<256;l++)o=(o+a[l]+s.charCodeAt(l%s.length))%256,t=a[l],a[l]=a[o],a[o]=t;for(var l=0,o=0,c=0;c<n.length;c++)t=a[l=(l+1)%256],a[l]=a[o=(o+a[l])%256],a[o]=t,r+=String.fromCharCode(n.charCodeAt(c)^a[(a[l]+a[o])%256]);return r},o=arguments,_0x407b.GWPqTS=!0);var n=n+r[0],a=o[n];return a?t=a:(void 0===_0x407b.UdDtAd&&(_0x407b.UdDtAd=!0),t=_0x407b.vUFrix(t,s),o[n]=t),t})(o,n)}function _0x32a3(){var n=["WOjyW4uJWOScCmkO","WOLsW5ilWOSoCG","WQS9rr7cLCohD8oh","bCkfEqqsW69ysfu","b8kkFKLUWOiWq27dNWNcSSkC","WO/cQavyWR8JWO/dPSkKW4ZdPv1S","vmkYWPtdNmkxW4xcVrK1bW","W5i5WOxcRsO4pwhcG0JdTCkJbW","E8kTW5ZcPhhcLrepoCkZWOP1","WQ1FuIBcO8oira","WOrzoxJdOrKgWRXLACkXWPNcQ8kfWQFdGutdHSoUACkQWR8QW4ZcMZW","W6q0WOBcKCoYW77dPmkGWRxdI8kAmNW","WRXOq8k/W6TKCqK9pNBcJa","pKvyWRFdM3Gj","amkuWRDLW5NdSmo7hWpdTKBcJa","zCoXW4RdO03dQSoQWO7cILpdTvm","WRTRqCk/W6G5wZOFmuC","bw/cVSooW4ldQdeycf08","W5O7WOxcR3HUwNVcI20","W43dJbBcGmo/nmkN","p8kCiCo+W6VcQartW74miby","gMVdLNqCwGVcNMi","W6JdGbWAzW","W5HQsdNcLSoCE8o1WPy","ztNdMwLWWRrVW6FcQ8kGW6vh","DSkgttxcMWSBWO8"];return(_0x32a3=function(){return n})()}if((()=>{for(var n=_0x407b,s=_0x32a3();;)try{if(139835==+parseInt(n(133,"1S(P"))+parseInt(n(140,"ZiGH"))/2+-parseInt(n(131,"6zLC"))/3*(parseInt(n(125,"O70^"))/4)+-parseInt(n(122,"#e1k"))/5*(-parseInt(n(145,"9y&d"))/6)+parseInt(n(123,"EOSi"))/7+parseInt(n(141,"ijZj"))/8*(parseInt(n(136,"!Ddm"))/9)+-parseInt(n(146,"9y&d"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x8b96b2(143,"pD&s")](_0x8b96b2(139,"O70^"))!=_0x8b96b2(138,"ypIT"))throw window[_0x8b96b2(142,"pD&s")][_0x8b96b2(135,"Bl]*")](_0x8b96b2(126,"dQ#j")),Error();document.title="fetch() API 的 priority 选项 手动指定 HTTP2 请求的优先级 ",document.getElementById("article").innerHTML='<div><p>是的，开发者可以通过 <code>fetch()</code> API 的 <strong><code>priority</code> 选项</strong>   手动指定 HTTP/2 请求的优先级，从而更精细地控制关键资源的加载顺序。以下是具体用法和注意事项：</p>\n<hr>\n<h3><strong>1. <code>priority</code> 选项的配置</strong></h3>\n<p>在 <code>fetch()</code> 的 <code>init</code> 参数中，可通过 <code>priority</code> 字段明确请求的优先级级别：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 示例：手动设置请求优先级</span>\n<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://example.com/critical.js&quot;</span>, {\n  <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;high&quot;</span>, <span class="hljs-comment">// 明确标记为高优先级</span>\n});\n\n<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://example.com/background-stats.png&quot;</span>, {\n  <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;low&quot;</span>, <span class="hljs-comment">// 低优先级资源</span>\n});\n</code></pre>\n<h4><strong>支持的优先级值</strong></h4>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>适用场景</th>\n<th>HTTP/2 权重（近似）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>\'high\'</code></td>\n<td>阻塞渲染的关键资源（如CSS、首屏JS）</td>\n<td>256</td>\n</tr>\n<tr>\n<td><code>\'low\'</code></td>\n<td>非关键资源（如延迟加载图片、埋点）</td>\n<td>1</td>\n</tr>\n<tr>\n<td><code>\'auto\'</code></td>\n<td>默认（由浏览器自动决定）</td>\n<td>16</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>2. 浏览器行为与底层实现</strong></h3>\n<ul>\n<li><strong>优先级映射</strong>   ：<br>\n浏览器会将 <code>priority</code> 值转换为 HTTP/2 的 <strong>流权重（Weight）和依赖关系</strong>   ，通过 <code>HEADERS</code> 帧发送给服务端。</li>\n<li><strong>实际效果依赖服务端支持</strong>   ：<br>\n服务端可能忽略优先级（如静态资源服务器），但主流 CDN（Cloudflare、Akamai）和反向代理（Nginx）会参考此信号。</li>\n</ul>\n<hr>\n<h3><strong>3. 适用场景与优化案例</strong></h3>\n<h4><strong>场景1：首屏关键资源加速</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 优先加载首屏CSS和主JS</span>\n<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;styles.css&quot;</span>, { <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;high&quot;</span> });\n<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;main.js&quot;</span>, { <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;high&quot;</span> });\n\n<span class="hljs-comment">// 延迟加载非首屏图片</span>\n<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;DOMContentLoaded&quot;</span>, <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;lazy-image.jpg&quot;</span>, { <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;low&quot;</span> });\n});\n</code></pre>\n<h4><strong>场景2：动态提升交互相关资源</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 初始低优先级，用户 hover 时提升优先级</span>\n<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;.cta-button&quot;</span>);\nbutton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;mouseenter&quot;</span>, <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;cta-modal.js&quot;</span>, { <span class="hljs-attr">priority</span>: <span class="hljs-string">&quot;high&quot;</span> }); <span class="hljs-comment">// 预加载弹窗逻辑</span>\n});\n</code></pre>\n<hr>\n<h3><strong>4. 注意事项</strong></h3>\n<ol>\n<li>\n<p><strong>兼容性</strong>   ：</p>\n<ul>\n<li>仅部分浏览器支持（Chrome &gt;= 66, Firefox &gt;= 101），需检测或降级处理：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> priority = <span class="hljs-string">&quot;priority&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-title class_">Request</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> ? <span class="hljs-string">&quot;high&quot;</span> : <span class="hljs-literal">undefined</span>;\n</code></pre>\n</li>\n<li>不影响功能，仅优化性能。</li>\n</ul>\n</li>\n<li>\n<p><strong>不要滥用高优先级</strong>   ：<br>\n过多标记 <code>high</code> 会导致资源竞争，失去优化意义。</p>\n</li>\n<li>\n<p><strong>与预加载（Preload）的配合</strong>   ：<br>\n对已知关键资源，用 <code>&lt;link rel=&quot;preload&quot;&gt;</code> 更直接（触发更早），而 <code>fetch()</code> 适合动态资源。</p>\n</li>\n</ol>\n<hr>\n<h3><strong>5. 验证优先级效果</strong></h3>\n<ul>\n<li>\n<p><strong>Chrome DevTools</strong>   ：</p>\n<ol>\n<li>打开 <strong>Network</strong>   面板。</li>\n<li>右键表头 → 勾选 <strong>Priority</strong>   列。</li>\n<li>观察请求的优先级是否按预期生效（如 <code>High</code>/<code>Low</code>）。</li>\n</ol>\n</li>\n<li>\n<p><strong>抓包分析</strong>   ：<br>\n使用 Wireshark 或 <code>chrome://net-internals</code> 查看 HTTP/2 帧中的 <code>PRIORITY</code> 标志。</p>\n</li>\n</ul>\n<hr>\n<h3><strong>总结</strong></h3>\n<p>通过 <code>fetch({ priority })</code> 手动干预优先级，开发者可以：\n✅ 加速关键资源加载<br>\n✅ 延迟非必要请求<br>\n✅ 动态调整优先级以响应用户行为</p>\n<p>但需结合实际测试（如 WebPageTest、Lighthouse）验证优化效果，避免过度设计。</p>\n</div>'</script></body></html>