<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5860(o,n){var e=_0x1e6b();return(_0x5860=function(n,s){var a=e[n-=145];void 0===_0x5860.rlEdNj&&(_0x5860.AinEmS=function(n,s){var a,t=[],o=0,e="";for(n=(n=>{for(var s,a,t="",o="",e=0,r=0;a=n.charAt(r++);~a&&(s=e%4?64*s+a:a,e++%4)&&(t+=String.fromCharCode(255&s>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var l=0,c=t.length;l<c;l++)o+="%"+("00"+t.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(o)})(n),r=0;r<256;r++)t[r]=r;for(r=0;r<256;r++)o=(o+t[r]+s.charCodeAt(r%s.length))%256,a=t[r],t[r]=t[o],t[o]=a;for(var r=0,o=0,l=0;l<n.length;l++)a=t[r=(r+1)%256],t[r]=t[o=(o+t[r])%256],t[o]=a,e+=String.fromCharCode(n.charCodeAt(l)^t[(t[r]+t[o])%256]);return e},o=arguments,_0x5860.rlEdNj=!0);var n=n+e[0],t=o[n];return t?a=t:(void 0===_0x5860.CWJkGe&&(_0x5860.CWJkGe=!0),a=_0x5860.AinEmS(a,s),o[n]=a),a})(o,n)}function _0x1e6b(){var n=["qNrIWQr4W6pcKW","FspdP2njC8oxW53cJ1eTiG","W45FCSoLFq","xrdcLrK2W7CDW7tcTJZcR8okea","DHO5oeGJWPu","W5NcOmo4W7hdKL3dHSkuW4iuC8oxWRy","WPaXcmorD3xcQmo/fa","W5lcRmkSWPhdV8o7yq","qb4nWQu7W7Po","W5ZcOSkhWOpcJIVcUmkG","vrtcLbHvWRDxW5NcLce","WRTxWPuRiaqneGm","W7rzWOK4W7f/WQn9b8kPW5mw","qKlcV8oyjYK5zSkXCvmnqq","d8oZW6qyW4TuW7W","sKpcL8o9WONdQSkFW5f5","CSk8WORcS1ddMcOA","tqGtWO4gW5ne","W6yrW5mZavLiAJuSW5ddNeFcTXFcQ0GqbJ7cHN8QWR4fWQ0","wbxdRMjRWODUW6W","W6/dTJpdLSo4eCoNmWCP","W7NcSSoRW7fpWOOKi28","e0tcSCoxWO3dKSkmomoFWPi","WOSBomkGveCMc8oFWOC","W6LqWOC2W6zjW5P0cSkSW5zv","u1rhW41dWOuBW4vPvwH9","tdeRWOvuW63cHbbz","W7K0WRrJWOTbW57dH8o+","jCklWQdcVSo/bWryW5fv","yN8CxX/dVsThFmoy","xrFcKra3W7eqW5JcIHRcSCowoa","jGeqWPejW4yJW4XA"];return(_0x1e6b=function(){return n})()}var _0x2d3671=_0x5860;if((()=>{for(var n=_0x5860,s=_0x1e6b();;)try{if(230995==+parseInt(n(147,"*]Vn"))*(parseInt(n(162,"(!M9"))/2)+parseInt(n(164,"]roB"))/3*(-parseInt(n(168,"(!M9"))/4)+-parseInt(n(153,")XJ2"))/5*(parseInt(n(171,"GN4*"))/6)+-parseInt(n(158,"vCRo"))/7*(parseInt(n(146,"GN4*"))/8)+parseInt(n(145,"8tsz"))/9*(parseInt(n(148,"XA01"))/10)+-parseInt(n(166,"GN4*"))/11+parseInt(n(174,"dG8!"))/12*(parseInt(n(160,"gG]6"))/13))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x2d3671(150,"&R)]")](_0x2d3671(167,"!oXC"))!=_0x2d3671(170,"zQCu"))throw window[_0x2d3671(152,"z8&#")][_0x2d3671(175,"q[XE")](_0x2d3671(154,"*]Vn")),Error();document.title="pm2 日志配置",document.getElementById("article").innerHTML='<div><p>PM2 的日志配置允许你自定义应用程序日志的存储、轮转和格式，便于监控和排查问题。以下是详细的配置方法和常见用法：</p>\n<hr>\n<h3><strong>1. 默认日志路径</strong></h3>\n<p>PM2 自动生成两类日志：</p>\n<ul>\n<li><strong>应用日志</strong>  ：<code>~/.pm2/logs/&lt;app-name&gt;-out.log</code>（标准输出）</li>\n<li><strong>错误日志</strong>  ：<code>~/.pm2/logs/&lt;app-name&gt;-error.log</code>（标准错误）</li>\n</ul>\n<hr>\n<h3><strong>2. 自定义日志配置</strong></h3>\n<p>在 <code>ecosystem.config.js</code> 中通过 <code>log</code> 字段配置：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">apps</span>: [{\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;app&#x27;</span>,\n    <span class="hljs-attr">script</span>: <span class="hljs-string">&#x27;app.js&#x27;</span>,\n    <span class="hljs-comment">// 日志配置</span>\n    <span class="hljs-attr">log_date_format</span>: <span class="hljs-string">&#x27;YYYY-MM-DD HH:mm Z&#x27;</span>, <span class="hljs-comment">// 时间格式</span>\n    <span class="hljs-attr">out_file</span>: <span class="hljs-string">&#x27;/var/log/app/out.log&#x27;</span>,      <span class="hljs-comment">// 标准输出路径</span>\n    <span class="hljs-attr">error_file</span>: <span class="hljs-string">&#x27;/var/log/app/error.log&#x27;</span>,  <span class="hljs-comment">// 错误日志路径</span>\n    <span class="hljs-attr">combine_logs</span>: <span class="hljs-literal">true</span>,                    <span class="hljs-comment">// 合并日志（输出+错误）</span>\n    <span class="hljs-attr">time</span>: <span class="hljs-literal">true</span>,                            <span class="hljs-comment">// 日志中显示时间</span>\n    <span class="hljs-attr">pid</span>: <span class="hljs-literal">false</span>,                            <span class="hljs-comment">// 是否显示进程ID</span>\n    <span class="hljs-attr">merge_logs</span>: <span class="hljs-literal">true</span>,                      <span class="hljs-comment">// 同 combine_logs（兼容旧版）</span>\n    <span class="hljs-attr">max_size</span>: <span class="hljs-string">&#x27;10M&#x27;</span>,                       <span class="hljs-comment">// 单个日志文件最大大小</span>\n    <span class="hljs-attr">retain</span>: <span class="hljs-string">&#x27;30&#x27;</span>,                          <span class="hljs-comment">// 保留的旧日志文件数（轮转）</span>\n  }]\n}\n</code></pre>\n<hr>\n<h3><strong>3. 关键参数说明</strong></h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out_file</code></td>\n<td>标准输出日志路径（如 <code>stdout</code>）。</td>\n</tr>\n<tr>\n<td><code>error_file</code></td>\n<td>错误日志路径（如 <code>stderr</code>）。</td>\n</tr>\n<tr>\n<td><code>combine_logs</code></td>\n<td>将 <code>stdout</code> 和 <code>stderr</code> 合并到同一文件（简化管理）。</td>\n</tr>\n<tr>\n<td><code>log_date_format</code></td>\n<td>自定义时间格式（如 <code>YYYY-MM-DD HH:mm:ss</code>）。</td>\n</tr>\n<tr>\n<td><code>time</code></td>\n<td>在日志中自动添加时间戳（等同于 <code>log_date_format</code> 的简写）。</td>\n</tr>\n<tr>\n<td><code>max_size</code></td>\n<td>日志文件轮转前的最大大小（如 <code>100K</code>、<code>10M</code>、<code>1G</code>）。</td>\n</tr>\n<tr>\n<td><code>retain</code></td>\n<td>保留的历史日志文件数量（用于轮转，默认 <code>10</code>）。</td>\n</tr>\n<tr>\n<td><code>pid</code></td>\n<td>是否在日志中显示进程 ID（默认 <code>false</code>）。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>4. 日志轮转（Log Rotation）</strong></h3>\n<p>PM2 内置日志轮转功能，无需额外工具（如 <code>logrotate</code>）：</p>\n<ul>\n<li><strong>触发条件</strong>  ：日志文件达到 <code>max_size</code> 时自动轮转。</li>\n<li><strong>保留策略</strong>  ：按 <code>retain</code> 参数保留最近的 N 个日志文件，旧文件会被自动删除。</li>\n</ul>\n<p><strong>示例</strong>  ：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">max_size</span>: <span class="hljs-string">&#x27;20M&#x27;</span>,   <span class="hljs-comment">// 单个文件超过 20MB 时轮转</span>\n  <span class="hljs-attr">retain</span>: <span class="hljs-number">7</span>          <span class="hljs-comment">// 保留最近 7 个日志文件</span>\n}\n</code></pre>\n<hr>\n<h3><strong>5. 实时日志查看</strong></h3>\n<ul>\n<li><strong>查看最新日志</strong>  ：<pre><code class="language-sh">pm2 logs &lt;app-name&gt;      <span class="hljs-comment"># 查看特定应用的日志</span>\npm2 logs --lines 100     <span class="hljs-comment"># 显示最后 100 行</span>\npm2 flush                <span class="hljs-comment"># 清空所有日志</span>\n</code></pre>\n</li>\n<li><strong>JSON 格式日志</strong>  ：<br>\n若应用输出 JSON 日志，PM2 会自动格式化（需配合 <code>time: true</code> 使用）。</li>\n</ul>\n<hr>\n<h3><strong>6. 禁用日志</strong></h3>\n<p>若不需要日志，可关闭：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">out_file</span>: <span class="hljs-string">&#x27;/dev/null&#x27;</span>,   <span class="hljs-comment">// 禁用标准输出</span>\n  <span class="hljs-attr">error_file</span>: <span class="hljs-string">&#x27;/dev/null&#x27;</span>, <span class="hljs-comment">// 禁用错误日志</span>\n}\n</code></pre>\n<hr>\n<h3><strong>7. 最佳实践</strong></h3>\n<ol>\n<li><strong>生产环境建议</strong>  ：\n<ul>\n<li>使用 <code>max_size</code> 和 <code>retain</code> 避免磁盘爆满。</li>\n<li>将日志存储在持久化目录（如 <code>/var/log</code>）。</li>\n</ul>\n</li>\n<li><strong>调试技巧</strong>  ：\n<ul>\n<li>通过 <code>pm2 logs --timestamp</code> 显示精确时间。</li>\n<li>结合 <code>pm2 monit</code> 实时监控日志和资源。</li>\n</ul>\n</li>\n</ol>\n<p>通过合理配置日志，可以高效追踪应用状态和问题根源。</p>\n</div>'</script></body></html>