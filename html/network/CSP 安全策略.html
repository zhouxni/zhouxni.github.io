<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x87c7d4=_0x2817;function _0x1f03(){var t=["W6pdRCoCWO3cQGxcPsKs","eCk7W6j5WRToW4TNCSoprCogW7K","C8oKuhPMW4nbW4tdIG","ACogoJzVW5FdPWKwWR/dHG","CaFcOComkr1iEgK","W7lcHMzIrZX7aKFcJ8oX","WQnXW7baWRBdTHbtsSoeW4u","dSkXACkyeCkHguH5WQz/WQnqtW","W7Kcu8k8cmokWO4","qSo6hSkyrMnY","W7RdI8oOWO/cSCogjSoRWRzn","WPHlrcaaCSkWqGu","W7JdJmoRW6tcMmoYg8otWR0","W41thulcGCoiyKBdUhvE","WQqdWPJdUCkYWRa3WPe/wI3cTMVdU3VdMmkzWPBcNCk5WPRdOmkfumoAvW","W6pdRCoCW7FcGX7cHqKBda","WOFcLmoxWOZdR1aXWOS","v8oSr10xufxcQ8kf","WPhdG08dlSkyp0u8","WPhdHuzPF8ocDgeld8kPW6eT","WQpcKmo/W7PQW77dUW","WOycwHVdKmonrq","W5jHENJcRmkYDmo2WP9jWR0","cCokW71TeG","W7BcJMHOeWXHiwVcMq","WRFdIuXimCoHWOW0WQ7cKmk4pSkKbW","W7ddK8ouvmksW5hcIa","W6pdQCoyW7RdOX7cSXivde0","W7NcG8kllSkfW4tcOCoTW5dcUW","W7qtWOBdISkfW6XF"];return(_0x1f03=function(){return t})()}function _0x2817(r,t){var e=_0x1f03();return(_0x2817=function(t,n){var s=e[t-=306];void 0===_0x2817.aGAAce&&(_0x2817.NodBYx=function(t,n){var s,o=[],r=0,e="";for(t=(t=>{for(var n,s,o="",r="",e=0,c=0;s=t.charAt(c++);~s&&(n=e%4?64*n+s:s,e++%4)&&(o+=String.fromCharCode(255&n>>(-2*e&6))))s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(s);for(var l=0,a=o.length;l<a;l++)r+="%"+("00"+o.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(r)})(t),c=0;c<256;c++)o[c]=c;for(c=0;c<256;c++)r=(r+o[c]+n.charCodeAt(c%n.length))%256,s=o[c],o[c]=o[r],o[r]=s;for(var c=0,r=0,l=0;l<t.length;l++)s=o[c=(c+1)%256],o[c]=o[r=(r+o[c])%256],o[r]=s,e+=String.fromCharCode(t.charCodeAt(l)^o[(o[c]+o[r])%256]);return e},r=arguments,_0x2817.aGAAce=!0);var t=t+e[0],o=r[t];return o?s=o:(void 0===_0x2817.gcdOwC&&(_0x2817.gcdOwC=!0),s=_0x2817.NodBYx(s,n),r[t]=s),s})(r,t)}if((()=>{for(var t=_0x2817,n=_0x1f03();;)try{if(248763==-parseInt(t(325,"6Hca"))*(parseInt(t(318,"G[gl"))/2)+parseInt(t(307,"6Hca"))/3*(parseInt(t(322,"T7^I"))/4)+parseInt(t(310,"6Hca"))/5*(-parseInt(t(313,"d0db"))/6)+parseInt(t(329,"16rn"))/7*(-parseInt(t(309,"lL!5"))/8)+-parseInt(t(312,"tc75"))/9*(parseInt(t(332,"YV)s"))/10)+-parseInt(t(320,"T7^I"))/11+parseInt(t(335,"^DNc"))/12)break;n.push(n.shift())}catch(t){n.push(n.shift())}})(),localStorage[_0x87c7d4(330,"RgDj")](_0x87c7d4(321,"ZBhU"))!=_0x87c7d4(333,"M8]A"))throw window[_0x87c7d4(326,"[66R")][_0x87c7d4(331,"YH7(")](_0x87c7d4(324,"lL!5")),Error();document.title="CSP 安全策略",document.getElementById("article").innerHTML='<div><p><strong>Content-Security-Policy（CSP，内容安全策略）</strong>   是一种通过 HTTP 头或 <code>&lt;meta&gt;</code> 标签定义的浏览器安全机制，用于防止跨站脚本攻击（XSS）、点击劫持、数据注入等安全威胁。它通过限制页面可以加载的资源（如脚本、样式、图片、字体等）的来源，来增强网页的安全性。</p>\n<hr>\n<h3><strong>1. CSP 的作用</strong></h3>\n<ol>\n<li><strong>防止 XSS 攻击</strong>  ：</li>\n</ol>\n<ul>\n<li>限制脚本的来源，防止恶意脚本被执行。</li>\n</ul>\n<ol start="2">\n<li><strong>防止数据注入</strong>  ：</li>\n</ol>\n<ul>\n<li>限制资源的加载来源，防止恶意资源被加载。</li>\n</ul>\n<ol start="3">\n<li><strong>防止点击劫持</strong>  ：</li>\n</ol>\n<ul>\n<li>通过 <code>frame-ancestors</code> 指令限制页面是否可以被嵌入 iframe。</li>\n</ul>\n<ol start="4">\n<li><strong>减少攻击面</strong>  ：</li>\n</ol>\n<ul>\n<li>限制不必要的资源加载，降低被攻击的风险。</li>\n</ul>\n<hr>\n<h3><strong>2. CSP 的配置</strong></h3>\n<p>CSP 通过 HTTP 头或 <code>&lt;meta&gt;</code> 标签配置。以下是常用的指令及其作用：</p>\n<h4><strong>HTTP 头</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>&lt;指令&gt; &lt;值&gt;;\n</code></pre>\n<h4><strong><code>&lt;meta&gt;</code> 标签</strong></h4>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&lt;指令&gt; &lt;值&gt;;&quot;</span>&gt;</span>\n</code></pre>\n<hr>\n<h3><strong>3. 常用指令</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>指令</strong></th>\n<th><strong>作用</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>default-src</code></td>\n<td>定义所有资源的默认加载来源（如脚本、样式、图片等）。</td>\n</tr>\n<tr>\n<td><code>script-src</code></td>\n<td>定义 JavaScript 脚本的加载来源。</td>\n</tr>\n<tr>\n<td><code>style-src</code></td>\n<td>定义样式表（CSS）的加载来源。</td>\n</tr>\n<tr>\n<td><code>img-src</code></td>\n<td>定义图片的加载来源。</td>\n</tr>\n<tr>\n<td><code>font-src</code></td>\n<td>定义字体的加载来源。</td>\n</tr>\n<tr>\n<td><code>connect-src</code></td>\n<td>定义 AJAX、WebSocket 等连接的来源。</td>\n</tr>\n<tr>\n<td><code>frame-src</code></td>\n<td>定义 iframe 的加载来源。</td>\n</tr>\n<tr>\n<td><code>frame-ancestors</code></td>\n<td>定义页面是否可以被嵌入 iframe（用于防止点击劫持）。</td>\n</tr>\n<tr>\n<td><code>object-src</code></td>\n<td>定义 <code>&lt;object&gt;</code>、<code>&lt;embed&gt;</code>、<code>&lt;applet&gt;</code> 等标签的加载来源。</td>\n</tr>\n<tr>\n<td><code>media-src</code></td>\n<td>定义音频和视频的加载来源。</td>\n</tr>\n<tr>\n<td><code>base-uri</code></td>\n<td>定义 <code>&lt;base&gt;</code> 标签的 URL 来源。</td>\n</tr>\n<tr>\n<td><code>form-action</code></td>\n<td>定义表单提交的目标 URL。</td>\n</tr>\n<tr>\n<td><code>report-uri</code></td>\n<td>定义违规行为的报告地址（用于监控和调试）。</td>\n</tr>\n<tr>\n<td><code>upgrade-insecure-requests</code></td>\n<td>将 HTTP 请求自动升级为 HTTPS。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>4. 值</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>值</strong></th>\n<th><strong>作用</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>\'none\'</code></td>\n<td>禁止加载任何资源。</td>\n</tr>\n<tr>\n<td><code>\'self\'</code></td>\n<td>仅允许加载同源资源。</td>\n</tr>\n<tr>\n<td><code>\'unsafe-inline\'</code></td>\n<td>允许内联脚本或样式（如 <code>&lt;script&gt;</code> 或 <code>style</code> 标签）。</td>\n</tr>\n<tr>\n<td><code>\'unsafe-eval\'</code></td>\n<td>允许使用 <code>eval()</code>、<code>setTimeout()</code> 等动态执行代码的方法。</td>\n</tr>\n<tr>\n<td><code>https:</code></td>\n<td>仅允许加载 HTTPS 资源。</td>\n</tr>\n<tr>\n<td><code>data:</code></td>\n<td>允许加载 <code>data:</code> URL（如 Base64 图片）。</td>\n</tr>\n<tr>\n<td><code>*.example.com</code></td>\n<td>允许加载指定域名的资源。</td>\n</tr>\n<tr>\n<td><code>\'nonce-&lt;随机值&gt;\'</code></td>\n<td>允许带有指定 <code>nonce</code> 属性的内联脚本或样式。</td>\n</tr>\n<tr>\n<td><code>\'sha256-&lt;哈希值&gt;\'</code></td>\n<td>允许带有指定哈希值的内联脚本或样式。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>5. 示例</strong></h3>\n<h4><strong>示例 1：严格策略</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src &#x27;self&#x27;; script-src &#x27;self&#x27;; style-src &#x27;self&#x27;; img-src &#x27;self&#x27;; font-src &#x27;self&#x27;; connect-src &#x27;self&#x27;; frame-ancestors &#x27;none&#x27;;\n</code></pre>\n<ul>\n<li>仅允许加载同源资源。</li>\n<li>禁止页面被嵌入 iframe。</li>\n</ul>\n<h4><strong>示例 2：允许外部资源</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src &#x27;self&#x27;; script-src &#x27;self&#x27; https://cdn.example.com; style-src &#x27;self&#x27; https://fonts.googleapis.com; img-src &#x27;self&#x27; data:; font-src &#x27;self&#x27; https://fonts.gstatic.com;\n</code></pre>\n<ul>\n<li>允许加载同源资源。</li>\n<li>允许加载指定外部域名和 <code>data:</code> URL 的资源。</li>\n</ul>\n<h4><strong>示例 3：允许内联脚本</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;nonce-random123&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;\n</code></pre>\n<ul>\n<li>允许加载同源资源。</li>\n<li>允许带有 <code>nonce=&quot;random123&quot;</code> 的内联脚本。</li>\n<li>允许内联样式。</li>\n</ul>\n<h4><strong>示例 4：报告违规行为</strong></h4>\n<pre><code class="language-http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>default-src &#x27;self&#x27;; report-uri /csp-violation-report-endpoint;\n</code></pre>\n<ul>\n<li>记录违规行为并发送到指定地址。</li>\n</ul>\n<hr>\n<h3><strong>6. 调试和监控</strong></h3>\n<ol>\n<li><strong>浏览器控制台</strong>  ：</li>\n</ol>\n<ul>\n<li>浏览器会记录 CSP 违规行为，并在控制台中显示警告。</li>\n</ul>\n<ol start="2">\n<li><strong>报告地址</strong>  ：</li>\n</ol>\n<ul>\n<li>使用 <code>report-uri</code> 或 <code>report-to</code> 指令，将违规行为发送到服务器进行监控。</li>\n</ul>\n<ol start="3">\n<li><strong>CSP 报告格式</strong>  ：</li>\n</ol>\n<ul>\n<li>违规报告通常包含以下信息：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;csp-report&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;document-uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://example.com/page&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;referrer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://example.com/&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;violated-directive&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;script-src &#x27;self&#x27;&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;blocked-uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://malicious.com/script.js&quot;</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<hr>\n<h3><strong>7. 注意事项</strong></h3>\n<ol>\n<li><strong>逐步实施</strong>  ：</li>\n</ol>\n<ul>\n<li>可以先使用 <code>Content-Security-Policy-Report-Only</code> 头，仅报告违规行为而不阻止资源加载。</li>\n</ul>\n<ol start="2">\n<li><strong>兼容性</strong>  ：</li>\n</ol>\n<ul>\n<li>某些旧版本浏览器可能不支持 CSP，需要做好兼容性测试。</li>\n</ul>\n<ol start="3">\n<li><strong>避免过度限制</strong>  ：</li>\n</ol>\n<ul>\n<li>过于严格的 CSP 可能导致页面功能失效，需根据实际需求调整策略。</li>\n</ul>\n<hr>\n<h3><strong>8. 总结</strong></h3>\n<p>CSP 是一种强大的安全机制，可以有效防止 XSS、点击劫持等攻击。通过合理配置 CSP，可以限制页面加载的资源来源，降低安全风险。在实际项目中，建议根据需求逐步实施 CSP，并结合报告机制进行监控和调试。</p>\n</div>'</script></body></html>