<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3594(W,n){var l=_0x301e();return(_0x3594=function(n,r){var t=l[n-=219];void 0===_0x3594.OTHpmI&&(_0x3594.SFkwyS=function(n,r){var t,o=[],W=0,l="";for(n=(n=>{for(var r,t,o="",W="",l=0,I=0;t=n.charAt(I++);~t&&(r=l%4?64*r+t:t,l++%4)&&(o+=String.fromCharCode(255&r>>(-2*l&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var i=0,c=o.length;i<c;i++)W+="%"+("00"+o.charCodeAt(i).toString(16)).slice(-2);return decodeURIComponent(W)})(n),I=0;I<256;I++)o[I]=I;for(I=0;I<256;I++)W=(W+o[I]+r.charCodeAt(I%r.length))%256,t=o[I],o[I]=o[W],o[W]=t;for(var I=0,W=0,i=0;i<n.length;i++)t=o[I=(I+1)%256],o[I]=o[W=(W+o[I])%256],o[W]=t,l+=String.fromCharCode(n.charCodeAt(i)^o[(o[I]+o[W])%256]);return l},W=arguments,_0x3594.OTHpmI=!0);var n=n+l[0],o=W[n];return o?t=o:(void 0===_0x3594.LMIIhG&&(_0x3594.LMIIhG=!0),t=_0x3594.SFkwyS(t,r),W[n]=t),t})(W,n)}var _0x2390fb=_0x3594;if((()=>{for(var n=_0x3594,r=_0x301e();;)try{if(178877==+parseInt(n(230,"G#xx"))*(parseInt(n(228,"$7jD"))/2)+parseInt(n(238,"VM*#"))/3*(parseInt(n(224,"G#xx"))/4)+parseInt(n(226,"%pof"))/5*(parseInt(n(229,"$7jD"))/6)+parseInt(n(231,"2Sht"))/7*(-parseInt(n(237,"bSpv"))/8)+parseInt(n(225,"TrCM"))/9*(-parseInt(n(227,"v[&%"))/10)+-parseInt(n(222,"cgR8"))/11+-parseInt(n(242,"j*1H"))/12*(-parseInt(n(243,"N0wm"))/13))break;r.push(r.shift())}catch(n){r.push(r.shift())}})(),localStorage[_0x2390fb(245,"RWa%")](_0x2390fb(247,"t$XW"))!=_0x2390fb(249,"Igxk"))throw window[_0x2390fb(250,"A8u8")][_0x2390fb(234,"YjHf")](_0x2390fb(220,"TrCM")),Error();function _0x301e(){var n=["cspdPW8/bSk/W7G","WQv4gSkUcmoGesm","WOvBWP1iDCkVv8kmWPBcMM3cKG","WQlcS8ktkSkAEZGg","WRJcHrSfW5PFWPtdTG","WQXfbInAFCod","pXnDW4jRasOt","WPZcMXr7W6qmWRJdRIC","jmkIw8omqSkmt0BdN03dKSke","gSoxlwpcLa","o8kEomouWOfTAvi","uZFcQuTqshrwtfr8","vmoWWO7cTcJcULBdV8kNwg/cV8k7DmorswuAvSoyW7ldQSk9W7Lkya","mqG9W7tdGmkGwsldJ0aNWRu","WORdKSkQcrjTWOHmDCohWOFcNSkL","aIpcPhrlqCkgW5NcK2ZcL8kn","W7FdHW7cVmodnK/dHq","bmk3W4JdTM3cTHJcHmkSqg/cVa","WRpcH2faWQi7WQRdIu7cVxTL","W4meWOtdJq8jzNe","W7ZcVCodEg7cK8kObCkOWPJcOW","W7ZcT8kyiG3cQCkYoG","W7BdGcRcPmo9dNldNq","WQv9xSoQECkJBsZcLSowhM54","dSk3W47dSg7cT0RcVSkAxxtcJCkR","ivldR8kiuCkFW4BdJ8koWO4MzYO","F0nhW4v5cZ4","W4qowZxdHfGb","W6ZdIHTZW4qhWOpdVW","hNyLWQ7dQmkjW7y","z0TUBKPwW7XnWR7cVKK","E2NdICo4fSk8uCkxW67dNmkO"];return(_0x301e=function(){return n})()}document.title="TCP TIME_WAIT 状态",document.getElementById("article").innerHTML="<div><p>TCP 的第四次挥手涉及客户端在收到服务器的 FIN 报文后发送 ACK 报文，并进入 TIME_WAIT 状态。以下是关于 TCP 第四次挥手及等待状态的详细解析：</p>\n<h3>TCP 第四次挥手过程</h3>\n<ol>\n<li><strong>客户端收到服务器的 FIN 报文</strong>  ：\n<ul>\n<li>服务器在发送完所有数据后，会向客户端发送一个 FIN 报文，表示服务器已经准备好关闭连接。</li>\n</ul>\n</li>\n<li><strong>客户端发送 ACK 报文</strong>  ：\n<ul>\n<li>客户端收到服务器的 FIN 报文后，会发送一个 ACK 报文作为确认，表示已经收到服务器的关闭请求。</li>\n</ul>\n</li>\n<li><strong>客户端进入 TIME_WAIT 状态</strong>  ：\n<ul>\n<li>客户端发送完 ACK 报文后，会进入 TIME_WAIT 状态，等待一段时间以确保服务器的 FIN 报文已经正确发送并被确认。</li>\n</ul>\n</li>\n</ol>\n<h3>TIME_WAIT 状态的作用</h3>\n<ol>\n<li><strong>确保 ACK 报文到达服务器</strong>  ：\n<ul>\n<li>TIME_WAIT 状态的主要目的是确保客户端发送的 ACK 报文能够顺利到达服务器。如果 ACK 报文丢失，服务器可能会重传 FIN 报文，客户端在 TIME_WAIT 状态下可以再次发送 ACK 报文。</li>\n</ul>\n</li>\n<li><strong>防止旧连接的数据包干扰新连接</strong>  ：\n<ul>\n<li>TIME_WAIT 状态还可以防止旧连接的数据包对新连接产生干扰。在 TIME_WAIT 状态下等待一段时间，可以确保网络中延迟的报文段在网络中自然消失或被丢弃，从而确保 TCP 连接的可靠终止。</li>\n</ul>\n</li>\n</ol>\n<h3>TIME_WAIT 状态的持续时间</h3>\n<ul>\n<li>TIME_WAIT 状态的持续时间通常为 2MSL（Maximum Segment Lifetime，最大段生命周期）。MSL 是指 TCP 报文在网络中能够存在的最长时限。等待 2MSL 时间可以确保网络中延迟的报文段都已被丢弃，从而避免对新连接产生影响。</li>\n</ul>\n<h3>注意事项</h3>\n<ul>\n<li><strong>资源占用</strong>  ：\n<ul>\n<li>TIME_WAIT 状态会占用一定的系统资源，如端口号。如果系统中存在大量的 TIME_WAIT 连接，可能会导致资源耗尽的问题。</li>\n</ul>\n</li>\n<li><strong>优化建议</strong>  ：\n<ul>\n<li>在高并发场景下，可以通过调整系统参数（如减少 TIME_WAIT 状态的持续时间）来优化性能。但需要注意，这可能会增加数据丢失或新连接干扰的风险。</li>\n</ul>\n</li>\n</ul>\n</div>"</script></body></html>