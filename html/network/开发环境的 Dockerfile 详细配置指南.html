<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1f3e(p,s){var o=_0x5d58();return(_0x1f3e=function(s,n){var a=o[s-=346];void 0===_0x1f3e.tIChFl&&(_0x1f3e.waqFbd=function(s,n){var a,t=[],p=0,o="";for(s=(s=>{for(var n,a,t="",p="",o=0,l=0;a=s.charAt(l++);~a&&(n=o%4?64*n+a:a,o++%4)&&(t+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,e=t.length;c<e;c++)p+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)p=(p+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[p],t[p]=a;for(var l=0,p=0,c=0;c<s.length;c++)a=t[l=(l+1)%256],t[l]=t[p=(p+t[l])%256],t[p]=a,o+=String.fromCharCode(s.charCodeAt(c)^t[(t[l]+t[p])%256]);return o},p=arguments,_0x1f3e.tIChFl=!0);var s=s+o[0],t=p[s];return t?a=t:(void 0===_0x1f3e.PRPfTr&&(_0x1f3e.PRPfTr=!0),a=_0x1f3e.waqFbd(a,n),p[s]=a),a})(p,s)}function _0x5d58(){var s=["wCobWQNdMGHYW6pcPghcGSkq","W4K1WPzrFCoQuq3cOmkwW7vmWRu","hWi+x1bHWO7dLW","W4K3WPjzDSoQdWxcPSkFW6Tk","tmkCAmoPW7fZW7xdL3pcMCkKWOJdNW","tHFcRXpcVvpdTG","WOWVD8oKxmkjWOmX","WPyaW6/cTWhdRCoz","WOb+lMpcPqVdLWLhluOG","WPb2W5yrpCoLsfJcLSkvW7DsWOS0WPT1dWSIrIhcMSkkWOKraa","kZRcR8krW6OTW4qg","W7FdLSkZk1qKW5zXWOqyEq","t3PmW4FdGuZcNqVcGWldVXW","W4KWWPrvFmkUcZZcUSk7W6G","W7BdPCkUBmojCmoYW5jnWRldICkCW5y","WPSwnfbvECkfDCo6nmkzia","x8kezYBcNXNdGmoHkG","WPqKfczVjCkWW4dcLSkL","j3z3BfxcMmkWWRn3prW+","hGv9kYCpWOhdUSkqu0Cj","mNnNnxa","WO8Rn8kDkSoGW504W7VcHeWZDW","CZ4NCKPnFuRdRmoT","WPpcRCkqW5VcTH7cSCk0zvm/"];return(_0x5d58=function(){return s})()}var _0xa26f60=_0x1f3e;if((()=>{for(var s=_0x1f3e,n=_0x5d58();;)try{if(613611==+parseInt(s(349,"eh%2"))+parseInt(s(366,"gj]@"))/2+-parseInt(s(352,"IvnV"))/3+parseInt(s(348,"08t&"))/4+-parseInt(s(355,"U@vc"))/5+parseInt(s(369,"(trY"))/6*(parseInt(s(351,"*BS("))/7)+parseInt(s(360,"jF0N"))/8*(parseInt(s(357,"S%22"))/9))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0xa26f60(363,"EUDt")](_0xa26f60(350,"#&TO"))!=_0xa26f60(354,"a1gn"))throw window[_0xa26f60(368,"Q%Zb")][_0xa26f60(365,"%TVc")](_0xa26f60(367,"qohk")),Error();document.title="开发环境的 Dockerfile 详细配置指南",document.getElementById("article").innerHTML='<div><p>以下是针对 <strong>开发环境</strong>   的 Dockerfile 详细配置指南，包含热重载、调试支持和高效开发的最佳实践：</p>\n<hr>\n<h3><strong>1. 开发专用 Dockerfile（<code>Dockerfile.dev</code>）</strong></h3>\n<pre><code class="language-dockerfile"><span class="hljs-comment"># 使用与生产环境相同的基础镜像（避免差异）</span>\n<span class="hljs-keyword">FROM</span> node:<span class="hljs-number">18</span>-alpine\n\n<span class="hljs-comment"># 设置工作目录</span>\n<span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span>\n\n<span class="hljs-comment"># 1. 先复制依赖文件（利用缓存优化）</span>\n<span class="hljs-keyword">COPY</span><span class="language-bash"> package*.json ./</span>\n\n<span class="hljs-comment"># 2. 安装所有依赖（包括devDependencies）</span>\n<span class="hljs-keyword">RUN</span><span class="language-bash"> npm install</span>\n\n<span class="hljs-comment"># 3. 复制源代码（生产环境不需要这步，开发时通过挂载覆盖）</span>\n<span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span>\n\n<span class="hljs-comment"># 4. 暴露应用端口+调试端口</span>\n<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3000</span>  <span class="hljs-comment"># 应用端口</span>\n<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">9229</span>  <span class="hljs-comment"># Node.js调试端口</span>\n\n<span class="hljs-comment"># 5. 启动开发服务器（支持热重载）</span>\n<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;npm&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-string">&quot;dev&quot;</span>]</span>\n</code></pre>\n<hr>\n<h3><strong>2. 配套的 <code>package.json</code> 配置</strong></h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nodemon --inspect=0.0.0.0 server.js&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启用调试和热重载</span>\n    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node server.js&quot;</span> <span class="hljs-comment">// 生产环境使用</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.18.2&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;nodemon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.0.1&quot;</span> <span class="hljs-comment">// 开发依赖，不会进入生产镜像</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h3><strong>3. 构建和运行开发环境</strong></h3>\n<pre><code class="language-bash"><span class="hljs-comment"># 构建开发镜像</span>\ndocker build -f Dockerfile.dev -t my-app-dev .\n\n<span class="hljs-comment"># 运行容器（挂载代码+调试端口）</span>\ndocker run -dp 3000:3000 -p 9229:9229 \\\n  -v $(<span class="hljs-built_in">pwd</span>):/app \\\n  -v /app/node_modules \\\n  my-app-dev\n</code></pre>\n<hr>\n<h3><strong>4. 开发环境优化配置</strong></h3>\n<h4>**(1) 支持实时文件同步</h4>\n<ul>\n<li><strong><code>-v $(pwd):/app</code></strong>   ：将本地代码挂载到容器，修改立即生效</li>\n<li><strong><code>-v /app/node_modules</code></strong>   ：防止覆盖容器内的依赖</li>\n</ul>\n<h4>**(2) 调试支持</h4>\n<ul>\n<li><strong>Node.js 调试</strong>   ：<code>--inspect=0.0.0.0</code> 允许外部连接</li>\n<li><strong>VS Code 配置</strong>   （<code>.vscode/launch.json</code>）：<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;request&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;attach&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Docker Debug&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;localhost&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9229</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;localRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;${workspaceFolder}&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;remoteRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/app&quot;</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4>**(3) 快速重建命令</h4>\n<pre><code class="language-bash"><span class="hljs-comment"># 一键停止旧容器并重建</span>\ndocker stop $(docker ps -q --filter ancestor=my-app-dev) &amp;&amp; \\\ndocker build -f Dockerfile.dev -t my-app-dev . &amp;&amp; \\\ndocker run -dp 3000:3000 -p 9229:9229 -v $(<span class="hljs-built_in">pwd</span>):/app -v /app/node_modules my-app-dev\n</code></pre>\n<hr>\n<h3><strong>5. 开发 vs 生产配置对比</strong></h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>开发环境 (<code>Dockerfile.dev</code>)</th>\n<th>生产环境 (<code>Dockerfile</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>依赖安装</strong></td>\n<td><code>npm install</code>（含devDependencies）</td>\n<td><code>npm ci --production</code></td>\n</tr>\n<tr>\n<td><strong>代码同步</strong></td>\n<td>挂载本地目录 (<code>-v $(pwd):/app</code>)</td>\n<td>固化到镜像</td>\n</tr>\n<tr>\n<td><strong>调试支持</strong></td>\n<td>开放9229端口 + nodemon</td>\n<td>仅必要端口</td>\n</tr>\n<tr>\n<td><strong>启动命令</strong></td>\n<td><code>npm run dev</code></td>\n<td><code>npm start</code></td>\n</tr>\n<tr>\n<td><strong>镜像体积</strong></td>\n<td>较大（含构建工具）</td>\n<td>最小化（多阶段构建）</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>6. 常见问题解决</strong></h3>\n<h4><strong>Q1: 修改代码后热重载不生效？</strong></h4>\n<ul>\n<li>确保 <code>package.json</code> 的 <code>dev</code> 脚本使用 <code>nodemon</code></li>\n<li>检查文件挂载是否正确：<pre><code class="language-bash">docker <span class="hljs-built_in">exec</span> -it &lt;container-id&gt; <span class="hljs-built_in">ls</span> /app  <span class="hljs-comment"># 确认文件同步</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>Q2: 如何进入容器调试？</strong></h4>\n<pre><code class="language-bash">docker <span class="hljs-built_in">exec</span> -it &lt;container-id&gt; /bin/sh\n<span class="hljs-comment"># 在容器内可运行：</span>\n<span class="hljs-comment">#   npm install 新增依赖</span>\n<span class="hljs-comment">#   npx nodemon --inspect server.js 手动调试</span>\n</code></pre>\n<h4><strong>Q3: 如何清理开发镜像？</strong></h4>\n<pre><code class="language-bash"><span class="hljs-comment"># 删除所有开发镜像和容器</span>\ndocker stop $(docker ps -aq --filter ancestor=my-app-dev)\ndocker rmi my-app-dev\n</code></pre>\n<hr>\n<p>通过这种配置，您将获得：</p>\n<ul>\n<li>实时代码修改同步 ✅</li>\n<li>完整的调试支持 ✅</li>\n<li>与生产环境一致的基础 ✅</li>\n<li>快速的开发迭代体验 🚀</li>\n</ul>\n</div>'</script></body></html>