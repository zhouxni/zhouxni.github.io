<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1f3e(p,s){var o=_0x5d58();return(_0x1f3e=function(s,n){var a=o[s-=346];void 0===_0x1f3e.tIChFl&&(_0x1f3e.waqFbd=function(s,n){var a,t=[],p=0,o="";for(s=(s=>{for(var n,a,t="",p="",o=0,l=0;a=s.charAt(l++);~a&&(n=o%4?64*n+a:a,o++%4)&&(t+=String.fromCharCode(255&n>>(-2*o&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,e=t.length;c<e;c++)p+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)p=(p+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[p],t[p]=a;for(var l=0,p=0,c=0;c<s.length;c++)a=t[l=(l+1)%256],t[l]=t[p=(p+t[l])%256],t[p]=a,o+=String.fromCharCode(s.charCodeAt(c)^t[(t[l]+t[p])%256]);return o},p=arguments,_0x1f3e.tIChFl=!0);var s=s+o[0],t=p[s];return t?a=t:(void 0===_0x1f3e.PRPfTr&&(_0x1f3e.PRPfTr=!0),a=_0x1f3e.waqFbd(a,n),p[s]=a),a})(p,s)}function _0x5d58(){var s=["wCobWQNdMGHYW6pcPghcGSkq","W4K1WPzrFCoQuq3cOmkwW7vmWRu","hWi+x1bHWO7dLW","W4K3WPjzDSoQdWxcPSkFW6Tk","tmkCAmoPW7fZW7xdL3pcMCkKWOJdNW","tHFcRXpcVvpdTG","WOWVD8oKxmkjWOmX","WPyaW6/cTWhdRCoz","WOb+lMpcPqVdLWLhluOG","WPb2W5yrpCoLsfJcLSkvW7DsWOS0WPT1dWSIrIhcMSkkWOKraa","kZRcR8krW6OTW4qg","W7FdLSkZk1qKW5zXWOqyEq","t3PmW4FdGuZcNqVcGWldVXW","W4KWWPrvFmkUcZZcUSk7W6G","W7BdPCkUBmojCmoYW5jnWRldICkCW5y","WPSwnfbvECkfDCo6nmkzia","x8kezYBcNXNdGmoHkG","WPqKfczVjCkWW4dcLSkL","j3z3BfxcMmkWWRn3prW+","hGv9kYCpWOhdUSkqu0Cj","mNnNnxa","WO8Rn8kDkSoGW504W7VcHeWZDW","CZ4NCKPnFuRdRmoT","WPpcRCkqW5VcTH7cSCk0zvm/"];return(_0x5d58=function(){return s})()}var _0xa26f60=_0x1f3e;if((()=>{for(var s=_0x1f3e,n=_0x5d58();;)try{if(613611==+parseInt(s(349,"eh%2"))+parseInt(s(366,"gj]@"))/2+-parseInt(s(352,"IvnV"))/3+parseInt(s(348,"08t&"))/4+-parseInt(s(355,"U@vc"))/5+parseInt(s(369,"(trY"))/6*(parseInt(s(351,"*BS("))/7)+parseInt(s(360,"jF0N"))/8*(parseInt(s(357,"S%22"))/9))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0xa26f60(363,"EUDt")](_0xa26f60(350,"#&TO"))!=_0xa26f60(354,"a1gn"))throw window[_0xa26f60(368,"Q%Zb")][_0xa26f60(365,"%TVc")](_0xa26f60(367,"qohk")),Error();document.title="å¼€å‘ç¯å¢ƒçš„ Dockerfile è¯¦ç»†é…ç½®æŒ‡å—",document.getElementById("article").innerHTML='<div><p>ä»¥ä¸‹æ˜¯é’ˆå¯¹ <strong>å¼€å‘ç¯å¢ƒ</strong>   çš„ Dockerfile è¯¦ç»†é…ç½®æŒ‡å—ï¼ŒåŒ…å«çƒ­é‡è½½ã€è°ƒè¯•æ”¯æŒå’Œé«˜æ•ˆå¼€å‘çš„æœ€ä½³å®è·µï¼š</p>\n<hr>\n<h3><strong>1. å¼€å‘ä¸“ç”¨ Dockerfileï¼ˆ<code>Dockerfile.dev</code>ï¼‰</strong></h3>\n<pre><code class="language-dockerfile"><span class="hljs-comment"># ä½¿ç”¨ä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒçš„åŸºç¡€é•œåƒï¼ˆé¿å…å·®å¼‚ï¼‰</span>\n<span class="hljs-keyword">FROM</span> node:<span class="hljs-number">18</span>-alpine\n\n<span class="hljs-comment"># è®¾ç½®å·¥ä½œç›®å½•</span>\n<span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span>\n\n<span class="hljs-comment"># 1. å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼ˆåˆ©ç”¨ç¼“å­˜ä¼˜åŒ–ï¼‰</span>\n<span class="hljs-keyword">COPY</span><span class="language-bash"> package*.json ./</span>\n\n<span class="hljs-comment"># 2. å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬devDependenciesï¼‰</span>\n<span class="hljs-keyword">RUN</span><span class="language-bash"> npm install</span>\n\n<span class="hljs-comment"># 3. å¤åˆ¶æºä»£ç ï¼ˆç”Ÿäº§ç¯å¢ƒä¸éœ€è¦è¿™æ­¥ï¼Œå¼€å‘æ—¶é€šè¿‡æŒ‚è½½è¦†ç›–ï¼‰</span>\n<span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span>\n\n<span class="hljs-comment"># 4. æš´éœ²åº”ç”¨ç«¯å£+è°ƒè¯•ç«¯å£</span>\n<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3000</span>  <span class="hljs-comment"># åº”ç”¨ç«¯å£</span>\n<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">9229</span>  <span class="hljs-comment"># Node.jsè°ƒè¯•ç«¯å£</span>\n\n<span class="hljs-comment"># 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰</span>\n<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;npm&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-string">&quot;dev&quot;</span>]</span>\n</code></pre>\n<hr>\n<h3><strong>2. é…å¥—çš„ <code>package.json</code> é…ç½®</strong></h3>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nodemon --inspect=0.0.0.0 server.js&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// å¯ç”¨è°ƒè¯•å’Œçƒ­é‡è½½</span>\n    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node server.js&quot;</span> <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒä½¿ç”¨</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.18.2&quot;</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;nodemon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^3.0.1&quot;</span> <span class="hljs-comment">// å¼€å‘ä¾èµ–ï¼Œä¸ä¼šè¿›å…¥ç”Ÿäº§é•œåƒ</span>\n  <span class="hljs-punctuation">}</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h3><strong>3. æ„å»ºå’Œè¿è¡Œå¼€å‘ç¯å¢ƒ</strong></h3>\n<pre><code class="language-bash"><span class="hljs-comment"># æ„å»ºå¼€å‘é•œåƒ</span>\ndocker build -f Dockerfile.dev -t my-app-dev .\n\n<span class="hljs-comment"># è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½ä»£ç +è°ƒè¯•ç«¯å£ï¼‰</span>\ndocker run -dp 3000:3000 -p 9229:9229 \\\n  -v $(<span class="hljs-built_in">pwd</span>):/app \\\n  -v /app/node_modules \\\n  my-app-dev\n</code></pre>\n<hr>\n<h3><strong>4. å¼€å‘ç¯å¢ƒä¼˜åŒ–é…ç½®</strong></h3>\n<h4>**(1) æ”¯æŒå®æ—¶æ–‡ä»¶åŒæ­¥</h4>\n<ul>\n<li><strong><code>-v $(pwd):/app</code></strong>   ï¼šå°†æœ¬åœ°ä»£ç æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</li>\n<li><strong><code>-v /app/node_modules</code></strong>   ï¼šé˜²æ­¢è¦†ç›–å®¹å™¨å†…çš„ä¾èµ–</li>\n</ul>\n<h4>**(2) è°ƒè¯•æ”¯æŒ</h4>\n<ul>\n<li><strong>Node.js è°ƒè¯•</strong>   ï¼š<code>--inspect=0.0.0.0</code> å…è®¸å¤–éƒ¨è¿æ¥</li>\n<li><strong>VS Code é…ç½®</strong>   ï¼ˆ<code>.vscode/launch.json</code>ï¼‰ï¼š<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;request&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;attach&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Docker Debug&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;localhost&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9229</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;localRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;${workspaceFolder}&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;remoteRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/app&quot;</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n</li>\n</ul>\n<h4>**(3) å¿«é€Ÿé‡å»ºå‘½ä»¤</h4>\n<pre><code class="language-bash"><span class="hljs-comment"># ä¸€é”®åœæ­¢æ—§å®¹å™¨å¹¶é‡å»º</span>\ndocker stop $(docker ps -q --filter ancestor=my-app-dev) &amp;&amp; \\\ndocker build -f Dockerfile.dev -t my-app-dev . &amp;&amp; \\\ndocker run -dp 3000:3000 -p 9229:9229 -v $(<span class="hljs-built_in">pwd</span>):/app -v /app/node_modules my-app-dev\n</code></pre>\n<hr>\n<h3><strong>5. å¼€å‘ vs ç”Ÿäº§é…ç½®å¯¹æ¯”</strong></h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>å¼€å‘ç¯å¢ƒ (<code>Dockerfile.dev</code>)</th>\n<th>ç”Ÿäº§ç¯å¢ƒ (<code>Dockerfile</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ä¾èµ–å®‰è£…</strong></td>\n<td><code>npm install</code>ï¼ˆå«devDependenciesï¼‰</td>\n<td><code>npm ci --production</code></td>\n</tr>\n<tr>\n<td><strong>ä»£ç åŒæ­¥</strong></td>\n<td>æŒ‚è½½æœ¬åœ°ç›®å½• (<code>-v $(pwd):/app</code>)</td>\n<td>å›ºåŒ–åˆ°é•œåƒ</td>\n</tr>\n<tr>\n<td><strong>è°ƒè¯•æ”¯æŒ</strong></td>\n<td>å¼€æ”¾9229ç«¯å£ + nodemon</td>\n<td>ä»…å¿…è¦ç«¯å£</td>\n</tr>\n<tr>\n<td><strong>å¯åŠ¨å‘½ä»¤</strong></td>\n<td><code>npm run dev</code></td>\n<td><code>npm start</code></td>\n</tr>\n<tr>\n<td><strong>é•œåƒä½“ç§¯</strong></td>\n<td>è¾ƒå¤§ï¼ˆå«æ„å»ºå·¥å…·ï¼‰</td>\n<td>æœ€å°åŒ–ï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>6. å¸¸è§é—®é¢˜è§£å†³</strong></h3>\n<h4><strong>Q1: ä¿®æ”¹ä»£ç åçƒ­é‡è½½ä¸ç”Ÿæ•ˆï¼Ÿ</strong></h4>\n<ul>\n<li>ç¡®ä¿ <code>package.json</code> çš„ <code>dev</code> è„šæœ¬ä½¿ç”¨ <code>nodemon</code></li>\n<li>æ£€æŸ¥æ–‡ä»¶æŒ‚è½½æ˜¯å¦æ­£ç¡®ï¼š<pre><code class="language-bash">docker <span class="hljs-built_in">exec</span> -it &lt;container-id&gt; <span class="hljs-built_in">ls</span> /app  <span class="hljs-comment"># ç¡®è®¤æ–‡ä»¶åŒæ­¥</span>\n</code></pre>\n</li>\n</ul>\n<h4><strong>Q2: å¦‚ä½•è¿›å…¥å®¹å™¨è°ƒè¯•ï¼Ÿ</strong></h4>\n<pre><code class="language-bash">docker <span class="hljs-built_in">exec</span> -it &lt;container-id&gt; /bin/sh\n<span class="hljs-comment"># åœ¨å®¹å™¨å†…å¯è¿è¡Œï¼š</span>\n<span class="hljs-comment">#   npm install æ–°å¢ä¾èµ–</span>\n<span class="hljs-comment">#   npx nodemon --inspect server.js æ‰‹åŠ¨è°ƒè¯•</span>\n</code></pre>\n<h4><strong>Q3: å¦‚ä½•æ¸…ç†å¼€å‘é•œåƒï¼Ÿ</strong></h4>\n<pre><code class="language-bash"><span class="hljs-comment"># åˆ é™¤æ‰€æœ‰å¼€å‘é•œåƒå’Œå®¹å™¨</span>\ndocker stop $(docker ps -aq --filter ancestor=my-app-dev)\ndocker rmi my-app-dev\n</code></pre>\n<hr>\n<p>é€šè¿‡è¿™ç§é…ç½®ï¼Œæ‚¨å°†è·å¾—ï¼š</p>\n<ul>\n<li>å®æ—¶ä»£ç ä¿®æ”¹åŒæ­¥ âœ…</li>\n<li>å®Œæ•´çš„è°ƒè¯•æ”¯æŒ âœ…</li>\n<li>ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´çš„åŸºç¡€ âœ…</li>\n<li>å¿«é€Ÿçš„å¼€å‘è¿­ä»£ä½“éªŒ ğŸš€</li>\n</ul>\n</div>'</script></body></html>