<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1d80(l,n){var d=_0x1389();return(_0x1d80=function(n,t){var o=d[n-=327];void 0===_0x1d80.CscjFM&&(_0x1d80.aftXyr=function(n,t){var o,r=[],l=0,d="";for(n=(n=>{for(var t,o,r="",l="",d=0,i=0;o=n.charAt(i++);~o&&(t=d%4?64*t+o:o,d++%4)&&(r+=String.fromCharCode(255&t>>(-2*d&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var s=0,e=r.length;s<e;s++)l+="%"+("00"+r.charCodeAt(s).toString(16)).slice(-2);return decodeURIComponent(l)})(n),i=0;i<256;i++)r[i]=i;for(i=0;i<256;i++)l=(l+r[i]+t.charCodeAt(i%t.length))%256,o=r[i],r[i]=r[l],r[l]=o;for(var i=0,l=0,s=0;s<n.length;s++)o=r[i=(i+1)%256],r[i]=r[l=(l+r[i])%256],r[l]=o,d+=String.fromCharCode(n.charCodeAt(s)^r[(r[i]+r[l])%256]);return d},l=arguments,_0x1d80.CscjFM=!0);var n=n+d[0],r=l[n];return r?o=r:(void 0===_0x1d80.yXltEj&&(_0x1d80.yXltEj=!0),o=_0x1d80.aftXyr(o,t),l[n]=o),o})(l,n)}var _0x4e3a4a=_0x1d80;function _0x1389(){var n=["aCo8gCkKW4HSWOjOkCofhSoe","WOPxWQtdOYaNEW","W7xcP8okxd1Mt8oiW6SXf8oJ","WRtcIL0xW4BdHaWjvfPh","WObyDf4YW4f6W6BcVrCfW50","W7DLWPy5xCkJgmoH","WQ/dSmk/W6Pbaf4pAmkSnG","W7jPqhKsccpcUmkdyCkRFq","W4tdMmogWQJcSSkoW5dcTq","W7JcVfX4C8oxW7OxW6W","W7LSW6vkn8olnSobW7yFWOGK","xmkGtmoXWOqZWRvS","WPjHoSoSrSkXW44oW57cRCk+ya","BSk0imo7CvjL","xYPAqSk7W581p2/dGte","WOq2W5WwWP/dONS+W4dcKWyXW5K","W6ddR8oXW6RcUMdcPmoE","gw8yaCoY","iXJcJ8oesrxcTxOi","WQNdJsZcRCoxmmouj8osWRqD","smoTgmkbf8oiwmoK","W4mGDSkSb8k+WPf5W5FcQCkDySk9W4pdKCk3gCoTW6dcMmkSW63cObRcTSoo","t8oIEmobh8oXACopWRbt","dSoGB8kUlComWRtcICkZoMCM","WOHACYPUWRLLW7tcUq","WO47y8oEgc9gsmkEEHtcKG","cCoUASkRECkYWPhcOCktda","WQZdTSk0W6zdyXaqt8kefSoLWQG"];return(_0x1389=function(){return n})()}if((()=>{for(var n=_0x1d80,t=_0x1389();;)try{if(560444==+parseInt(n(354,"baDO"))+-parseInt(n(343,"^69k"))/2+parseInt(n(332,"k%lV"))/3*(-parseInt(n(330,"kK9N"))/4)+-parseInt(n(328,"THZM"))/5+-parseInt(n(340,")Ihb"))/6*(-parseInt(n(346,")#Lk"))/7)+parseInt(n(335,"3&]&"))/8*(parseInt(n(342,"o)Hk"))/9)+parseInt(n(341,"RSP^"))/10*(parseInt(n(352,"npBF"))/11))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x4e3a4a(329,"pl9U")](_0x4e3a4a(353,"sF*U"))!=_0x4e3a4a(333,"kK9N"))throw window[_0x4e3a4a(327,"DvgV")][_0x4e3a4a(345,"[41z")](_0x4e3a4a(337,"THZM")),Error();document.title="TCP 三次握手和四次挥手",document.getElementById("article").innerHTML="<div><h3>TCP 三次握手和四次挥手详解</h3>\n<p>TCP（Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议。在 TCP 协议中，三次握手用于建立连接，而四次挥手用于终止连接。以下是关于 TCP 三次握手和四次挥手的全面解析：</p>\n<hr>\n<h4>一、TCP 三次握手（建立连接）</h4>\n<p><strong>三次握手</strong>  是 TCP 协议用于建立可靠连接的过程，确保客户端和服务器双方都已准备好进行数据传输。具体步骤如下：</p>\n<ol>\n<li><strong>第一次握手（SYN）</strong>  ：\n<ul>\n<li>客户端向服务器发送一个 SYN（Synchronize Sequence Numbers）包，请求建立连接。</li>\n<li>该包中包含一个初始序列号（假设为 <code>x</code>），用于后续的数据传输。</li>\n</ul>\n</li>\n<li><strong>第二次握手（SYN-ACK）</strong>  ：\n<ul>\n<li>服务器收到 SYN 包后，向客户端发送一个 SYN-ACK（Synchronize-Acknowledgment）包，表示同意建立连接。</li>\n<li>该包中包含服务器的初始序列号（假设为 <code>y</code>）和对客户端序列号的确认号（<code>x+1</code>）。</li>\n</ul>\n</li>\n<li><strong>第三次握手（ACK）</strong>  ：\n<ul>\n<li>客户端收到 SYN-ACK 包后，向服务器发送一个 ACK（Acknowledgment）包，确认连接建立。</li>\n<li>该包中包含对服务器序列号的确认号（<code>y+1</code>）。</li>\n</ul>\n</li>\n</ol>\n<p><strong>为什么需要三次握手？</strong></p>\n<ul>\n<li><strong>防止旧连接请求</strong>  ：三次握手可以确保客户端收到的 SYN-ACK 包是针对当前请求的，而不是之前的旧请求。</li>\n<li><strong>同步序列号</strong>  ：通过三次握手，客户端和服务器可以协商并确认各自的初始序列号，确保后续数据传输的可靠性。</li>\n</ul>\n<hr>\n<h4>二、TCP 四次挥手（终止连接）</h4>\n<p><strong>四次挥手</strong>  是 TCP 协议用于终止可靠连接的过程，确保双方都已完成数据传输并准备好关闭连接。具体步骤如下：</p>\n<ol>\n<li><strong>第一次挥手（FIN）</strong>  ：\n<ul>\n<li>客户端向服务器发送一个 FIN（Finish）包，表示客户端已没有数据要发送，请求关闭连接。</li>\n</ul>\n</li>\n<li><strong>第二次挥手（ACK）</strong>  ：\n<ul>\n<li>服务器收到 FIN 包后，向客户端发送一个 ACK 包，确认收到关闭请求。</li>\n<li>此时，客户端到服务器的方向已经关闭，但服务器到客户端的方向仍然可以传输数据。</li>\n</ul>\n</li>\n<li><strong>第三次挥手（FIN）</strong>  ：\n<ul>\n<li>当服务器也没有数据要发送时，向客户端发送一个 FIN 包，表示服务器也请求关闭连接。</li>\n</ul>\n</li>\n<li><strong>第四次挥手（ACK）</strong>  ：\n<ul>\n<li>客户端收到服务器的 FIN 包后，向服务器发送一个 ACK 包，确认收到关闭请求。</li>\n<li>此时，连接完全关闭，双方都不再发送或接收数据。</li>\n</ul>\n</li>\n</ol>\n<p><strong>为什么需要四次挥手？</strong></p>\n<ul>\n<li><strong>确保数据完整性</strong>  ：四次挥手允许双方在关闭连接前完成所有数据的传输和确认。</li>\n<li><strong>半关闭状态</strong>  ：TCP 连接支持半关闭状态，即一方可以关闭发送方向，但继续接收数据。四次挥手可以处理这种半关闭情况。</li>\n</ul>\n<hr>\n<h4>三、TCP 三次握手和四次挥手的比较</h4>\n<table>\n<thead>\n<tr>\n<th><strong>特性</strong></th>\n<th><strong>三次握手</strong></th>\n<th><strong>四次挥手</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>目的</strong></td>\n<td>建立连接</td>\n<td>终止连接</td>\n</tr>\n<tr>\n<td><strong>包的数量</strong></td>\n<td>3 个包（SYN, SYN-ACK, ACK）</td>\n<td>4 个包（FIN, ACK, FIN, ACK）</td>\n</tr>\n<tr>\n<td><strong>状态变化</strong></td>\n<td>从 CLOSED 到 ESTABLISHED</td>\n<td>从 ESTABLISHED 到 CLOSED</td>\n</tr>\n<tr>\n<td><strong>关键点</strong></td>\n<td>同步序列号，防止旧连接请求</td>\n<td>确保数据完整性，处理半关闭状态</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h4>四、TCP 三次握手和四次挥手的类比</h4>\n<p><strong>三次握手类比</strong>  ：</p>\n<ul>\n<li>想象两个人在打电话，第一个人说“你好，我可以说话吗？”（SYN），第二个人回答“可以，你说吧。”（SYN-ACK），第一个人再说“好的，我开始说了。”（ACK）。</li>\n</ul>\n<p><strong>四次挥手类比</strong>  ：</p>\n<ul>\n<li>想象两个人在结束通话，第一个人说“我说完了，你还有什么要说吗？”（FIN），第二个人回答“我知道了，你等我说完。”（ACK），然后第二个人说“我也说完了。”（FIN），第一个人回答“好的，那挂了吧。”（ACK）。</li>\n</ul>\n<hr>\n<h4>五、总结</h4>\n<p>TCP 三次握手和四次挥手是 TCP 协议中用于建立可靠连接和终止连接的重要过程。三次握手确保双方都已准备好进行数据传输，并同步序列号；四次挥手确保双方都已完成数据传输，并安全地关闭连接。理解这两个过程对于掌握 TCP 协议的工作原理和网络编程至关重要。</p>\n</div>"</script></body></html>