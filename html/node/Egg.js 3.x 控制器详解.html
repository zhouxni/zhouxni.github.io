<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x8da3fe=_0xd374;function _0x53f8(){var s=["l0pcT2xdO1xdQxioEmoRC8oj","W6ZcOdv8WOlcM09xDCo7vai","W7BdS8kNemo5ownZ","DCkMW68Pp3bP","W6znDSkCvWfc","bND2xCkDW5LJW5ujpSou","uxNdMZhdMZGjW6/dGYOms8oV","W4FcUHhcTM3cUdNdN8k1tMmuW6C","w8oip3BdNCkhW6ddNmotWOhdNfhdGq","WPtcKeBcJmojWOJcHCoCW7GuW5ddGf7cV8o2W6e8uZ7cNw1Qm8odWR93","kXCzWPDmW5T2nW","umoLW43cL2y6DmolWOu","WRLzyCoIWOe8W4xdVCkyWQTqsW","m1PVW6hdNeeVdCoU","WPn8WRVdNmoXW6C6WRi","jfNcK8oNFSkoWOH6","AWu8W5ldM24yeG","lZNdJtxcJYNcPG","DX8SW4ddLG","WRaIWPyYFG3dP8o0kqhcSrDH","kKFcSqpcQcRcIxq9","v8kQlX/cGSo4DSonWRxdOxpcPt4","D8oFWPn9wWyVoSkKCCk9WPvSW7S","WRuZW47dRcH8W6C","xSogo3VdLmkiW6ddHmoVWPJdK03dPG","WOzJWR9ECZRcRSoVW7q0W4ldG2m4"];return(_0x53f8=function(){return s})()}function _0xd374(p,s){var t=_0x53f8();return(_0xd374=function(s,a){var n=t[s-=482];void 0===_0xd374.Opoain&&(_0xd374.RMSkZH=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0xd374.Opoain=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0xd374.CRxTCR&&(_0xd374.CRxTCR=!0),n=_0xd374.RMSkZH(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0xd374,a=_0x53f8();;)try{if(403854==-parseInt(s(507,"XB1C"))*(parseInt(s(504,"7XbY"))/2)+-parseInt(s(502,"#Ve4"))/3+parseInt(s(483,"V#pa"))/4*(-parseInt(s(498,"7XbY"))/5)+parseInt(s(488,"qIyT"))/6*(-parseInt(s(490,"MPmV"))/7)+-parseInt(s(497,"XM8P"))/8+-parseInt(s(486,"#Ve4"))/9+parseInt(s(500,"XB1C"))/10*(parseInt(s(506,"o$f1"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x8da3fe(482,"@(%0")](_0x8da3fe(489,"RJG("))!=_0x8da3fe(496,"WhtS"))throw window[_0x8da3fe(494,"WhtS")][_0x8da3fe(501,"%WFV")](_0x8da3fe(487,"Nv#V")),Error();document.title="Egg.js 3.x 控制器详解",document.getElementById("article").innerHTML='<div><p>控制器(Controller)是 Egg.js 中负责处理用户输入和返回响应的核心部分，它继承自 Koa 的 Context 对象，提供了更强大的封装和便捷的 API。</p>\n<h2>1. 控制器基础</h2>\n<h3>控制器目录结构</h3>\n<pre><code>app\n├── controller\n│   ├── home.js       # 首页控制器\n│   ├── user.js       # 用户相关控制器\n│   └── api\n│       ├── v1.js     # API v1\n│       └── v2.js     # API v2\n└── router.js\n</code></pre>\n<h3>基本控制器示例</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/controller/home.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Controller</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>);\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;Hello Egg.js&#x27;</span>;\n  }\n  \n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">about</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    ctx.<span class="hljs-property">body</span> = {\n      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Egg.js&#x27;</span>,\n      <span class="hljs-attr">version</span>: <span class="hljs-string">&#x27;3.x&#x27;</span>\n    };\n  }\n}\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">HomeController</span>;\n</code></pre>\n<h2>2. 控制器核心功能</h2>\n<h3>HTTP 请求处理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-comment">// GET /users?name=egg</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">list</span>(ctx.<span class="hljs-property">query</span>.<span class="hljs-property">name</span>);\n    ctx.<span class="hljs-property">body</span> = { users };\n  }\n  \n  <span class="hljs-comment">// POST /users { &quot;name&quot;: &quot;egg&quot; }</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">create</span>(ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">201</span>;\n    ctx.<span class="hljs-property">body</span> = user;\n  }\n  \n  <span class="hljs-comment">// GET /users/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    ctx.<span class="hljs-property">body</span> = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">find</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n  }\n}\n</code></pre>\n<h3>便捷的上下文方法</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    \n    <span class="hljs-comment">// 设置状态码</span>\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">200</span>;\n    \n    <span class="hljs-comment">// 设置响应体</span>\n    ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;response&#x27;</span> };\n    \n    <span class="hljs-comment">// 设置响应头</span>\n    ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;X-Custom-Header&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>);\n    \n    <span class="hljs-comment">// 重定向</span>\n    ctx.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/new-url&#x27;</span>);\n    \n    <span class="hljs-comment">// 渲染模板</span>\n    <span class="hljs-keyword">await</span> ctx.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;home.tpl&#x27;</span>, { data });\n    \n    <span class="hljs-comment">// 抛出错误</span>\n    ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">404</span>, <span class="hljs-string">&#x27;Not Found&#x27;</span>);\n  }\n}\n</code></pre>\n<h2>3. 参数校验</h2>\n<h3>内置校验方法</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    \n    <span class="hljs-comment">// 校验参数</span>\n    ctx.<span class="hljs-title function_">validate</span>({\n      <span class="hljs-attr">username</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },\n      <span class="hljs-attr">password</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">min</span>: <span class="hljs-number">6</span> },\n      <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">120</span> }\n    });\n    \n    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">create</span>(ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>);\n    ctx.<span class="hljs-property">body</span> = user;\n  }\n}\n</code></pre>\n<h3>自定义校验规则</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app.js</span>\napp.<span class="hljs-property">validator</span>.<span class="hljs-title function_">addRule</span>(<span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">rule, value</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^1[3-9]\\d{9}$/</span>.<span class="hljs-title function_">test</span>(value)) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;手机号码格式错误&#x27;</span>;\n  }\n});\n\n<span class="hljs-comment">// 在控制器中使用</span>\nctx.<span class="hljs-title function_">validate</span>({ <span class="hljs-attr">phone</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });\n</code></pre>\n<h2>4. 控制器最佳实践</h2>\n<h3>RESTful 控制器</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-comment">// GET /posts</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">post</span>.<span class="hljs-title function_">list</span>();\n    ctx.<span class="hljs-property">body</span> = { posts };\n  }\n  \n  <span class="hljs-comment">// GET /posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">post</span>.<span class="hljs-title function_">find</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n    ctx.<span class="hljs-property">body</span> = { post };\n  }\n  \n  <span class="hljs-comment">// POST /posts</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) {\n    ctx.<span class="hljs-title function_">validate</span>({\n      <span class="hljs-attr">title</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },\n      <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> }\n    });\n    <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">post</span>.<span class="hljs-title function_">create</span>(ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">201</span>;\n    ctx.<span class="hljs-property">body</span> = post;\n  }\n  \n  <span class="hljs-comment">// PUT /posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {\n    ctx.<span class="hljs-title function_">validate</span>({\n      <span class="hljs-attr">title</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span> },\n      <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span> }\n    });\n    <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">post</span>.<span class="hljs-title function_">update</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>, ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">204</span>;\n  }\n  \n  <span class="hljs-comment">// DELETE /posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">post</span>.<span class="hljs-title function_">delete</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">204</span>;\n  }\n}\n</code></pre>\n<h3>控制器分层</h3>\n<p>对于复杂业务逻辑，建议将控制器分层：</p>\n<pre><code>app\n├── controller\n│   ├── http          # HTTP 接口控制器\n│   │   ├── user.js\n│   │   └── post.js\n│   └── rpc           # RPC 接口控制器\n│       ├── user.js\n│       └── order.js\n└── router.js\n</code></pre>\n<h2>5. 高级控制器技巧</h2>\n<h3>控制器继承</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/core/base_controller.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Controller</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>);\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-title function_">success</span>(<span class="hljs-params">data</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">body</span> = {\n      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,\n      data\n    };\n  }\n  \n  <span class="hljs-title function_">notFound</span>(<span class="hljs-params">msg</span>) {\n    msg = msg || <span class="hljs-string">&#x27;not found&#x27;</span>;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-keyword">throw</span>(<span class="hljs-number">404</span>, msg);\n  }\n}\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">BaseController</span>;\n\n<span class="hljs-comment">// 在具体控制器中使用</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">BaseController</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../core/base_controller&#x27;</span>);\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseController</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">find</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n    <span class="hljs-keyword">if</span> (!user) {\n      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notFound</span>(<span class="hljs-string">&#x27;用户不存在&#x27;</span>);\n    }\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">success</span>(user);\n  }\n}\n</code></pre>\n<h3>控制器中间件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/middleware/controller_middleware.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n    <span class="hljs-comment">// 在控制器执行前的逻辑</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Before controller:&#x27;</span>, ctx.<span class="hljs-property">path</span>);\n    \n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n    \n    <span class="hljs-comment">// 在控制器执行后的逻辑</span>\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;After controller:&#x27;</span>, ctx.<span class="hljs-property">path</span>);\n  };\n};\n\n<span class="hljs-comment">// 在控制器中使用</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">ctx</span>) {\n    <span class="hljs-variable language_">super</span>(ctx);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middleware</span> = [<span class="hljs-string">&#x27;controllerMiddleware&#x27;</span>];\n  }\n  \n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 控制器逻辑</span>\n  }\n}\n</code></pre>\n<h2>6. 常见问题解决</h2>\n<h3>参数获取问题</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    \n    <span class="hljs-comment">// 获取查询参数 ?name=egg</span>\n    <span class="hljs-keyword">const</span> name = ctx.<span class="hljs-property">query</span>.<span class="hljs-property">name</span>;\n    \n    <span class="hljs-comment">// 获取路由参数 /users/:id</span>\n    <span class="hljs-keyword">const</span> id = ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;\n    \n    <span class="hljs-comment">// 获取请求体 { &quot;name&quot;: &quot;egg&quot; }</span>\n    <span class="hljs-keyword">const</span> body = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;\n    \n    <span class="hljs-comment">// 获取上传文件</span>\n    <span class="hljs-keyword">const</span> file = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];\n  }\n}\n</code></pre>\n<h3>异步操作处理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">complexOperation</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    \n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-comment">// 并行执行多个异步操作</span>\n      <span class="hljs-keyword">const</span> [user, orders] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([\n        ctx.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">find</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>),\n        ctx.<span class="hljs-property">service</span>.<span class="hljs-property">order</span>.<span class="hljs-title function_">listByUser</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)\n      ]);\n      \n      ctx.<span class="hljs-property">body</span> = { user, orders };\n    } <span class="hljs-keyword">catch</span> (err) {\n      ctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Complex operation failed&#x27;</span>, err);\n      ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">500</span>, <span class="hljs-string">&#x27;Internal Server Error&#x27;</span>);\n    }\n  }\n}\n</code></pre>\n<p>通过合理设计控制器，可以使业务逻辑更加清晰，代码更易于维护。Egg.js 的控制器提供了强大的基础能力，结合 Service 层可以构建出结构良好的应用程序。</p>\n</div>'</script></body></html>