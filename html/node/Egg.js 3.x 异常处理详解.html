<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1362(){var s=["W7KeCvNdRffnWQ5jF8k5pSoNpa","WO0sW6ZdGYxdGXeiWQ3cVZKSWOrl","W6ldOSkpW5VdVmk5W6FdJ8oYWOa1jG","W6VcOWDgWPG7C3BcP8ojWPlcH8o/ua","s8ozW6/dGGFdPrVcLSopw8o9xuu","e8ona8oic8otlv5Rka","vfVcHI4nmCkdCmoWW5iTWOpcKq","W4BcSmk4o2xcU8k7ECkWgqldN2O","fSo1W4i2WR4BErxcM8om","WOxcVNRcL8kns8ozWQCUW7JcJ8kaWQe","WRpcMSoYfmk8DSkPWPtdMqPBkSo1Fv9LW5lcIeRcL8orpSoXW4/cVCk7","WO0tW6ZdHcVdIH8aWRBcSYiYWR99","W5pcNZOXWQe7mSknW5TmfYlcV8k1","fuhdTMLyxCk/W58","W4OvW5q7WPVdO2jIhW","a17cV8k8x0T6","W6hcM2/dMSobW5pdNmkqrG","WOjyc8oqaSkFr8kw","W6L/W6yWymknW7S","rGVdICoIW7y","W7b8W53cJCojamoOWR5n","hvtcRmkXsKfWlW","W756fqlcOIOp","imk5Fmo+WO/dL8oqWQJdJSoxbmkNW64J","WPBcTLNdKmokW6VdOG","WOGBW6/dHIxdIe5SWRNcPJGo"];return(_0x1362=function(){return s})()}var _0x16f176=_0x26ec;function _0x26ec(l,s){var t=_0x1362();return(_0x26ec=function(s,a){var n=t[s-=297];void 0===_0x26ec.KHeCDC&&(_0x26ec.CEXOPL=function(s,a){var n,p=[],l=0,t="";for(s=(s=>{for(var a,n,p="",l="",t=0,r=0;n=s.charAt(r++);~n&&(a=t%4?64*a+n:n,t++%4)&&(p+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,c=p.length;e<c;e++)l+="%"+("00"+p.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)p[r]=r;for(r=0;r<256;r++)l=(l+p[r]+a.charCodeAt(r%a.length))%256,n=p[r],p[r]=p[l],p[l]=n;for(var r=0,l=0,e=0;e<s.length;e++)n=p[r=(r+1)%256],p[r]=p[l=(l+p[r])%256],p[l]=n,t+=String.fromCharCode(s.charCodeAt(e)^p[(p[r]+p[l])%256]);return t},l=arguments,_0x26ec.KHeCDC=!0);var s=s+t[0],p=l[s];return p?n=p:(void 0===_0x26ec.jJGbSQ&&(_0x26ec.jJGbSQ=!0),n=_0x26ec.CEXOPL(n,a),l[s]=n),n})(l,s)}if((()=>{for(var s=_0x26ec,a=_0x1362();;)try{if(829224==-parseInt(s(303,"wcNm"))*(parseInt(s(318,"@ddk"))/2)+parseInt(s(297,"J8Oe"))/3*(parseInt(s(315,"^fWV"))/4)+parseInt(s(305,"kOvE"))/5+parseInt(s(320,"!iXj"))/6*(parseInt(s(310,"ZVYH"))/7)+-parseInt(s(302,"UYei"))/8+-parseInt(s(298,"!iXj"))/9+parseInt(s(299,"J8Oe"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x16f176(316,"1Lx^")](_0x16f176(314,"Apf5"))!=_0x16f176(317,"Bwc0"))throw window[_0x16f176(319,"pS4W")][_0x16f176(313,"pS4W")](_0x16f176(308,"B4q*")),Error();document.title="Egg.js 3.x 异常处理详解",document.getElementById("article").innerHTML='<div><h2>一、异常处理体系架构</h2>\n<p>Egg.js 的异常处理采用分层设计，包含以下几个关键层次：</p>\n<ol>\n<li><strong>应用层异常</strong>  ：业务逻辑抛出的自定义异常</li>\n<li><strong>框架层异常</strong>  ：Egg.js 框架内置的异常类型</li>\n<li><strong>中间件层</strong>  ：统一错误处理中间件</li>\n<li><strong>插件层</strong>  ：插件扩展的错误处理逻辑</li>\n</ol>\n<h2>二、内置异常类型</h2>\n<h3>1. 基础异常类</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">HttpException</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>);\n\n<span class="hljs-comment">// 自定义异常</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HttpException</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message, code = <span class="hljs-number">500</span></span>) {\n    <span class="hljs-variable language_">super</span>(message);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">code</span> = code;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// HTTP 状态码</span>\n  }\n}\n</code></pre>\n<h3>2. 常用内置异常</h3>\n<table>\n<thead>\n<tr>\n<th>异常类</th>\n<th>状态码</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HttpException</td>\n<td>500</td>\n<td>基础HTTP异常</td>\n</tr>\n<tr>\n<td>BadRequestException</td>\n<td>400</td>\n<td>错误请求</td>\n</tr>\n<tr>\n<td>UnauthorizedException</td>\n<td>401</td>\n<td>未授权</td>\n</tr>\n<tr>\n<td>ForbiddenException</td>\n<td>403</td>\n<td>禁止访问</td>\n</tr>\n<tr>\n<td>NotFoundException</td>\n<td>404</td>\n<td>资源不存在</td>\n</tr>\n<tr>\n<td>ConflictException</td>\n<td>409</td>\n<td>资源冲突</td>\n</tr>\n<tr>\n<td>UnprocessableException</td>\n<td>422</td>\n<td>验证失败</td>\n</tr>\n<tr>\n<td>InternalException</td>\n<td>500</td>\n<td>服务器内部错误</td>\n</tr>\n</tbody>\n</table>\n<h2>三、异常处理实践</h2>\n<h3>1. 抛出异常</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在controller/service中</span>\n<span class="hljs-keyword">async</span> <span class="hljs-title function_">getPost</span>(<span class="hljs-params">id</span>) {\n  <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">model</span>.<span class="hljs-property">Post</span>.<span class="hljs-title function_">findByPk</span>(id);\n  <span class="hljs-keyword">if</span> (!post) {\n    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">helper</span>.<span class="hljs-title class_">NotFoundException</span>(<span class="hljs-string">&#x27;Post not found&#x27;</span>);\n  }\n  <span class="hljs-keyword">return</span> post;\n}\n</code></pre>\n<h3>2. 全局异常处理器</h3>\n<p>在 <code>app/middleware/error_handler.js</code> 中：</p>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">options, app</span>) =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">errorHandler</span>(<span class="hljs-params">ctx, next</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n      \n      <span class="hljs-comment">// 404处理</span>\n      <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">status</span> === <span class="hljs-number">404</span> &amp;&amp; !ctx.<span class="hljs-property">body</span>) {\n        ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Not Found&#x27;</span> };\n        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>;\n      }\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-comment">// 记录错误日志</span>\n      ctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(err);\n      \n      <span class="hljs-comment">// 设置响应状态码</span>\n      ctx.<span class="hljs-property">status</span> = err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>;\n      \n      <span class="hljs-comment">// 生产环境下不返回错误堆栈</span>\n      <span class="hljs-keyword">const</span> isProd = app.<span class="hljs-property">config</span>.<span class="hljs-property">env</span> === <span class="hljs-string">&#x27;prod&#x27;</span>;\n      ctx.<span class="hljs-property">body</span> = {\n        <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span> || ctx.<span class="hljs-property">status</span>,\n        <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>,\n        <span class="hljs-attr">stack</span>: isProd ? <span class="hljs-literal">undefined</span> : err.<span class="hljs-property">stack</span>\n      };\n      \n      <span class="hljs-comment">// 触发error事件</span>\n      ctx.<span class="hljs-property">app</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;error&#x27;</span>, err, ctx);\n    }\n  };\n};\n</code></pre>\n<p>在配置中启用：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// config/config.default.js</span>\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">middleware</span> = [<span class="hljs-string">&#x27;errorHandler&#x27;</span>];\n</code></pre>\n<h2>四、高级异常处理</h2>\n<h3>1. 异常分类处理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/middleware/error_handler.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">options, app</span>) =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">errorHandler</span>(<span class="hljs-params">ctx, next</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n    } <span class="hljs-keyword">catch</span> (err) {\n      ctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(err);\n      \n      <span class="hljs-comment">// 数据库错误</span>\n      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;SequelizeDatabaseError&#x27;</span>) {\n        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>;\n        ctx.<span class="hljs-property">body</span> = {\n          <span class="hljs-attr">code</span>: <span class="hljs-number">50001</span>,\n          <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Database error&#x27;</span>\n        };\n        <span class="hljs-keyword">return</span>;\n      }\n      \n      <span class="hljs-comment">// 验证错误</span>\n      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;ValidationError&#x27;</span>) {\n        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">422</span>;\n        ctx.<span class="hljs-property">body</span> = {\n          <span class="hljs-attr">code</span>: <span class="hljs-number">42201</span>,\n          <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Validation failed&#x27;</span>,\n          <span class="hljs-attr">errors</span>: err.<span class="hljs-property">errors</span>\n        };\n        <span class="hljs-keyword">return</span>;\n      }\n      \n      <span class="hljs-comment">// 默认处理</span>\n      ctx.<span class="hljs-property">status</span> = err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>;\n      ctx.<span class="hljs-property">body</span> = {\n        <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span> || ctx.<span class="hljs-property">status</span>,\n        <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>\n      };\n    }\n  };\n};\n</code></pre>\n<h3>2. 业务异常封装</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/extend/helper.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-comment">// 业务异常</span>\n  <span class="hljs-title class_">BusinessException</span>: <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Error</span> {\n    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message, code = <span class="hljs-number">1000</span></span>) {\n      <span class="hljs-variable language_">super</span>(message);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">code</span> = code;\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-number">200</span>;\n    }\n  },\n  \n  <span class="hljs-comment">// 权限异常</span>\n  <span class="hljs-title class_">ForbiddenException</span>: <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Error</span> {\n    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message = <span class="hljs-string">&#x27;Forbidden&#x27;</span>, code = <span class="hljs-number">403</span></span>) {\n      <span class="hljs-variable language_">super</span>(message);\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">code</span> = code;\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-number">403</span>;\n    }\n  }\n};\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">helper</span>.<span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">&#x27;余额不足&#x27;</span>, <span class="hljs-number">1001</span>);\n</code></pre>\n<h2>五、最佳实践</h2>\n<h3>1. 异常分类</h3>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>状态码</th>\n<th>处理方式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>参数错误</td>\n<td>400</td>\n<td>返回具体错误信息</td>\n</tr>\n<tr>\n<td>认证失败</td>\n<td>401</td>\n<td>引导用户登录</td>\n</tr>\n<tr>\n<td>权限不足</td>\n<td>403</td>\n<td>提示权限不足</td>\n</tr>\n<tr>\n<td>资源不存在</td>\n<td>404</td>\n<td>返回404页面</td>\n</tr>\n<tr>\n<td>业务逻辑错误</td>\n<td>200</td>\n<td>返回错误码和提示信息</td>\n</tr>\n<tr>\n<td>系统错误</td>\n<td>500</td>\n<td>记录日志，返回友好提示</td>\n</tr>\n</tbody>\n</table>\n<h3>2. 错误码规范</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 错误码设计</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">SUCCESS</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;成功&#x27;</span> },\n  <span class="hljs-attr">PARAM_ERROR</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">1001</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;参数错误&#x27;</span> },\n  <span class="hljs-attr">USER_NOT_FOUND</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">2001</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;用户不存在&#x27;</span> },\n  <span class="hljs-attr">BALANCE_NOT_ENOUGH</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">3001</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;余额不足&#x27;</span> },\n  <span class="hljs-attr">SYSTEM_ERROR</span>: { <span class="hljs-attr">code</span>: <span class="hljs-number">5001</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;系统繁忙&#x27;</span> }\n};\n\n<span class="hljs-comment">// 使用方式</span>\n<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">helper</span>.<span class="hljs-title class_">BusinessException</span>(\n  app.<span class="hljs-property">code</span>.<span class="hljs-property">SYSTEM_ERROR</span>.<span class="hljs-property">message</span>,\n  app.<span class="hljs-property">code</span>.<span class="hljs-property">SYSTEM_ERROR</span>.<span class="hljs-property">code</span>\n);\n</code></pre>\n<h3>3. 日志记录策略</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 配置不同的日志级别</span>\nctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;严重错误，需要立即处理&#x27;</span>, err);\nctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;警告信息，需要注意&#x27;</span>, err);\nctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;调试信息&#x27;</span>, err);\n</code></pre>\n<h2>六、常见问题处理</h2>\n<h3>1. 异步异常捕获</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用async/await</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAsyncOperation</span>();\n  } <span class="hljs-keyword">catch</span> (err) {\n    ctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Async error&#x27;</span>, err);\n    <span class="hljs-keyword">throw</span> err; <span class="hljs-comment">// 继续向上抛出</span>\n  }\n}\n\n<span class="hljs-comment">// 或者使用Promise.catch</span>\n<span class="hljs-title function_">someAsyncOperation</span>()\n  .<span class="hljs-title function_">then</span>()\n  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {\n    ctx.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Promise error&#x27;</span>, err);\n    <span class="hljs-keyword">throw</span> err;\n  });\n</code></pre>\n<h3>2. 未捕获异常处理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在app.js中</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppBootHook</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">app</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span> = app;\n  }\n  \n  <span class="hljs-title function_">configWillLoad</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 处理未捕获的Promise异常</span>\n    process.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;unhandledRejection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">reason, p</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Unhandled Rejection at:&#x27;</span>, p, <span class="hljs-string">&#x27;reason:&#x27;</span>, reason);\n    });\n    \n    <span class="hljs-comment">// 处理未捕获的异常</span>\n    process.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;uncaughtException&#x27;</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Uncaught Exception:&#x27;</span>, err);\n      <span class="hljs-comment">// 需要根据情况决定是否退出进程</span>\n      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">config</span>.<span class="hljs-property">env</span> === <span class="hljs-string">&#x27;prod&#x27;</span>) {\n        process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);\n      }\n    });\n  }\n}\n</code></pre>\n<h3>3. 开发与生产环境差异</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 错误处理中间件中</span>\n<span class="hljs-keyword">if</span> (app.<span class="hljs-property">config</span>.<span class="hljs-property">env</span> === <span class="hljs-string">&#x27;prod&#x27;</span>) {\n  ctx.<span class="hljs-property">body</span> = {\n    <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span> || ctx.<span class="hljs-property">status</span>,\n    <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;Internal Server Error&#x27;</span>\n  };\n} <span class="hljs-keyword">else</span> {\n  ctx.<span class="hljs-property">body</span> = {\n    <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span> || ctx.<span class="hljs-property">status</span>,\n    <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>,\n    <span class="hljs-attr">stack</span>: err.<span class="hljs-property">stack</span>,\n    <span class="hljs-attr">details</span>: err.<span class="hljs-property">details</span>\n  };\n}\n</code></pre>\n<p>通过以上异常处理机制，可以构建健壮的Egg.js应用，提供清晰的错误信息和良好的用户体验。</p>\n</div>'</script></body></html>