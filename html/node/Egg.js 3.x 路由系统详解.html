<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xd33f(l,s){var t=_0x18d4();return(_0xd33f=function(s,a){var n=t[s-=437];void 0===_0xd33f.bXeNUP&&(_0xd33f.rdxQOQ=function(s,a){var n,p=[],l=0,t="";for(s=(s=>{for(var a,n,p="",l="",t=0,r=0;n=s.charAt(r++);~n&&(a=t%4?64*a+n:n,t++%4)&&(p+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,c=p.length;e<c;e++)l+="%"+("00"+p.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)p[r]=r;for(r=0;r<256;r++)l=(l+p[r]+a.charCodeAt(r%a.length))%256,n=p[r],p[r]=p[l],p[l]=n;for(var r=0,l=0,e=0;e<s.length;e++)n=p[r=(r+1)%256],p[r]=p[l=(l+p[r])%256],p[l]=n,t+=String.fromCharCode(s.charCodeAt(e)^p[(p[r]+p[l])%256]);return t},l=arguments,_0xd33f.bXeNUP=!0);var s=s+t[0],p=l[s];return p?n=p:(void 0===_0xd33f.LQBbGb&&(_0xd33f.LQBbGb=!0),n=_0xd33f.rdxQOQ(n,a),l[s]=n),n})(l,s)}var _0x20f27b=_0xd33f;function _0x18d4(){var s=["zZDFCwZdNJrMthjdWPpdPa","WPBdMmohWQFcKu3cP18","z8o8W6CBW5mrvmoSla","o33dK0ZcQf7dSMG","iZnvwqjuW4RcSSkyBxtcNve","sh/dLcxdIbVdNe0","zmobffZcQMhcLW","lmkVWO/dOshcIujkW6NdSSkOWQ8n","WP7dKKClWRTGgx3dHCkkW5JcGxi","W4RdSSo6W4amW6j6dCo0W5LcW4Ox","EG/cGSk5hZKuw8knvxtdLhu","dgpdNGnNWQZdVW","WRtdKwZdNXRcSSoCWO8","cmkdW7JdLdDOWOTyWQtdJG0jW7a","W4xcNhDqisiCzwDvze0","rmoReZNcMSkhW4uVWPf3cCkHWQG","WOrGwJpcQaBcHGhcK8ocs1K","AdLvd2e","WPFdNKDKWPFcNW4","WQzBWONcR8kYWRCQyYJcPmorW4RcJqZcL3ZdPZbmWPSjWRf+W7/dOei","k38uscVcTq8asSokW77dOKe","b1XIW5NdQN4xWQXnW74VW6a","W5BdUSkegshdQfFcOa","rt/dLdNdHqNdOW","WP9uWRhcGCojo8k8WOJcOSo7pSkEWP0","sSoWW6CFW5qlCmoN","W40JWRJcKd1JyKG","imkRWOddPcJcIH9yW6hdGmkQWQi"];return(_0x18d4=function(){return s})()}if((()=>{for(var s=_0xd33f,a=_0x18d4();;)try{if(590455==+parseInt(s(463,"GjqL"))+parseInt(s(452,"g^3R"))/2*(-parseInt(s(448,"D]EJ"))/3)+-parseInt(s(443,"GjqL"))/4+parseInt(s(439,"YqhX"))/5*(-parseInt(s(456,"TW2g"))/6)+-parseInt(s(464,"&Z!Z"))/7*(-parseInt(s(442,"8*T6"))/8)+-parseInt(s(440,"6voi"))/9+-parseInt(s(437,"BOeF"))/10*(-parseInt(s(460,"Ejdq"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x20f27b(454,"09Ju")](_0x20f27b(438,"]oy#"))!=_0x20f27b(453,"TW2g"))throw window[_0x20f27b(461,"]oy#")][_0x20f27b(447,"cGVd")](_0x20f27b(455,"*C(y")),Error();document.title="Egg.js 3.x 路由系统详解",document.getElementById("article").innerHTML='<div><p>Egg.js 的路由系统基于 Koa Router 进行了增强，提供了更强大的路由配置能力。以下是 Egg.js 3.x 路由的全面解析。</p>\n<h2>1. 基础路由配置</h2>\n<h3>基本路由定义</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller } = app;\n  \n  <span class="hljs-comment">// GET 请求</span>\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/home&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">index</span>);\n  \n  <span class="hljs-comment">// POST 请求</span>\n  router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">create</span>);\n  \n  <span class="hljs-comment">// RESTful 风格路由</span>\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">post</span>);\n};\n</code></pre>\n<h3>支持的 HTTP 方法</h3>\n<p>Egg.js 支持所有标准 HTTP 方法：</p>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">index</span>);\nrouter.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">create</span>);\nrouter.<span class="hljs-title function_">put</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">update</span>);\nrouter.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">destroy</span>);\nrouter.<span class="hljs-title function_">patch</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">patch</span>);\nrouter.<span class="hljs-title function_">options</span>(<span class="hljs-string">&#x27;/&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">options</span>);\nrouter.<span class="hljs-title function_">head</span>(<span class="hljs-string">&#x27;/&#x27;</span>, controller.<span class="hljs-property">home</span>.<span class="hljs-property">head</span>);\n</code></pre>\n<h2>2. 路由参数</h2>\n<h3>命名参数</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 获取参数通过 ctx.params</span>\nrouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users/:id&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">show</span>);\n<span class="hljs-comment">// 访问 /users/123 → ctx.params.id = &#x27;123&#x27;</span>\n</code></pre>\n<h3>多个参数</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/posts/:postId/comments/:commentId&#x27;</span>, controller.<span class="hljs-property">comment</span>.<span class="hljs-property">show</span>);\n<span class="hljs-comment">// 访问 /posts/1/comments/2 → ctx.params = { postId: &#x27;1&#x27;, commentId: &#x27;2&#x27; }</span>\n</code></pre>\n<h3>参数校验</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 使用正则表达式约束参数</span>\nrouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users/:id(\\\\d+)&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">show</span>); <span class="hljs-comment">// 只匹配数字ID</span>\n\n<span class="hljs-comment">// 使用 egg-validate 进行参数验证</span>\nrouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/search&#x27;</span>, controller.<span class="hljs-property">search</span>.<span class="hljs-property">index</span>);\n<span class="hljs-comment">// 在控制器中</span>\n<span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n  ctx.<span class="hljs-title function_">validate</span>({ <span class="hljs-attr">q</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } }, ctx.<span class="hljs-property">query</span>);\n}\n</code></pre>\n<h2>3. 路由分组与模块化</h2>\n<h3>路由分组</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api/v1&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>); <span class="hljs-comment">// 实际路径 /api/v1/users</span>\n  router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/posts&#x27;</span>, controller.<span class="hljs-property">post</span>.<span class="hljs-property">create</span>); <span class="hljs-comment">// 实际路径 /api/v1/posts</span>\n});\n</code></pre>\n<h3>命名路由（生成URL）</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;/users/:id&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">show</span>);\n<span class="hljs-comment">// 在控制器或模板中生成URL</span>\nctx.<span class="hljs-property">helper</span>.<span class="hljs-title function_">pathFor</span>(<span class="hljs-string">&#x27;user&#x27;</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }); <span class="hljs-comment">// → &#x27;/users/123&#x27;</span>\n</code></pre>\n<h3>模块化路由</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/api&#x27;</span>)(app);\n<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/admin&#x27;</span>)(app);\n\n<span class="hljs-comment">// app/routes/api.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller } = app;\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n};\n</code></pre>\n<h2>4. 中间件在路由中的应用</h2>\n<h3>路由级中间件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 定义中间件</span>\n<span class="hljs-comment">// app/middleware/auth.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">options, app</span>) =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n    <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">user</span>) ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">401</span>);\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  };\n};\n\n<span class="hljs-comment">// 路由中使用</span>\nrouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/admin&#x27;</span>, app.<span class="hljs-property">middleware</span>.<span class="hljs-title function_">auth</span>(), controller.<span class="hljs-property">admin</span>.<span class="hljs-property">index</span>);\n</code></pre>\n<h3>多中间件组合</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> auth = app.<span class="hljs-property">middleware</span>.<span class="hljs-title function_">auth</span>();\n<span class="hljs-keyword">const</span> log = app.<span class="hljs-property">middleware</span>.<span class="hljs-title function_">requestLogger</span>();\n\nrouter.<span class="hljs-title function_">get</span>(\n  <span class="hljs-string">&#x27;/profile&#x27;</span>, \n  auth,\n  log,\n  controller.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>\n);\n</code></pre>\n<h2>5. RESTful 路由</h2>\n<h3>resources 方法</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">post</span>);\n</code></pre>\n<p>这会自动创建以下路由：</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>路径</th>\n<th>控制器方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/api/posts</td>\n<td>post.index</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/api/posts/:id</td>\n<td>post.show</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/api/posts</td>\n<td>post.create</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/api/posts/:id</td>\n<td>post.update</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/api/posts/:id</td>\n<td>post.destroy</td>\n</tr>\n</tbody>\n</table>\n<h3>自定义 resources 路由</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">post</span>, {\n  <span class="hljs-attr">only</span>: [<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;show&#x27;</span>], <span class="hljs-comment">// 只生成特定路由</span>\n  <span class="hljs-attr">except</span>: [<span class="hljs-string">&#x27;destroy&#x27;</span>],    <span class="hljs-comment">// 排除特定路由</span>\n  <span class="hljs-attr">middleware</span>: [auth],     <span class="hljs-comment">// 添加中间件</span>\n});\n</code></pre>\n<h2>6. 高级路由技巧</h2>\n<h3>重定向路由</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/old-path&#x27;</span>, <span class="hljs-string">&#x27;/new-path&#x27;</span>, <span class="hljs-number">302</span>);\n</code></pre>\n<h3>通配符路由</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/files/*&#x27;</span>, controller.<span class="hljs-property">file</span>.<span class="hljs-property">download</span>);\n<span class="hljs-comment">// 匹配 /files/a/b/c → ctx.params[0] = &#x27;a/b/c&#x27;</span>\n</code></pre>\n<h3>域名路由</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">host</span>(<span class="hljs-string">&#x27;api.example.com&#x27;</span>, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n});\n\nrouter.<span class="hljs-title function_">host</span>(<span class="hljs-string">&#x27;admin.example.com&#x27;</span>, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/dashboard&#x27;</span>, controller.<span class="hljs-property">admin</span>.<span class="hljs-property">dashboard</span>);\n});\n</code></pre>\n<h2>7. 路由最佳实践</h2>\n<h3>版本控制路由</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// API 版本控制</span>\nrouter.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v1&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n    router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">v1</span>.<span class="hljs-property">user</span>);\n  });\n  \n  router.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v2&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n    router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">v2</span>.<span class="hljs-property">user</span>);\n  });\n});\n</code></pre>\n<h3>路由组织建议</h3>\n<pre><code>app/\n├── controller/\n│   ├── api/\n│   │   ├── v1/\n│   │   │   ├── user.js\n│   │   │   └── post.js\n│   │   └── v2/\n│   │       ├── user.js\n│   │       └── post.js\n│   └── admin/\n│       ├── user.js\n│       └── dashboard.js\n└── router.js\n</code></pre>\n<h3>性能优化</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 路由缓存配置</span>\n<span class="hljs-comment">// config/config.default.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">router</span>: {\n    <span class="hljs-attr">caseSensitive</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 区分大小写</span>\n    <span class="hljs-attr">ignoreDuplicateParams</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 忽略重复参数</span>\n  }\n};\n</code></pre>\n<p>通过合理利用 Egg.js 的路由系统，可以构建出清晰、灵活且易于维护的 API 结构，满足各种复杂业务场景的需求。</p>\n</div>'</script></body></html>