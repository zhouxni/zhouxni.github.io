<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x343056=_0x1624;function _0x3d96(){var s=["W6qdWRxcGgz6W4/dIa","WOS3A11yW5HcW4HRs8ojhx8","iKdcKSkWgIpdL8o4W5bMWPJdQG","hSoZWR44W4y","C8k6WOxdGHFcVSomaG","keFcLCk4gYhcSCo0W5rKWONdTLC","WR3cPurdymodaYNdMSoRWOldMW","W6n5W6ldNWJdQxRcR8oYuaq","W4nrWPZdK8okW5fGtJ4XW73cP8knB1/dISoeWRyiW6FcT3bUceJdJa","WQmLWRpcU8kQzSoF","W4VcNXddHmk1WPeCW7DwW6/cUmk7xti","fX54iYFdQ8ktWQn4WPxdOW0+","W6nXW6ddNGxcN0VcK8oBDq7cOG","xCk2W7H6WOVdRmoHWOVcTcJdOmk3WQ8","WPOqWQNdQSoXWP8xiW","W6ilW6NdVYb3W7tdMG12WPO","daVdIGaTpmkLW5GqWO7dImoaWPfd","BJldVXpcOcX2FI5pW4NcImoq","W7X4W7tdGSoMn8kkW7ldHuldLmoXW6q","WQmOrZlcJx7dVa","daZcV35wECofWQS","W6BdPvVcMCkeW7BdNs07","dmoFWPmAef3dKuddMeZdNvu","teeUDwdcSCooWRu"];return(_0x3d96=function(){return s})()}function _0x1624(t,s){var p=_0x3d96();return(_0x1624=function(s,a){var n=p[s-=205];void 0===_0x1624.cOTUlD&&(_0x1624.UrlJVS=function(s,a){var n,l=[],t=0,p="";for(s=(s=>{for(var a,n,l="",t="",p=0,c=0;n=s.charAt(c++);~n&&(a=p%4?64*a+n:n,p++%4)&&(l+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,h=l.length;e<h;e++)t+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(t)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)t=(t+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[t],l[t]=n;for(var c=0,t=0,e=0;e<s.length;e++)n=l[c=(c+1)%256],l[c]=l[t=(t+l[c])%256],l[t]=n,p+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[t])%256]);return p},t=arguments,_0x1624.cOTUlD=!0);var s=s+p[0],l=t[s];return l?n=l:(void 0===_0x1624.UFWlEy&&(_0x1624.UFWlEy=!0),n=_0x1624.UrlJVS(n,a),t[s]=n),n})(t,s)}if((()=>{for(var s=_0x1624,a=_0x3d96();;)try{if(985334==+parseInt(s(223,"mF89"))+-parseInt(s(213,"*1Ey"))/2+parseInt(s(226,"g%KZ"))/3+parseInt(s(222,"vmq#"))/4+-parseInt(s(225,"yn3H"))/5*(parseInt(s(216,"*1Ey"))/6)+-parseInt(s(227,"Q9eg"))/7+-parseInt(s(212,"]B#T"))/8*(-parseInt(s(211,"g%KZ"))/9))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x343056(220,"pYQX")](_0x343056(208,"LQx%"))!=_0x343056(214,"LA#W"))throw window[_0x343056(210,"vmq#")][_0x343056(206,"Ptfm")](_0x343056(219,"yn3H")),Error();document.title=" Node.js 模板引擎",document.getElementById("article").innerHTML='<div><p>在 Node.js 实现 SSR（服务器端渲染）时，模板引擎扮演着核心角色，它负责将动态数据与静态 HTML 结构融合，生成最终发送给客户端的完整页面。不同的模板引擎有不同的语法风格和功能特性，下面详细解析主流模板引擎的工作原理、核心特性及实战用法。</p>\n<h3>一、模板引擎的核心工作原理</h3>\n<p>模板引擎的本质是<strong>字符串解析器</strong>   ，其工作流程可概括为：</p>\n<ol>\n<li><strong>编译阶段</strong>   ：将模板文件（含特殊语法标签）解析为可执行的函数</li>\n<li><strong>渲染阶段</strong>   ：传入数据对象，执行编译后的函数，生成最终 HTML 字符串</li>\n</ol>\n<pre><code>模板文件（带语法标签） → 编译 → 渲染函数 → 传入数据 → 最终 HTML\n</code></pre>\n<p>Node.js 环境下，模板引擎通常与 Express/Koa 等 Web 框架集成，通过中间件完成模板文件的加载、编译和渲染。</p>\n<h3>二、主流模板引擎深度解析</h3>\n<h4>1. EJS（Embedded JavaScript）</h4>\n<p><strong>核心特点</strong>   ：语法最接近原生 HTML，直接嵌入 JavaScript 代码，学习成本极低。</p>\n<p><strong>语法规则</strong>   ：</p>\n<ul>\n<li><code>&lt;%= variable %&gt;</code>：输出变量（自动 HTML 转义，防 XSS）</li>\n<li><code>&lt;%- variable %&gt;</code>：输出原始 HTML（不转义）</li>\n<li><code>&lt;% code %&gt;</code>：执行 JavaScript 代码（条件、循环等）</li>\n<li><code>&lt;%- include(\'path\') %&gt;</code>：引入其他模板片段</li>\n<li><code>&lt;%# comment %&gt;</code>：模板注释（不会输出到 HTML）</li>\n</ul>\n<p><strong>实战示例</strong>   ：</p>\n<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&lt;%= title %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">\n      <span class="hljs-selector-class">.post</span> {\n        <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;\n        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;\n        <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;\n      }\n    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&lt;%= title %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n      &lt;% if (isLogin) { %&gt;\n      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>欢迎，&lt;%= user.name %&gt;！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n      &lt;% } else { %&gt;\n      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/login&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n      &lt;% } %&gt;\n    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>\n\n    <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>\n      &lt;% if (posts.length &gt; 0) { %&gt; &lt;% posts.forEach(post =&gt; { %&gt;\n      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&lt;%= post.title %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>作者：&lt;%= post.author %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n        &lt;%- post.content %&gt;\n        <span class="hljs-comment">&lt;!-- 输出原始 HTML --&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n      &lt;% }) %&gt; &lt;% } else { %&gt;\n      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无文章<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n      &lt;% } %&gt;\n    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>\n\n    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© &lt;%= new Date().getFullYear() %&gt; 博客平台<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>\n</code></pre>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);\n<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();\n\n<span class="hljs-comment">// 配置 EJS 模板引擎</span>\napp.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;ejs&quot;</span>);\napp.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;views&quot;</span>, <span class="hljs-string">&quot;./views&quot;</span>); <span class="hljs-comment">// 模板文件存放目录</span>\n\n<span class="hljs-comment">// 模拟数据</span>\n<span class="hljs-keyword">const</span> blogData = {\n  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Node.js SSR 实战&quot;</span>,\n  <span class="hljs-attr">posts</span>: [\n    {\n      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,\n      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;EJS 模板引擎详解&quot;</span>,\n      <span class="hljs-attr">author</span>: <span class="hljs-string">&quot;张三&quot;</span>,\n      <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;&lt;p&gt;这是一篇关于 EJS 的文章&lt;/p&gt;&quot;</span>,\n    },\n    {\n      <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,\n      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;SSR 性能优化技巧&quot;</span>,\n      <span class="hljs-attr">author</span>: <span class="hljs-string">&quot;李四&quot;</span>,\n      <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;&lt;p&gt;分享 SSR 优化经验&lt;/p&gt;&quot;</span>,\n    },\n  ],\n  <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;访客&quot;</span> },\n};\n\n<span class="hljs-comment">// 路由处理</span>\napp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {\n  <span class="hljs-comment">// 渲染模板并传递数据</span>\n  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;index&quot;</span>, blogData);\n});\n\napp.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;服务器运行在 http://localhost:3000&quot;</span>);\n});\n</code></pre>\n<p><strong>EJS 优势场景</strong>   ：</p>\n<ul>\n<li>快速开发原型或小型项目</li>\n<li>团队中多数人熟悉原生 HTML/JS</li>\n<li>需要在模板中编写复杂逻辑（如数据转换）</li>\n</ul>\n<h4>2. Pug（原 Jade）</h4>\n<p><strong>核心特点</strong>   ：采用缩进式语法，去除所有闭合标签，代码极其简洁，但有一定学习成本。</p>\n<p><strong>语法规则</strong>   ：</p>\n<ul>\n<li>缩进表示层级关系（必须统一使用空格或制表符）</li>\n<li><code>tag#id.class</code>：定义 HTML 标签（如 <code>div#content.post-list</code>）</li>\n<li><code>=</code> 输出变量（自动转义），<code>!=</code> 输出原始 HTML</li>\n<li><code>- code</code>：执行 JavaScript 代码</li>\n<li><code>include path</code>：引入其他模板</li>\n<li><code>mixin</code>：定义可复用组件</li>\n</ul>\n<p><strong>Pug 优势场景</strong>   ：</p>\n<ul>\n<li>追求代码简洁性和开发效率</li>\n<li>团队能统一遵守缩进规范</li>\n<li>需要大量复用组件（mixin 功能强大）</li>\n</ul>\n<h4>3. Handlebars</h4>\n<p><strong>核心特点</strong>   ：逻辑与视图分离，限制模板中的复杂逻辑，适合大型团队协作和维护。</p>\n<p><strong>语法规则</strong>   ：</p>\n<ul>\n<li><code>{{variable}}</code>：输出变量（自动转义）</li>\n<li><code>{{{variable}}}</code>：输出原始 HTML</li>\n<li><code>{{#if condition}}...{{/if}}</code>：条件判断</li>\n<li><code>{{#each list}}...{{/each}}</code>：循环遍历</li>\n<li><code>{{&gt; partial}}</code>：引入部分模板</li>\n<li>支持自定义助手函数（Helper）扩展功能</li>\n</ul>\n<p><strong>实战示例</strong>   ：</p>\n<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">\n      <span class="hljs-selector-class">.post</span> {\n        <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;\n        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;\n        <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;\n      }\n    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n    {{{body}}}\n    <span class="hljs-comment">&lt;!-- 页面内容会插入到这里 --&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© {{formatDate(new Date())}} 博客平台<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>\n</code></pre>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n  {{#if isLogin}}\n  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>欢迎，{{user.name}}！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n  {{else}}\n  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/login&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n  {{/if}}\n<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>\n  {{#if posts.length}} {{#each posts}}\n  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>作者：{{author}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n    {{{content}}}\n    <span class="hljs-comment">&lt;!-- 输出原始 HTML --&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n  {{/each}} {{else}}\n  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无文章<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n  {{/if}}\n<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>\n</code></pre>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);\n<span class="hljs-keyword">const</span> exphbs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-handlebars&quot;</span>);\n<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();\n\n<span class="hljs-comment">// 配置 Handlebars</span>\napp.<span class="hljs-title function_">engine</span>(\n  <span class="hljs-string">&quot;handlebars&quot;</span>,\n  exphbs.<span class="hljs-title function_">engine</span>({\n    <span class="hljs-attr">defaultLayout</span>: <span class="hljs-string">&quot;main&quot;</span>, <span class="hljs-comment">// 默认布局模板</span>\n    <span class="hljs-attr">helpers</span>: {\n      <span class="hljs-comment">// 自定义助手函数：格式化日期</span>\n      <span class="hljs-attr">formatDate</span>: <span class="hljs-function">(<span class="hljs-params">date</span>) =&gt;</span> {\n        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date).<span class="hljs-title function_">toLocaleDateString</span>();\n      },\n    },\n  }),\n);\napp.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;handlebars&quot;</span>);\napp.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;views&quot;</span>, <span class="hljs-string">&quot;./views&quot;</span>);\n\n<span class="hljs-comment">// 路由和数据处理（同 EJS 示例）</span>\napp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {\n  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;index&quot;</span>, blogData);\n});\n\napp.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);\n</code></pre>\n<p><strong>Handlebars 优势场景</strong>   ：</p>\n<ul>\n<li>大型团队协作（限制逻辑复杂度，统一视图风格）</li>\n<li>需要严格分离业务逻辑和视图层</li>\n<li>需自定义通用功能（通过助手函数扩展）</li>\n</ul>\n<h4>4. Nunjucks</h4>\n<p><strong>核心特点</strong>   ：功能最全面的模板引擎，支持模板继承、宏定义、异步渲染等高级特性，语法类似 Jinja2。</p>\n<p><strong>独特功能</strong>   ：</p>\n<ul>\n<li>模板继承（<code>{% extends %}</code> + <code>{% block %}</code>）</li>\n<li>宏定义（<code>{% macro %}</code>）：类似组件复用</li>\n<li>异步支持：可在模板中处理异步数据（<code>async/await</code>）</li>\n<li>沙箱模式：限制模板中的代码执行权限</li>\n</ul>\n<p><strong>语法示例</strong>   ：</p>\n<pre><code class="language-html">{% extends &quot;layout.njk&quot; %}\n<span class="hljs-comment">&lt;!-- 继承布局模板 --&gt;</span>\n\n{% block content %}\n<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n\n{% macro postItem(post) %}\n<span class="hljs-comment">&lt;!-- 定义宏（组件） --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{ post.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ post.content }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n{% endmacro %} {% for post in posts %} {{ postItem(post) }}\n<span class="hljs-comment">&lt;!-- 调用宏 --&gt;</span>\n{% endfor %} {% endblock %}\n</code></pre>\n<h3>三、模板引擎关键技术点</h3>\n<h4>1. 模板缓存机制</h4>\n<p>生产环境中，模板引擎会缓存编译后的函数，避免重复解析模板文件，提升性能：</p>\n<ul>\n<li>Express 中通过 <code>app.enable(\'view cache\')</code> 开启（生产环境默认开启）</li>\n<li>手动清除缓存：<code>delete require.cache[require.resolve(\'./views/template.ejs\')]</code></li>\n</ul>\n<h4>2. 防 XSS 攻击</h4>\n<p>模板引擎默认会对输出内容进行 HTML 转义（如将 <code>&lt;</code> 转为 <code>&amp;lt;</code>），但需注意：</p>\n<ul>\n<li>输出可信的原始 HTML 时，使用特定语法（如 EJS 的 <code>&lt;%- %&gt;</code>）</li>\n<li>不可信内容（如用户输入）必须保持默认转义</li>\n</ul>\n<h4>3. 模板继承与复用</h4>\n<p>减少代码冗余的核心手段：</p>\n<ul>\n<li>布局模板（Layout）：定义页面骨架（头部、底部、导航等）</li>\n<li>部分模板（Partial）：复用小片段（如评论框、广告位）</li>\n<li>组件/宏（Macro）：带参数的可复用模块</li>\n</ul>\n<h4>4. 性能对比</h4>\n<table>\n<thead>\n<tr>\n<th>模板引擎</th>\n<th>编译速度</th>\n<th>渲染速度</th>\n<th>内存占用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>EJS</td>\n<td>快</td>\n<td>快</td>\n<td>中</td>\n</tr>\n<tr>\n<td>Pug</td>\n<td>中</td>\n<td>快</td>\n<td>中</td>\n</tr>\n<tr>\n<td>Handlebars</td>\n<td>中</td>\n<td>中</td>\n<td>低</td>\n</tr>\n<tr>\n<td>Nunjucks</td>\n<td>较慢</td>\n<td>中</td>\n<td>较高</td>\n</tr>\n</tbody>\n</table>\n<p><em>注：性能差异在中小型应用中不明显，大型应用需结合实际场景测试</em></p>\n<h3>四、选择建议</h3>\n<ol>\n<li><strong>团队熟悉度优先</strong>   ：如果团队已习惯某种语法（如 Python 开发者可能更喜欢 Pug 的缩进），优先选择对应引擎。</li>\n<li><strong>项目复杂度</strong>   ：\n<ul>\n<li>简单项目：EJS（快速上手）</li>\n<li>中型项目：Handlebars（平衡功能与规范）</li>\n<li>大型项目：Nunjucks（丰富的高级特性）</li>\n</ul>\n</li>\n<li><strong>前后端复用</strong>   ：如需前后端共用模板，考虑 Mustache（无逻辑，跨语言支持）。</li>\n<li><strong>框架适配</strong>   ：\n<ul>\n<li>Express/Koa：所有模板引擎都有良好支持</li>\n<li>NestJS：推荐使用 Nunjucks 或 Handlebars（与 TypeScript 配合更佳）</li>\n</ul>\n</li>\n</ol>\n<h3>五、总结</h3>\n<p>Node.js 模板引擎是 SSR 技术的基础组件，它们通过简化动态 HTML 生成过程，大幅提升开发效率。选择时需综合考虑团队习惯、项目需求和性能特性。对于现代前端框架（React/Vue）主导的项目，虽然更多使用 JSX 或框架自带的模板系统，但传统模板引擎在轻量级应用、内容网站和后端主导的项目中仍有不可替代的优势。</p>\n</div>'</script></body></html>