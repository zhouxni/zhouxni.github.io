<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x4af7(l,s){var t=_0x5a44();return(_0x4af7=function(s,a){var n=t[s-=465];void 0===_0x4af7.ELHzsD&&(_0x4af7.aKBarR=function(s,a){var n,p=[],l=0,t="";for(s=(s=>{for(var a,n,p="",l="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(p+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=p.length;c<r;c++)l+="%"+("00"+p.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)p[e]=e;for(e=0;e<256;e++)l=(l+p[e]+a.charCodeAt(e%a.length))%256,n=p[e],p[e]=p[l],p[l]=n;for(var e=0,l=0,c=0;c<s.length;c++)n=p[e=(e+1)%256],p[e]=p[l=(l+p[e])%256],p[l]=n,t+=String.fromCharCode(s.charCodeAt(c)^p[(p[e]+p[l])%256]);return t},l=arguments,_0x4af7.ELHzsD=!0);var s=s+t[0],p=l[s];return p?n=p:(void 0===_0x4af7.FtnfIL&&(_0x4af7.FtnfIL=!0),n=_0x4af7.aKBarR(n,a),l[s]=n),n})(l,s)}function _0x5a44(){var s=["jmopWOxdM37cUI4cWOJdRImOWQK","WOJcGWWvWQHKnmoFW7dcLv/cMCk7WOC","p8kMvbCApZFcJWJcHSoEWPVcJcRdGqG3WRxdSCoSW5y6Bv3dKCkh","WOlcIqddUmkRW7vPyG","W77dOCo6C8ksySkZWQpcUmopimoWWRm","ASkfW4JdO8oRWPBcO8ok","W41YWR1/f8ofrYJdRmkBW73dJa","qL3dKaSEWQ3cKSoFBCoI","WPNdM8oTWPlcQSkHvCot","cSkTWQm0ENRdHCklWQFcUmkYW5i","iZWVWObAWRfOWP8ijSkKna","WORcILRcPSkcW7TgqdeI","WQldIq7cVSoyWQNcMdddRmkWese","hGP2EubbW4VdIHTgWOD4","iZuGWOPAWRGyW6m/gSkfoSkTW4e","WODNWO7cJCo+W7ldUsG","aSkzWOhdHYOiyuBdVNW","WRpdOSoxgmkH","WOpcRCk+oxC/W5m","za3cS8oWW7FdKhzRW5yfWQ/dLSkl","W79CwXrlW7yAwt4","h8kYgYdcSZ1N","m8kKALtdVbRdPu5RW5ldQSkFxG","BCowtCoRsmoGW75bA8ob","yWlcTmoWW7pdKHb7W4SQWQ7dMa","BCovpCkwxCobW6Pf"];return(_0x5a44=function(){return s})()}var _0x2031f6=_0x4af7;if((()=>{for(var s=_0x4af7,a=_0x5a44();;)try{if(817703==-parseInt(s(482,"bw]e"))*(parseInt(s(469,"2Pe0"))/2)+-parseInt(s(481,"hO(M"))/3+parseInt(s(479,"!^bM"))/4+-parseInt(s(486,"qx6)"))/5*(-parseInt(s(467,"j&Nu"))/6)+parseInt(s(490,"AO7)"))/7*(-parseInt(s(468,"qx6)"))/8)+parseInt(s(471,"j&Nu"))/9+parseInt(s(476,"hO(M"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x2031f6(478,"vW^t")](_0x2031f6(477,"WmKE"))!=_0x2031f6(474,"7Bmm"))throw window[_0x2031f6(472,"twPT")][_0x2031f6(475,"X8AB")](_0x2031f6(485,"l)80")),Error();document.title="egg-axios 插件详解",document.getElementById("article").innerHTML='<div><p>egg-axios 是 Egg.js 框架中基于 axios 封装的 HTTP 客户端插件，提供了便捷的 HTTP 请求能力，支持 Promise API，拦截器等功能。</p>\n<h2>安装与配置</h2>\n<ol>\n<li>安装：</li>\n</ol>\n<pre><code class="language-sh">npm i egg-axios --save\n</code></pre>\n<ol start="2">\n<li>在 <code>config/plugin.js</code> 中启用：</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-built_in">exports</span>.<span class="hljs-property">axios</span> = {\n  <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">package</span>: <span class="hljs-string">&#x27;egg-axios&#x27;</span>,\n};\n</code></pre>\n<h2>基本配置</h2>\n<p>在 <code>config/config.default.js</code> 中进行配置：</p>\n<pre><code class="language-javascript"><span class="hljs-built_in">exports</span>.<span class="hljs-property">axios</span> = {\n  <span class="hljs-comment">// 默认配置</span>\n  <span class="hljs-attr">default</span>: {\n    <span class="hljs-comment">// 所有实例共享的配置</span>\n  },\n  \n  <span class="hljs-comment">// 创建不同实例</span>\n  <span class="hljs-attr">clients</span>: {\n    <span class="hljs-attr">default</span>: {\n      <span class="hljs-comment">// 默认实例的配置</span>\n      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>,\n      <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>\n    },\n    <span class="hljs-attr">api2</span>: {\n      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://api2.example.com&#x27;</span>\n    }\n  }\n};\n</code></pre>\n<h2>基本使用</h2>\n<h3>1. 使用默认实例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-comment">// GET 请求</span>\n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>);\n  \n  <span class="hljs-comment">// POST 请求</span>\n  <span class="hljs-keyword">const</span> createRes = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John&#x27;</span>,\n    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>\n  });\n  \n  ctx.<span class="hljs-property">body</span> = response.<span class="hljs-property">data</span>;\n}\n</code></pre>\n<h3>2. 使用指定实例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-comment">// 使用 api2 实例</span>\n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/posts&#x27;</span>, {\n    <span class="hljs-attr">axiosInstance</span>: <span class="hljs-string">&#x27;api2&#x27;</span>\n  });\n  \n  ctx.<span class="hljs-property">body</span> = response.<span class="hljs-property">data</span>;\n}\n</code></pre>\n<h2>核心功能</h2>\n<h3>1. 请求方法</h3>\n<p>支持所有 axios 请求方法：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// GET</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(url[, config])\n\n<span class="hljs-comment">// POST</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">post</span>(url[, data[, config]])\n\n<span class="hljs-comment">// PUT</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">put</span>(url[, data[, config]])\n\n<span class="hljs-comment">// DELETE</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">delete</span>(url[, config])\n\n<span class="hljs-comment">// HEAD</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">head</span>(url[, config])\n\n<span class="hljs-comment">// OPTIONS</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">options</span>(url[, config])\n\n<span class="hljs-comment">// PATCH</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">patch</span>(url[, data[, config]])\n\n<span class="hljs-comment">// 自定义请求</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-title function_">request</span>(config)\n</code></pre>\n<h3>2. 并发请求</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">concurrentRequests</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">const</span> [users, posts] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([\n    app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>),\n    app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/posts&#x27;</span>)\n  ]);\n  \n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">users</span>: users.<span class="hljs-property">data</span>,\n    <span class="hljs-attr">posts</span>: posts.<span class="hljs-property">data</span>\n  };\n}\n</code></pre>\n<h3>3. 请求配置</h3>\n<p>常用配置选项：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>, <span class="hljs-comment">// 基础URL</span>\n  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,                     <span class="hljs-comment">// 超时时间(ms)</span>\n  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;X-Custom-Header&#x27;</span>: <span class="hljs-string">&#x27;value&#x27;</span> }, <span class="hljs-comment">// 请求头</span>\n  <span class="hljs-attr">params</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> },               <span class="hljs-comment">// URL参数</span>\n  <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John&#x27;</span> },            <span class="hljs-comment">// 请求体数据</span>\n  <span class="hljs-attr">responseType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,              <span class="hljs-comment">// 响应类型</span>\n  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,             <span class="hljs-comment">// 跨域携带cookie</span>\n  <span class="hljs-attr">maxContentLength</span>: <span class="hljs-number">2000</span>,            <span class="hljs-comment">// 最大响应内容长度</span>\n  <span class="hljs-attr">validateStatus</span>: <span class="hljs-function"><span class="hljs-params">status</span> =&gt;</span> status &lt; <span class="hljs-number">500</span> <span class="hljs-comment">// 有效状态码</span>\n}\n</code></pre>\n<h3>4. 响应结构</h3>\n<p>响应对象包含以下属性：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">data</span>: {},          <span class="hljs-comment">// 响应数据</span>\n  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,       <span class="hljs-comment">// HTTP状态码</span>\n  <span class="hljs-attr">statusText</span>: <span class="hljs-string">&#x27;OK&#x27;</span>,  <span class="hljs-comment">// 状态消息</span>\n  <span class="hljs-attr">headers</span>: {},       <span class="hljs-comment">// 响应头</span>\n  <span class="hljs-attr">config</span>: {},        <span class="hljs-comment">// 请求配置</span>\n  <span class="hljs-attr">request</span>: {}        <span class="hljs-comment">// 请求对象</span>\n}\n</code></pre>\n<h2>高级功能</h2>\n<h3>1. 拦截器(在 app.js 添加)</h3>\n<h4>请求拦截器</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 添加请求拦截器</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {\n  <span class="hljs-comment">// 在发送请求前做些什么</span>\n  config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${getToken()}</span>`</span>;\n  <span class="hljs-keyword">return</span> config;\n}, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {\n  <span class="hljs-comment">// 对请求错误做些什么</span>\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);\n});\n</code></pre>\n<h4>响应拦截器</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 添加响应拦截器</span>\napp.<span class="hljs-property">axios</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {\n  <span class="hljs-comment">// 对响应数据做点什么</span>\n  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>);\n  }\n  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;\n}, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {\n  <span class="hljs-comment">// 对响应错误做点什么</span>\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);\n});\n</code></pre>\n<h3>2. 取消请求</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">cancelableRequest</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">const</span> source = app.<span class="hljs-property">axios</span>.<span class="hljs-property">CancelToken</span>.<span class="hljs-title function_">source</span>();\n  \n  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n    source.<span class="hljs-title function_">cancel</span>(<span class="hljs-string">&#x27;Request canceled by timeout&#x27;</span>);\n  }, <span class="hljs-number">5000</span>);\n  \n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, {\n      <span class="hljs-attr">cancelToken</span>: source.<span class="hljs-property">token</span>\n    });\n    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-keyword">if</span> (app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">isCancel</span>(error)) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Request canceled&#x27;</span>, error.<span class="hljs-property">message</span>);\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-comment">// 处理其他错误</span>\n    }\n  }\n}\n</code></pre>\n<h3>3. 自定义实例</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 创建自定义实例</span>\n<span class="hljs-keyword">const</span> instance = app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">create</span>({\n  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>,\n  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>\n});\n\n<span class="hljs-comment">// 使用自定义实例</span>\n<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> instance.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>);\n</code></pre>\n<h2>错误处理</h2>\n<h3>1. 基本错误处理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users/123&#x27;</span>);\n    ctx.<span class="hljs-property">body</span> = response.<span class="hljs-property">data</span>;\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {\n      <span class="hljs-comment">// 请求已发出，服务器响应状态码超出 2xx 范围</span>\n      ctx.<span class="hljs-property">status</span> = error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>;\n      ctx.<span class="hljs-property">body</span> = {\n        <span class="hljs-attr">code</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>,\n        <span class="hljs-attr">message</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>\n      };\n    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">request</span>) {\n      <span class="hljs-comment">// 请求已发出但没有收到响应</span>\n      ctx.<span class="hljs-property">status</span> = <span class="hljs-number">504</span>;\n      ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;请求超时&#x27;</span> };\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-comment">// 设置请求时发生错误</span>\n      ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>;\n      ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;服务器错误&#x27;</span> };\n    }\n  }\n}\n</code></pre>\n<h3>2. 全局错误处理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// app.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  app.<span class="hljs-property">axios</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {\n    <span class="hljs-comment">// 统一处理错误</span>\n    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {\n      error.<span class="hljs-property">message</span> = <span class="hljs-string">`请求错误: <span class="hljs-subst">${error.response.status}</span>`</span>;\n    }\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);\n  });\n};\n</code></pre>\n<h2>常见使用场景</h2>\n<h3>1. 调用第三方API</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getWeather</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;https://api.weather.com/data&#x27;</span>, {\n    <span class="hljs-attr">params</span>: {\n      <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;beijing&#x27;</span>,\n      <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;your-api-key&#x27;</span>\n    }\n  });\n  \n  ctx.<span class="hljs-property">body</span> = response.<span class="hljs-property">data</span>;\n}\n</code></pre>\n<h3>2. 微服务间调用</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getOrderWithUser</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">const</span> [order, user] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([\n    app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://order-service/orders/123&#x27;</span>),\n    app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://user-service/users/456&#x27;</span>)\n  ]);\n  \n  ctx.<span class="hljs-property">body</span> = {\n    <span class="hljs-attr">order</span>: order.<span class="hljs-property">data</span>,\n    <span class="hljs-attr">user</span>: user.<span class="hljs-property">data</span>\n  };\n}\n</code></pre>\n<h3>3. 文件上传</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> { ctx, app } = <span class="hljs-variable language_">this</span>;\n  \n  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();\n  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;file&#x27;</span>, fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">&#x27;/path/to/file&#x27;</span>));\n  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;example&#x27;</span>);\n  \n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> app.<span class="hljs-property">axios</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/upload&#x27;</span>, formData, {\n    <span class="hljs-attr">headers</span>: formData.<span class="hljs-title function_">getHeaders</span>()\n  });\n  \n  ctx.<span class="hljs-property">body</span> = response.<span class="hljs-property">data</span>;\n}\n</code></pre>\n<h2>性能优化建议</h2>\n<ol>\n<li><strong>复用实例</strong>  ：尽量复用 axios 实例，避免频繁创建新实例</li>\n<li><strong>连接池</strong>  ：配置 <code>httpAgent</code> 和 <code>httpsAgent</code> 优化连接</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);\n<span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;https&#x27;</span>);\n\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">axios</span> = {\n  <span class="hljs-attr">clients</span>: {\n    <span class="hljs-attr">default</span>: {\n      <span class="hljs-attr">httpAgent</span>: <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>({ <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> }),\n      <span class="hljs-attr">httpsAgent</span>: <span class="hljs-keyword">new</span> https.<span class="hljs-title class_">Agent</span>({ <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> })\n    }\n  }\n};\n</code></pre>\n<ol start="3">\n<li><strong>合理设置超时</strong>  ：根据业务场景设置适当的超时时间</li>\n<li><strong>启用压缩</strong>  ：配置 <code>Accept-Encoding</code> 头启用响应压缩</li>\n</ol>\n<pre><code class="language-javascript"><span class="hljs-attr">headers</span>: {\n  <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip, deflate&#x27;</span>\n}\n</code></pre>\n<ol start="5">\n<li><strong>缓存策略</strong>  ：对频繁请求且变化不大的数据实现缓存机制</li>\n</ol>\n<p>egg-axios 提供了强大而灵活的 HTTP 请求能力，通过合理配置可以满足各种 HTTP 请求场景需求，是 Egg.js 应用中与外部服务交互的重要工具。</p>\n</div>'</script></body></html>