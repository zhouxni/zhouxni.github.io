<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3b9886=_0x4abe;function _0x4abe(o,n){var s=_0x30de();return(_0x4abe=function(n,t){var e=s[n-=396];void 0===_0x4abe.yfuHpu&&(_0x4abe.vGDREC=function(n,t){var e,d=[],o=0,s="";for(n=(n=>{for(var t,e,d="",o="",s=0,c=0;e=n.charAt(c++);~e&&(t=s%4?64*t+e:e,s++%4)&&(d+=String.fromCharCode(255&t>>(-2*s&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var r=0,a=d.length;r<a;r++)o+="%"+("00"+d.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(o)})(n),c=0;c<256;c++)d[c]=c;for(c=0;c<256;c++)o=(o+d[c]+t.charCodeAt(c%t.length))%256,e=d[c],d[c]=d[o],d[o]=e;for(var c=0,o=0,r=0;r<n.length;r++)e=d[c=(c+1)%256],d[c]=d[o=(o+d[c])%256],d[o]=e,s+=String.fromCharCode(n.charCodeAt(r)^d[(d[c]+d[o])%256]);return s},o=arguments,_0x4abe.yfuHpu=!0);var n=n+s[0],d=o[n];return d?e=d:(void 0===_0x4abe.IPWowU&&(_0x4abe.IPWowU=!0),e=_0x4abe.vGDREC(e,t),o[n]=e),e})(o,n)}function _0x30de(){var n=["W6BdTqRdSYaArM42W6nroCom","afZcHdqQwSkuWRdcJSkZW4XS","W7CNsJRcP8kpWQtcOZG","W7tdGSoReba","bSocWQlcIt5EW5RdOG","W70DWRBcJCoaW6NcVmkwCSoComkzWPa","kf7dRXFdRmokW6SVW45izs3dPq","W7uLyIVdOmoyu8otwmk0W4GtaW","dhXvWPi8WRDsfNq","WOtdUmkOySoSC8k2W4WDW6ZdPMm","W6SzW6JdGmoLW71dW7bbW6BdUCoVW4n0W6FcMt/dNs3cHKzXWRJcRCorEq","WQm/WPlcQSomkSkagtBcSCoHkmo2","x8kAW7FdKhOoW5JdOCo3W7tdNCoN","kvZdQ2/cLSknWPaTW7C","W6ddVW/dSYKFrNasW5PTpCoh","s3BdP20/WQpdNa","WOZcJmogfSkrW69gWRtdT8k7WQHXWOC","WRhdLLRdNuVdTdpdVSoAD3Wamq","W4pdRCkFW4ldL1Or","W7BdQCoLWPhdSSkHtL1QmSkaW73dTG","W68CjCkeWPykW5XAqfxdT8k7"];return(_0x30de=function(){return n})()}if((()=>{for(var n=_0x4abe,t=_0x30de();;)try{if(878869==-parseInt(n(403,"AkFZ"))+-parseInt(n(408,"LlO&"))/2+parseInt(n(412,"M%6E"))/3+-parseInt(n(407,"BZfs"))/4+parseInt(n(405,"M%6E"))/5+-parseInt(n(396,"a$Y4"))/6+-parseInt(n(414,"aBh4"))/7*(-parseInt(n(411,"pJZD"))/8))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x3b9886(406,"wJnM")](_0x3b9886(399,"wO#C"))!=_0x3b9886(415,")r[v"))throw window[_0x3b9886(416,"AkFZ")][_0x3b9886(409,"aj&q")](_0x3b9886(401,"W!a9")),Error();document.title="Nginx 配置指令",document.getElementById("article").innerHTML='<div><p>以下是 Nginx 配置指令的详细解析，涵盖核心指令、作用域、常见用法及示例，帮助您全面掌握 Nginx 的配置逻辑。</p>\n<hr>\n<h3><strong>一、指令作用域分类</strong></h3>\n<p>Nginx 指令按作用域分为三类：</p>\n<ol>\n<li><strong>全局块指令</strong>  ：影响整个服务（如 <code>worker_processes</code>）。</li>\n<li><strong>Events 块指令</strong>  ：控制连接处理模型（如 <code>worker_connections</code>）。</li>\n<li><strong>HTTP/Server/Location 块指令</strong>  ：定义具体请求处理逻辑。</li>\n</ol>\n<hr>\n<h3><strong>二、核心指令详解</strong></h3>\n<h4><strong>1. 全局块指令</strong></h4>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>user</code></td>\n<td>指定运行 Nginx 的用户和组</td>\n<td><code>user nginx nginx;</code></td>\n</tr>\n<tr>\n<td><code>worker_processes</code></td>\n<td>工作进程数（通常设为 CPU 核心数或 <code>auto</code>）</td>\n<td><code>worker_processes 4;</code></td>\n</tr>\n<tr>\n<td><code>error_log</code></td>\n<td>错误日志路径和级别（<code>debug/info/notice/warn/error/crit</code>）</td>\n<td><code>error_log /var/log/nginx/error.log warn;</code></td>\n</tr>\n<tr>\n<td><code>pid</code></td>\n<td>指定 PID 文件路径</td>\n<td><code>pid /run/nginx.pid;</code></td>\n</tr>\n</tbody>\n</table>\n<h4><strong>2. Events 块指令</strong></h4>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>worker_connections</code></td>\n<td>单个工作进程的最大连接数</td>\n<td><code>worker_connections 1024;</code></td>\n</tr>\n<tr>\n<td><code>use</code></td>\n<td>指定事件驱动模型（<code>epoll/kqueue/select</code>）</td>\n<td><code>use epoll;</code></td>\n</tr>\n<tr>\n<td><code>multi_accept</code></td>\n<td>是否一次性接受所有新连接（<code>on/off</code>）</td>\n<td><code>multi_accept on;</code></td>\n</tr>\n</tbody>\n</table>\n<h4><strong>3. HTTP 块核心指令</strong></h4>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>include</code></td>\n<td>引入其他配置文件</td>\n<td><code>include /etc/nginx/mime.types;</code></td>\n</tr>\n<tr>\n<td><code>default_type</code></td>\n<td>默认 MIME 类型</td>\n<td><code>default_type application/octet-stream;</code></td>\n</tr>\n<tr>\n<td><code>sendfile</code></td>\n<td>启用高效文件传输（零拷贝）</td>\n<td><code>sendfile on;</code></td>\n</tr>\n<tr>\n<td><code>keepalive_timeout</code></td>\n<td>客户端长连接超时时间（秒）</td>\n<td><code>keepalive_timeout 65;</code></td>\n</tr>\n<tr>\n<td><code>gzip</code></td>\n<td>启用响应压缩</td>\n<td><code>gzip on;</code></td>\n</tr>\n</tbody>\n</table>\n<h4><strong>4. Server 块指令</strong></h4>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>listen</code></td>\n<td>监听端口（可加 IP 和参数）</td>\n<td><code>listen 80;</code><br/><code>listen 443 ssl http2;</code></td>\n</tr>\n<tr>\n<td><code>server_name</code></td>\n<td>匹配的域名（支持通配符 <code>*</code> 和正则 <code>~</code>）</td>\n<td><code>server_name example.com *.example.com;</code></td>\n</tr>\n<tr>\n<td><code>root</code></td>\n<td>站点根目录</td>\n<td><code>root /var/www/html;</code></td>\n</tr>\n<tr>\n<td><code>index</code></td>\n<td>默认首页文件</td>\n<td><code>index index.html index.php;</code></td>\n</tr>\n<tr>\n<td><code>access_log</code></td>\n<td>访问日志路径和格式</td>\n<td><code>access_log /var/log/nginx/access.log combined;</code></td>\n</tr>\n<tr>\n<td><code>error_page</code></td>\n<td>自定义错误页面</td>\n<td><code>error_page 404 /404.html;</code></td>\n</tr>\n</tbody>\n</table>\n<h4><strong>5. Location 块指令</strong></h4>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>proxy_pass</code></td>\n<td>反向代理到后端服务</td>\n<td><code>proxy_pass http://127.0.0.1:8080;</code></td>\n</tr>\n<tr>\n<td><code>try_files</code></td>\n<td>按顺序检查文件或路径</td>\n<td><code>try_files $uri $uri/ /index.php?$args;</code></td>\n</tr>\n<tr>\n<td><code>rewrite</code></td>\n<td>URL 重写（支持正则）</td>\n<td><code>rewrite ^/old/(.*)$ /new/$1 permanent;</code></td>\n</tr>\n<tr>\n<td><code>alias</code></td>\n<td>定义路径别名（与 <code>root</code> 的区别是保留匹配部分）</td>\n<td><code>location /img/ { alias /data/images/; }</code></td>\n</tr>\n<tr>\n<td><code>expires</code></td>\n<td>设置静态资源缓存时间</td>\n<td><code>expires 30d;</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>三、关键指令深度解析</strong></h3>\n<h4><strong>1. <code>location</code> 匹配规则</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-section">location</span> [修饰符] 匹配模式 {\n    <span class="hljs-comment"># 指令...</span>\n}\n</code></pre>\n<ul>\n<li><strong>修饰符</strong>  ：\n<ul>\n<li><code>=</code>：精确匹配（最高优先级）</li>\n<li><code>~</code>：区分大小写的正则匹配</li>\n<li><code>~*</code>：不区分大小写的正则匹配</li>\n<li><code>^~</code>：前缀匹配（不检查正则）</li>\n</ul>\n</li>\n</ul>\n<p><strong>示例</strong>  ：</p>\n<pre><code class="language-nginx"><span class="hljs-section">location</span> = /favicon.ico { ... }       <span class="hljs-comment"># 精确匹配</span>\n<span class="hljs-section">location</span> <span class="hljs-regexp">~* \\.(jpg|png)$</span> { ... }     <span class="hljs-comment"># 不区分大小写的图片匹配</span>\n<span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /static/ { ... }         <span class="hljs-comment"># 优先匹配 /static/ 前缀</span>\n</code></pre>\n<h4><strong>2. <code>proxy_pass</code> 行为差异</strong></h4>\n<ul>\n<li><strong>路径保留</strong>  ：当 <code>proxy_pass</code> 后无 URI 时，传递完整路径：<pre><code class="language-nginx"><span class="hljs-section">location</span> /api/ {\n    <span class="hljs-attribute">proxy_pass</span> http://backend;  <span class="hljs-comment"># → http://backend/api/xxx</span>\n}\n</code></pre>\n</li>\n<li><strong>路径截断</strong>  ：当 <code>proxy_pass</code> 包含 URI 时，替换匹配部分：<pre><code class="language-nginx"><span class="hljs-section">location</span> /api/ {\n    <span class="hljs-attribute">proxy_pass</span> http://backend/v1/;  <span class="hljs-comment"># → http://backend/v1/xxx</span>\n}\n</code></pre>\n</li>\n</ul>\n<h4><strong>3. <code>try_files</code> 工作流程</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-section">location</span> / {\n    <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /fallback.html;\n}\n</code></pre>\n<p>执行顺序：</p>\n<ol>\n<li>检查 <code>$uri</code> 文件是否存在（如 <code>/index.html</code>）</li>\n<li>检查 <code>$uri/</code> 目录是否存在</li>\n<li>若均不存在，返回 <code>/fallback.html</code></li>\n</ol>\n<hr>\n<h3><strong>四、高级指令示例</strong></h3>\n<h4><strong>1. 负载均衡配置</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-section">upstream</span> backend {\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.1</span> weight=<span class="hljs-number">5</span>;\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.2</span>;\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.3</span> backup;  <span class="hljs-comment"># 备用服务器</span>\n    least_conn;                 <span class="hljs-comment"># 最少连接算法</span>\n}\n\n<span class="hljs-section">location</span> / {\n    <span class="hljs-attribute">proxy_pass</span> http://backend;\n}\n</code></pre>\n<h4><strong>2. 限流配置</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-attribute">limit_req_zone</span> <span class="hljs-variable">$binary_remote_addr</span> zone=req_limit:<span class="hljs-number">10m</span> rate=10r/s;\n\n<span class="hljs-section">location</span> /login/ {\n    <span class="hljs-attribute">limit_req</span> zone=req_limit burst=<span class="hljs-number">20</span> nodelay;\n}\n</code></pre>\n<h4><strong>3. 跨域配置</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-section">location</span> /api/ {\n    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="hljs-string">&#x27;*&#x27;</span>;\n    <span class="hljs-attribute">add_header</span> <span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="hljs-string">&#x27;GET, POST&#x27;</span>;\n    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> = <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) {\n        <span class="hljs-attribute">return</span> <span class="hljs-number">204</span>;\n    }\n}\n</code></pre>\n<hr>\n<h3><strong>五、调试指令</strong></h3>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>stub_status</code></td>\n<td>启用基础状态监控</td>\n<td><code>location /status { stub_status on; }</code></td>\n</tr>\n<tr>\n<td><code>rewrite_log</code></td>\n<td>记录重写日志（需 <code>error_log</code> 级别为 <code>notice</code>）</td>\n<td><code>rewrite_log on;</code></td>\n</tr>\n<tr>\n<td><code>return</code></td>\n<td>直接返回响应码或重定向</td>\n<td><code>return 301 https://$host$uri;</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>六、最佳实践建议</strong></h3>\n<ol>\n<li><strong>避免滥用 <code>if</code></strong><br>\nNginx 的 <code>if</code> 是重写模块的指令，非编程语言中的条件判断，使用不当会导致性能问题。</li>\n<li><strong>路径匹配优先级</strong><br>\n<code>location</code> 的匹配顺序：精确匹配 <code>=</code> &gt; 前缀匹配 <code>^~</code> &gt; 正则匹配 <code>~</code> &gt; 普通前缀匹配。</li>\n<li><strong>变量使用</strong><br>\n常用变量如 <code>$host</code>（请求域名）、<code>$request_uri</code>（完整请求路径）、<code>$args</code>（查询参数）。</li>\n<li><strong>配置复用</strong><br>\n使用 <code>include</code> 拆分重复配置（如多个 Server 块的 SSL 配置）。</li>\n</ol>\n<hr>\n<p>通过掌握这些指令，您可以灵活配置 Nginx 实现高性能 Web 服务、反向代理、负载均衡等复杂场景。建议结合官方文档和实际需求进行实践。</p>\n</div>'</script></body></html>