<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x286892=_0x38f6;function _0x530a(){var s=["tLvroSkvq8kRjM5ZW7e","uuONCttdPmoXEMu","FW4jyvbdvCkkWRehxCkI","a8kvWOe2AqtdJXZcL8oryJS","W7yHwrBcLSo+jc8PivZcNG","dSkPi0JdS8oyfq","pCkeemkDlCo0WPiZC8k8nb5ma8kTg8oVCCklW61vWQCFBSokda","W7CJW7hdRSoCW4tcKYqaW5JcPmoy","A34McCkrqdhcKxZdHa","WRyIWRldQCk9WQLKASkHaIq","emorC8o/l8kRW5BdOY/dTwG","WP8avJZdT38c","yCocumk/fmkyW7nXrW","Bmohvmk+hmknW6LEFG","WQBdUbNdJmo0","ohhcR8odWRnGWQaG","W57cTmoOW5yPCcfyW5hdQG","WPbSc2BcRaumWQ/cICkVW6W2","WRldTmouWQuPlCowW57cKa","tvrtmCktsmksn3j/W5y","ACkWlmoadq3cSIuWW6pdPSkC","W7mJW7xdPCoFWPRcIHizW6/cHG","WRWKWRBdQmkZW7rXy8kmjrjf","W4xdIf7dJJFdO1/cRfuHW5u","WQTXW5NdVCkSW4DRW6voEHhcQW","W5ldMNDyW5DiWOC","WQ7dJSkCW5vxW5ZdM3pcMa","W7GZb8oDamk9WQ8"];return(_0x530a=function(){return s})()}function _0x38f6(l,s){var t=_0x530a();return(_0x38f6=function(s,a){var n=t[s-=452];void 0===_0x38f6.XidHTw&&(_0x38f6.KfjwaB=function(s,a){var n,p=[],l=0,t="";for(s=(s=>{for(var a,n,p="",l="",t=0,r=0;n=s.charAt(r++);~n&&(a=t%4?64*a+n:n,t++%4)&&(p+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,e=p.length;c<e;c++)l+="%"+("00"+p.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)p[r]=r;for(r=0;r<256;r++)l=(l+p[r]+a.charCodeAt(r%a.length))%256,n=p[r],p[r]=p[l],p[l]=n;for(var r=0,l=0,c=0;c<s.length;c++)n=p[r=(r+1)%256],p[r]=p[l=(l+p[r])%256],p[l]=n,t+=String.fromCharCode(s.charCodeAt(c)^p[(p[r]+p[l])%256]);return t},l=arguments,_0x38f6.XidHTw=!0);var s=s+t[0],p=l[s];return p?n=p:(void 0===_0x38f6.NFmJoQ&&(_0x38f6.NFmJoQ=!0),n=_0x38f6.KfjwaB(n,a),l[s]=n),n})(l,s)}if((()=>{for(var s=_0x38f6,a=_0x530a();;)try{if(556289==+parseInt(s(479,"pXBK"))+-parseInt(s(465,"][%y"))/2*(-parseInt(s(475,"^[&#"))/3)+-parseInt(s(470,"!@9!"))/4+-parseInt(s(477,"OXND"))/5*(-parseInt(s(476,"oRdM"))/6)+parseInt(s(455,"6)6E"))/7+-parseInt(s(474,"Vvbn"))/8*(parseInt(s(464,"GY$c"))/9)+-parseInt(s(467,"oRdM"))/10*(parseInt(s(458,"79S@"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x286892(453,"Y(wm")](_0x286892(466,"*j#F"))!=_0x286892(462,"VQ9M"))throw window[_0x286892(463,"O*Q8")][_0x286892(473,"b&H7")](_0x286892(454,"UgG2")),Error();document.title="Egg.js 3.x RESTful 风格路由详解",document.getElementById("article").innerHTML='<div><h2>一、基本概念</h2>\n<p>RESTful 是一种基于 HTTP 协议的设计风格，它使用 HTTP 方法（GET、POST、PUT、DELETE 等）来表示对资源的操作。Egg.js 提供了简洁的方式来定义 RESTful 路由。</p>\n<h2>二、核心方法：router.resources</h2>\n<p>Egg.js 提供了 <code>router.resources</code> 方法来快速生成 RESTful 路由：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller } = app;\n  \n  <span class="hljs-comment">// 基本用法</span>\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">posts</span>);\n};\n</code></pre>\n<p>这行代码会自动生成以下路由：</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>路径</th>\n<th>控制器方法</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/api/posts</td>\n<td>index</td>\n<td>获取资源列表</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/api/posts/:id</td>\n<td>show</td>\n<td>获取单个资源</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/api/posts</td>\n<td>create</td>\n<td>创建资源</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/api/posts/:id</td>\n<td>update</td>\n<td>更新整个资源</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/api/posts/:id</td>\n<td>patch</td>\n<td>部分更新资源</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/api/posts/:id</td>\n<td>destroy</td>\n<td>删除资源</td>\n</tr>\n</tbody>\n</table>\n<h2>三、控制器实现示例</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/controller/posts.js</span>\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Controller</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>);\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">PostsController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-comment">// GET /api/posts</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">index</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">list</span>();\n    ctx.<span class="hljs-property">body</span> = posts;\n  }\n\n  <span class="hljs-comment">// GET /api/posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">find</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n    ctx.<span class="hljs-property">body</span> = post;\n  }\n\n  <span class="hljs-comment">// POST /api/posts</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> created = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">create</span>(ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">201</span>;\n    ctx.<span class="hljs-property">body</span> = created;\n  }\n\n  <span class="hljs-comment">// PUT /api/posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> updated = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">update</span>(\n      ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,\n      ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>\n    );\n    ctx.<span class="hljs-property">body</span> = updated;\n  }\n\n  <span class="hljs-comment">// PATCH /api/posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> patched = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">patch</span>(\n      ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,\n      ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>\n    );\n    ctx.<span class="hljs-property">body</span> = patched;\n  }\n\n  <span class="hljs-comment">// DELETE /api/posts/:id</span>\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">posts</span>.<span class="hljs-title function_">del</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">204</span>;\n  }\n}\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">PostsController</span>;\n</code></pre>\n<h2>四、高级配置</h2>\n<h3>1. 自定义路由映射</h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">posts</span>, {\n  <span class="hljs-comment">// 只生成特定路由</span>\n  <span class="hljs-attr">only</span>: [<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;show&#x27;</span>, <span class="hljs-string">&#x27;create&#x27;</span>],\n  \n  <span class="hljs-comment">// 排除特定路由</span>\n  <span class="hljs-attr">except</span>: [<span class="hljs-string">&#x27;destroy&#x27;</span>],\n  \n  <span class="hljs-comment">// 自定义方法名映射</span>\n  <span class="hljs-attr">member</span>: {\n    <span class="hljs-attr">publish</span>: <span class="hljs-string">&#x27;PUT&#x27;</span>,  <span class="hljs-comment">// PUT /api/posts/:id/publish</span>\n    <span class="hljs-attr">like</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,     <span class="hljs-comment">// POST /api/posts/:id/like</span>\n  },\n  \n  <span class="hljs-comment">// 集合路由（不包含ID）</span>\n  <span class="hljs-attr">collection</span>: {\n    <span class="hljs-attr">top</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,       <span class="hljs-comment">// GET /api/posts/top</span>\n    <span class="hljs-attr">search</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,    <span class="hljs-comment">// GET /api/posts/search</span>\n  }\n});\n</code></pre>\n<h3>2. 嵌套资源路由</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 嵌套资源：/api/users/:user_id/posts</span>\nrouter.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;users.posts&#x27;</span>, <span class="hljs-string">&#x27;/api/users/:user_id/posts&#x27;</span>, controller.<span class="hljs-property">posts</span>);\n</code></pre>\n<p>这会生成以下路由：</p>\n<ul>\n<li>GET /api/users/:user_id/posts</li>\n<li>POST /api/users/:user_id/posts</li>\n<li>GET /api/users/:user_id/posts/:id</li>\n<li>PUT /api/users/:user_id/posts/:id</li>\n<li>DELETE /api/users/:user_id/posts/:id</li>\n</ul>\n<h3>3. 中间件支持</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 为特定路由添加中间件</span>\nrouter.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/posts&#x27;</span>, controller.<span class="hljs-property">posts</span>, {\n  <span class="hljs-attr">middleware</span>: [<span class="hljs-string">&#x27;auth&#x27;</span>, <span class="hljs-string">&#x27;logger&#x27;</span>],\n  \n  <span class="hljs-comment">// 为特定方法添加中间件</span>\n  <span class="hljs-attr">index</span>: [<span class="hljs-string">&#x27;pagination&#x27;</span>],\n  <span class="hljs-attr">create</span>: [<span class="hljs-string">&#x27;adminRequired&#x27;</span>]\n});\n</code></pre>\n<h2>五、最佳实践</h2>\n<ol>\n<li><strong>命名规范</strong>  ：\n<ul>\n<li>资源名称使用复数形式（如 <code>/posts</code> 而非 <code>/post</code>）</li>\n<li>控制器方法名保持 RESTful 标准命名</li>\n</ul>\n</li>\n<li><strong>状态码</strong>  ：\n<ul>\n<li>成功创建：201 Created</li>\n<li>成功删除：204 No Content</li>\n<li>成功获取：200 OK</li>\n</ul>\n</li>\n<li><strong>版本控制</strong>  ：<pre><code class="language-javascript">router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/v1/posts&#x27;</span>, controller.<span class="hljs-property">v1</span>.<span class="hljs-property">posts</span>);\nrouter.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/v2/posts&#x27;</span>, controller.<span class="hljs-property">v2</span>.<span class="hljs-property">posts</span>);\n</code></pre>\n</li>\n<li><strong>参数验证</strong>  ：\n使用 Egg.js 的 <code>validate</code> 插件进行参数校验</li>\n<li><strong>分页处理</strong>  ：\n在 <code>index</code> 方法中实现分页逻辑</li>\n</ol>\n<h2>六、完整示例</h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller } = app;\n  \n  <span class="hljs-comment">// 基本 RESTful 路由</span>\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;posts&#x27;</span>, <span class="hljs-string">&#x27;/api/v1/posts&#x27;</span>, controller.<span class="hljs-property">v1</span>.<span class="hljs-property">posts</span>);\n  \n  <span class="hljs-comment">// 带自定义操作的嵌套资源</span>\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;users.posts&#x27;</span>, <span class="hljs-string">&#x27;/api/v1/users/:user_id/posts&#x27;</span>, controller.<span class="hljs-property">v1</span>.<span class="hljs-property">posts</span>, {\n    <span class="hljs-attr">only</span>: [<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;create&#x27;</span>],\n    <span class="hljs-attr">middleware</span>: [<span class="hljs-string">&#x27;auth&#x27;</span>],\n    <span class="hljs-attr">collection</span>: {\n      <span class="hljs-attr">search</span>: <span class="hljs-string">&#x27;GET&#x27;</span>\n    }\n  });\n  \n  <span class="hljs-comment">// 带版本控制的 API</span>\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;comments&#x27;</span>, <span class="hljs-string">&#x27;/api/v2/comments&#x27;</span>, controller.<span class="hljs-property">v2</span>.<span class="hljs-property">comments</span>, {\n    <span class="hljs-attr">member</span>: {\n      <span class="hljs-attr">like</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,\n      <span class="hljs-attr">unlike</span>: <span class="hljs-string">&#x27;DELETE&#x27;</span>\n    }\n  });\n};\n</code></pre>\n<p>通过以上配置，你可以轻松地在 Egg.js 3.x 中实现符合 RESTful 设计风格的 API 路由。</p>\n</div>'</script></body></html>