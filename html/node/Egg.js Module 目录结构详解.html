<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5d8f(){var s=["FCkGcMGEW7BdOINcPCoD","x3jijmk+WOihvtJdGNZdU8k0","g0dcJ8oGFKJdLSoCWQJcKSo7vmkb","WPrBnCkIs37dNmkylvi","WRxdUWVdTxDLv8koBv7cL8k9W40xWO7cH8kEp8kTW5G0AhxcIX4C","WRxdH2njlSoesSkUfNSUhG","C8oYysFcQSkftmo3W4W0utVcTsq","deznWQ0L","Ct3dH14RWPLlgxVdO8kOWP4","WOiKy0KhWPmGW6/cTcaeW5zL","vtSqW7xdGCkmW5e","WPDCoSkUkcpcQSoflu8Ak0ldGq","W4H/WPS2tmobsuBcUCozWP7dSW","W4tcJ8oHfKmfyNiei8oCiG","suT4WQyPCsK","WPqjrmoyyKxdJG","jL54cmoLoSkWWQxcLSoOW4rI","lSoOurRdTCkQnbRcOCo9WRS","th9xq0xcJCoKAM7cGhe","WOiHzeecWPaJW4/cGHC4W49D","k8omW4pdT3TWW74","WOlcUmoPW4ibWQq+WQS","oSkFWPrFWRhdHq4","WRldLmk7rWzcw38e","jYemcmoNW6BdVq","W5JdOCk6WPveW7GIWO7dGSoUW4RcUq"];return(_0x5d8f=function(){return s})()}var _0x566a10=_0x2b3c;function _0x2b3c(p,s){var e=_0x5d8f();return(_0x2b3c=function(s,a){var n=e[s-=479];void 0===_0x2b3c.nsWIAM&&(_0x2b3c.fRpGDF=function(s,a){var n,l=[],p=0,e="";for(s=(s=>{for(var a,n,l="",p="",e=0,r=0;n=s.charAt(r++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var t=0,c=l.length;t<c;t++)p+="%"+("00"+l.charCodeAt(t).toString(16)).slice(-2);return decodeURIComponent(p)})(s),r=0;r<256;r++)l[r]=r;for(r=0;r<256;r++)p=(p+l[r]+a.charCodeAt(r%a.length))%256,n=l[r],l[r]=l[p],l[p]=n;for(var r=0,p=0,t=0;t<s.length;t++)n=l[r=(r+1)%256],l[r]=l[p=(p+l[r])%256],l[p]=n,e+=String.fromCharCode(s.charCodeAt(t)^l[(l[r]+l[p])%256]);return e},p=arguments,_0x2b3c.nsWIAM=!0);var s=s+e[0],l=p[s];return l?n=l:(void 0===_0x2b3c.BXDxyh&&(_0x2b3c.BXDxyh=!0),n=_0x2b3c.fRpGDF(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x2b3c,a=_0x5d8f();;)try{if(431451==+parseInt(s(494,"9Fi1"))+-parseInt(s(493,"IGZ7"))/2*(-parseInt(s(490,"b8lP"))/3)+parseInt(s(491,")2q6"))/4*(parseInt(s(492,"!KY]"))/5)+-parseInt(s(487,"MhHV"))/6+-parseInt(s(495,"s1$W"))/7*(-parseInt(s(481,"IGZ7"))/8)+parseInt(s(480,"pl(!"))/9+-parseInt(s(484,"kV3n"))/10)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x566a10(500,"d[HI")](_0x566a10(501,")2q6"))!=_0x566a10(485,"!KY]"))throw window[_0x566a10(499,"z]7n")][_0x566a10(498,"R$dB")](_0x566a10(482,"2!vp")),Error();document.title="Egg.js Module 目录结构详解",document.getElementById("article").innerHTML='<div><p>在 Egg.js 中，Module（模块）是指可以被复用的业务单元，通常用于大型项目中组织代码。以下是 Module 目录的详细说明：</p>\n<h2>标准 Module 目录结构</h2>\n<pre><code>egg-project\n├── app\n│   ├── module/              # 模块目录\n│   │   ├── user/            # 用户模块\n│   │   │   ├── controller/  # 模块控制器\n│   │   │   ├── service/     # 模块服务\n│   │   │   ├── model/       # 模块模型\n│   │   │   ├── middleware/  # 模块中间件\n│   │   │   ├── router.js    # 模块路由配置\n│   │   │   └── config/      # 模块专属配置\n│   │   ├── order/           # 订单模块\n│   │   └── product/         # 产品模块\n</code></pre>\n<h2>Module 各目录功能说明</h2>\n<h3>1. controller/ (模块控制器)</h3>\n<ul>\n<li>处理模块相关的 HTTP 请求</li>\n<li>示例：<code>app/module/user/controller/user.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Controller</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>).<span class="hljs-property">Controller</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Controller</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">list</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">const</span> { ctx } = <span class="hljs-variable language_">this</span>;\n    <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> ctx.<span class="hljs-property">service</span>.<span class="hljs-property">module</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">list</span>();\n    ctx.<span class="hljs-property">body</span> = { users };\n  }\n}\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">UserController</span>;\n</code></pre>\n<h3>2. service/ (模块服务)</h3>\n<ul>\n<li>封装模块业务逻辑</li>\n<li>示例：<code>app/module/user/service/user.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Service</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;egg&#x27;</span>).<span class="hljs-property">Service</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Service</span> {\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">list</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">model</span>.<span class="hljs-property">User</span>.<span class="hljs-title function_">findAll</span>();\n  }\n}\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">UserService</span>;\n</code></pre>\n<h3>3. model/ (模块模型)</h3>\n<ul>\n<li>定义模块数据模型</li>\n<li>示例：<code>app/module/user/model/user.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">STRING</span>, <span class="hljs-variable constant_">INTEGER</span> } = app.<span class="hljs-property">Sequelize</span>;\n  \n  <span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = app.<span class="hljs-property">model</span>.<span class="hljs-title function_">define</span>(<span class="hljs-string">&#x27;user&#x27;</span>, {\n    <span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">INTEGER</span>, <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span> },\n    <span class="hljs-attr">name</span>: <span class="hljs-title function_">STRING</span>(<span class="hljs-number">30</span>),\n  });\n\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">User</span>;\n};\n</code></pre>\n<h3>4. middleware/ (模块中间件)</h3>\n<ul>\n<li>模块专属中间件</li>\n<li>示例：<code>app/module/user/middleware/auth.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">auth</span>(<span class="hljs-params">ctx, next</span>) {\n    <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>) {\n      ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">401</span>, <span class="hljs-string">&#x27;Unauthorized&#x27;</span>);\n    }\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  };\n};\n</code></pre>\n<h3>5. router.js (模块路由)</h3>\n<ul>\n<li>模块路由配置</li>\n<li>示例：<code>app/module/user/router.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller } = app;\n  \n  <span class="hljs-comment">// 用户模块路由</span>\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/user/list&#x27;</span>, controller.<span class="hljs-property">module</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n  router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/user/create&#x27;</span>, controller.<span class="hljs-property">module</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>.<span class="hljs-property">create</span>);\n};\n</code></pre>\n<h3>6. config/ (模块配置)</h3>\n<ul>\n<li>模块专属配置</li>\n<li>示例：<code>app/module/user/config/config.default.js</code></li>\n</ul>\n<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-comment">// 用户模块配置</span>\n  <span class="hljs-attr">user</span>: {\n    <span class="hljs-attr">defaultAvatar</span>: <span class="hljs-string">&#x27;/public/images/default-avatar.png&#x27;</span>,\n    <span class="hljs-attr">pagination</span>: {\n      <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,\n    },\n  },\n};\n</code></pre>\n<h2>Module 使用最佳实践</h2>\n<h3>1. 模块注册</h3>\n<p>在 <code>app.js</code> 中动态加载模块：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// app.js</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppBootHook</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">app</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span> = app;\n  }\n\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">willReady</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 加载所有模块</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">loader</span>.<span class="hljs-title function_">loadToApp</span>(<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-property">config</span>.<span class="hljs-property">baseDir</span>, <span class="hljs-string">&#x27;app/module&#x27;</span>), <span class="hljs-string">&#x27;module&#x27;</span>);\n  }\n}\n</code></pre>\n<h3>2. 模块间调用</h3>\n<p>通过 <code>ctx.module</code> 访问其他模块：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在订单模块中调用用户模块</span>\n<span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">module</span>.<span class="hljs-property">user</span>.<span class="hljs-property">service</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">get</span>(userId);\n</code></pre>\n<h3>3. 模块路由聚合</h3>\n<p>在全局路由中引入模块路由：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./module/user/router&#x27;</span>)(app);\n  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./module/order/router&#x27;</span>)(app);\n  \n  <span class="hljs-comment">// 全局路由</span>\n  app.<span class="hljs-property">router</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, app.<span class="hljs-property">controller</span>.<span class="hljs-property">home</span>.<span class="hljs-property">index</span>);\n};\n</code></pre>\n<h3>4. 模块配置合并</h3>\n<p>在配置文件中加载模块配置：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// config/config.default.js</span>\n<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);\n<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadModuleConfig</span> = app =&gt; {\n  <span class="hljs-keyword">const</span> modulesPath = path.<span class="hljs-title function_">join</span>(app.<span class="hljs-property">baseDir</span>, <span class="hljs-string">&#x27;app/module&#x27;</span>);\n  <span class="hljs-keyword">const</span> modules = fs.<span class="hljs-title function_">readdirSync</span>(modulesPath);\n  \n  <span class="hljs-keyword">const</span> config = {};\n  modules.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> {\n    <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(modulesPath, <span class="hljs-variable language_">module</span>, <span class="hljs-string">&#x27;config/config.default.js&#x27;</span>);\n    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(configPath)) {\n      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(config, <span class="hljs-built_in">require</span>(configPath));\n    }\n  });\n  \n  <span class="hljs-keyword">return</span> config;\n};\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> userConfig = {\n    <span class="hljs-comment">// 全局配置</span>\n  };\n  \n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(userConfig, <span class="hljs-title function_">loadModuleConfig</span>(app));\n};\n</code></pre>\n<h2>Module 与普通目录的区别</h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>Module</th>\n<th>普通目录</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>定位</td>\n<td>业务功能单元</td>\n<td>功能分层</td>\n</tr>\n<tr>\n<td>独立性</td>\n<td>高，可独立开发测试</td>\n<td>依赖项目整体</td>\n</tr>\n<tr>\n<td>复用性</td>\n<td>可跨项目复用</td>\n<td>项目内复用</td>\n</tr>\n<tr>\n<td>配置</td>\n<td>有独立配置</td>\n<td>使用全局配置</td>\n</tr>\n<tr>\n<td>路由</td>\n<td>模块内聚合</td>\n<td>全局路由管理</td>\n</tr>\n</tbody>\n</table>\n<h2>实际项目示例</h2>\n<p>电商项目模块划分示例：</p>\n<pre><code>app/module/\n├── account/         # 账户模块\n│   ├── controller/  # 登录/注册/个人中心\n│   ├── service/     # 账户服务\n│   └── router.js    # /account/...\n├── product/         # 商品模块\n│   ├── controller/  # 商品CRUD\n│   ├── model/       # 商品模型\n│   └── router.js    # /product/...\n├── order/           # 订单模块\n│   ├── controller/  # 订单管理\n│   ├── service/     # 订单服务\n│   └── router.js    # /order/...\n└── payment/         # 支付模块\n    ├── controller/  # 支付接口\n    ├── schedule/    # 定时检查支付状态\n    └── router.js    # /payment/...\n</code></pre>\n<p>通过 Module 组织代码，可以使大型项目保持清晰的结构，便于团队协作和维护。</p>\n</div>'</script></body></html>