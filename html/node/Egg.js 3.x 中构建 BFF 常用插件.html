<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x27f5(l,n){var a=_0x5b2e();return(_0x27f5=function(n,s){var e=a[n-=128];void 0===_0x27f5.SebidS&&(_0x27f5.OFazVK=function(n,s){var e,r=[],l=0,a="";for(n=(n=>{for(var s,e,r="",l="",a=0,o=0;e=n.charAt(o++);~e&&(s=a%4?64*s+e:e,a++%4)&&(r+=String.fromCharCode(255&s>>(-2*a&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var c=0,t=r.length;c<t;c++)l+="%"+("00"+r.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(n),o=0;o<256;o++)r[o]=o;for(o=0;o<256;o++)l=(l+r[o]+s.charCodeAt(o%s.length))%256,e=r[o],r[o]=r[l],r[l]=e;for(var o=0,l=0,c=0;c<n.length;c++)e=r[o=(o+1)%256],r[o]=r[l=(l+r[o])%256],r[l]=e,a+=String.fromCharCode(n.charCodeAt(c)^r[(r[o]+r[l])%256]);return a},l=arguments,_0x27f5.SebidS=!0);var n=n+a[0],r=l[n];return r?e=r:(void 0===_0x27f5.mbWtmX&&(_0x27f5.mbWtmX=!0),e=_0x27f5.OFazVK(e,s),l[n]=e),e})(l,n)}function _0x5b2e(){var n=["W6rmWPlcUmk9bSkXpW3dRe0mW64","WOpdHSo8W4buW4S5W7yIW7uSWP/cGq","DrFcSCkqWOFcIYNcNmok","A8kOnSozW6Lst15U","W6DpWPhcVSoTt8ormIddVa","W4KjWQW3W6BdM280AYZcIHrs","asLuWQRcM31BvcpcI8odssJcRMFdR8kJW6JdGCo2l8owW6JdV019","qCk3rMxcGKdcTSoAW7PzW6ZcP8kb","kCk2WR8FW4jVWPldTCoJz07cOG","WQf0WPpdGhPRyYa","WPhdOLfatHiGW7W5W4ZcVa","W7m6BSktWR7dMb4r","AdPBh8k5iCkc","uSkBWPpcTZ/dSaWAh8o8Bq","uXhcPSk8WOdcNq8","W6iHWPxdJ0jrqa","yCoGEgnTW59gW44","cmkQFmooWPdcPei4cKBdKdJdHG","wMOxW6ldMxeNcJJcP8oUzq","WPD5cCoqomoOrY1pcG","t0ZdPSkCrZO6W6PGWOFcS8ov","WOnLWRSoDCoNkr9wnSoAw8oy","leKeWOBcHa","WONdIh7dGSkRW4/cLLldISkoxM8","WOJcSWhcL8ohWPBcNW","qCkWqaZdHbRdLmoZW5u"];return(_0x5b2e=function(){return n})()}var _0x2248f7=_0x27f5;if((()=>{for(var n=_0x27f5,s=_0x5b2e();;)try{if(162916==-parseInt(n(136,"]uE1"))+-parseInt(n(138,"w9wk"))/2*(-parseInt(n(149,"6bRL"))/3)+parseInt(n(134,"P9rn"))/4+parseInt(n(131,"XTZO"))/5+-parseInt(n(153,"#!yD"))/6+parseInt(n(130,")Occ"))/7*(-parseInt(n(151,"7NsO"))/8)+parseInt(n(133,"7NsO"))/9*(-parseInt(n(135,"*aIq"))/10))break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x2248f7(140,"5yQI")](_0x2248f7(128,"5yQI"))!=_0x2248f7(148,"%iq@"))throw window[_0x2248f7(137,"bKVm")][_0x2248f7(141,"*aIq")](_0x2248f7(132,"WXH[")),Error();document.title="Egg.js 3.x 中构建 BFF 常用插件",document.getElementById("article").innerHTML='<div><p>在 Egg.js 3.x 中构建 BFF（Backend For Frontend）层时，以下插件是核心开发中经常使用的，按功能分类整理如下：</p>\n<hr>\n<h3><strong>一、核心插件（必选）</strong></h3>\n<ol>\n<li><strong>HTTP 相关</strong>\n<ul>\n<li><code>egg-http-proxy</code><br>\n▸ 反向代理后端 API，避免前端直接调用内部服务<br>\n▸ 示例：将 <code>/api/user</code> 代理到 <code>http://user-service:8080</code></li>\n<li><code>egg-axios</code><br>\n▸ 封装 axios 的请求拦截、错误统一处理<br>\n▸ 支持 TypeScript 类型提示</li>\n</ul>\n</li>\n<li><strong>安全防护</strong>\n<ul>\n<li><code>egg-security</code>（内置）<br>\n▸ 自动防御 CSRF/XSS<br>\n▸ 配置：<code>config.security = { csrf: { enable: false } }</code>（按需关闭）</li>\n<li><code>egg-jwt</code><br>\n▸ 生成和验证 JWT Token<br>\n▸ 示例：<code>app.jwt.sign({ userId: 123 })</code></li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>二、数据聚合增强</strong></h3>\n<ol>\n<li><strong>缓存插件</strong>\n<ul>\n<li><code>egg-redis</code><br>\n▸ 连接 Redis 实现分布式缓存<br>\n▸ 示例：<code>app.redis.get(\'cache_key\')</code></li>\n<li><code>egg-cache</code><br>\n▸ 内存缓存（LRU 策略）<br>\n▸ 适合高频读取的低频更新数据</li>\n</ul>\n</li>\n<li><strong>GraphQL 支持</strong>\n<ul>\n<li><code>egg-graphql</code><br>\n▸ 快速搭建 GraphQL 网关<br>\n▸ 配合 <code>graphql-tools</code> 实现 Schema 合并</li>\n<li><code>egg-apollo-server</code><br>\n▸ 集成 Apollo Server 生态（如 Federation）</li>\n</ul>\n</li>\n<li><strong>RPC 调用</strong>\n<ul>\n<li><code>egg-grpc</code><br>\n▸ 调用 gRPC 微服务<br>\n▸ 需配合 <code>.proto</code> 文件定义</li>\n<li><code>egg-sofa-rpc</code><br>\n▸ 蚂蚁内部 SOFA 协议支持</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>三、性能与稳定性</strong></h3>\n<ol>\n<li><strong>熔断降级</strong>\n<ul>\n<li><code>egg-circuit-breaker</code><br>\n▸ 基于 Hystrix 模式的熔断器<br>\n▸ 配置示例：<pre><code class="language-javascript">config.<span class="hljs-property">circuitbreaker</span> = {\n  <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 失败率阈值</span>\n  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>   <span class="hljs-comment">// 超时时间</span>\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>限流控制</strong>\n<ul>\n<li><code>egg-rate-limiter</code><br>\n▸ 基于 Redis 的分布式限流<br>\n▸ 示例：限制接口 100 次/分钟</li>\n</ul>\n</li>\n<li><strong>日志增强</strong>\n<ul>\n<li><code>egg-logrotator</code>（内置）<br>\n▸ 自动切割日志文件</li>\n<li><code>egg-sls-logger</code><br>\n▸ 阿里云日志服务集成</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>四、开发辅助</strong></h3>\n<ol>\n<li><strong>文档生成</strong>\n<ul>\n<li><code>egg-swagger-doc</code><br>\n▸ 自动生成 OpenAPI 文档<br>\n▸ 配合装饰器使用：<pre><code class="language-typescript"><span class="hljs-meta">@Controller</span>(<span class="hljs-string">&#x27;/api&#x27;</span>)\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {\n  <span class="hljs-meta">@Summary</span>(<span class="hljs-string">&#x27;获取用户信息&#x27;</span>)\n  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;/user&#x27;</span>)\n  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params"></span>) {}\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>Mock 数据</strong>\n<ul>\n<li><code>egg-mock</code>（内置）<br>\n▸ 本地开发模拟接口</li>\n<li><code>egg-json-schema-faker</code><br>\n▸ 根据 JSON Schema 生成 Mock 数据</li>\n</ul>\n</li>\n<li><strong>测试工具</strong>\n<ul>\n<li><code>egg-mock</code>（内置）<br>\n▸ 单元测试/接口测试</li>\n<li><code>egg-jaeger</code><br>\n▸ 分布式链路追踪（集成 Jaeger）</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>五、部署与监控</strong></h3>\n<ol>\n<li><strong>健康检查</strong>\n<ul>\n<li><code>egg-health</code><br>\n▸ Kubernetes 就绪探针支持<br>\n▸ 示例：<code>/healthz</code> 端点</li>\n</ul>\n</li>\n<li><strong>性能监控</strong>\n<ul>\n<li><code>egg-alinode</code><br>\n▸ 阿里云 Node.js 性能监控</li>\n<li><code>egg-prometheus</code><br>\n▸ 暴露 Prometheus Metrics</li>\n</ul>\n</li>\n<li><strong>配置管理</strong>\n<ul>\n<li><code>egg-nacos</code><br>\n▸ 从 Nacos 配置中心读取配置</li>\n<li><code>egg-consul</code><br>\n▸ 服务发现与配置管理</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>六、完整配置示例</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// config/plugin.js</span>\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">redis</span> = {\n  <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">package</span>: <span class="hljs-string">&#x27;egg-redis&#x27;</span>\n};\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">graphql</span> = {\n  <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">package</span>: <span class="hljs-string">&#x27;egg-graphql&#x27;</span>\n};\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">circuitbreaker</span> = {\n  <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">package</span>: <span class="hljs-string">&#x27;egg-circuit-breaker&#x27;</span>\n};\n\n<span class="hljs-comment">// config/config.default.js</span>\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">redis</span> = {\n  <span class="hljs-attr">client</span>: {\n    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,\n    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>\n  }\n};\n<span class="hljs-built_in">exports</span>.<span class="hljs-property">graphql</span> = {\n  <span class="hljs-attr">router</span>: <span class="hljs-string">&#x27;/graphql&#x27;</span>,\n  <span class="hljs-attr">schemaDirectives</span>: { <span class="hljs-comment">/* ... */</span> }\n};\n</code></pre>\n<hr>\n<h3><strong>插件选型建议</strong></h3>\n<ol>\n<li><strong>基础场景</strong>  ：<br>\n<code>egg-http-proxy</code> + <code>egg-redis</code> + <code>egg-circuit-breaker</code></li>\n<li><strong>全功能 BFF</strong>  ：<br>\n<code>egg-graphql</code> + <code>egg-grpc</code> + <code>egg-prometheus</code></li>\n<li><strong>阿里云生态</strong>  ：<br>\n<code>egg-alinode</code> + <code>egg-sls-logger</code> + <code>egg-nacos</code></li>\n</ol>\n<p><strong>注意事项</strong>  ：</p>\n<ul>\n<li>避免过度使用插件，按需引入（每个插件会增加启动时间）</li>\n<li>优先使用 Egg 官方维护的插件（社区插件需评估稳定性）</li>\n<li>生产环境务必启用安全插件（如 <code>egg-security</code>）</li>\n</ul>\n</div>'</script></body></html>