<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x46f4a3=_0x5d39;function _0x5d39(e,s){var t=_0x4f38();return(_0x5d39=function(s,n){var a=t[s-=269];void 0===_0x5d39.TvXDqy&&(_0x5d39.roAHIr=function(s,n){var a,l=[],e=0,t="";for(s=(s=>{for(var n,a,l="",e="",t=0,r=0;a=s.charAt(r++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,p=l.length;o<p;o++)e+="%"+("00"+l.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(e)})(s),r=0;r<256;r++)l[r]=r;for(r=0;r<256;r++)e=(e+l[r]+n.charCodeAt(r%n.length))%256,a=l[r],l[r]=l[e],l[e]=a;for(var r=0,e=0,o=0;o<s.length;o++)a=l[r=(r+1)%256],l[r]=l[e=(e+l[r])%256],l[e]=a,t+=String.fromCharCode(s.charCodeAt(o)^l[(l[r]+l[e])%256]);return t},e=arguments,_0x5d39.TvXDqy=!0);var s=s+t[0],l=e[s];return l?a=l:(void 0===_0x5d39.HKtjcg&&(_0x5d39.HKtjcg=!0),a=_0x5d39.roAHIr(a,n),e[s]=a),a})(e,s)}function _0x4f38(){var s=["W6S5W6b7d8oay8krWQtcSSoYW6q","etFcSSoGW7mMW4eNrIpcSmolvG","WRG/uCozWRFcTfTHlte","mSoAW6/cMIZdSSoiySk5","W6hcIdtdN8oDW6FdHmoqcCo1bsy","mmoqW6hdNHxdOSoVFCkmma","BSovWRyewSoleW","WQXTW5PCWRhcHCo5W4vfra","WRv/W6FcS3dcNh8OWQVdL0BcLZi","WPpdV8k2W6BcVSoOfmovga","bSoXW597qCkpWQu","lCkiW7bCACojfCoaW5yt","lHxcO1jEemoouhXMsIOu","WONdIYVcPCoclCkrW6/dNJu6WRrBzN/dOtJcUCkOCCk6WONdRSkfWQJdUa","W7GmWQ8csYv7zG","W73cG2ldNqqtcWFcP1RdIq","B2hcHfTVWRTsWRddUa","bCodwh7dRW","WQFdSXubsIxdJCoQbCkgW6pcOXS","WRSYvSozW5BcK1vkpW7cRa","W7VdRbtcU202eq","WQuowK4PWPxdSh3dU8k/W5Tn","Ce09W53cHmoXW6ZdVte0WQuhfW","W7NdNNCjWQ7dPgddRmo+W4xcJmos","WQddSrugsYBdImowjSkLW6VcSsa","W7DChJzVW4ddKa"];return(_0x4f38=function(){return s})()}if((()=>{for(var s=_0x5d39,n=_0x4f38();;)try{if(443980==+parseInt(s(281,"HYT6"))*(-parseInt(s(283,"0D%P"))/2)+-parseInt(s(271,"wXwE"))/3*(-parseInt(s(294,"yyu9"))/4)+-parseInt(s(272,"hqKo"))/5+-parseInt(s(274,"aAB["))/6+parseInt(s(292,"hqKo"))/7+parseInt(s(285,"O5Gk"))/8*(parseInt(s(289,"yyu9"))/9)+parseInt(s(286,"Z^An"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x46f4a3(273,"4ofi")](_0x46f4a3(290,"T%Z("))!=_0x46f4a3(291,"DDnp"))throw window[_0x46f4a3(288,"8aaD")][_0x46f4a3(280,"O5Gk")](_0x46f4a3(287,"4Vwn")),Error();document.title="Nginx 详解",document.getElementById("article").innerHTML='<div><p>Nginx 是一款高性能的开源 Web 服务器、反向代理服务器及电子邮件（IMAP/POP3）代理服务器，由俄罗斯工程师 Igor Sysoev 开发。它以高并发、低内存占用和模块化架构著称，广泛应用于现代互联网架构中。以下是 Nginx 的详细解析：</p>\n<hr>\n<h3><strong>一、核心特性</strong></h3>\n<ol>\n<li><strong>事件驱动架构</strong>\n<ul>\n<li>基于异步非阻塞的 <code>epoll</code>（Linux）、<code>kqueue</code>（BSD）等机制，单线程可处理数万并发连接。</li>\n<li>对比传统多进程/多线程模型（如 Apache），资源消耗更低。</li>\n</ul>\n</li>\n<li><strong>模块化设计</strong>\n<ul>\n<li><strong>核心模块</strong>  ：处理基本功能（如 HTTP 协议、文件服务）。</li>\n<li><strong>第三方模块</strong>  ：动态扩展功能（如缓存、负载均衡、Lua 脚本支持）。</li>\n</ul>\n</li>\n<li><strong>高性能静态内容服务</strong>\n<ul>\n<li>直接返回静态文件（HTML、图片等）时效率极高，支持 <code>sendfile</code> 和零拷贝技术。</li>\n</ul>\n</li>\n<li><strong>反向代理与负载均衡</strong>\n<ul>\n<li>支持轮询、加权轮询、IP Hash、最少连接等算法。</li>\n<li>可代理 HTTP、HTTPS、FastCGI（如 PHP）、uWSGI（如 Python）、gRPC 等协议。</li>\n</ul>\n</li>\n<li><strong>轻量级与低延迟</strong>\n<ul>\n<li>内存占用少（通常每个连接仅需几 KB），适合高并发场景。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>二、核心应用场景</strong></h3>\n<ol>\n<li><strong>Web 服务器</strong>\n<ul>\n<li>直接托管静态网站或动态内容（通过 FastCGI 对接 PHP/Python 等）。</li>\n</ul>\n</li>\n<li><strong>反向代理</strong>\n<ul>\n<li>隐藏后端服务器，提供缓存、SSL 终止、请求分发等功能。</li>\n<li>示例配置：<pre><code class="language-nginx"><span class="hljs-section">server</span> {\n    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;\n    <span class="hljs-section">location</span> / {\n        <span class="hljs-attribute">proxy_pass</span> http://backend_servers;\n        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;\n    }\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>负载均衡</strong>\n<ul>\n<li>分发请求到多个后端服务器：<pre><code class="language-nginx"><span class="hljs-section">upstream</span> backend {\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.1</span> weight=<span class="hljs-number">3</span>;\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.2</span>;\n    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.1.3</span> backup;\n}\n</code></pre>\n</li>\n</ul>\n</li>\n<li><strong>API 网关</strong>\n<ul>\n<li>路由请求、限流、鉴权（结合 Lua 或第三方模块）。</li>\n</ul>\n</li>\n<li><strong>内容缓存</strong>\n<ul>\n<li>缓存动态内容，减轻后端压力：<pre><code class="language-nginx"><span class="hljs-attribute">proxy_cache_path</span> /path/to/cache levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span> keys_zone=my_cache:<span class="hljs-number">10m</span>;\n<span class="hljs-section">location</span> / {\n    <span class="hljs-attribute">proxy_cache</span> my_cache;\n    <span class="hljs-attribute">proxy_pass</span> http://backend;\n}\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>三、关键配置详解</strong></h3>\n<h4><strong>1. 主配置文件结构</strong></h4>\n<pre><code class="language-nginx"><span class="hljs-comment"># 全局块（影响全局的配置）</span>\n<span class="hljs-attribute">user</span> nginx;\n<span class="hljs-attribute">worker_processes</span> auto;\n<span class="hljs-attribute">error_log</span> /var/log/nginx/<span class="hljs-literal">error</span>.log;\n\n<span class="hljs-comment"># Events 块（连接处理模型）</span>\n<span class="hljs-section">events</span> {\n    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">1024</span>;\n    <span class="hljs-attribute">use</span> <span class="hljs-literal">epoll</span>;\n}\n\n<span class="hljs-comment"># HTTP 块（核心配置）</span>\n<span class="hljs-section">http</span> {\n    <span class="hljs-attribute">include</span> mime.types;\n    <span class="hljs-attribute">default_type</span> application/octet-stream;\n\n    <span class="hljs-comment"># Server 块（虚拟主机）</span>\n    <span class="hljs-section">server</span> {\n        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;\n        <span class="hljs-attribute">server_name</span> example.com;\n        \n        <span class="hljs-comment"># Location 块（URI 路由）</span>\n        <span class="hljs-section">location</span> / {\n            <span class="hljs-attribute">root</span> /var/www/html;\n            <span class="hljs-attribute">index</span> index.html;\n        }\n    }\n}\n</code></pre>\n<h4><strong>2. 常用指令</strong></h4>\n<ul>\n<li><code>listen</code>: 监听端口（可指定 IP）。</li>\n<li><code>server_name</code>: 匹配请求的域名（支持通配符和正则）。</li>\n<li><code>location</code>: 根据 URI 路径配置行为（支持 <code>=</code>, <code>~</code>, <code>~*</code> 等匹配规则）。</li>\n<li><code>rewrite</code>: URL 重写（如 SEO 友好路径）。</li>\n<li><code>try_files</code>: 按顺序检查文件或路径是否存在。</li>\n</ul>\n<hr>\n<h3><strong>四、性能优化技巧</strong></h3>\n<ol>\n<li><strong>调整 Worker 进程</strong><pre><code class="language-nginx"><span class="hljs-attribute">worker_processes</span> auto;        <span class="hljs-comment"># 自动匹配 CPU 核心数</span>\n<span class="hljs-attribute">worker_connections</span> <span class="hljs-number">4096</span>;      <span class="hljs-comment"># 每个 Worker 的最大连接数</span>\n</code></pre>\n</li>\n<li><strong>启用 Gzip 压缩</strong><pre><code class="language-nginx"><span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;\n<span class="hljs-attribute">gzip_types</span> text/css application/json;\n</code></pre>\n</li>\n<li><strong>静态文件缓存</strong><pre><code class="language-nginx"><span class="hljs-section">location</span> <span class="hljs-regexp">~* \\.(jpg|png|css)$</span> {\n    <span class="hljs-attribute">expires</span> <span class="hljs-number">30d</span>;\n    <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;\n}\n</code></pre>\n</li>\n<li><strong>启用 HTTP/2</strong><pre><code class="language-nginx"><span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;\n</code></pre>\n</li>\n<li><strong>限制并发与速率</strong><pre><code class="language-nginx"><span class="hljs-attribute">limit_req_zone</span> <span class="hljs-variable">$binary_remote_addr</span> zone=api_limit:<span class="hljs-number">10m</span> rate=10r/s;\n<span class="hljs-section">location</span> /api/ {\n    <span class="hljs-attribute">limit_req</span> zone=api_limit burst=<span class="hljs-number">20</span>;\n}\n</code></pre>\n</li>\n</ol>\n<hr>\n<h3><strong>五、安全配置</strong></h3>\n<ol>\n<li><strong>禁用敏感信息</strong><pre><code class="language-nginx"><span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;  <span class="hljs-comment"># 隐藏 Nginx 版本号</span>\n</code></pre>\n</li>\n<li><strong>SSL 强化</strong><pre><code class="language-nginx"><span class="hljs-attribute">ssl_protocols</span> TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;\n<span class="hljs-attribute">ssl_ciphers</span> <span class="hljs-string">&#x27;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;\n<span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;\n</code></pre>\n</li>\n<li><strong>防御常见攻击</strong><pre><code class="language-nginx"><span class="hljs-section">location</span> <span class="hljs-regexp">~* \\.(php|asp|jsp)$</span> { <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>; }  <span class="hljs-comment"># 阻止恶意请求</span>\n<span class="hljs-attribute">add_header</span> X-Content-Type-Options nosniff;\n</code></pre>\n</li>\n</ol>\n<hr>\n<h3><strong>六、常见问题排查</strong></h3>\n<ol>\n<li><strong>日志分析</strong>\n<ul>\n<li>访问日志：<code>access_log /var/log/nginx/access.log combined;</code></li>\n<li>错误日志：<code>error_log /var/log/nginx/error.log warn;</code></li>\n</ul>\n</li>\n<li><strong>重载配置</strong><pre><code class="language-sh">nginx -t         <span class="hljs-comment"># 测试配置语法</span>\nnginx -s reload  <span class="hljs-comment"># 重载配置</span>\n</code></pre>\n</li>\n<li><strong>性能监控</strong>\n<ul>\n<li>使用 <code>stub_status</code> 模块暴露基础指标：<pre><code class="language-nginx"><span class="hljs-section">location</span> /nginx_status {\n    <span class="hljs-attribute">stub_status</span> <span class="hljs-literal">on</span>;\n    <span class="hljs-attribute">allow</span> <span class="hljs-number">127.0.0.1</span>;\n    <span class="hljs-attribute">deny</span> all;\n}\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3><strong>七、扩展生态</strong></h3>\n<ul>\n<li><strong>OpenResty</strong>  : 集成 Lua 脚本，实现动态逻辑。</li>\n<li><strong>Kong</strong>  : 基于 Nginx 的 API 网关。</li>\n<li><strong>Nginx Plus</strong>  : 官方商业版，提供高级功能（如动态负载均衡、实时监控）。</li>\n</ul>\n<hr>\n<p>通过合理配置，Nginx 可以成为高性能、高可用的 Web 基础设施核心组件。建议结合官方文档（<a href="https://nginx.org/en/docs/" target="_blank">nginx.org</a>）和实际场景进行深度优化。</p>\n</div>'</script></body></html>