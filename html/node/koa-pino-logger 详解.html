<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x55cb9f=_0x5eaf;if((()=>{for(var s=_0x5eaf,n=_0x353d();;)try{if(544712==+parseInt(s(196,"a2Qw"))+-parseInt(s(198,"(6Eg"))/2*(parseInt(s(207,"pNvA"))/3)+-parseInt(s(191,"KTHR"))/4+-parseInt(s(201,"6gA8"))/5*(parseInt(s(212,"(hum"))/6)+-parseInt(s(187,"6gA8"))/7+-parseInt(s(195,"[97N"))/8+parseInt(s(194,"9Qch"))/9*(parseInt(s(210,"kESr"))/10))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x55cb9f(208,"q*CG")](_0x55cb9f(188,"a1Q&"))!=_0x55cb9f(206,"7aOg"))throw window[_0x55cb9f(189,"&Bnc")][_0x55cb9f(205,"9Qch")](_0x55cb9f(209,"[#v3")),Error();function _0x5eaf(p,s){var t=_0x353d();return(_0x5eaf=function(s,n){var a=t[s-=187];void 0===_0x5eaf.ymZSGH&&(_0x5eaf.HBpeJm=function(s,n){var a,l=[],p=0,t="";for(s=(s=>{for(var n,a,l="",p="",t=0,c=0;a=s.charAt(c++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,o=l.length;r<o;r++)p+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+n.charCodeAt(c%n.length))%256,a=l[c],l[c]=l[p],l[p]=a;for(var c=0,p=0,r=0;r<s.length;r++)a=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=a,t+=String.fromCharCode(s.charCodeAt(r)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x5eaf.ymZSGH=!0);var s=s+t[0],l=p[s];return l?a=l:(void 0===_0x5eaf.OKafQG&&(_0x5eaf.OKafQG=!0),a=_0x5eaf.HBpeJm(a,n),p[s]=a),a})(p,s)}function _0x353d(){var s=["W5tcQCoVWPBdUwtdR3a","dZpcGmonW7xcJxJdHSkgWOzgdW","W4lcG8obWQGSyHJdPHTRAGZcHa","W78OhrxcOmkKW4zkEq","WPFcNW7dJIpcV8oEmmkHa8kak8oy","WRKhWO1xl8kiWOFdICkAW4ddG8k1","W7FdU8kNmshcPq/dLCkzne8gWQK","zvdcUeSZWO5TWRPHf8k7iq","W7tdIGJdHIdcTmofaW","n2hcMuCliL3dTSoPBta","qmouoCkMBSkddJNdM1JcGCofWOW","hSkbWORcPJO7WPddMSo9WR5BrG","ksC9s8kTW57cUmklW4Sm","W73cNCowW6BdJSkTWQPCvwW","W4WfFI1ZWOKUWPfiW5i","W5TBW4ldGLK1AxeRFg4","W7LrW4OoD8oAWPm","WP7cS8oAWO7dLG","WPOdr8kWtaW7WQa","WOvuFe1Cna4","hmkyF8oNk8kkffldQhhcJmosWPL2sSoxWQvmWOBcSSkVWQ8lWO5IW60","g8klWO3dV3LNWOtdICoV","W7OJheNdR8o4WPf6rquFWQ4f","dCkRquVdS0jBW4D0vG","lI08t8o1WPNdTmkbW5ejWOSGBG","nSkfWRiSWRygWQ7dSCof"];return(_0x353d=function(){return s})()}document.title="koa-pino-logger 详解",document.getElementById("article").innerHTML='<div><p><code>koa-pino-logger</code> 是 Koa 生态中基于 <strong>Pino</strong>   的高性能 JSON 结构化日志中间件，专为生产环境设计，相比 <code>koa-logger</code> 具有更强的日志处理能力和更低的性能开销。以下是深度解析：</p>\n<hr>\n<h2><strong>1. 核心优势</strong></h2>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>高性能</strong></td>\n<td>异步二进制日志写入，比传统 <code>console.log</code> 快 4-5 倍</td>\n</tr>\n<tr>\n<td><strong>结构化 JSON</strong></td>\n<td>机器可读的日志格式，便于 ELK/Grafana 等系统分析</td>\n</tr>\n<tr>\n<td><strong>开发友好</strong></td>\n<td>支持 <code>prettyPrint</code> 美化输出（开发环境）</td>\n</tr>\n<tr>\n<td><strong>低开销</strong></td>\n<td>极低的内存和 CPU 占用（适合高并发场景）</td>\n</tr>\n<tr>\n<td><strong>请求追踪</strong></td>\n<td>自动生成唯一 <code>requestId</code>，关联请求全链路日志</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>2. 安装与基础用法</strong></h2>\n<h3><strong>安装</strong></h3>\n<pre><code class="language-sh">npm install koa-pino-logger pino\n<span class="hljs-comment"># 或使用 pino 的 pretty 打印（开发环境）</span>\nnpm install pino-pretty -D\n</code></pre>\n<h3><strong>基础使用</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);\n<span class="hljs-keyword">const</span> koaPino = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-pino-logger&#x27;</span>);\n\n<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>(); <span class="hljs-comment">// 默认输出到 process.stdout</span>\n\napp.<span class="hljs-title function_">use</span>(logger);\n\napp.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx) =&gt; {\n  ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;处理请求&#x27;</span>); <span class="hljs-comment">// 记录自定义日志</span>\n  ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;Hello Pino!&#x27;</span> };\n});\n\napp.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);\n</code></pre>\n<p><strong>输出示例（JSON）</strong>  ：</p>\n<pre><code class="language-json"><span class="hljs-punctuation">{</span>\n  <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1630000000000</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;pid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12345</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;hostname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;server1&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;reqId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;req-1&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;处理请求&quot;</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;req&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GET&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/&quot;</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;user-agent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;curl/7.68.0&quot;</span> <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;res&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>\n    <span class="hljs-attr">&quot;statusCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>\n    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;content-type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;application/json&quot;</span> <span class="hljs-punctuation">}</span>\n  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>\n  <span class="hljs-attr">&quot;responseTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>\n<span class="hljs-punctuation">}</span>\n</code></pre>\n<hr>\n<h2><strong>3. 高级配置</strong></h2>\n<h3><strong>（1）美化输出（开发环境）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({\n  <span class="hljs-attr">prettyPrint</span>: {\n    <span class="hljs-attr">colorize</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 彩色输出</span>\n    <span class="hljs-attr">translateTime</span>: <span class="hljs-string">&#x27;SYS:yyyy-mm-dd HH:MM:ss&#x27;</span>,\n    <span class="hljs-attr">ignore</span>: <span class="hljs-string">&#x27;pid,hostname&#x27;</span> <span class="hljs-comment">// 隐藏字段</span>\n  }\n});\n</code></pre>\n<h3><strong>（2）自定义日志级别</strong></h3>\n<pre><code class="language-javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaPino</span>({\n  <span class="hljs-attr">level</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? <span class="hljs-string">&#x27;info&#x27;</span> : <span class="hljs-string">&#x27;debug&#x27;</span>\n}));\n\n<span class="hljs-comment">// 使用不同级别记录日志</span>\nctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;调试信息&#x27;</span>);\nctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">warn</span>({ data }, <span class="hljs-string">&#x27;警告&#x27;</span>);\nctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">error</span>(err, <span class="hljs-string">&#x27;错误&#x27;</span>);\n</code></pre>\n<h3><strong>（3）输出到文件</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);\n<span class="hljs-keyword">const</span> pino = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pino&#x27;</span>);\n\n<span class="hljs-comment">// 创建文件传输流</span>\n<span class="hljs-keyword">const</span> stream = pino.<span class="hljs-title function_">destination</span>(<span class="hljs-string">&#x27;./logs/app.log&#x27;</span>);\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({}, stream);\n\n<span class="hljs-comment">// 日志文件自动轮转（可选）</span>\n<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pino-rotating-file&#x27;</span>)({\n  <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;./logs/app.log&#x27;</span>,\n  <span class="hljs-attr">size</span>: <span class="hljs-string">&#x27;10M&#x27;</span>,\n  <span class="hljs-attr">interval</span>: <span class="hljs-string">&#x27;1d&#x27;</span>\n});\n</code></pre>\n<h3><strong>（4）关联请求上下文</strong></h3>\n<pre><code class="language-javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n  ctx.<span class="hljs-property">log</span> = ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">child</span>({ \n    <span class="hljs-attr">userId</span>: ctx.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>?.<span class="hljs-property">id</span> || <span class="hljs-string">&#x27;anonymous&#x27;</span> \n  });\n  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n});\n\n<span class="hljs-comment">// 日志中自动添加 userId</span>\nctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;用户操作&#x27;</span>);\n</code></pre>\n<hr>\n<h2><strong>4. 关键功能详解</strong></h2>\n<h3><strong>（1）自动请求日志</strong></h3>\n<ul>\n<li><strong>默认字段</strong>  ：\n<ul>\n<li><code>req</code>：请求方法、URL、头信息</li>\n<li><code>res</code>：状态码、响应头</li>\n<li><code>responseTime</code>：处理耗时（毫秒）</li>\n<li><code>reqId</code>：唯一请求 ID</li>\n</ul>\n</li>\n</ul>\n<h3><strong>（2）错误日志处理</strong></h3>\n<pre><code class="language-javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  } <span class="hljs-keyword">catch</span> (err) {\n    ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">error</span>({ err, <span class="hljs-attr">req</span>: ctx.<span class="hljs-property">request</span> }, <span class="hljs-string">&#x27;请求失败&#x27;</span>);\n    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>;\n    ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Internal Error&#x27;</span> };\n  }\n});\n</code></pre>\n<h3><strong>（3）自定义序列化</strong></h3>\n<p>过滤敏感信息（如密码）：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({\n  <span class="hljs-attr">serializers</span>: {\n    <span class="hljs-attr">req</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> ({\n      <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,\n      <span class="hljs-attr">url</span>: req.<span class="hljs-property">url</span>,\n      <span class="hljs-attr">headers</span>: _.<span class="hljs-title function_">omit</span>(req.<span class="hljs-property">headers</span>, [<span class="hljs-string">&#x27;authorization&#x27;</span>])\n    }),\n    <span class="hljs-attr">user</span>: <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> _.<span class="hljs-title function_">pick</span>(user, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>])\n  }\n});\n</code></pre>\n<hr>\n<h2><strong>5. 生产环境最佳实践</strong></h2>\n<h3><strong>（1）日志分级存储</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// info 及以上级别存文件，error 额外发邮件</span>\n<span class="hljs-keyword">const</span> streams = [\n  { <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-attr">stream</span>: fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">&#x27;./logs/info.log&#x27;</span>) },\n  { <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-attr">stream</span>: fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">&#x27;./logs/error.log&#x27;</span>) }\n];\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({}, pino.<span class="hljs-title function_">multistream</span>(streams));\n</code></pre>\n<h3><strong>（2）与 ELK 集成</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> pinoElastic = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pino-elasticsearch&#x27;</span>);\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({}, <span class="hljs-title function_">pinoElastic</span>({\n  <span class="hljs-attr">index</span>: <span class="hljs-string">&#x27;app-logs&#x27;</span>,\n  <span class="hljs-attr">node</span>: <span class="hljs-string">&#x27;http://elasticsearch:9200&#x27;</span>\n}));\n</code></pre>\n<h3><strong>（3）性能监控</strong></h3>\n<pre><code class="language-javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();\n  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;\n  ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>({ duration }, <span class="hljs-string">&#x27;请求耗时&#x27;</span>);\n  metrics.<span class="hljs-title function_">track</span>(<span class="hljs-string">&#x27;request_time&#x27;</span>, duration); <span class="hljs-comment">// 上报到 Prometheus</span>\n});\n</code></pre>\n<hr>\n<h2><strong>6. 完整示例</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);\n<span class="hljs-keyword">const</span> koaPino = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-pino-logger&#x27;</span>);\n<span class="hljs-keyword">const</span> pino = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pino&#x27;</span>);\n\n<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();\n\n<span class="hljs-comment">// 配置日志</span>\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({\n  <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;info&#x27;</span>,\n  <span class="hljs-attr">serializers</span>: {\n    <span class="hljs-attr">err</span>: pino.<span class="hljs-property">stdSerializers</span>.<span class="hljs-property">err</span>,\n    <span class="hljs-attr">req</span>: pino.<span class="hljs-property">stdSerializers</span>.<span class="hljs-property">req</span>,\n  },\n  <span class="hljs-attr">redact</span>: [<span class="hljs-string">&#x27;req.headers.cookie&#x27;</span>] <span class="hljs-comment">// 脱敏字段</span>\n});\n\napp.<span class="hljs-title function_">use</span>(logger);\n\n<span class="hljs-comment">// 错误处理</span>\napp.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();\n  } <span class="hljs-keyword">catch</span> (err) {\n    ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">error</span>({ err }, <span class="hljs-string">&#x27;请求异常&#x27;</span>);\n    ctx.<span class="hljs-property">status</span> = err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>;\n    ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">code</span>: <span class="hljs-number">500</span>, <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> };\n  }\n});\n\n<span class="hljs-comment">// 业务路由</span>\napp.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx) =&gt; {\n  ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;开始处理&#x27;</span>);\n  <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAsyncTask</span>();\n  ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;OK&#x27;</span> };\n});\n\napp.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {\n  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;Server started on port 3000&#x27;</span>);\n});\n</code></pre>\n<hr>\n<h2><strong>7. 常见问题</strong></h2>\n<h3><strong>Q: 如何关闭请求日志？</strong></h3>\n<pre><code class="language-javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaPino</span>({\n  <span class="hljs-attr">autoLogging</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 禁用自动请求日志</span>\n}));\n</code></pre>\n<h3><strong>Q: 为什么日志中没有错误堆栈？</strong></h3>\n<ul>\n<li><strong>原因</strong>  ：需显式序列化 Error 对象：<pre><code class="language-javascript">ctx.<span class="hljs-property">log</span>.<span class="hljs-title function_">error</span>({ <span class="hljs-attr">err</span>: pino.<span class="hljs-property">stdSerializers</span>.<span class="hljs-title function_">err</span>(err) }, <span class="hljs-string">&#x27;错误&#x27;</span>);\n</code></pre>\n</li>\n</ul>\n<h3><strong>Q: 如何与 Sentry 集成？</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> pinoSentry = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pino-sentry&#x27;</span>);\n<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">koaPino</span>({}, <span class="hljs-title function_">pinoSentry</span>({\n  <span class="hljs-attr">dsn</span>: <span class="hljs-string">&#x27;https://xxx@sentry.io/xxx&#x27;</span>\n}));\n</code></pre>\n<hr>\n<h3><strong>总结</strong></h3>\n<ul>\n<li><strong>生产首选</strong>  ：<code>koa-pino-logger</code> 是 Koa 应用日志的黄金标准，兼顾性能与可观测性。</li>\n<li><strong>核心能力</strong>  ：\n<ul>\n<li>结构化 JSON 日志</li>\n<li>请求链路追踪</li>\n<li>自定义日志分级</li>\n</ul>\n</li>\n<li><strong>必做事项</strong>  ：\n<ul>\n<li>生产环境禁用 <code>prettyPrint</code></li>\n<li>敏感信息脱敏</li>\n<li>集成日志分析系统（如 ELK）</li>\n</ul>\n</li>\n</ul>\n</div>'</script></body></html>