<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x4b7f3c=_0x4d29;function _0x4d29(p,s){var r=_0x6c8f();return(_0x4d29=function(s,n){var a=r[s-=418];void 0===_0x4d29.euBJrw&&(_0x4d29.SYolFL=function(s,n){var a,t=[],p=0,r="";for(s=(s=>{for(var n,a,t="",p="",r=0,l=0;a=s.charAt(l++);~a&&(n=r%4?64*n+a:a,r++%4)&&(t+=String.fromCharCode(255&n>>(-2*r&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,e=t.length;o<e;o++)p+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(p)})(s),l=0;l<256;l++)t[l]=l;for(l=0;l<256;l++)p=(p+t[l]+n.charCodeAt(l%n.length))%256,a=t[l],t[l]=t[p],t[p]=a;for(var l=0,p=0,o=0;o<s.length;o++)a=t[l=(l+1)%256],t[l]=t[p=(p+t[l])%256],t[p]=a,r+=String.fromCharCode(s.charCodeAt(o)^t[(t[l]+t[p])%256]);return r},p=arguments,_0x4d29.euBJrw=!0);var s=s+r[0],t=p[s];return t?a=t:(void 0===_0x4d29.VeUEqC&&(_0x4d29.VeUEqC=!0),a=_0x4d29.SYolFL(a,n),p[s]=a),a})(p,s)}if((()=>{for(var s=_0x4d29,n=_0x6c8f();;)try{if(535275==-parseInt(s(434,"hw!C"))+parseInt(s(429,"bq4o"))/2+parseInt(s(443,"3sol"))/3+parseInt(s(427,"*BG%"))/4*(-parseInt(s(439,")UdU"))/5)+parseInt(s(441,")1@E"))/6*(parseInt(s(425,"I!Fj"))/7)+-parseInt(s(440,"Q@T@"))/8*(-parseInt(s(428,"0tml"))/9)+-parseInt(s(426,"trUX"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x4b7f3c(423,"7kkp")](_0x4b7f3c(418,"bq4o"))!=_0x4b7f3c(424,"!xUr"))throw window[_0x4b7f3c(435,"!UzF")][_0x4b7f3c(436,"lZp*")](_0x4b7f3c(432,"H^Pp")),Error();function _0x6c8f(){var s=["WRrpq8odWOnit8o6WOJcNW","W6xcI8kiWO1hWQZdLr55WQK","lmkbyCkfkvGUWRDDWRiQkwG","WOXfWQDvW7hcOSoTWQ9TWRqTWPa","WQZcMmonamo8lGC5W7JdGZ4uW78","WONdUCkGBwX3rmkeW7y0kGldLHRcGSocW67dLqxdMvtcLw7dPMZdKW","vGVcLHxcJ8kIWPRcNSokaa","d25bWP3dSbKzpCoJrgbi","W7Pya8ogjmouACkU","W5KBgCkWuCo/WQ0","pgeEirlcJSo+emk+sSoIhG","WPFcR8o9WQpdLdVcS38sWOm","b8o8dSkqrmkSfaZdSCoC","WQldJCozWO3cOseIW4qzW5G","iKrDW4a2WQLkWO1j","WPlcPmo0W5ddGWtcTwiu","zSoaWOKzj8k3W4hdSt98WOVdGW","x8osmCouyX9DWRv1","q1VcQCoKa1ZcU2OtymkZ","zSkhqMj0W7tcIMHAWQOMW7hdL8kz","gSo2W7/cGYaGb2CiiW","gCo9W5fXf3ldRmo7CI4","nSo2W4dcGmkQWQjS","W4v1wCkwW5e","WQTSamoTWOORlfRcLr3dNW","s1pcRSoKbHldMaKhxCkQW5H1EW"];return(_0x6c8f=function(){return s})()}document.title="eggjs3.x router.group 详解",document.getElementById("article").innerHTML='<div><p>在 <strong>Egg.js 3.x</strong>   中，<code>router.group</code> 是一个强大的路由分组方法，允许你为<strong>一组路由统一配置中间件、前缀、名称</strong>  等，显著提升代码可维护性。以下是详细解析和完整示例：</p>\n<hr>\n<h3><strong>1. <code>router.group</code> 核心功能</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>功能</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>统一中间件</strong></td>\n<td>组内所有路由自动应用指定的中间件（如 JWT 校验）。</td>\n</tr>\n<tr>\n<td><strong>路由前缀</strong></td>\n<td>为组内路由自动添加 URL 前缀（如 <code>/api</code>）。</td>\n</tr>\n<tr>\n<td><strong>命名空间</strong></td>\n<td>为路由命名，方便生成 URL（如 <code>ctx.helper.pathFor(\'groupName.routeName\')</code>）。</td>\n</tr>\n<tr>\n<td><strong>嵌套分组</strong></td>\n<td>支持多层嵌套，适合复杂模块化场景。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>2. 基础语法</strong></h3>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({ options }, callback);\n</code></pre>\n<ul>\n<li><strong><code>options</code></strong>  ：配置对象（可选字段见下文）。</li>\n<li><strong><code>callback</code></strong>  ：包含子路由的定义函数，参数为当前路由实例。</li>\n</ul>\n<hr>\n<h3><strong>3. 完整配置选项（<code>options</code>）</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>类型</strong></th>\n<th><strong>默认值</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>prefix</code></td>\n<td><code>string</code></td>\n<td><code>\'\'</code></td>\n<td>路由组前缀（如 <code>/admin</code>）。</td>\n</tr>\n<tr>\n<td><code>name</code></td>\n<td><code>string</code></td>\n<td><code>\'\'</code></td>\n<td>路由组命名空间（用于生成 URL）。</td>\n</tr>\n<tr>\n<td><code>middleware</code></td>\n<td><code>Array</code></td>\n<td><code>[]</code></td>\n<td>组内路由统一应用的中间件（可指定多个）。</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3><strong>4. 使用示例</strong></h3>\n<h4><strong>(1) 基础分组（中间件 + 前缀）</strong></h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// app/router.js</span>\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">app</span> =&gt;</span> {\n  <span class="hljs-keyword">const</span> { router, controller, middleware } = app;\n  <span class="hljs-keyword">const</span> jwtAuth = middleware.<span class="hljs-title function_">jwtAuth</span>(); <span class="hljs-comment">// JWT 校验中间件</span>\n  <span class="hljs-keyword">const</span> logRequest = middleware.<span class="hljs-title function_">logRequest</span>(); <span class="hljs-comment">// 日志中间件</span>\n\n  <span class="hljs-comment">// 路由组：统一校验 JWT 和日志</span>\n  router.<span class="hljs-title function_">group</span>({ \n    <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api&#x27;</span>, \n    <span class="hljs-attr">middleware</span>: [logRequest, jwtAuth] \n  }, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n    router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>); <span class="hljs-comment">// 实际路径: /api/users</span>\n    router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/profile&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>); <span class="hljs-comment">// 实际路径: /api/profile</span>\n  });\n\n  <span class="hljs-comment">// 公开路由（不应用中间件）</span>\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/public&#x27;</span>, controller.<span class="hljs-property">public</span>.<span class="hljs-property">index</span>);\n};\n</code></pre>\n<h4><strong>(2) 命名路由组（生成 URL）</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;admin&#x27;</span>,\n  <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/admin&#x27;</span>\n}, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;dashboard&#x27;</span>, <span class="hljs-string">&#x27;/home&#x27;</span>, controller.<span class="hljs-property">admin</span>.<span class="hljs-property">home</span>); <span class="hljs-comment">// 命名路由: admin.dashboard</span>\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">admin</span>.<span class="hljs-property">users</span>);   <span class="hljs-comment">// 命名路由: admin.users</span>\n});\n\n<span class="hljs-comment">// 在 Controller 中生成 URL</span>\nctx.<span class="hljs-property">helper</span>.<span class="hljs-title function_">pathFor</span>(<span class="hljs-string">&#x27;admin.dashboard&#x27;</span>); <span class="hljs-comment">// 输出: /admin/home</span>\n</code></pre>\n<h4><strong>(3) 嵌套分组</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">apiRouter</span> =&gt;</span> {\n  apiRouter.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v1&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">v1Router</span> =&gt;</span> {\n    v1Router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">v1</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>); <span class="hljs-comment">// 实际路径: /api/v1/users</span>\n  });\n\n  apiRouter.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v2&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">v2Router</span> =&gt;</span> {\n    v2Router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">v2</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>); <span class="hljs-comment">// 实际路径: /api/v2/users</span>\n  });\n});\n</code></pre>\n<hr>\n<h3><strong>5. 中间件执行顺序</strong></h3>\n<p>组内中间件按定义顺序执行：</p>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({\n  <span class="hljs-attr">middleware</span>: [middlewareA, middlewareB] <span class="hljs-comment">// 先执行 A，再执行 B</span>\n}, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/test&#x27;</span>, controller.<span class="hljs-property">test</span>);\n});\n</code></pre>\n<hr>\n<h3><strong>6. 实际应用场景</strong></h3>\n<h4><strong>(1) 管理员后台路由</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({\n  <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/admin&#x27;</span>,\n  <span class="hljs-attr">middleware</span>: [middleware.<span class="hljs-title function_">authAdmin</span>(), middleware.<span class="hljs-title function_">logOperation</span>()],\n  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;admin&#x27;</span>\n}, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, controller.<span class="hljs-property">admin</span>.<span class="hljs-property">index</span>);\n  router.<span class="hljs-title function_">resources</span>(<span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">admin</span>.<span class="hljs-property">user</span>); <span class="hljs-comment">// RESTful 路由</span>\n});\n</code></pre>\n<h4><strong>(2) API 版本控制</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api&#x27;</span> }, <span class="hljs-function"><span class="hljs-params">api</span> =&gt;</span> {\n  api.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v1&#x27;</span>, <span class="hljs-attr">middleware</span>: [middleware.<span class="hljs-property">apiV1</span>] }, <span class="hljs-function"><span class="hljs-params">v1</span> =&gt;</span> {\n    v1.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">v1</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n  });\n\n  api.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v2&#x27;</span>, <span class="hljs-attr">middleware</span>: [middleware.<span class="hljs-property">apiV2</span>] }, <span class="hljs-function"><span class="hljs-params">v2</span> =&gt;</span> {\n    v2.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">api</span>.<span class="hljs-property">v2</span>.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n  });\n});\n</code></pre>\n<hr>\n<h3><strong>7. 注意事项</strong></h3>\n<ol>\n<li><strong>中间件作用域</strong><br>\n组内中间件仅对当前组的路由生效，不影响外部路由。</li>\n<li><strong>性能优化</strong><br>\n避免在中间件中执行阻塞操作（如同步 IO）。</li>\n<li><strong>错误处理</strong><br>\n组内中间件抛出错误时，可通过全局 <code>app.config.errorHandler</code> 捕获。</li>\n</ol>\n<hr>\n<h3><strong>8. 对比传统写法</strong></h3>\n<h4><strong>传统方式（冗余代码）</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, middleware.<span class="hljs-property">logRequest</span>, middleware.<span class="hljs-property">jwtAuth</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\nrouter.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/profile&#x27;</span>, middleware.<span class="hljs-property">logRequest</span>, middleware.<span class="hljs-property">jwtAuth</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>);\n</code></pre>\n<h4><strong><code>router.group</code> 方式（简洁清晰）</strong></h4>\n<pre><code class="language-javascript">router.<span class="hljs-title function_">group</span>({ \n  <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/api&#x27;</span>, \n  <span class="hljs-attr">middleware</span>: [middleware.<span class="hljs-property">logRequest</span>, middleware.<span class="hljs-property">jwtAuth</span>] \n}, <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> {\n  router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">list</span>);\n  router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/profile&#x27;</span>, controller.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>);\n});\n</code></pre>\n<hr>\n<h3><strong>总结</strong></h3>\n<ul>\n<li><strong>核心价值</strong>  ：通过 <code>router.group</code> 实现 <strong>路由模块化</strong>   和 <strong>中间件复用</strong>  ，提升代码可读性。</li>\n<li><strong>适用场景</strong>  ：\n<ul>\n<li>需要统一认证的接口组（如 <code>/api</code>、<code>/admin</code>）。</li>\n<li>多版本 API 路由隔离。</li>\n<li>复杂项目的分层路由管理。</li>\n</ul>\n</li>\n</ul>\n<p>Egg.js 3.x 的 <code>router.group</code> 是大型应用路由组织的利器，合理使用能大幅降低维护成本。</p>\n</div>'</script></body></html>