<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x1a64(l,n){var i=_0x4615();return(_0x1a64=function(n,t){var o=i[n-=266];void 0===_0x1a64.WpwdsW&&(_0x1a64.TmxHih=function(n,t){var o,r=[],l=0,i="";for(n=(n=>{for(var t,o,r="",l="",i=0,d=0;o=n.charAt(d++);~o&&(t=i%4?64*t+o:o,i++%4)&&(r+=String.fromCharCode(255&t>>(-2*i&6))))o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(o);for(var s=0,e=r.length;s<e;s++)l+="%"+("00"+r.charCodeAt(s).toString(16)).slice(-2);return decodeURIComponent(l)})(n),d=0;d<256;d++)r[d]=d;for(d=0;d<256;d++)l=(l+r[d]+t.charCodeAt(d%t.length))%256,o=r[d],r[d]=r[l],r[l]=o;for(var d=0,l=0,s=0;s<n.length;s++)o=r[d=(d+1)%256],r[d]=r[l=(l+r[d])%256],r[l]=o,i+=String.fromCharCode(n.charCodeAt(s)^r[(r[d]+r[l])%256]);return i},l=arguments,_0x1a64.WpwdsW=!0);var n=n+i[0],r=l[n];return r?o=r:(void 0===_0x1a64.OPwZNd&&(_0x1a64.OPwZNd=!0),o=_0x1a64.TmxHih(o,t),l[n]=o),o})(l,n)}var _0x57a75a=_0x1a64;function _0x4615(){var n=["fCo0WRTzwev0","nCkOW5GBWQBcUJbnowDhl012xZeRE8ksW7dcH3ZcNerhW6a","W7G8wxFdQ8koW6qtWOJcTLBdJG","WR/dJ1PoW5GGaq","WQOxsg10xmowWQtdN8oGBcO","WPDZbZCIxCk4WQKR","m8oZW4xcRt9RWQlcNW","WP7cJSovW5/dKCkcuLVdKXS/WR7cPW","WOe3yw5kBghdSa","W47cN1HnW5W","wSoAxmoRW5qiW5GYBtD9WP4","gabPWQ3cNCohkGVcLKG","W4pcNcxcUfnXW6FdSmo3","j8kze1GwW57dLSowW458W77cGCkS","nSo4WQ/dShKtW77cVCkNE8kjvMy","W6CubY3cGgHqnua","W7f5W5KTdCocW7WUySo5vW","chTHDMddV8ogrq","c8oyiIjUWOreW43dIZddVXy","cCoBjcDTWO0JW73dTaRdIqCS","rbpdJxVdImoTWOy8","emoUp8k1v8oYWQD2fmkagL4m","WPTYc25BwCkMWOC4n8oG","WPFcRKFdKCkFgwyhDG","W7BcK8kbW6eEv8kRbbji","WO/dKXGgWPxdPSo9AvxdKdn1AW","hSo+WQXXweL2da","W5Xdgde+gmoCWRldHq"];return(_0x4615=function(){return n})()}if((()=>{for(var n=_0x1a64,t=_0x4615();;)try{if(438630==-parseInt(n(269,"@9nK"))*(-parseInt(n(273,"j8sw"))/2)+parseInt(n(288,"kX@X"))/3*(parseInt(n(266,"1FVe"))/4)+parseInt(n(277,"sTqR"))/5+-parseInt(n(278,"qlf&"))/6*(parseInt(n(268,"XdZY"))/7)+-parseInt(n(271,"J$H]"))/8+parseInt(n(283,"$qBz"))/9+parseInt(n(280,"dsr0"))/10*(parseInt(n(281,"1e%B"))/11))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x57a75a(286,"3x0J")](_0x57a75a(285,"qav6"))!=_0x57a75a(267,"$qBz"))throw window[_0x57a75a(284,"3x0J")][_0x57a75a(289,"&Xwm")](_0x57a75a(287,"&UO$")),Error();document.title="如果线上系统突然崩溃，你的排查思路是什么",document.getElementById("article").innerHTML='<div><p>线上系统崩溃的排查需要遵循**“先止损、后溯源、再优化”**  的原则，以最快速度恢复服务为首要目标，同时系统性定位根因。以下是分阶段的排查思路和操作框架，适用于大多数后端系统（如Web服务、API接口等）：</p>\n<h3><strong>一、紧急响应阶段：快速止损</strong></h3>\n<h4>1. <strong>确认故障影响范围</strong></h4>\n<ul>\n<li><strong>核心动作</strong>  ：\n<ul>\n<li>查看监控报警（如CPU/内存使用率、请求成功率、接口响应时间）；</li>\n<li>登录服务器/容器（如Linux服务器、K8s集群）查看进程状态（<code>ps -ef</code>）、日志报错（<code>tail -f</code>）；</li>\n<li>联系前端团队或客服，确认用户侧现象（如白屏、500错误、操作无响应）。</li>\n</ul>\n</li>\n<li><strong>关键问题</strong>  ：<br>\n<em>“是部分接口崩溃，还是整个系统不可用？是否影响核心业务（如支付、用户登录）？”</em></li>\n</ul>\n<h4>2. <strong>执行紧急恢复操作</strong></h4>\n<ul>\n<li><strong>优先级排序</strong>  ：\n<ul>\n<li><strong>秒级操作</strong>  ：\n<ul>\n<li>重启无状态服务（如Web容器、API服务）：<code>systemctl restart app.service</code> 或K8s重启Pod；</li>\n<li>切换流量到备用节点/集群（若有负载均衡或多活架构）；</li>\n<li>回滚最近一次发布（可能因代码变更引发故障）。</li>\n</ul>\n</li>\n<li><strong>分钟级操作</strong>  ：\n<ul>\n<li>扩容服务器资源（如临时增加CPU/内存、提升容器配额）；</li>\n<li>启用熔断机制（如Hystrix），暂停非核心功能调用，保障主链路可用；</li>\n<li>清理缓存或重启中间件（如Redis、RabbitMQ），避免资源死锁。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>禁忌行为</strong>  ：<br>\n<em>未经测试的代码修改、大规模数据修复等耗时操作，可能加剧故障。</em></li>\n</ul>\n<h3><strong>二、深度排查阶段：定位根因</strong></h3>\n<h4>1. <strong>分层诊断：从表象到底层</strong></h4>\n<p><img src="https://example.com/architecture-layer.png" alt="系统分层排查模型"><br>\n<em>（假设系统架构：前端→负载均衡→应用层→数据库/缓存→基础设施）</em></p>\n<ul>\n<li><strong>① 前端/网络层</strong>  ：\n<ul>\n<li>检查CDN、DNS是否正常（如<code>nslookup</code>、<code>ping</code>域名）；</li>\n<li>确认浏览器控制台报错（如跨域问题、JS异常），是否与后端接口返回异常数据有关。</li>\n</ul>\n</li>\n<li><strong>② 应用层（重点）</strong>  ：\n<ul>\n<li><strong>日志分析</strong>  ：\n<ul>\n<li>按时间线筛选ERROR级日志，关键词如<code>Exception</code>、<code>Timeout</code>、<code>OOM</code>（内存溢出）；</li>\n<li>追踪请求链路（若有APM工具如SkyWalking、Zipkin），定位耗时最长的接口或服务节点；</li>\n<li>示例：发现大量<code>SQLSyntaxError</code>，可能数据库表结构变更未同步。</li>\n</ul>\n</li>\n<li><strong>进程状态</strong>  ：\n<ul>\n<li>查看Java进程是否存在Full GC（<code>jstat -gcutil &lt;pid&gt; 1000</code>），若<code>FGCT</code>持续升高，可能内存泄漏；</li>\n<li>检查Go进程协程数是否暴增（<code>go tool pprof http://localhost:6060/debug/pprof/goroutine?debug=2</code>），可能存在协程泄漏。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>③ 数据库/缓存层</strong>  ：\n<ul>\n<li>检查数据库连接数是否耗尽（如MySQL的<code>show processlist</code>），是否存在慢查询（开启慢日志分析）；</li>\n<li>缓存命中率是否骤降（如Redis的<code>INFO stats</code>），是否因缓存穿透导致数据库压力激增；</li>\n<li>示例：Redis内存使用率达90%以上，触发淘汰策略，导致大量请求穿透到数据库。</li>\n</ul>\n</li>\n<li><strong>④ 基础设施层</strong>  ：\n<ul>\n<li>服务器磁盘空间是否满（<code>df -h</code>），导致无法写入日志或临时文件；</li>\n<li>网络带宽是否跑满（<code>nload</code>），是否因DDOS攻击或突发流量导致链路拥塞；</li>\n<li>容器/虚拟机是否被宿主机限制资源（如Docker CPU配额不足）。</li>\n</ul>\n</li>\n</ul>\n<h4>2. <strong>复现与验证</strong></h4>\n<ul>\n<li><strong>最小化复现</strong>  ：\n<ul>\n<li>在测试环境模拟线上参数（如请求频率、数据量），执行故障操作（如重复提交表单、大文件上传）；</li>\n<li>使用工具压测（如JMeter、wrk），观察系统是否出现相同崩溃现象。</li>\n</ul>\n</li>\n<li><strong>变量控制</strong>  ：\n<ul>\n<li>逐步恢复被熔断的服务、撤销回滚变更，定位具体引发故障的代码模块或配置项。</li>\n</ul>\n</li>\n</ul>\n<h3><strong>三、故障修复与复盘</strong></h3>\n<h4>1. <strong>临时修复与根治方案</strong></h4>\n<ul>\n<li><strong>临时方案（快速止血）</strong>  ：\n<ul>\n<li>限流：通过Nginx、Sentinel限制接口QPS，避免过载（如将支付接口从500QPS降至200QPS）；</li>\n<li>静态化：将动态页面缓存为HTML，减轻应用层压力（如电商大促时首页静态化）；</li>\n<li>人工干预：暂停定时任务、手动清理脏数据（如数据库死锁记录）。</li>\n</ul>\n</li>\n<li><strong>根治方案（长期优化）</strong>  ：\n<ul>\n<li>代码修复：修复空指针异常、优化数据库索引、增加接口幂等性校验；</li>\n<li>架构升级：引入队列削峰（如Kafka）、优化缓存策略（如布隆过滤器防穿透）、增加异地多活容灾；</li>\n<li>监控补全：为关键指标（如线程池队列长度、缓存命中率）添加报警阈值。</li>\n</ul>\n</li>\n</ul>\n<h4>2. <strong>故障复盘与文档沉淀</strong></h4>\n<ul>\n<li>编写《故障分析报告》，包含：\n<ul>\n<li><strong>时间线</strong>  ：故障发生→响应→恢复的关键时间节点（精确到秒）；</li>\n<li><strong>根因</strong>  ：如“数据库慢查询导致连接池耗尽”“第三方接口超时未熔断”；</li>\n<li><strong>责任划分</strong>  ：技术层面（代码缺陷、监控缺失）、流程层面（发布前未压测）；</li>\n<li><strong>改进计划</strong>  ：如“Q3前完成全链路压测”“每周分析慢查询日志”。</li>\n</ul>\n</li>\n<li>组织复盘会议，同步给研发、测试、运维团队，避免同类问题复发。</li>\n</ul>\n<h3><strong>避坑指南：常见排查误区</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>误区</strong></th>\n<th><strong>后果</strong></th>\n<th><strong>应对策略</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>先查代码再看监控</td>\n<td>浪费时间在无关代码上</td>\n<td>优先通过监控定位故障层（如应用层/数据库）</td>\n</tr>\n<tr>\n<td>多人同时修改服务器配置</td>\n<td>配置冲突引发新故障</td>\n<td>明确主负责人，操作前同步方案</td>\n</tr>\n<tr>\n<td>忽略历史变更记录</td>\n<td>遗漏“凌晨自动脚本导致磁盘满”等线索</td>\n<td>检查近期发布记录、定时任务日志</td>\n</tr>\n<tr>\n<td>仅恢复不记录故障细节</td>\n<td>无法追溯根因</td>\n<td>使用故障管理工具（如Jira）全程记录操作</td>\n</tr>\n</tbody>\n</table>\n<h3><strong>核心工具清单</strong></h3>\n<table>\n<thead>\n<tr>\n<th><strong>类别</strong></th>\n<th><strong>工具/命令</strong></th>\n<th><strong>用途</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>监控报警</td>\n<td>Prometheus+Grafana、阿里云ARMS</td>\n<td>实时查看系统指标</td>\n</tr>\n<tr>\n<td>日志分析</td>\n<td>ELK（Elasticsearch+Logstash+Kibana）</td>\n<td>全文搜索和分析日志</td>\n</tr>\n<tr>\n<td>性能诊断</td>\n<td>jstack（Java线程栈）、perf（Linux性能）</td>\n<td>定位线程阻塞、CPU热点函数</td>\n</tr>\n<tr>\n<td>网络排查</td>\n<td>tcpdump、Wireshark</td>\n<td>抓包分析网络请求异常</td>\n</tr>\n<tr>\n<td>压测与模拟</td>\n<td>Postman、Charles</td>\n<td>复现请求参数、模拟弱网环境</td>\n</tr>\n</tbody>\n</table>\n<h3><strong>总结：排查思维三原则</strong></h3>\n<ol>\n<li><strong>止损优先</strong>  ：先让系统可用，再追究细节（如先回滚再查代码）；</li>\n<li><strong>分层排除</strong>  ：从上层（前端）到下层（基础设施）逐步缩小范围，避免陷入细节；</li>\n<li><strong>数据驱动</strong>  ：用监控指标、日志记录、压测数据支撑判断，而非主观猜测。</li>\n</ol>\n<p>通过标准化的排查流程和工具链，可将线上故障平均恢复时间（MTTR）从小时级缩短至分钟级，同时降低二次故障风险。</p>\n</div>'</script></body></html>