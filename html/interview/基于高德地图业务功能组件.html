<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x489a4c=_0x5b38;function _0x5b38(p,s){var t=_0x3562();return(_0x5b38=function(s,a){var n=t[s-=399];void 0===_0x5b38.JUMrGf&&(_0x5b38.Ihwcnk=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,o=l.length;c<o;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x5b38.JUMrGf=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x5b38.Mobzcg&&(_0x5b38.Mobzcg=!0),n=_0x5b38.Ihwcnk(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x5b38,a=_0x3562();;)try{if(629470==+parseInt(s(415,"f]!j"))+-parseInt(s(408,"#^jb"))/2+parseInt(s(420,"MxJ&"))/3*(-parseInt(s(424,"v2GT"))/4)+-parseInt(s(407,"wLUe"))/5*(parseInt(s(410,"CuSM"))/6)+parseInt(s(413,"CuSM"))/7+parseInt(s(412,"9mdv"))/8+-parseInt(s(405,"Sl)$"))/9*(-parseInt(s(418,"bkfk"))/10))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x489a4c(399,"5(oO")](_0x489a4c(423,"t1wZ"))!=_0x489a4c(406,"#KMG"))throw window[_0x489a4c(417,"A2$l")][_0x489a4c(414,"CuSM")](_0x489a4c(411,"UFtr")),Error();function _0x3562(){var s=["vmooW5NcPchcLmkKDa","fmkiW5RdGCoPimoUW5e","WPdcG8kNWQVcISocCSkSbt8XcsC","rZRcOCo0kMGXW4ft","WR3cS8oeeCoTo8kDW63dKSkNkxDA","w8oKW5RdUmkfEMhcOmoUuSoRW67cKW","dmkpmSo+WRNdNHT3WRK","BSk/gIJcUKXfg8kcdG","WQCAmtmJWPmr","emkbWQBcUmkpnCorW75UW6GD","ou1Oo8oZW7uNWRrHsufSdq","kslcT8o+o8oKkSonWQy","i2ZcHCoUzgeDW6jb","W6C6ASkFeNhdHCkfjSoVbCoW","jCobh8oGW59upuRdNdPsWQxcQG","W7ZdVmk1t0m","WOu5W6ldGYTCWPNcR8oL","CCkzD8kDf8oAW70GA1tcPmosFa","WOq1l8kszLlcN8kg","mfNcM8oVW7NcGCo6fmoJaZO","W6RcU8kdbSogcmoyWQJdTmoSWR7cHdTVWRXUxrFdSmkzWO51uSk5iXW","W5BdHehcNuRdKCk3WOb7dXKJwq","mfFcLSoVW73dTCkubCoUoslcHgC","DWxdKSkYWQJcPSog","kIBcTmk3ECkNh8oIWQ0cW67dPW","WOaJWPXPmNddJCk9W4hcOW"];return(_0x3562=function(){return s})()}document.title="基于高德地图业务功能组件",document.getElementById("article").innerHTML='<div><p>好的，我们来详细探讨一下如何基于高德地图 JavaScript API 进行业务功能封装。</p>\n<p>这种封装的核心思想是：<strong>将通用的地图操作、复杂的业务逻辑与基础的 SDK API 调用分离开来</strong>   。这样做可以带来诸多好处：</p>\n<ul>\n<li><strong>代码复用</strong>   ：避免在多个页面或组件中编写重复的地图初始化、标记点创建等代码。</li>\n<li><strong>简化开发</strong>   ：为业务开发者提供简洁、语义化的方法（如 <code>showStoreOnMap(storeId)</code>），隐藏底层复杂的 API 调用。</li>\n<li><strong>统一管理</strong>   ：将所有的地图相关操作集中在一个或几个类/模块中，便于维护和迭代。</li>\n<li><strong>降低耦合</strong>   ：业务逻辑不再直接依赖高德地图 SDK，如果未来需要更换地图服务商或升级 SDK，主要改动将集中在封装层。</li>\n</ul>\n<p>下面我们将分步骤、结合代码示例来详细介绍如何实现这种封装。</p>\n<hr>\n<h3>1. 设计思路与架构</h3>\n<p>一个良好的封装通常包含以下几个层次：</p>\n<ol>\n<li><strong>基础层（SDK 加载与初始化）</strong>   ：负责引入高德地图 JS API，并创建最基础的地图实例。</li>\n<li><strong>核心封装层（MapService / MapUtils）</strong>   ：这是一个核心类，封装了最常用的地图功能，如创建标记、绘制多边形、地理编码、路径规划等。它直接调用 AMap API。</li>\n<li><strong>业务层（BusinessMapService）</strong>   ：继承或组合核心封装层，针对特定业务场景进行更高阶的封装。例如，封装“显示所有门店”、“绘制配送范围”、“规划取货路线”等方法。</li>\n<li><strong>UI 组件层（Vue/React Map Component）</strong>   ：如果使用 Vue/React 等框架，可以基于核心封装层开发出更易用的地图组件，通过 Props 和 Events 与外界交互。</li>\n</ol>\n<p>本文将重点介绍 <strong>核心封装层</strong>   和 <strong>业务层</strong>   的实现。</p>\n<hr>\n<h3>2. 实现步骤与代码示例</h3>\n<p>我们将以一个假设的“门店地图”业务为例，创建一个名为 <code>MapService</code> 的类。</p>\n<h4>步骤一：基础封装 - 地图初始化和常用方法</h4>\n<p>首先，我们封装地图的创建、销毁以及添加标记、信息窗等基础操作。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// MapService.js</span>\n\n<span class="hljs-comment">// 假设高德地图 JS API 的 script 标签已在 index.html 中引入</span>\n<span class="hljs-comment">// &lt;script type=&quot;text/javascript&quot; src=&quot;https://webapi.amap.com/maps?v=2.0&amp;key=你的key&amp;plugin=AMap.Geocoder,AMap.Driving&quot;&gt;&lt;/script&gt;</span>\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapService</span> {\n  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">containerId, mapOptions = {}</span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(containerId);\n    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>) {\n      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Map container #<span class="hljs-subst">${containerId}</span> not found.`</span>);\n    }\n\n    <span class="hljs-comment">// 默认配置与自定义配置合并</span>\n    <span class="hljs-keyword">const</span> defaultOptions = {\n      <span class="hljs-attr">zoom</span>: <span class="hljs-number">13</span>,\n      <span class="hljs-attr">center</span>: [<span class="hljs-number">116.397428</span>, <span class="hljs-number">39.90923</span>], <span class="hljs-comment">// 默认北京中心</span>\n      <span class="hljs-attr">viewMode</span>: <span class="hljs-string">&quot;2D&quot;</span>,\n      ...mapOptions,\n    };\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Map</span>(containerId, defaultOptions);\n\n    <span class="hljs-comment">// 用于存储覆盖物和事件的引用，便于管理</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span> = [];\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWindows</span> = [];\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span> = [];\n  }\n\n  <span class="hljs-comment">/**\n   * 销毁地图实例，释放资源\n   */</span>\n  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-comment">// 清除所有覆盖物</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearMarkers</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearInfoWindows</span>();\n\n    <span class="hljs-comment">// 移除所有事件监听</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">off</span>(listener.<span class="hljs-property">type</span>, listener.<span class="hljs-property">handler</span>);\n    });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span> = [];\n\n    <span class="hljs-comment">// 销毁地图</span>\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">destroy</span>();\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-literal">null</span>;\n    }\n  }\n\n  <span class="hljs-comment">/**\n   * 创建并添加一个标记点\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} position [lng, lat]\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} options 标记选项\n   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">AMap.Marker</span>} 创建的标记对象\n   */</span>\n  <span class="hljs-title function_">addMarker</span>(<span class="hljs-params">position, options = {}</span>) {\n    <span class="hljs-keyword">const</span> defaultIcon = {\n      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;image&quot;</span>,\n      <span class="hljs-attr">image</span>: <span class="hljs-string">&quot;https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png&quot;</span>,\n      <span class="hljs-attr">size</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">30</span>],\n      <span class="hljs-attr">anchor</span>: <span class="hljs-string">&quot;bottom-center&quot;</span>,\n    };\n\n    <span class="hljs-keyword">const</span> marker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Marker</span>({\n      position,\n      <span class="hljs-attr">icon</span>: options.<span class="hljs-property">icon</span> || defaultIcon,\n      <span class="hljs-attr">content</span>: options.<span class="hljs-property">content</span>, <span class="hljs-comment">// 自定义 DOM 内容</span>\n      <span class="hljs-attr">offset</span>: options.<span class="hljs-property">offset</span>,\n      <span class="hljs-attr">title</span>: options.<span class="hljs-property">title</span>,\n      ...options, <span class="hljs-comment">// 其他选项</span>\n    });\n\n    marker.<span class="hljs-title function_">setMap</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>);\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">push</span>(marker);\n\n    <span class="hljs-comment">// 添加点击事件</span>\n    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">onClick</span>) {\n      marker.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> options.<span class="hljs-title function_">onClick</span>(marker));\n    }\n\n    <span class="hljs-keyword">return</span> marker;\n  }\n\n  <span class="hljs-comment">/**\n   * 创建并添加一个信息窗\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} position [lng, lat]\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String|HTMLElement</span>} content 信息窗内容\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} options 信息窗选项\n   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">AMap.InfoWindow</span>} 创建的信息窗对象\n   */</span>\n  <span class="hljs-title function_">addInfoWindow</span>(<span class="hljs-params">position, content, options = {}</span>) {\n    <span class="hljs-keyword">const</span> infoWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">InfoWindow</span>({\n      content,\n      <span class="hljs-attr">anchor</span>: <span class="hljs-string">&quot;bottom-center&quot;</span>,\n      <span class="hljs-attr">offset</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">30</span>],\n      ...options,\n    });\n\n    <span class="hljs-comment">// 默认不立即打开</span>\n    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">isOpen</span>) {\n      infoWindow.<span class="hljs-title function_">open</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>, position);\n    }\n\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWindows</span>.<span class="hljs-title function_">push</span>(infoWindow);\n    <span class="hljs-keyword">return</span> infoWindow;\n  }\n\n  <span class="hljs-comment">/**\n   * 清除所有标记\n   */</span>\n  <span class="hljs-title function_">clearMarkers</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">marker</span>) =&gt;</span> {\n      marker.<span class="hljs-title function_">setMap</span>(<span class="hljs-literal">null</span>);\n    });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span> = [];\n  }\n\n  <span class="hljs-comment">/**\n   * 清除所有信息窗\n   */</span>\n  <span class="hljs-title function_">clearInfoWindows</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWindows</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">infoWindow</span>) =&gt;</span> {\n      infoWindow.<span class="hljs-title function_">close</span>();\n    });\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWindows</span> = [];\n  }\n\n  <span class="hljs-comment">/**\n   * 地理编码（地址转坐标）\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} address 地址字符串\n   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} 返回Promise，resolve包含{location, address}\n   */</span>\n  <span class="hljs-title function_">geocode</span>(<span class="hljs-params">address</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {\n      <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Geocoder</span>({}).<span class="hljs-title function_">getLocation</span>(address, <span class="hljs-function">(<span class="hljs-params">status, result</span>) =&gt;</span> {\n        <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&quot;complete&quot;</span> &amp;&amp; result.<span class="hljs-property">geocodes</span>.<span class="hljs-property">length</span>) {\n          <span class="hljs-keyword">const</span> { location, formattedAddress } = result.<span class="hljs-property">geocodes</span>[<span class="hljs-number">0</span>];\n          <span class="hljs-title function_">resolve</span>({ location, <span class="hljs-attr">address</span>: formattedAddress });\n        } <span class="hljs-keyword">else</span> {\n          <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Geocoding failed for address: <span class="hljs-subst">${address}</span>`</span>));\n        }\n      });\n    });\n  }\n\n  <span class="hljs-comment">/**\n   * 逆地理编码（坐标转地址）\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} lnglat [lng, lat]\n   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} 返回Promise，resolve包含地址信息\n   */</span>\n  <span class="hljs-title function_">reverseGeocode</span>(<span class="hljs-params">lnglat</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {\n      <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Geocoder</span>({}).<span class="hljs-title function_">getAddress</span>(lnglat, <span class="hljs-function">(<span class="hljs-params">status, result</span>) =&gt;</span> {\n        <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&quot;complete&quot;</span> &amp;&amp; result.<span class="hljs-property">regeocode</span>) {\n          <span class="hljs-title function_">resolve</span>(result.<span class="hljs-property">regeocode</span>);\n        } <span class="hljs-keyword">else</span> {\n          <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Reverse geocoding failed&quot;</span>));\n        }\n      });\n    });\n  }\n\n  <span class="hljs-comment">// ... 可以继续封装绘制折线、多边形、驾车路线、搜索等功能</span>\n}\n</code></pre>\n<h4>步骤二：业务封装 - 继承并实现特定功能</h4>\n<p>现在，我们基于 <code>MapService</code> 创建一个针对“门店管理”业务的类 <code>StoreMapService</code>。</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// StoreMapService.js</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">MapService</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./MapService&quot;</span>;\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StoreMapService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MapService</span> {\n  <span class="hljs-comment">/**\n   * 在地图上显示所有门店\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} stores 门店列表数据\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} onStoreClick 门店点击回调\n   */</span>\n  <span class="hljs-title function_">showStores</span>(<span class="hljs-params">stores, onStoreClick = <span class="hljs-literal">null</span></span>) {\n    <span class="hljs-comment">// 先清除之前的所有标记</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearMarkers</span>();\n\n    stores.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">store</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> { id, name, address, lng, lat } = store; <span class="hljs-comment">// 假设数据结构如此</span>\n\n      <span class="hljs-comment">// 创建自定义 Marker 内容</span>\n      <span class="hljs-keyword">const</span> markerContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);\n      markerContent.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;store-marker&quot;</span>;\n      markerContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`\n        &lt;div class=&quot;marker-pin&quot;&gt;&lt;/div&gt;\n        &lt;div class=&quot;marker-name&quot;&gt;<span class="hljs-subst">${name}</span>&lt;/div&gt;\n      `</span>;\n\n      <span class="hljs-comment">// 添加标记</span>\n      <span class="hljs-keyword">const</span> marker = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMarker</span>([lng, lat], {\n        <span class="hljs-attr">content</span>: markerContent,\n        <span class="hljs-attr">onClick</span>: <span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> {\n          <span class="hljs-comment">// 点击标记时，打开信息窗</span>\n          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showStoreInfo</span>(store);\n          <span class="hljs-comment">// 调用外部传入的回调</span>\n          <span class="hljs-keyword">if</span> (onStoreClick) {\n            <span class="hljs-title function_">onStoreClick</span>(store, m);\n          }\n        },\n      });\n\n      <span class="hljs-comment">// 可以将门店ID存在Marker对象上，便于后续查找</span>\n      marker.<span class="hljs-property">storeId</span> = id;\n    });\n\n    <span class="hljs-comment">// 自动调整地图视野以包含所有门店</span>\n    <span class="hljs-keyword">if</span> (stores.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {\n      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setBounds</span>(stores.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> [s.<span class="hljs-property">lng</span>, s.<span class="hljs-property">lat</span>]));\n    }\n  }\n\n  <span class="hljs-comment">/**\n   * 显示单个门店的详细信息窗\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} store 门店数据\n   */</span>\n  <span class="hljs-title function_">showStoreInfo</span>(<span class="hljs-params">store</span>) {\n    <span class="hljs-keyword">const</span> { name, address, tel, lng, lat } = store;\n\n    <span class="hljs-keyword">const</span> infoContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);\n    infoContent.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;store-info-window&quot;</span>;\n    infoContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`\n      &lt;h3&gt;<span class="hljs-subst">${name}</span>&lt;/h3&gt;\n      &lt;p&gt;地址：<span class="hljs-subst">${address}</span>&lt;/p&gt;\n      &lt;p&gt;电话：<span class="hljs-subst">${tel}</span>&lt;/p&gt;\n    `</span>;\n\n    <span class="hljs-comment">// 关闭其他信息窗，打开新的</span>\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearInfoWindows</span>();\n    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addInfoWindow</span>([lng, lat], infoContent, { <span class="hljs-attr">isOpen</span>: <span class="hljs-literal">true</span> });\n  }\n\n  <span class="hljs-comment">/**\n   * 规划从当前位置到指定门店的路线\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} fromLnglat 起点坐标 [lng, lat]\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} toStore 目标门店对象\n   */</span>\n  <span class="hljs-title function_">planRouteToStore</span>(<span class="hljs-params">fromLnglat, toStore</span>) {\n    <span class="hljs-keyword">const</span> driving = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Driving</span>({\n      <span class="hljs-attr">map</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>,\n      <span class="hljs-attr">panel</span>: <span class="hljs-string">&quot;route-panel&quot;</span>, <span class="hljs-comment">// 指定显示路线详情的容器ID</span>\n    });\n\n    driving.<span class="hljs-title function_">search</span>(\n      <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">LngLat</span>(fromLnglat[<span class="hljs-number">0</span>], fromLnglat[<span class="hljs-number">1</span>]),\n      <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">LngLat</span>(toStore.<span class="hljs-property">lng</span>, toStore.<span class="hljs-property">lat</span>),\n      <span class="hljs-function">(<span class="hljs-params">status, result</span>) =&gt;</span> {\n        <span class="hljs-comment">// 处理搜索结果</span>\n        <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&quot;complete&quot;</span>) {\n          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;路线规划完成&quot;</span>);\n        } <span class="hljs-keyword">else</span> {\n          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;路线规划失败&quot;</span>, result);\n        }\n      },\n    );\n  }\n\n  <span class="hljs-comment">/**\n   * 设置地图视野到能显示所有给定坐标点的范围\n   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} lnglats 坐标数组 [[lng, lat], ...]\n   */</span>\n  <span class="hljs-title function_">setBounds</span>(<span class="hljs-params">lnglats</span>) {\n    <span class="hljs-keyword">if</span> (lnglats.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;\n    <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">setFitView</span>(\n      lnglats.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">ll</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">LngLat</span>(ll[<span class="hljs-number">0</span>], ll[<span class="hljs-number">1</span>])),\n      <span class="hljs-literal">false</span>,\n      [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>],\n    ); <span class="hljs-comment">// 添加边距</span>\n  }\n}\n</code></pre>\n<h4>步骤三：在实际项目中使用</h4>\n<p>在您的 Vue 或 React 组件中，您可以这样使用封装好的类：</p>\n<p><strong>Vue 示例</strong></p>\n<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;map-container&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;route-panel&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;route-panel&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">\n  <span class="hljs-keyword">import</span> <span class="hljs-title class_">StoreMapService</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/services/StoreMapService&quot;</span>;\n\n  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;StoreLocator&quot;</span>,\n    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-keyword">return</span> {\n        <span class="hljs-attr">mapService</span>: <span class="hljs-literal">null</span>,\n        <span class="hljs-attr">stores</span>: [], <span class="hljs-comment">// 从API获取的门店数据</span>\n      };\n    },\n    <span class="hljs-keyword">async</span> <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-comment">// 初始化地图</span>\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapService</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreMapService</span>(<span class="hljs-string">&quot;map-container&quot;</span>, {\n        <span class="hljs-attr">zoom</span>: <span class="hljs-number">10</span>,\n      });\n\n      <span class="hljs-comment">// 模拟获取门店数据</span>\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$api</span>.<span class="hljs-title function_">getStores</span>();\n\n      <span class="hljs-comment">// 显示所有门店</span>\n      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapService</span>.<span class="hljs-title function_">showStores</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span>, <span class="hljs-function">(<span class="hljs-params">store</span>) =&gt;</span> {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`您点击了门店: <span class="hljs-subst">${store.name}</span>`</span>);\n      });\n    },\n    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) {\n      <span class="hljs-comment">// 组件销毁时，务必销毁地图服务以释放内存</span>\n      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapService</span>) {\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapService</span>.<span class="hljs-title function_">destroy</span>();\n      }\n    },\n    <span class="hljs-attr">methods</span>: {\n      <span class="hljs-comment">// 一个方法的示例：规划路线到第0个门店</span>\n      <span class="hljs-title function_">planRoute</span>(<span class="hljs-params"></span>) {\n        <span class="hljs-comment">// 假设从某处获取了用户当前位置</span>\n        <span class="hljs-keyword">const</span> userLocation = [<span class="hljs-number">116.4</span>, <span class="hljs-number">39.91</span>];\n        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapService</span>.<span class="hljs-title function_">planRouteToStore</span>(userLocation, <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span>[<span class="hljs-number">0</span>]);\n      },\n    },\n  };\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css">\n  <span class="hljs-selector-class">.map</span> {\n    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;\n    <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;\n  }\n  <span class="hljs-selector-class">.route-panel</span> {\n    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;\n    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;\n    <span class="hljs-attribute">overflow-y</span>: scroll;\n  }\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>\n</code></pre>\n<hr>\n<h3>3. 进阶封装考虑</h3>\n<ol>\n<li><strong>状态管理</strong>   ：在大型应用中，可以将地图的中心点、缩放等级、选中的门店等状态与 Vuex 或 Redux 进行同步。</li>\n<li><strong>组件化</strong>   ：在 Vue 中，可以创建如 <code>&lt;amap-marker :position=&quot;pos&quot; :events=&quot;events&quot;&gt;</code> 这样的组件，通过数据驱动视图更新。</li>\n<li><strong>性能优化</strong>   ：\n<ul>\n<li>对大量点标记使用 <code>AMap.MarkerClusterer</code> 点聚合插件。</li>\n<li>使用 <code>debounce</code> 或 <code>throttle</code> 优化频繁触发的事件（如 <code>map.moveend</code>）。</li>\n</ul>\n</li>\n<li><strong>错误处理与加载状态</strong>   ：在封装中统一处理地理编码失败、路线规划失败等情况，并提供友好的用户提示。</li>\n<li><strong>插件管理</strong>   ：动态加载所需的 SDK 插件，避免一次性加载所有插件。</li>\n</ol>\n<h3>总结</h3>\n<p>通过这种分层封装的方式，我们将复杂的地图 SDK API 转换为了简单、直观、面向业务的接口。业务开发人员无需深入了解高德地图的细节，只需调用诸如 <code>showStores</code>, <code>planRouteToStore</code> 这样的方法即可实现复杂功能，大大提高了开发效率和代码的可维护性。</p>\n</div>'</script></body></html>