<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x465e(t,s){var e=_0x7457();return(_0x465e=function(s,a){var n=e[s-=483];void 0===_0x465e.AOCZmU&&(_0x465e.CUOsKZ=function(s,a){var n,l=[],t=0,e="";for(s=(s=>{for(var a,n,l="",t="",e=0,p=0;n=s.charAt(p++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+a.charCodeAt(p%a.length))%256,n=l[p],l[p]=l[t],l[t]=n;for(var p=0,t=0,c=0;c<s.length;c++)n=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=n,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[t])%256]);return e},t=arguments,_0x465e.AOCZmU=!0);var s=s+e[0],l=t[s];return l?n=l:(void 0===_0x465e.iNRFQI&&(_0x465e.iNRFQI=!0),n=_0x465e.CUOsKZ(n,a),t[s]=n),n})(t,s)}function _0x7457(){var s=["AuuVW7BcMSk7WOlcQfKZi3W","W6WNec7dTCocn0pcGq","WPjXsCkQkd/dHtaoaSoMi8klW4m","n8kwW7v2wLyPW6JcIflcLSoMva","W68KffVcNCk7ve/cV8krW6zBW4K","w2iNWRldRu7dIG","W5xdSbZcRCknW4T0W55CW5jEdW","hGtcRvBcOa","m2/cI1ykWRtdRWbOW77dLG","W5OjW5CtWO4wEgy","yCoQyYxcN8oSECkt","WQ/cHmk/WPVcK3bjW49Mc8oxk1G","nSoIWOmherb7","WOntW4WkWQ0RE0W","W7tdRx82WOVcVSkm","s8k3WQldTqCjca","W4hdNY7cS8oUgmoudSkq","vNa0W4FcS8oTsCkFW7tdVCo/WQ7cKa","W5btWQ/cQsetWQFdHCogFeZdOdRcVq","eSkyfSophSomWRPJWQi","WPtcMSowW7hdR8oHFSo6pZXbWOfRW6NcJmkQgay+eNeMvuHmW6q","eCkCeCkbqmkeW6TOWPa8WOHMEq","kSk6W4xdShddMCojuCkLWRyCWPFdSG","WOi6zL7dHgLIWQzo","eemrWPBdTf/dJq","W54iWP8rWRu6Ce4y","fCkCemkhqCkcWOHhWR8KWOP/","W5nAWQJcRIuvW7JcHSoLz0RdJa","iJxcQIeVWR1A","WPTCWPrlW6tdNCkLr8kymSo4"];return(_0x7457=function(){return s})()}var _0x233967=_0x465e;if((()=>{for(var s=_0x465e,a=_0x7457();;)try{if(776639==+parseInt(s(490,"g*pc"))*(parseInt(s(507,"ayZ3"))/2)+-parseInt(s(494,"VF^E"))/3*(-parseInt(s(508,"DTcI"))/4)+parseInt(s(486,"PELn"))/5*(parseInt(s(496,"ITGP"))/6)+parseInt(s(483,"PELn"))/7*(parseInt(s(488,"[h#u"))/8)+parseInt(s(504,"YUhD"))/9+parseInt(s(499,"if88"))/10+parseInt(s(492,"VZ(0"))/11*(-parseInt(s(500,"K8&P"))/12))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x233967(510,"cuWD")](_0x233967(498,"6drC"))!=_0x233967(489,"7IWd"))throw window[_0x233967(495,"ayZ3")][_0x233967(506,"mg8h")](_0x233967(502,"*tP#")),Error();document.title="React Native WebView 详解",document.getElementById("article").innerHTML='<div><p>WebView 是 React Native 中用于嵌入网页内容的组件，它允许开发者在原生应用中加载和显示网页。以下是关于 React Native WebView 的全面解析。</p>\n<h2>基本用法</h2>\n<h3>1. 安装</h3>\n<pre><code class="language-sh">npm install react-native-webview\n<span class="hljs-comment"># 或</span>\nyarn add react-native-webview\n</code></pre>\n<p>对于 iOS 还需要运行：</p>\n<pre><code class="language-sh"><span class="hljs-built_in">cd</span> ios &amp;&amp; pod install\n</code></pre>\n<h3>2. 基本使用</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-webview&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyWebView</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n      <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">reactnative.dev</span>&#x27; }}\n      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span> }}\n    /&gt;</span></span>\n  );\n}\n</code></pre>\n<h2>核心功能</h2>\n<h3>1. 加载内容</h3>\n<h4>加载网页</h4>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span> source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }} /&gt;\n</code></pre>\n<h4>加载 HTML 字符串</h4>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  originWhitelist={[<span class="hljs-string">&#x27;*&#x27;</span>]}\n  source={{ <span class="hljs-attr">html</span>: <span class="hljs-string">&#x27;&lt;h1&gt;Hello WebView&lt;/h1&gt;&#x27;</span> }}\n/&gt;\n</code></pre>\n<h3>2. 导航控制</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> webViewRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);\n\n<span class="hljs-comment">// 前进</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">goForward</span> = (<span class="hljs-params"></span>) =&gt; webViewRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">goForward</span>();\n\n<span class="hljs-comment">// 后退</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">goBack</span> = (<span class="hljs-params"></span>) =&gt; webViewRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">goBack</span>();\n\n<span class="hljs-comment">// 刷新</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">reload</span> = (<span class="hljs-params"></span>) =&gt; webViewRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">reload</span>();\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n  <span class="hljs-attr">ref</span>=<span class="hljs-string">{webViewRef}</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }}\n/&gt;</span></span>\n</code></pre>\n<h3>3. 通信机制</h3>\n<h4>RN 向 Web 发送消息</h4>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> webViewRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessageToWeb</span> = (<span class="hljs-params"></span>) =&gt; {\n  webViewRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">injectJavaScript</span>(<span class="hljs-string">`\n    window.postMessage(&#x27;Hello from RN&#x27;);\n    true;\n  `</span>);\n};\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n  <span class="hljs-attr">ref</span>=<span class="hljs-string">{webViewRef}</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }}\n/&gt;</span></span>\n</code></pre>\n<h4>Web 向 RN 发送消息</h4>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  onMessage={<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Message from web:&#x27;</span>, event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">data</span>);\n  }}\n  injectedJavaScript={<span class="hljs-string">`\n    window.ReactNativeWebView.postMessage(&#x27;Hello from Web&#x27;);\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h2>高级功能</h2>\n<h3>1. 文件上传/下载</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  allowsInlineMediaPlayback={<span class="hljs-literal">true</span>}\n  allowsFullscreenVideo={<span class="hljs-literal">false</span>}\n  allowsBackForwardNavigationGestures={<span class="hljs-literal">true</span>}\n  javaScriptEnabled={<span class="hljs-literal">true</span>}\n  domStorageEnabled={<span class="hljs-literal">true</span>}\n  startInLoadingState={<span class="hljs-literal">true</span>}\n  mixedContentMode=<span class="hljs-string">&quot;compatibility&quot;</span>\n  thirdPartyCookiesEnabled={<span class="hljs-literal">true</span>}\n  allowFileAccess={<span class="hljs-literal">true</span>}\n  allowFileAccessFromFileURLs={<span class="hljs-literal">true</span>}\n  allowUniversalAccessFromFileURLs={<span class="hljs-literal">true</span>}\n/&gt;\n</code></pre>\n<h3>2. 自定义用户代理</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  userAgent=<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>\n/&gt;\n</code></pre>\n<h3>3. 处理导航状态变化</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  onNavigationStateChange={<span class="hljs-function">(<span class="hljs-params">navState</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Current URL:&#x27;</span>, navState.<span class="hljs-property">url</span>);\n  }}\n/&gt;\n</code></pre>\n<h2>性能优化</h2>\n<h3>1. 预加载 WebView</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> [webViewReady, setWebViewReady] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n\n<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setWebViewReady</span>(<span class="hljs-literal">true</span>), <span class="hljs-number">2000</span>);\n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);\n}, []);\n\n<span class="hljs-keyword">return</span> webViewReady ? (\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span> <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }} /&gt;</span></span>\n) : (\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ActivityIndicator</span> /&gt;</span></span>\n);\n</code></pre>\n<h3>2. 缓存策略</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  cacheEnabled={<span class="hljs-literal">true</span>}\n  cacheMode=<span class="hljs-string">&quot;LOAD_CACHE_ELSE_NETWORK&quot;</span>\n/&gt;\n</code></pre>\n<h3>3. 懒加载</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> [showWebView, setShowWebView] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n\n<span class="hljs-keyword">return</span> (\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;加载WebView&quot;</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowWebView(true)} /&gt;\n    {showWebView &amp;&amp; (\n      <span class="hljs-tag">&lt;<span class="hljs-name">WebView</span> <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }} /&gt;</span>\n    )}\n  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>\n);\n</code></pre>\n<h2>安全考虑</h2>\n<h3>1. HTTPS 强制</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://secure.example.com&#x27;</span> }}\n  mixedContentMode=<span class="hljs-string">&quot;never&quot;</span>\n/&gt;\n</code></pre>\n<h3>2. 输入过滤</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">sanitizeHTML</span> = (<span class="hljs-params">html</span>) =&gt; {\n  <span class="hljs-keyword">return</span> html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;script\\b[^&lt;]*(?:(?!&lt;\\/script&gt;)&lt;[^&lt;]*)*&lt;\\/script&gt;/gi</span>, <span class="hljs-string">&#x27;&#x27;</span>);\n};\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">html:</span> <span class="hljs-attr">sanitizeHTML</span>(<span class="hljs-attr">userContent</span>) }}\n/&gt;</span></span>\n</code></pre>\n<h3>3. 域名白名单</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://trusted.com&#x27;</span> }}\n  originWhitelist={[<span class="hljs-string">&#x27;https://trusted.com&#x27;</span>]}\n/&gt;\n</code></pre>\n<h2>常见问题解决</h2>\n<h3>1. Android 空白页面</h3>\n<p><strong>解决方案</strong>  ：</p>\n<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- AndroidManifest.xml --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">application</span>\n  <span class="hljs-attr">android:usesCleartextTraffic</span>=<span class="hljs-string">&quot;true&quot;</span>\n  <span class="hljs-attr">android:networkSecurityConfig</span>=<span class="hljs-string">&quot;@xml/network_security_config&quot;</span>&gt;</span>\n</code></pre>\n<h3>2. iOS 加载本地 HTML</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;ios&#x27;</span> \n    ? <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./local.html&#x27;</span>) \n    : { <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;file:///android_asset/local.html&#x27;</span> }}\n/&gt;\n</code></pre>\n<h3>3. 键盘遮挡问题</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">KeyboardAvoidingView</span> behavior=<span class="hljs-string">&quot;padding&quot;</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> }}&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n    <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }}\n    <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span> }}\n  /&gt;</span></span>\n&lt;/<span class="hljs-title class_">KeyboardAvoidingView</span>&gt;\n</code></pre>\n<h2>最佳实践</h2>\n<ol>\n<li><strong>按需加载</strong>  ：非必要不加载 WebView</li>\n<li><strong>内容压缩</strong>  ：优化网页资源大小</li>\n<li><strong>错误处理</strong>  ：<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  renderError={<span class="hljs-function">(<span class="hljs-params">errorName</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorView</span> /&gt;</span></span>}\n  onError={<span class="hljs-function">(<span class="hljs-params">syntheticEvent</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;WebView error:&#x27;</span>, syntheticEvent.<span class="hljs-property">nativeEvent</span>);\n  }}\n/&gt;\n</code></pre>\n</li>\n<li><strong>混合导航</strong>  ：结合 React Navigation 实现无缝过渡</li>\n</ol>\n<p>WebView 是强大的工具，但应谨慎使用。在性能敏感的场景优先考虑原生实现，对复杂内容或需要快速迭代的功能可合理使用 WebView。</p>\n</div>'</script></body></html>