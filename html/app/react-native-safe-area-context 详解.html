<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1c0046=_0x279d;function _0x15e3(){var s=["mSk+EehcTGtdGmo2WOq","WPSaAg5/gmkZcmkJBmoGW6j5","WRH+rYddS8kSWOhdR8oeWQVdPCkgW44","WOBdNZZcHmkcaCkkz00","sSkVWP/dNuBdQmk2tmkt","r3VcNhjfwJP+WP0","rhvZzCkJhYLY","mSk2EKZcPWZdMmoLWQS","n1b1cgBcTLJcHCkB","D8oaWOC6WP0","z8oAm8oBW6n5ECk1tmkVW40zWP3dIK3dOCoAh2tcM3v7WOtcJLFdLG","nCkfW4X/WOdcJdCpW605","WRn/rYtdTSonW6xdKmodWQBdKW","fa12rCk3uSoj","pmoVqCond8ouWRjxnSkPWORcVW","tCkMWPtcVfFdTmkstmkTWRS","WOz8W5xcT8kPWRv9mmktW4bY","WOJcRZNcGuK7kMrAWRKeFIu","W5FdICoSW57dU0tcPSoXW4K","hCoSWQbXdmk7l8oiB1RdJwK","W6dcHx7cOCo3W4CKva9lWRzzBG","gISMnmoGqxfRW6RdKCoQWQhdIW","WPxcGvyebCooW5iLW68","BG9+W6f7pSoI","W6n6W6JcMb80of99FainCa","W4zxW41aW69UW4VdV1JcRW","evDjomk3WQuVW6mY"];return(_0x15e3=function(){return s})()}function _0x279d(t,s){var e=_0x15e3();return(_0x279d=function(s,a){var n=e[s-=286];void 0===_0x279d.TjCDHO&&(_0x279d.nhYiHE=function(s,a){var n,l=[],t=0,e="";for(s=(s=>{for(var a,n,l="",t="",e=0,p=0;n=s.charAt(p++);~n&&(a=e%4?64*a+n:n,e++%4)&&(l+=String.fromCharCode(255&a>>(-2*e&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+a.charCodeAt(p%a.length))%256,n=l[p],l[p]=l[t],l[t]=n;for(var p=0,t=0,c=0;c<s.length;c++)n=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=n,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[t])%256]);return e},t=arguments,_0x279d.TjCDHO=!0);var s=s+e[0],l=t[s];return l?n=l:(void 0===_0x279d.dbGDJw&&(_0x279d.dbGDJw=!0),n=_0x279d.nhYiHE(n,a),t[s]=n),n})(t,s)}if((()=>{for(var s=_0x279d,a=_0x15e3();;)try{if(829587==-parseInt(s(302,"beL4"))*(-parseInt(s(294,"Rjx!"))/2)+-parseInt(s(308,"Du7$"))/3+parseInt(s(304,"%H9J"))/4+-parseInt(s(305,")9dH"))/5*(parseInt(s(299,"1)wn"))/6)+parseInt(s(312,"SPK@"))/7*(parseInt(s(295,"$mFV"))/8)+parseInt(s(301,"PN@i"))/9*(parseInt(s(287,"Rjx!"))/10)+parseInt(s(288,"M0PZ"))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1c0046(300,"OT!&")](_0x1c0046(309,"]1g["))!=_0x1c0046(296,"TQh8"))throw window[_0x1c0046(293,"Du7$")][_0x1c0046(310,"c&X^")](_0x1c0046(297,"^iQg")),Error();document.title="react-native-safe-area-context 详解",document.getElementById("article").innerHTML='<div><p><code>react-native-safe-area-context</code> 是 React Native 生态中处理设备安全区域的官方推荐解决方案，它能完美适配各种刘海屏、挖孔屏设备，并解决状态栏、底部导航栏等系统 UI 对应用内容的遮挡问题。</p>\n<h2>核心概念</h2>\n<h3>1. 安全区域（Safe Area）</h3>\n<p>指屏幕上不会被设备物理特征（如刘海、圆角）或系统 UI（如状态栏、导航栏）遮挡的可视区域。</p>\n<h3>2. 边缘插入（Insets）</h3>\n<p>表示从屏幕边缘到安全区域的距离，包含四个值：</p>\n<ul>\n<li><code>top</code>: 顶部插入距离（通常对应状态栏高度）</li>\n<li><code>right</code>: 右侧插入距离</li>\n<li><code>bottom</code>: 底部插入距离（通常对应导航栏高度）</li>\n<li><code>left</code>: 左侧插入距离</li>\n</ul>\n<h2>完整 API 解析</h2>\n<h3>1. SafeAreaProvider</h3>\n<p><strong>作用</strong>  ：提供安全区域上下文，必须包裹在应用最外层</p>\n<p><strong>属性</strong>  ：</p>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">SafeAreaProvider</span>\n  initialMetrics={initialMetrics}  <span class="hljs-comment">// 初始安全区域数据</span>\n  initialSafeAreaInsets={initialInsets} <span class="hljs-comment">// 初始插入值（已废弃，推荐用initialMetrics）</span>\n&gt;\n  {children}\n&lt;/<span class="hljs-title class_">SafeAreaProvider</span>&gt;\n</code></pre>\n<p><strong>initialMetrics 结构</strong>  ：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">insets</span>: { <span class="hljs-attr">top</span>: number, <span class="hljs-attr">right</span>: number, <span class="hljs-attr">bottom</span>: number, <span class="hljs-attr">left</span>: number },\n  <span class="hljs-attr">frame</span>: { <span class="hljs-attr">x</span>: number, <span class="hljs-attr">y</span>: number, <span class="hljs-attr">width</span>: number, <span class="hljs-attr">height</span>: number }\n}\n</code></pre>\n<h3>2. SafeAreaView</h3>\n<p><strong>作用</strong>  ：自动应用安全区域插入的 View 组件</p>\n<p><strong>属性</strong>  ：</p>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">SafeAreaView</span>\n  edges={[<span class="hljs-string">&#x27;top&#x27;</span>, <span class="hljs-string">&#x27;right&#x27;</span>, <span class="hljs-string">&#x27;bottom&#x27;</span>, <span class="hljs-string">&#x27;left&#x27;</span>]} <span class="hljs-comment">// 控制哪些边应用安全区域</span>\n  mode=<span class="hljs-string">&quot;padding&quot;</span> <span class="hljs-comment">// 或 &quot;margin&quot;（控制如何应用插入值）</span>\n  style={[<span class="hljs-comment">/* 你的样式 */</span>]}\n&gt;\n  {children}\n&lt;/<span class="hljs-title class_">SafeAreaView</span>&gt;\n</code></pre>\n<p><strong>edges 参数详解</strong>  ：</p>\n<ul>\n<li>默认包含所有边</li>\n<li>可单独控制：<code>[\'top\']</code>、<code>[\'left\', \'right\']</code> 等组合</li>\n</ul>\n<h3>3. useSafeAreaInsets</h3>\n<p><strong>作用</strong>  ：Hook 方式获取当前安全区域插入值</p>\n<p><strong>用法</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> insets = <span class="hljs-title function_">useSafeAreaInsets</span>();\n<span class="hljs-comment">// insets: { top: number, right: number, bottom: number, left: number }</span>\n</code></pre>\n<h3>4. useSafeAreaFrame</h3>\n<p><strong>作用</strong>  ：获取安全区域内的可用尺寸</p>\n<p><strong>用法</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> frame = <span class="hljs-title function_">useSafeAreaFrame</span>();\n<span class="hljs-comment">// frame: { x: number, y: number, width: number, height: number }</span>\n</code></pre>\n<h3>5. SafeAreaInsetsContext</h3>\n<p><strong>作用</strong>  ：上下文对象，可用于类组件</p>\n<p><strong>用法</strong>  ：</p>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">SafeAreaInsetsContext</span>.<span class="hljs-property">Consumer</span>&gt;\n  {<span class="hljs-function">(<span class="hljs-params">insets</span>) =&gt;</span> (<span class="hljs-comment">/* 使用insets渲染 */</span>)}\n&lt;/<span class="hljs-title class_">SafeAreaInsetsContext</span>.<span class="hljs-property">Consumer</span>&gt;\n</code></pre>\n<h2>高级功能</h2>\n<h3>1. 自定义边距行为</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">SafeAreaView</span> \n  edges={[<span class="hljs-string">&#x27;top&#x27;</span>, <span class="hljs-string">&#x27;bottom&#x27;</span>]}\n  mode=<span class="hljs-string">&quot;margin&quot;</span> <span class="hljs-comment">// 使用margin代替padding</span>\n&gt;\n  {<span class="hljs-comment">/* 内容 */</span>}\n&lt;/<span class="hljs-title class_">SafeAreaView</span>&gt;\n</code></pre>\n<h3>2. 动态边缘控制</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DynamicSafeArea</span>(<span class="hljs-params">{ showHeader }</span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SafeAreaView</span> <span class="hljs-attr">edges</span>=<span class="hljs-string">{showHeader</span> ? [&#x27;<span class="hljs-attr">bottom</span>&#x27;] <span class="hljs-attr">:</span> [&#x27;<span class="hljs-attr">top</span>&#x27;, &#x27;<span class="hljs-attr">bottom</span>&#x27;]}&gt;</span>\n      {/* 内容 */}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">SafeAreaView</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h3>3. 嵌套使用</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">SafeAreaView</span> edges={[<span class="hljs-string">&#x27;top&#x27;</span>]}&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span>\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SafeAreaView</span> <span class="hljs-attr">edges</span>=<span class="hljs-string">{[</span>&#x27;<span class="hljs-attr">left</span>&#x27;, &#x27;<span class="hljs-attr">right</span>&#x27;, &#x27;<span class="hljs-attr">bottom</span>&#x27;]}&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">SafeAreaView</span>&gt;</span></span>\n&lt;/<span class="hljs-title class_">SafeAreaView</span>&gt;\n</code></pre>\n<h2>平台特定行为</h2>\n<h3>iOS</h3>\n<ul>\n<li>自动识别刘海屏设备（iPhone X 及以上）</li>\n<li>正确处理圆角和Home Indicator</li>\n<li>旋转设备时自动更新安全区域</li>\n</ul>\n<h3>Android</h3>\n<ul>\n<li>自动适配各种厂商的刘海屏实现</li>\n<li>正确处理导航栏高度</li>\n<li>需要确保主题设置正确：<pre><code class="language-xml">// android/app/src/main/res/values/styles.xml\n\n<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;AppTheme&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><span class="language-xml">\n    <span class="hljs-comment">&lt;!-- 关键配置 --&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowTranslucentStatus&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowTranslucentNavigation&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>\n    \n    <span class="hljs-comment">&lt;!-- 兼容刘海屏 (API 28+) --&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowLayoutInDisplayCutoutMode&quot;</span>&gt;</span>shortEdges<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>\n</code></pre>\n</li>\n</ul>\n<h2>性能优化</h2>\n<ol>\n<li><strong>减少重渲染</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> insets = <span class="hljs-title function_">useSafeAreaInsets</span>();\n<span class="hljs-comment">// 使用insets时用useMemo缓存计算结果</span>\n<span class="hljs-keyword">const</span> headerStyle = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">paddingTop</span>: insets.<span class="hljs-property">top</span> }), [insets.<span class="hljs-property">top</span>]);\n</code></pre>\n</li>\n<li><strong>选择性更新</strong>  ：<pre><code class="language-jsx"><span class="hljs-comment">// 只监听top变化</span>\n<span class="hljs-keyword">const</span> { top } = <span class="hljs-title function_">useSafeAreaInsets</span>();\n</code></pre>\n</li>\n<li><strong>初始值优化</strong>  ：<pre><code class="language-jsx">&lt;<span class="hljs-title class_">SafeAreaProvider</span> initialMetrics={cache.<span class="hljs-title function_">getSavedMetrics</span>()}&gt;\n  {<span class="hljs-comment">/* 应用 */</span>}\n&lt;/<span class="hljs-title class_">SafeAreaProvider</span>&gt;\n</code></pre>\n</li>\n</ol>\n<h2>常见问题解决方案</h2>\n<h3>1. 底部留白过大</h3>\n<pre><code class="language-jsx"><span class="hljs-comment">// 检查是否重复应用了安全区域</span>\n&lt;<span class="hljs-title class_">SafeAreaView</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> }}&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span></span>\n  {<span class="hljs-comment">/* 不要再嵌套SafeAreaView */</span>}\n&lt;/<span class="hljs-title class_">SafeAreaView</span>&gt;\n</code></pre>\n<h3>2. 状态栏颜色问题</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StatusBar</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-comment">// 在组件中设置</span>\n<span class="hljs-title class_">StatusBar</span>.<span class="hljs-title function_">setBackgroundColor</span>(<span class="hljs-string">&#x27;transparent&#x27;</span>);\n<span class="hljs-title class_">StatusBar</span>.<span class="hljs-title function_">setTranslucent</span>(<span class="hljs-literal">true</span>);\n</code></pre>\n<h3>3. Android 刘海屏不生效</h3>\n<p>确保已正确配置原生端：</p>\n<pre><code class="language-java"><span class="hljs-comment">// MainActivity.java</span>\n<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {\n    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);\n    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {\n        WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> getWindow().getAttributes();\n        params.layoutInDisplayCutoutMode = \n            WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;\n        getWindow().setAttributes(params);\n    }\n}\n</code></pre>\n<h2>测试策略</h2>\n<ol>\n<li><strong>多设备测试</strong>  ：\n<ul>\n<li>iPhone 12/13/14 系列（不同刘海尺寸）</li>\n<li>华为/小米等Android刘海屏设备</li>\n<li>iPad（无刘海但有大圆角）</li>\n</ul>\n</li>\n<li><strong>方向测试</strong>  ：\n<ul>\n<li>竖屏和横屏模式</li>\n<li>旋转设备时的过渡动画</li>\n</ul>\n</li>\n<li><strong>极端案例</strong>  ：\n<ul>\n<li>全屏视频播放</li>\n<li>模态对话框</li>\n<li>键盘弹出场景</li>\n</ul>\n</li>\n</ol>\n<h2>最佳实践</h2>\n<ol>\n<li><strong>设计规范</strong>  ：\n<ul>\n<li>重要内容保持在安全区域内</li>\n<li>背景元素可以延伸到非安全区域</li>\n</ul>\n</li>\n<li><strong>代码组织</strong>  ：<pre><code class="language-javascript"><span class="hljs-comment">// 创建一个可复用的安全区域组件</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AppSafeArea</span>(<span class="hljs-params">{ children, edges }</span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SafeAreaView</span> <span class="hljs-attr">edges</span>=<span class="hljs-string">{edges}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span> }}&gt;</span>\n      {children}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">SafeAreaView</span>&gt;</span></span>\n  );\n}\n</code></pre>\n</li>\n<li><strong>样式整合</strong>  ：<pre><code class="language-javascript"><span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({\n  <span class="hljs-attr">safeArea</span>: {\n    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,\n    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>\n  },\n  <span class="hljs-attr">content</span>: {\n    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,\n    <span class="hljs-attr">paddingHorizontal</span>: <span class="hljs-number">16</span>\n  }\n});\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">Screen</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SafeAreaView</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.safeArea}</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.content}</span>&gt;</span>\n        {/* 内容 */}\n      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">SafeAreaView</span>&gt;</span></span>\n  );\n}\n</code></pre>\n</li>\n</ol>\n<p>通过深入理解这些特性和模式，你可以构建出完美适配各种全面屏设备的 React Native 应用。</p>\n</div>'</script></body></html>