<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x1ed61e=_0x46ce;function _0x45fe(){var s=["W7lcO0CrW6NdKSo2","WPJcN8k4WQKfECkVkrNdSYdcVG","oWVdUt00nJu8ECoSgIqe","W4tdQmoBW6OjW7hdHxHqWRyUW74","W67cHhGPc3hcN8kCwvGE","W4epqeZdMCkmWOxdPv/dI8kZW4K","WPNcNSkWWQOlEmkIaZ3dNXRcPq","C0FdMc4Fe2RdI8k1pmo3WRW","tMZdTgJdVSkxW6S","W7/dKmk8vSkeyt4uwvFdNCkX","e8kswaJdTHefkSkjqN8","W6RdNv1NWRfDrGWCvH7dLa","WReLeCohWR0bz8obgmkoxCkj","iuRdHmkoW60OWRHqW74","W59RW7ZcOJ7dKCo4qHLMWPdcTSkDr8oWWONcJWSFWPDhWOJdMmoAwHS","cCosemodWOHOagLzWPfIoa","W6dcPL4Dpwz3","WQCOew90WQZcJXpdRq","pa7dQCoHdH/dUG","WRn/s8kEW4vEzG","WPtdQ8oEWPj5sX3dHtm","eMtdK1y/WQNdTCkx","WQ/dItHSsG","W5hdVsq4lSoFWRddICo5W6bIFq","W7xdOCkDWP1SWQL7E8k5peBdHrK","WPJdTSoOW5X2b8kb"];return(_0x45fe=function(){return s})()}function _0x46ce(e,s){var t=_0x45fe();return(_0x46ce=function(s,n){var a=t[s-=391];void 0===_0x46ce.ruaWmj&&(_0x46ce.kPJMaL=function(s,n){var a,l=[],e=0,t="";for(s=(s=>{for(var n,a,l="",e="",t=0,p=0;a=s.charAt(p++);~a&&(n=t%4?64*n+a:a,t++%4)&&(l+=String.fromCharCode(255&n>>(-2*t&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,h=l.length;c<h;c++)e+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)e=(e+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[e],l[e]=a;for(var p=0,e=0,c=0;c<s.length;c++)a=l[p=(p+1)%256],l[p]=l[e=(e+l[p])%256],l[e]=a,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[e])%256]);return t},e=arguments,_0x46ce.ruaWmj=!0);var s=s+t[0],l=e[s];return l?a=l:(void 0===_0x46ce.qObdma&&(_0x46ce.qObdma=!0),a=_0x46ce.kPJMaL(a,n),e[s]=a),a})(e,s)}if((()=>{for(var s=_0x46ce,n=_0x45fe();;)try{if(157904==+parseInt(s(391,"qkHq"))+-parseInt(s(394,"8V2k"))/2*(parseInt(s(413,"Z5Wm"))/3)+-parseInt(s(405,"tZtM"))/4*(parseInt(s(410,"f*%R"))/5)+parseInt(s(396,"j%Y*"))/6*(-parseInt(s(409,"chXG"))/7)+-parseInt(s(408,"jz*^"))/8+-parseInt(s(411,"1gZ*"))/9+parseInt(s(403,"m6w("))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x1ed61e(397,"wd#A")](_0x1ed61e(399,"MvON"))!=_0x1ed61e(401,"chXG"))throw window[_0x1ed61e(400,"]HIM")][_0x1ed61e(395,"^QvN")](_0x1ed61e(393,"^rS&")),Error();document.title="React Native Appearance 详解",document.getElementById("article").innerHTML='<div><h1>React Native Appearance 详解</h1>\n<p>Appearance API 是 React Native 提供的用于检测和响应设备外观偏好（如深色/浅色模式）的系统模块。以下是全面解析：</p>\n<h2>一、基本概念与核心功能</h2>\n<h3>1. 核心能力</h3>\n<ul>\n<li>实时获取设备当前的颜色方案（color scheme）</li>\n<li>监听系统外观偏好的变化</li>\n<li>自动响应系统主题切换</li>\n<li>支持 iOS 和 Android（Android API 29+）</li>\n</ul>\n<h3>2. 颜色方案类型</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ColorSchemeName</span> = <span class="hljs-string">&#x27;light&#x27;</span> | <span class="hljs-string">&#x27;dark&#x27;</span> | <span class="hljs-literal">null</span>;\n<span class="hljs-comment">// null 表示无法确定当前主题</span>\n</code></pre>\n<h2>二、基础使用方式</h2>\n<h3>1. 引入模块</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Appearance</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n</code></pre>\n<h3>2. 获取当前主题</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> colorScheme = <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>();\n\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`当前主题: <span class="hljs-subst">${colorScheme}</span>`</span>); \n<span class="hljs-comment">// 输出: &#x27;light&#x27; 或 &#x27;dark&#x27;</span>\n</code></pre>\n<h3>3. 监听主题变化</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> subscription = <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">addChangeListener</span>(<span class="hljs-function">(<span class="hljs-params">{ colorScheme }</span>) =&gt;</span> {\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;主题变化:&#x27;</span>, colorScheme);\n});\n\n<span class="hljs-comment">// 组件卸载时取消监听</span>\n<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> subscription.<span class="hljs-title function_">remove</span>();\n}, []);\n</code></pre>\n<h2>三、高级应用方案</h2>\n<h3>1. 结合 Context 实现全局主题管理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 创建主题上下文</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>();\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeProvider</span>(<span class="hljs-params">{ children }</span>) {\n  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>());\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">listener</span> = (<span class="hljs-params">{ colorScheme }</span>) =&gt; {\n      <span class="hljs-title function_">setTheme</span>(colorScheme);\n    };\n    <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">addChangeListener</span>(listener);\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">removeChangeListener</span>(listener);\n  }, []);\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{theme}</span>&gt;</span>\n      {children}\n    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>\n  );\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemedComponent</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{theme</span> === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-attr">styles.dark</span> <span class="hljs-attr">:</span> <span class="hljs-attr">styles.light</span>} /&gt;</span></span>;\n}\n</code></pre>\n<h3>2. 样式动态适配方案</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 定义主题样式</span>\n<span class="hljs-keyword">const</span> themeStyles = {\n  <span class="hljs-attr">light</span>: {\n    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;#ffffff&#x27;</span>,\n    <span class="hljs-attr">textColor</span>: <span class="hljs-string">&#x27;#000000&#x27;</span>\n  },\n  <span class="hljs-attr">dark</span>: {\n    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;#222222&#x27;</span>,\n    <span class="hljs-attr">textColor</span>: <span class="hljs-string">&#x27;#ffffff&#x27;</span>\n  }\n};\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemedView</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> colorScheme = <span class="hljs-title function_">useColorScheme</span>();\n  <span class="hljs-keyword">const</span> styles = themeStyles[colorScheme || <span class="hljs-string">&#x27;light&#x27;</span>];\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">styles.backgroundColor</span> }}&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> <span class="hljs-attr">styles.textColor</span> }}&gt;</span>\n        自适应主题文本\n      <span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<h2>四、Hook 封装与优化</h2>\n<h3>1. 自定义 useTheme Hook</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useTheme</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>());\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> <span class="hljs-title function_">listener</span> = (<span class="hljs-params">{ colorScheme }</span>) =&gt; {\n      <span class="hljs-title function_">setTheme</span>(colorScheme);\n    };\n    <span class="hljs-keyword">const</span> sub = <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">addChangeListener</span>(listener);\n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> sub.<span class="hljs-title function_">remove</span>();\n  }, []);\n\n  <span class="hljs-keyword">return</span> theme || <span class="hljs-string">&#x27;light&#x27;</span>; <span class="hljs-comment">// 提供默认值</span>\n}\n</code></pre>\n<h3>2. 带记忆化的样式 Hook</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useThemedStyles</span>(<span class="hljs-params">styleCreator</span>) {\n  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useColorScheme</span>();\n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(\n    <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">styleCreator</span>(theme || <span class="hljs-string">&#x27;light&#x27;</span>),\n    [theme, styleCreator]\n  );\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> styles = <span class="hljs-title function_">useThemedStyles</span>(<span class="hljs-function">(<span class="hljs-params">theme</span>) =&gt;</span> ({\n    <span class="hljs-attr">container</span>: {\n      <span class="hljs-attr">backgroundColor</span>: theme === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-string">&#x27;#333&#x27;</span> : <span class="hljs-string">&#x27;#fff&#x27;</span>\n    }\n  }));\n\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span> /&gt;</span></span>;\n}\n</code></pre>\n<h2>五、平台特性与注意事项</h2>\n<h3>1. 平台差异处理</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>iOS</th>\n<th>Android</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>系统版本支持</td>\n<td>13+</td>\n<td>10+ (完全支持29+)</td>\n</tr>\n<tr>\n<td>实时切换响应</td>\n<td>✓</td>\n<td>✓</td>\n</tr>\n<tr>\n<td>获取初始值可靠性</td>\n<td>高</td>\n<td>可能需要延迟获取</td>\n</tr>\n</tbody>\n</table>\n<h3>2. Android 兼容方案</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 处理低版本Android的兼容</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSafeColorScheme</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span> &amp;&amp; <span class="hljs-title class_">Platform</span>.<span class="hljs-property">Version</span> &lt; <span class="hljs-number">29</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;light&#x27;</span>; <span class="hljs-comment">// 默认值</span>\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>();\n}\n</code></pre>\n<h2>六、实际开发技巧</h2>\n<h3>1. 调试技巧</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 强制设置主题（开发环境专用）</span>\n<span class="hljs-keyword">if</span> (__DEV__) {\n  <span class="hljs-keyword">const</span> forceTheme = <span class="hljs-string">&#x27;dark&#x27;</span>; <span class="hljs-comment">// 可改为light测试</span>\n  <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">colorScheme</span>: forceTheme });\n}\n</code></pre>\n<h3>2. 主题持久化方案</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 结合AsyncStorage保存用户偏好</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useCustomTheme</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>());\n  \n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> savedTheme = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;userTheme&#x27;</span>);\n    <span class="hljs-keyword">if</span> (savedTheme) {\n      <span class="hljs-title function_">setTheme</span>(savedTheme);\n      <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">colorScheme</span>: savedTheme });\n    }\n  }, []);\n\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setUserTheme</span> = (<span class="hljs-params">newTheme</span>) =&gt; {\n    <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;userTheme&#x27;</span>, newTheme);\n    <span class="hljs-title function_">setTheme</span>(newTheme);\n  };\n\n  <span class="hljs-keyword">return</span> [theme, setUserTheme];\n}\n</code></pre>\n<h3>3. 性能优化建议</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 避免频繁渲染的优化模式</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedThemedView</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useColorScheme</span>();\n  \n  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{theme</span> === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-attr">darkStyles</span> <span class="hljs-attr">:</span> <span class="hljs-attr">lightStyles</span>} /&gt;</span></span>\n  ), [theme]);\n}\n</code></pre>\n<h2>七、常见问题解决方案</h2>\n<h3>1. 监听器不触发问题</h3>\n<p><strong>解决方案</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 确保监听器正确设置</span>\n<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">const</span> sub = <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">addChangeListener</span>(handleChange);\n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-comment">// 注意使用正确的引用移除</span>\n    sub.<span class="hljs-title function_">remove</span>(); \n  };\n}, []);\n</code></pre>\n<h3>2. Android 主题延迟问题</h3>\n<p><strong>解决方案</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-comment">// 添加延迟获取作为fallback</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">useReliableTheme</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>());\n\n  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {\n      <span class="hljs-keyword">const</span> current = <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>();\n      <span class="hljs-keyword">if</span> (current !== theme) {\n        <span class="hljs-title function_">setTheme</span>(current);\n      }\n    }, <span class="hljs-number">500</span>);\n    \n    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);\n  }, []);\n  \n  <span class="hljs-keyword">return</span> theme;\n}\n</code></pre>\n<h3>3. Web 平台兼容方案</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 跨平台主题检测</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCrossPlatformTheme</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;web&#x27;</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">&#x27;(prefers-color-scheme: dark)&#x27;</span>).<span class="hljs-property">matches</span> \n      ? <span class="hljs-string">&#x27;dark&#x27;</span> \n      : <span class="hljs-string">&#x27;light&#x27;</span>;\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Appearance</span>.<span class="hljs-title function_">getColorScheme</span>();\n}\n</code></pre>\n<p>通过以上全面的 Appearance API 解析，您可以实现：</p>\n<ol>\n<li>完美的深色/浅色模式自动切换</li>\n<li>高性能的主题敏感组件</li>\n<li>跨平台的统一主题体验</li>\n<li>用户偏好与系统设置的智能结合</li>\n</ol>\n<p>建议将主题管理封装成独立的模块，便于整个应用统一维护和升级。</p>\n</div>'</script></body></html>