<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0xa9c1(o,n){var e=_0x4051();return(_0xa9c1=function(n,t){var s=e[n-=127];void 0===_0xa9c1.GwRoQw&&(_0xa9c1.AdeYiA=function(n,t){var s,r=[],o=0,e="";for(n=(n=>{for(var t,s,r="",o="",e=0,a=0;s=n.charAt(a++);~s&&(t=e%4?64*t+s:s,e++%4)&&(r+=String.fromCharCode(255&t>>(-2*e&6))))s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(s);for(var l=0,c=r.length;l<c;l++)o+="%"+("00"+r.charCodeAt(l).toString(16)).slice(-2);return decodeURIComponent(o)})(n),a=0;a<256;a++)r[a]=a;for(a=0;a<256;a++)o=(o+r[a]+t.charCodeAt(a%t.length))%256,s=r[a],r[a]=r[o],r[o]=s;for(var a=0,o=0,l=0;l<n.length;l++)s=r[a=(a+1)%256],r[a]=r[o=(o+r[a])%256],r[o]=s,e+=String.fromCharCode(n.charCodeAt(l)^r[(r[a]+r[o])%256]);return e},o=arguments,_0xa9c1.GwRoQw=!0);var n=n+e[0],r=o[n];return r?s=r:(void 0===_0xa9c1.KIzqNE&&(_0xa9c1.KIzqNE=!0),s=_0xa9c1.AdeYiA(s,t),o[n]=s),s})(o,n)}var _0x2bc04e=_0xa9c1;function _0x4051(){var n=["WR3cJaRcU2FcMg4Da2G7WRS","WRL0WR9HW5hcIMynW5lcH3qg","WQdcSv3cTCkxt2WGamkwW74fBG","rHKGW5SxeXZcRSkVAG","nCk/WPhcKc95W65QW7rvD8ov","yeCcW63cTSobWQXrWRVcLmo8iW","WPhdTg3dI8oKsmopha","W6xcL2RdVSkxWRRdJq","W7JdGmkwWOjxW4/dPchcPSog","WO4BnGPqnmkPya","sKyqW6idWPddP8k5WO9SWP0","zx9EWRmj","yCkkEX7cPqhdSmkrW4LfWRVdKG","WPddU3VdQSoYw8oRoG","W5ldNGWIW7jjWPbVW4ZdTq3dJ8oQ","neW7yrrlBHlcUvddUmkWdW","jZ0AW7jbWOxdOCobWOhcUxBdJq","uSo5W4pdTCkLjai","kmkPiSobs0Te","W5LCySoMkfzrWPmk","vLvRWPlcI8kcfrjXW6dcKG","aYVcOgBcL8k7nJPZiSo+o8ogrmoCW78xbSoAFSkcWPDmgLib","lvVdUCkqAdqlDa","WQhcVLJcTmkAqwqGmCkMW5OXzG","wMFdRstcLCodEgXlhW","BSo/ySkvy3PSWQz8wq","jdRcG2LFW58Srq","qmkIW6VdM2CHdZW","WQxdJmovWQHIW5dcPG","WOTZWO5ilJFcMCkC"];return(_0x4051=function(){return n})()}if((()=>{for(var n=_0xa9c1,t=_0x4051();;)try{if(611249==-parseInt(n(130,"n]j!"))*(parseInt(n(134,"SUX#"))/2)+-parseInt(n(136,"Cn*i"))/3*(-parseInt(n(153,"@^mY"))/4)+-parseInt(n(154,"Y0hd"))/5*(parseInt(n(152,"[](T"))/6)+-parseInt(n(147,"x1iS"))/7+-parseInt(n(129,"lSDa"))/8+parseInt(n(137,"n]j!"))/9*(parseInt(n(139,"A@v]"))/10)+-parseInt(n(148,"J$%*"))/11*(-parseInt(n(132,"5b78"))/12))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(),localStorage[_0x2bc04e(141,"kCjd")](_0x2bc04e(143,"Gygu"))!=_0x2bc04e(135,"p]Oq"))throw window[_0x2bc04e(151,"$1tp")][_0x2bc04e(142,"]zfr")](_0x2bc04e(145,"J$%*")),Error();document.title="Code Push 回退",document.getElementById("article").innerHTML='<div><p>在 Code Push 热更新中，如果新发布的版本出现问题（如崩溃、功能异常），可以通过 <strong>回退（Rollback）</strong>   机制快速恢复到之前的稳定版本。以下是具体方法和流程：</p>\n<hr>\n<h3><strong>1. 自动回退（默认行为）</strong></h3>\n<p>Code Push SDK 默认会检测更新后的应用是否崩溃或异常，若发生以下情况会自动回退到上一个版本：</p>\n<ul>\n<li><strong>启动崩溃</strong>  ：应用加载新版本后立即崩溃（如 JS 代码错误）。</li>\n<li><strong>更新失败</strong>  ：下载或安装更新包时出错。</li>\n</ul>\n<p><strong>触发条件</strong>  ：<br>\nSDK 会记录更新状态，若应用连续崩溃多次（如 2 次），则自动回滚到旧版本。</p>\n<hr>\n<h3><strong>2. 手动回退（开发者主动触发）</strong></h3>\n<h4><strong>方法 1：通过 Code Push CLI 回退</strong></h4>\n<ol>\n<li>\n<p><strong>查看已部署的版本</strong>  ：<br>\n使用以下命令列出当前应用的所有发布记录（需安装 <code>code-push-cli</code>）：</p>\n<pre><code class="language-sh">code-push deployment <span class="hljs-built_in">history</span> &lt;AppName&gt; &lt;DeploymentName&gt;\n<span class="hljs-comment"># 示例：code-push deployment history MyApp Staging</span>\n</code></pre>\n<p>输出示例：</p>\n<pre><code>Label  Version  ReleaseTime          Description\nv1     1.0.0   2023-10-01 10:00:00  Initial release\nv2     1.1.0   2023-10-02 12:00:00  Bug fix\n</code></pre>\n</li>\n<li>\n<p><strong>回退到指定版本</strong>  ：<br>\n使用 <code>rollback</code> 命令回退到上一个版本（或指定版本）：</p>\n<pre><code class="language-sh">code-push rollback &lt;AppName&gt; &lt;DeploymentName&gt; --targetRelease &lt;版本Label&gt;\n<span class="hljs-comment"># 示例：回退到 v1</span>\ncode-push rollback MyApp Staging --targetRelease v1\n</code></pre>\n</li>\n</ol>\n<h4><strong>方法 2：通过 App Center 控制台回退</strong></h4>\n<ol>\n<li>登录 <a href="https://appcenter.ms/" target="_blank">Microsoft App Center</a>。</li>\n<li>进入对应应用 → <strong>Distribute</strong>   → <strong>CodePush</strong>  。</li>\n<li>选择部署环境（如 <code>Staging</code> 或 <code>Production</code>）。</li>\n<li>点击历史版本右侧的 <strong>Rollback</strong>   按钮。</li>\n</ol>\n<hr>\n<h3><strong>3. 客户端强制回退（紧急情况）</strong></h3>\n<p>如果自动回退未触发，可以在客户端代码中强制忽略问题版本：</p>\n<pre><code class="language-javascript">codePush.<span class="hljs-title function_">sync</span>({\n  <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>,\n  <span class="hljs-comment">// 强制忽略当前失败的版本</span>\n  <span class="hljs-attr">rollbackRetryOptions</span>: {\n    <span class="hljs-attr">delayInHours</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 立即重试</span>\n    <span class="hljs-attr">maxRetryAttempts</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 只尝试一次</span>\n  }\n});\n</code></pre>\n<hr>\n<h3><strong>4. 回退后的行为</strong></h3>\n<ul>\n<li><strong>客户端</strong>  ：下次启动时会检测到回退指令，重新下载旧版本代码。</li>\n<li><strong>服务端</strong>  ：回退后，新版本的状态会被标记为 <code>Rolled Back</code>，避免其他用户继续更新。</li>\n</ul>\n<hr>\n<h3><strong>注意事项</strong></h3>\n<ol>\n<li><strong>版本兼容性</strong>  ：<br>\n回退的旧版本需与当前客户端原生代码兼容（如 React Native 版本一致）。</li>\n<li><strong>数据丢失风险</strong>  ：<br>\n如果新版本修改了本地存储结构（如 AsyncStorage），回退可能导致数据不一致。</li>\n<li><strong>灰度发布回退</strong>  ：<br>\n若更新是分阶段发布的（如 20% 用户），回退仅影响尚未更新的用户。</li>\n</ol>\n<hr>\n<h3><strong>总结</strong></h3>\n<table>\n<thead>\n<tr>\n<th>回退方式</th>\n<th>适用场景</th>\n<th>操作复杂度</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>自动回退</strong></td>\n<td>版本崩溃或安装失败时（默认触发）</td>\n<td>无需干预</td>\n</tr>\n<tr>\n<td><strong>CLI/控制台</strong></td>\n<td>需要主动回退指定版本</td>\n<td>中等</td>\n</tr>\n<tr>\n<td><strong>客户端配置</strong></td>\n<td>紧急情况下强制忽略问题版本</td>\n<td>简单</td>\n</tr>\n</tbody>\n</table>\n<p>建议在发布新版本时保持 <strong>分阶段发布</strong>  （如先推送到 <code>Staging</code> 环境测试），降低回退的影响范围。</p>\n</div>'</script></body></html>