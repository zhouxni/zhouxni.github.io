<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x422e(){var s=["W7FdG3uBW4GrWRFdG8oLvSkwW7pcQCoYWQdcTCo5cmoFWQ7dGCo+WQ/dNmk3WOm","W7yHWONcHYZcHaBcOG","ueboBColWQP7W6lcOW","AHZcLvpcLKpdTq","lXhdPezFWRNcHa","hbFdT09nWQNcQSohWRi","iSkXW5/dVSkTBuldQa","W6BdV0Hsi8kqCmk5WOldLSoNW7pcOq","W4myW63dLq9aEhvOnSk5oSkQ","j8khxaZdKeVdJW","pSo5q3VcPNJdQ8ktrCopW4hcVvq","tCk4ymkGWQ3dN20dbmosEWGl","BK/dP8oyewpdVW","jCkCBrpcOgNdM0bScCk5wSkF","WOGTWQ/dHI3dG8kfW6BcM1VcO0/dN8oZ","cWnzzCoZuLulDmk7W4K","smotWO4VzHT5","WRrPc8oKW4FcMLZcV0Gkn8kbWPq","W6tdLmo9W6tdSCkgWPO","W6/cI8kIWPRcS8oxWOuOn8oeaCo2","uCk3W4Lmw8oFW7DsqW","gqqnBCoC","oCo5q3VcPx7dQ8oJq8oQW5NcGg/cUq","W63dLCkSlSoOaZ0DW6LtuW","WR9YW50YsY7dNSkNemo3W43cR8kvWR8","W6KoW5hcS8ohAc5Tav8cCa","W6ZcGCkJWPdcSSorW6zOdCombmohWQ42","WPy3DMVcS1ldUeG"];return(_0x422e=function(){return s})()}function _0x48dc(p,s){var t=_0x422e();return(_0x48dc=function(s,a){var n=t[s-=264];void 0===_0x48dc.uNbICH&&(_0x48dc.DGUgjL=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,e=0;n=s.charAt(e++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),e=0;e<256;e++)l[e]=e;for(e=0;e<256;e++)p=(p+l[e]+a.charCodeAt(e%a.length))%256,n=l[e],l[e]=l[p],l[p]=n;for(var e=0,p=0,c=0;c<s.length;c++)n=l[e=(e+1)%256],l[e]=l[p=(p+l[e])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(c)^l[(l[e]+l[p])%256]);return t},p=arguments,_0x48dc.uNbICH=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x48dc.fWGLtb&&(_0x48dc.fWGLtb=!0),n=_0x48dc.DGUgjL(n,a),p[s]=n),n})(p,s)}var _0x5173ae=_0x48dc;if((()=>{for(var s=_0x48dc,a=_0x422e();;)try{if(827387==+parseInt(s(273,"KiLk"))*(parseInt(s(282,"im4G"))/2)+parseInt(s(264,"!C(X"))/3+-parseInt(s(265,")oF6"))/4+-parseInt(s(277,"O[#D"))/5*(-parseInt(s(272,"wnKK"))/6)+parseInt(s(274,"KSda"))/7+parseInt(s(281,"Sf4C"))/8*(parseInt(s(269,"#4VD"))/9)+-parseInt(s(291,"5YgH"))/10*(parseInt(s(279,"Sr4n"))/11))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x5173ae(288,"56D2")](_0x5173ae(290,"Hvvo"))!=_0x5173ae(278,"N6pt"))throw window[_0x5173ae(286,"ml[w")][_0x5173ae(289,"Hvvo")](_0x5173ae(285,"ybs^")),Error();document.title="React Native 音视频文件处理全攻略",document.getElementById("article").innerHTML='<div><h1>React Native 音视频文件处理全攻略</h1>\n<h2>一、音视频播放解决方案</h2>\n<h3>1. 视频播放</h3>\n<h4>react-native-video (主流选择)</h4>\n<pre><code class="language-sh">npm install react-native-video\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Video</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-video&#x27;</span>;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Video</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">file:</span>///<span class="hljs-attr">path</span>/<span class="hljs-attr">to</span>/<span class="hljs-attr">video.mp4</span>&#x27; }} // <span class="hljs-attr">支持本地文件</span>\n  <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> &#x27;<span class="hljs-attr">100</span>%&#x27;, <span class="hljs-attr">aspectRatio:</span> <span class="hljs-attr">16</span>/<span class="hljs-attr">9</span> }}\n  <span class="hljs-attr">controls</span>=<span class="hljs-string">{true}</span>\n  <span class="hljs-attr">resizeMode</span>=<span class="hljs-string">&quot;contain&quot;</span>\n  <span class="hljs-attr">onError</span>=<span class="hljs-string">{(e)</span> =&gt;</span> console.log(&#x27;播放错误:&#x27;, e.error)}\n/&gt;</span>\n</code></pre>\n<h3>2. 音频播放</h3>\n<h4>react-native-sound</h4>\n<pre><code class="language-sh">npm install react-native-sound\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Sound</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-sound&#x27;</span>;\n\n<span class="hljs-comment">// 播放本地音频文件</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">playAudio</span> = (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">const</span> sound = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sound</span>(path, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n    <span class="hljs-keyword">if</span> (error) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;加载失败&#x27;</span>, error);\n      <span class="hljs-keyword">return</span>;\n    }\n    sound.<span class="hljs-title function_">play</span>();\n  });\n  \n  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> sound.<span class="hljs-title function_">release</span>(); <span class="hljs-comment">// 组件卸载时释放资源</span>\n};\n</code></pre>\n<h2>二、音视频录制方案</h2>\n<h3>1. 视频录制</h3>\n<h4>react-native-camera (已归档，推荐替代方案)</h4>\n<pre><code class="language-sh">npm install react-native-vision-camera\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { useCameraDevice, <span class="hljs-title class_">Camera</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-vision-camera&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">CameraScreen</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> device = <span class="hljs-title function_">useCameraDevice</span>(<span class="hljs-string">&#x27;back&#x27;</span>);\n  \n  <span class="hljs-keyword">if</span> (device == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>无可用摄像头<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>;\n  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Camera</span> \n    <span class="hljs-attr">style</span>=<span class="hljs-string">{StyleSheet.absoluteFill}</span>\n    <span class="hljs-attr">device</span>=<span class="hljs-string">{device}</span>\n    <span class="hljs-attr">isActive</span>=<span class="hljs-string">{true}</span>\n  /&gt;</span></span>;\n}\n</code></pre>\n<h3>2. 音频录制</h3>\n<h4>react-native-audio-recorder-player</h4>\n<pre><code class="language-sh">npm install react-native-audio-recorder-player\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AudioRecorderPlayer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-audio-recorder-player&#x27;</span>;\n\n<span class="hljs-keyword">const</span> audioRecorderPlayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioRecorderPlayer</span>();\n\n<span class="hljs-comment">// 开始录音</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">startRecording</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">const</span> path = <span class="hljs-string">&#x27;file:///path/to/recording.mp3&#x27;</span>;\n  <span class="hljs-keyword">await</span> audioRecorderPlayer.<span class="hljs-title function_">startRecorder</span>(path);\n};\n\n<span class="hljs-comment">// 停止录音</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">stopRecording</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> audioRecorderPlayer.<span class="hljs-title function_">stopRecorder</span>();\n  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;录音文件:&#x27;</span>, result);\n};\n</code></pre>\n<h2>三、音视频文件处理</h2>\n<h3>1. 文件系统访问</h3>\n<h4>react-native-fs</h4>\n<pre><code class="language-sh">npm install react-native-fs\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">RNFS</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-fs&#x27;</span>;\n\n<span class="hljs-comment">// 读取视频文件信息</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">const</span> stat = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">stat</span>(path);\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">size</span>: stat.<span class="hljs-property">size</span>,\n    <span class="hljs-attr">lastModified</span>: stat.<span class="hljs-property">mtime</span>,\n    <span class="hljs-attr">path</span>: stat.<span class="hljs-property">path</span>\n  };\n};\n\n<span class="hljs-comment">// 删除音频文件</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">deleteAudio</span> = (<span class="hljs-params">path</span>) =&gt; <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">unlink</span>(path);\n</code></pre>\n<h3>2. 音视频编辑</h3>\n<h4>react-native-ffmpeg (高级处理)</h4>\n<pre><code class="language-sh">npm install react-native-ffmpeg\n</code></pre>\n<pre><code class="language-jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">RNFFmpeg</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-ffmpeg&#x27;</span>;\n\n<span class="hljs-comment">// 视频裁剪</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">cropVideo</span> = (<span class="hljs-params">inputPath, outputPath, startTime, duration</span>) =&gt; {\n  <span class="hljs-keyword">const</span> cmd = <span class="hljs-string">`-ss <span class="hljs-subst">${startTime}</span> -i <span class="hljs-subst">${inputPath}</span> -t <span class="hljs-subst">${duration}</span> -c copy <span class="hljs-subst">${outputPath}</span>`</span>;\n  <span class="hljs-title class_">RNFFmpeg</span>.<span class="hljs-title function_">execute</span>(cmd).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;裁剪完成&#x27;</span>));\n};\n\n<span class="hljs-comment">// 音频提取</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">extractAudio</span> = (<span class="hljs-params">videoPath, audioPath</span>) =&gt; {\n  <span class="hljs-title class_">RNFFmpeg</span>.<span class="hljs-title function_">execute</span>(<span class="hljs-string">`-i <span class="hljs-subst">${videoPath}</span> -vn -acodec copy <span class="hljs-subst">${audioPath}</span>`</span>);\n};\n</code></pre>\n<h2>四、音视频上传下载</h2>\n<h3>1. 文件上传</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadVideo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">uri</span>) =&gt; {\n  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();\n  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;video&#x27;</span>, {\n    uri,\n    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;video.mp4&#x27;</span>,\n    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;video/mp4&#x27;</span>\n  });\n\n  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/upload&#x27;</span>, {\n    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,\n    <span class="hljs-attr">body</span>: formData,\n    <span class="hljs-attr">headers</span>: {\n      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>,\n    },\n  });\n  \n  <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();\n};\n</code></pre>\n<h3>2. 文件下载</h3>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">downloadFile</span> = (<span class="hljs-params">url, path</span>) =&gt; {\n  <span class="hljs-keyword">const</span> download = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">downloadFile</span>({\n    <span class="hljs-attr">fromUrl</span>: url,\n    <span class="hljs-attr">toFile</span>: path,\n    <span class="hljs-attr">progress</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n      <span class="hljs-keyword">const</span> progress = (res.<span class="hljs-property">bytesWritten</span> / res.<span class="hljs-property">contentLength</span>) * <span class="hljs-number">100</span>;\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`下载进度: <span class="hljs-subst">${progress.toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);\n    }\n  });\n\n  <span class="hljs-keyword">return</span> download.<span class="hljs-property">promise</span>;\n};\n</code></pre>\n<h2>五、特殊格式处理</h2>\n<h3>1. HLS/DASH流媒体</h3>\n<pre><code class="language-jsx"><span class="hljs-comment">// react-native-video支持HLS</span>\n&lt;<span class="hljs-title class_">Video</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com/stream.m3u8&#x27;</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;m3u8&#x27;</span> }}\n/&gt;\n</code></pre>\n<h3>2. 处理GIF</h3>\n<pre><code class="language-jsx"><span class="hljs-comment">// 使用react-native-fast-image处理GIF</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">FastImage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-fast-image&#x27;</span>;\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FastImage</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>/<span class="hljs-attr">animation.gif</span>&#x27; }}\n  <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">200</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">200</span> }}\n  <span class="hljs-attr">resizeMode</span>=<span class="hljs-string">{FastImage.resizeMode.contain}</span>\n/&gt;</span></span>\n</code></pre>\n<h2>六、性能优化技巧</h2>\n<ol>\n<li><strong>视频缓存策略</strong><pre><code class="language-jsx"><span class="hljs-comment">// react-native-video缓存配置</span>\n&lt;<span class="hljs-title class_">Video</span>\n  source={{\n    <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com/video.mp4&#x27;</span>,\n    <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>\n  }}\n/&gt;\n</code></pre>\n</li>\n<li><strong>音频后台播放 (iOS需配置Info.plist)</strong><pre><code class="language-javascript"><span class="hljs-comment">// 在App.js中配置</span>\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-title class_">AppState</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {\n  <span class="hljs-keyword">if</span> (state === <span class="hljs-string">&#x27;background&#x27;</span>) {\n    <span class="hljs-comment">// 保持音频后台播放逻辑</span>\n  }\n});\n</code></pre>\n</li>\n<li><strong>内存管理</strong><pre><code class="language-jsx"><span class="hljs-comment">// 列表中的视频优化</span>\n&lt;<span class="hljs-title class_">FlatList</span>\n  data={videos}\n  renderItem={<span class="hljs-function">(<span class="hljs-params">{ item }</span>) =&gt;</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Video</span>\n      <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> <span class="hljs-attr">item.url</span> }}\n      <span class="hljs-attr">paused</span>=<span class="hljs-string">{!item.isVisible}</span> // <span class="hljs-attr">根据可见性控制播放</span>\n    /&gt;</span></span>\n  )}\n  windowSize={<span class="hljs-number">3</span>}\n  maxToRenderPerBatch={<span class="hljs-number">2</span>}\n/&gt;\n</code></pre>\n</li>\n</ol>\n<h2>七、常见问题解决</h2>\n<h3>1. Android文件路径问题</h3>\n<pre><code class="language-jsx"><span class="hljs-comment">// 获取正确的文件路径</span>\n<span class="hljs-keyword">const</span> videoPath = <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n  <span class="hljs-attr">ios</span>: <span class="hljs-string">&#x27;file:///path/to/video.mp4&#x27;</span>,\n  <span class="hljs-attr">android</span>: <span class="hljs-string">&#x27;file:///storage/emulated/0/Video/video.mp4&#x27;</span>\n});\n</code></pre>\n<h3>2. iOS录音权限</h3>\n<pre><code class="language-plist"><span class="hljs-comment">&lt;!-- Info.plist 添加 --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSMicrophoneUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>我们需要访问麦克风以录制音频<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n</code></pre>\n<h3>3. 格式兼容性问题</h3>\n<pre><code class="language-jsx"><span class="hljs-comment">// 使用FFmpeg转换格式</span>\n<span class="hljs-title class_">RNFFmpeg</span>.<span class="hljs-title function_">execute</span>(<span class="hljs-string">&#x27;-i input.avi -c:v libx264 -c:a aac output.mp4&#x27;</span>);\n</code></pre>\n<p>通过以上方案，您可以实现React Native应用中完整的音视频处理功能。根据项目需求选择合适的库组合，并注意各平台的特性差异和性能优化。</p>\n</div>'</script></body></html>