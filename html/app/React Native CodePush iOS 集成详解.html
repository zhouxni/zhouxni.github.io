<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x28e70b=_0x36e1;function _0x50ce(){var s=["qtniW403b8owaHOsDrzZ","mmkkW4TYWQqVbu9Vpmo6W6i+W4m","gbqyW6hcHMXPW6pdSW","gWddH8otlaviWPBdPZyEDY3dMa","W7i5WPlcH8kVtdFdGSkLWQtcL2Sg","rfm2WO3dVx3cSa","iSozW6WalSkuo8o4vq","W6uEeqrLW7dcSq","WQ9RzhZcIJNdGKDLgZXEWQK","WPDyW5v/WOC","WQ7cR8o3W6JcHI0LWRm2EbpdJ0a","hmoAWQC6WP7cSMpcN8kWbuG","e3VcJSkhthmQ","WO9zW5j8WO00CmoqrmkGBvnFmSorjsRcPZbUwmkdWQCIy1K","exmTWOddNvlcICkt","WPK1W4tdKYBcGvlcImoElmk8r3FcHq","WR4yx3vWW6mEWPb2W7RdIbdcLXq","EmkVWPhcKCkooc3dSSkvqwRcUSoh","WQ5MmSkfWRzoW4tdT8k8W4FcQSozWQBdLq","W6/dUmk+WRtdK3T0","WQ/dRmoPBSkQWP/dV8kKW5FdQ8kdW6tdPW","pbtcJ8kmW5DJkG","gbauWOJdGXq4WRJdU2ivWOlcGwO","WOjVW4xdLSoQdu7dPmk2","hr0CWO/dGeDmW6FdLNGr","W65fWPOJhY1u"];return(_0x50ce=function(){return s})()}function _0x36e1(e,s){var p=_0x50ce();return(_0x36e1=function(s,n){var a=p[s-=448];void 0===_0x36e1.xPhgCN&&(_0x36e1.szySKp=function(s,n){var a,l=[],e=0,p="";for(s=(s=>{for(var n,a,l="",e="",p=0,t=0;a=s.charAt(t++);~a&&(n=p%4?64*n+a:a,p++%4)&&(l+=String.fromCharCode(255&n>>(-2*p&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,c=l.length;o<c;o++)e+="%"+("00"+l.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(e)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)e=(e+l[t]+n.charCodeAt(t%n.length))%256,a=l[t],l[t]=l[e],l[e]=a;for(var t=0,e=0,o=0;o<s.length;o++)a=l[t=(t+1)%256],l[t]=l[e=(e+l[t])%256],l[e]=a,p+=String.fromCharCode(s.charCodeAt(o)^l[(l[t]+l[e])%256]);return p},e=arguments,_0x36e1.xPhgCN=!0);var s=s+p[0],l=e[s];return l?a=l:(void 0===_0x36e1.hyOXgd&&(_0x36e1.hyOXgd=!0),a=_0x36e1.szySKp(a,n),e[s]=a),a})(e,s)}if((()=>{for(var s=_0x36e1,n=_0x50ce();;)try{if(981178==+parseInt(s(452,"fm]9"))+parseInt(s(464,"&v2j"))/2+parseInt(s(470,"It$4"))/3+parseInt(s(455,"Y4*G"))/4*(parseInt(s(450,"e$pJ"))/5)+-parseInt(s(469,"r$JQ"))/6*(-parseInt(s(460,"n6&S"))/7)+-parseInt(s(473,"qGu5"))/8*(-parseInt(s(456,"qGu5"))/9)+-parseInt(s(466,"zC5E"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x28e70b(465,"qbaM")](_0x28e70b(467,"J2em"))!=_0x28e70b(453,"5ZkZ"))throw window[_0x28e70b(458,"^OuC")][_0x28e70b(463,"[dtS")](_0x28e70b(457,"5ZkZ")),Error();document.title="React Native CodePush iOS 集成详解",document.getElementById("article").innerHTML='<div><h2>一、前期准备</h2>\n<h3>1. 安装必要工具</h3>\n<pre><code class="language-sh">npm install -g code-push-cli\nnpm install react-native-code-push --save\n</code></pre>\n<h3>2. 注册CodePush应用</h3>\n<pre><code class="language-sh">code-push app add MyApp-iOS ios react-native\n</code></pre>\n<p>记下返回的Staging和Production环境的Deployment Key</p>\n<h2>二、iOS项目配置</h2>\n<h3>1. 安装CocoaPods依赖</h3>\n<pre><code class="language-sh"><span class="hljs-built_in">cd</span> ios &amp;&amp; pod install\n</code></pre>\n<h3>2. 修改AppDelegate.m</h3>\n<pre><code class="language-objective-c">// ios/MyApp/AppDelegate.m\n#import &lt;CodePush/CodePush.h&gt;\n\n// 替换\n// jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;index&quot; fallbackResource:nil];\n// 为\njsCodeLocation = [CodePush bundleURL];\n</code></pre>\n<h3>3. 配置Deployment Key (可选)</h3>\n<h4>方法1: 在Info.plist中配置</h4>\n<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- ios/MyApp/Info.plist --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CodePushDeploymentKey<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>$(CODEPUSH_KEY)<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n\n<span class="hljs-comment">&lt;!-- 添加配置项 --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CodePushServerURL<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>https://codepush.appcenter.ms/<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n</code></pre>\n<h4>方法2: 在Build Settings中配置</h4>\n<ol>\n<li>在Xcode中打开项目</li>\n<li>选择项目 → Build Settings</li>\n<li>搜索&quot;Preprocessor Macros&quot;</li>\n<li>为Debug配置添加：<pre><code>CODEPUSH_KEY=YOUR_STAGING_KEY\n</code></pre>\n</li>\n<li>为Release配置添加：<pre><code>CODEPUSH_KEY=YOUR_PRODUCTION_KEY\n</code></pre>\n</li>\n</ol>\n<h2>三、代码集成</h2>\n<h3>1. 基础集成方式</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// App.js</span>\n<span class="hljs-keyword">import</span> codePush <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-native-code-push&quot;</span>;\n\n<span class="hljs-keyword">let</span> codePushOptions = { \n    <span class="hljs-attr">checkFrequency</span>: codePush.<span class="hljs-property">CheckFrequency</span>.<span class="hljs-property">ON_APP_START</span>,\n    <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>\n};\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> {\n    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) {\n        codePush.<span class="hljs-title function_">sync</span>();\n    }\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">codePush</span>(codePushOptions)(<span class="hljs-title class_">MyApp</span>);\n</code></pre>\n<h3>2. 高级配置选项</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> codePushOptions = {\n    <span class="hljs-comment">// 检查更新频率</span>\n    <span class="hljs-attr">checkFrequency</span>: codePush.<span class="hljs-property">CheckFrequency</span>.<span class="hljs-property">ON_APP_RESUME</span>,\n    \n    <span class="hljs-comment">// 更新对话框配置</span>\n    <span class="hljs-attr">updateDialog</span>: {\n        <span class="hljs-attr">appendReleaseDescription</span>: <span class="hljs-literal">true</span>,\n        <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;新版本可用&quot;</span>,\n        <span class="hljs-attr">optionalUpdateMessage</span>: <span class="hljs-string">&quot;是否立即更新？&quot;</span>,\n        <span class="hljs-attr">optionalIgnoreButtonLabel</span>: <span class="hljs-string">&quot;稍后提醒&quot;</span>,\n        <span class="hljs-attr">optionalInstallButtonLabel</span>: <span class="hljs-string">&quot;立即更新&quot;</span>,\n        <span class="hljs-attr">mandatoryContinueButtonLabel</span>: <span class="hljs-string">&quot;立即更新&quot;</span>,\n        <span class="hljs-attr">mandatoryUpdateMessage</span>: <span class="hljs-string">&quot;必须更新后才能继续使用&quot;</span>\n    },\n    \n    <span class="hljs-comment">// 安装模式</span>\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESUME</span>,\n    \n    <span class="hljs-comment">// 部署密钥(可选，推荐在原生配置)</span>\n    <span class="hljs-attr">deploymentKey</span>: <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n        <span class="hljs-attr">ios</span>: <span class="hljs-string">&quot;YOUR_IOS_DEPLOYMENT_KEY&quot;</span>,\n        <span class="hljs-attr">android</span>: <span class="hljs-string">&quot;YOUR_ANDROID_DEPLOYMENT_KEY&quot;</span>\n    })\n};\n</code></pre>\n<h2>四、发布更新</h2>\n<h3>1. 生成发布包</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 开发环境</span>\ncode-push release-react MyApp-iOS ios --dev\n\n<span class="hljs-comment"># 生产环境强制更新</span>\ncode-push release-react MyApp-iOS ios -m --description <span class="hljs-string">&quot;重要更新&quot;</span>\n\n<span class="hljs-comment"># 指定目标版本范围</span>\ncode-push release-react MyApp-iOS ios -t <span class="hljs-string">&quot;1.0.0&quot;</span> --m\n\n<span class="hljs-comment"># 灰度发布(20%用户)</span>\ncode-push release-react MyApp-iOS ios --rollout 20%\n</code></pre>\n<h3>2. 查看发布历史</h3>\n<pre><code class="language-sh">code-push deployment <span class="hljs-built_in">history</span> MyApp-iOS Production\n</code></pre>\n<h2>五、调试与问题排查</h2>\n<h3>1. 获取当前包信息</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-title function_">getUpdateMetadata</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">update</span> =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;当前版本:&quot;</span>, update.<span class="hljs-property">label</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;是否强制更新:&quot;</span>, update.<span class="hljs-property">isMandatory</span>);\n});\n</code></pre>\n<h3>2. 常见问题解决</h3>\n<p><strong>问题1：更新不生效</strong></p>\n<ul>\n<li>检查<code>CFBundleShortVersionString</code>是否与发布时指定的版本范围匹配</li>\n<li>确认Deployment Key配置一致</li>\n<li>清除应用数据重新测试</li>\n</ul>\n<p><strong>问题2：CodePush.bundle not found</strong></p>\n<pre><code class="language-sh"><span class="hljs-built_in">cd</span> ios &amp;&amp; pod install\n</code></pre>\n<p><strong>问题3：无法加载JS Bundle</strong></p>\n<ul>\n<li>检查<code>bundleURL</code>方法是否正确调用</li>\n<li>确认没有其他代码覆盖了JSBundle加载逻辑</li>\n</ul>\n<h2>六、最佳实践</h2>\n<ol>\n<li><strong>版本控制策略</strong>\n<ul>\n<li>保持<code>CFBundleShortVersionString</code>与CodePush发布版本兼容</li>\n<li>使用语义化版本控制 (如1.0.0)</li>\n</ul>\n</li>\n<li><strong>更新策略</strong><pre><code class="language-javascript"><span class="hljs-comment">// 静默下载，应用从后台恢复时生效</span>\ncodePush.<span class="hljs-title function_">sync</span>({\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESUME</span>,\n    <span class="hljs-attr">minimumBackgroundDuration</span>: <span class="hljs-number">60</span>,\n    <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">false</span>\n});\n</code></pre>\n</li>\n<li><strong>安全考虑</strong>\n<ul>\n<li>生产环境使用Production Deployment Key</li>\n<li>考虑添加更新包签名验证</li>\n</ul>\n</li>\n<li><strong>App Store审核注意事项</strong>\n<ul>\n<li>热更新不能修改应用的核心功能</li>\n<li>不能违反Apple的开发者条款</li>\n<li>准备原生版本作为后备方案</li>\n</ul>\n</li>\n</ol>\n<p>通过以上步骤，您已完成CodePush在iOS平台的完整集成。建议先在Staging环境充分测试，再发布到Production环境。</p>\n</div>'</script></body></html>