<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0xc9bea7=_0x3235;function _0x3235(p,s){var t=_0x1ac7();return(_0x3235=function(s,a){var n=t[s-=309];void 0===_0x3235.oWUMAi&&(_0x3235.ITGJNR=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,r=l.length;e<r;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,e=0;e<s.length;e++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x3235.oWUMAi=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x3235.bbSSNh&&(_0x3235.bbSSNh=!0),n=_0x3235.ITGJNR(n,a),p[s]=n),n})(p,s)}function _0x1ac7(){var s=["WQKpWPX5W6KpamoJuqG","vmo/DZNdGmoYkXpcIW","WQS3WRddMSoWfSk/t8oIW5e","W5pcSSkoW4O6W5yJWQiEf8kldq","ewmoxXpcLmoGwuzdxJy","W5VdGMWbWPydq8osW5S","hqpcTmkCtgtcThn+qmoKFa","W6pdJmo3c8obCHe7vmkeWPxcGdK","W7/dPmoBWR/dUG","W41OWOVdSSk2WRxdS8o+z8oeiCoTmW","halcUCkBsgpdPer9A8oyACog","W6axWRfBhIJcHbH2W5b+nW","W5VdS8oXWOBdQCkrl8kBWR3dS2OGW53dHG","vx7dJGjKWOpdUMpcSq","s2OMW5WZWRxdGZCtWONdGJSh","W5/cT8klW4SZW5rSW6iifmkppCo+eq","bCkDvh/dVSkbw8k3W4JcRNq","W6eMW7RdVvFdGSkq","tgORW51hW43cNaClWRq","W6hdISo7dSognu8BsCk6WO8","W7LZcmksnSo3rSoegmkq","rSopecBcQ8kxvW","cSoWimoWsSk1CmoLy8o6W6VcJ8k3WPbJW70HWRuYCSotASkgBSoXqW","W7vRWQRcLMhcJM5d"];return(_0x1ac7=function(){return s})()}if((()=>{for(var s=_0x3235,a=_0x1ac7();;)try{if(708249==-parseInt(s(329,"a0Lm"))*(parseInt(s(324,"Fevp"))/2)+-parseInt(s(325,"a0Lm"))/3+-parseInt(s(315,"(gL0"))/4+-parseInt(s(320,"6XU6"))/5+-parseInt(s(330,"uPDd"))/6*(parseInt(s(313,"0Zj0"))/7)+-parseInt(s(322,"MTEU"))/8+parseInt(s(323,"Ex%Q"))/9)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0xc9bea7(328,"JBY4")](_0xc9bea7(312,"FyE#"))!=_0xc9bea7(319,"AK2c"))throw window[_0xc9bea7(310,"WZ*S")][_0xc9bea7(332,"aLTP")](_0xc9bea7(309,"MnM0")),Error();document.title="React Native Share 模块详解",document.getElementById("article").innerHTML='<div><h1>React Native Share 模块详解</h1>\n<p>Share 是 React Native 提供的用于调用系统原生分享对话框的 API，支持内容分享到其他应用。以下是全面解析：</p>\n<h2>一、核心功能与基础使用</h2>\n<h3>1. 基本分享功能</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Share</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-comment">// 基本分享</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">shareContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>({\n      <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;分享内容文本&#x27;</span>,\n      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;分享标题&#x27;</span>\n    });\n    \n    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">action</span> === <span class="hljs-title class_">Share</span>.<span class="hljs-property">sharedAction</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;分享成功&#x27;</span>);\n    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.<span class="hljs-property">action</span> === <span class="hljs-title class_">Share</span>.<span class="hljs-property">dismissedAction</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;分享取消&#x27;</span>);\n    }\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;分享失败:&#x27;</span>, error.<span class="hljs-property">message</span>);\n  }\n};\n</code></pre>\n<h3>2. 分享结果对象</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShareResult</span> {\n  <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;sharedAction&#x27;</span> | <span class="hljs-string">&#x27;dismissedAction&#x27;</span>; <span class="hljs-comment">// 分享动作类型</span>\n  <span class="hljs-attr">activityType</span>?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// iOS特有，分享目标类型</span>\n}\n</code></pre>\n<h2>二、平台特性与高级用法</h2>\n<h3>1. 平台特定参数</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 平台特定配置</span>\n<span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>({\n  <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;跨平台分享内容&#x27;</span>,\n  <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;请选择分享方式&#x27;</span>,\n  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;https://reactnative.dev&#x27;</span>, <span class="hljs-comment">// 链接</span>\n  <span class="hljs-attr">subject</span>: <span class="hljs-string">&#x27;分享主题&#x27;</span>, <span class="hljs-comment">// Android邮件主题</span>\n  <span class="hljs-attr">dialogTitle</span>: <span class="hljs-string">&#x27;分享到&#x27;</span>, <span class="hljs-comment">// Android对话框标题</span>\n  <span class="hljs-comment">// iOS特有</span>\n  <span class="hljs-attr">excludedActivityTypes</span>: [\n    <span class="hljs-string">&#x27;com.apple.UIKit.activity.PostToTwitter&#x27;</span> <span class="hljs-comment">// 排除Twitter</span>\n  ]\n});\n</code></pre>\n<h3>2. 文件分享（Android）</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// Android文件分享需要额外配置</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">shareFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">filePath</span>) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>({\n      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;分享文件&#x27;</span>,\n      <span class="hljs-attr">url</span>: <span class="hljs-string">`file://<span class="hljs-subst">${filePath}</span>`</span>, <span class="hljs-comment">// 必须使用file://协议</span>\n      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;application/pdf&#x27;</span> <span class="hljs-comment">// MIME类型</span>\n    });\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;文件分享失败:&#x27;</span>, error);\n  }\n};\n</code></pre>\n<h2>三、实用工具方法</h2>\n<h3>1. 分享Hook封装</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useShare</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> [isSharing, setIsSharing] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">share</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">options</span>) =&gt; {\n    <span class="hljs-title function_">setIsSharing</span>(<span class="hljs-literal">true</span>);\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>(options);\n      <span class="hljs-keyword">return</span> result;\n    } <span class="hljs-keyword">finally</span> {\n      <span class="hljs-title function_">setIsSharing</span>(<span class="hljs-literal">false</span>);\n    }\n  };\n\n  <span class="hljs-keyword">return</span> { share, isSharing };\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">const</span> { share, isSharing } = <span class="hljs-title function_">useShare</span>();\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> \n  <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;分享&quot;</span> \n  <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> share({ message: &#x27;测试内容&#x27; })} \n  disabled={isSharing}\n/&gt;</span>\n</code></pre>\n<h3>2. 社交平台直接分享</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 检测特定平台是否可用</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">shareToPlatform</span>(<span class="hljs-params">platform</span>) {\n  <span class="hljs-keyword">const</span> urlMap = {\n    <span class="hljs-attr">twitter</span>: <span class="hljs-string">&#x27;twitter://post?message=&#x27;</span>,\n    <span class="hljs-attr">facebook</span>: <span class="hljs-string">&#x27;fb://publish/profile/me?text=&#x27;</span>,\n    <span class="hljs-attr">whatsapp</span>: <span class="hljs-string">&#x27;whatsapp://send?text=&#x27;</span>\n  };\n\n  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${urlMap[platform]}</span><span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">&#x27;分享内容&#x27;</span>)}</span>`</span>;\n  \n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> supported = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Linking</span>.<span class="hljs-title function_">canOpenURL</span>(url);\n    <span class="hljs-keyword">if</span> (supported) {\n      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Linking</span>.<span class="hljs-title function_">openURL</span>(url);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;\n    }\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;分享内容&#x27;</span> });\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`分享到<span class="hljs-subst">${platform}</span>失败:`</span>, error);\n    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n  }\n}\n</code></pre>\n<h2>四、平台差异处理</h2>\n<h3>1. 主要平台差异</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>iOS</th>\n<th>Android</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>文件分享</td>\n<td>有限支持</td>\n<td>完整支持</td>\n</tr>\n<tr>\n<td>排除特定应用</td>\n<td>支持</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>分享结果回调</td>\n<td>精确</td>\n<td>基本</td>\n</tr>\n<tr>\n<td>本地文件分享</td>\n<td>需要额外处理</td>\n<td>原生支持</td>\n</tr>\n</tbody>\n</table>\n<h3>2. 跨平台适配方案</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">universalShare</span>(<span class="hljs-params">content</span>) {\n  <span class="hljs-keyword">const</span> baseOptions = {\n    <span class="hljs-attr">title</span>: content.<span class="hljs-property">title</span>,\n    <span class="hljs-attr">message</span>: content.<span class="hljs-property">message</span>,\n    <span class="hljs-attr">url</span>: content.<span class="hljs-property">url</span>\n  };\n\n  <span class="hljs-keyword">const</span> platformOptions = <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n    <span class="hljs-attr">ios</span>: {\n      <span class="hljs-attr">excludedActivityTypes</span>: [\n        <span class="hljs-string">&#x27;com.apple.UIKit.activity.AddToReadingList&#x27;</span>\n      ]\n    },\n    <span class="hljs-attr">android</span>: {\n      <span class="hljs-attr">subject</span>: content.<span class="hljs-property">subject</span>,\n      <span class="hljs-attr">dialogTitle</span>: <span class="hljs-string">&#x27;分享到&#x27;</span>\n    }\n  });\n\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>({ ...baseOptions, ...platformOptions });\n}\n</code></pre>\n<h2>五、常见问题解决方案</h2>\n<h3>1. Android文件分享不工作</h3>\n<p><strong>解决方案</strong>  ：</p>\n<ol>\n<li>确保文件路径使用<code>file://</code>前缀</li>\n<li>添加文件读取权限</li>\n<li>配置正确的MIME类型</li>\n</ol>\n<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- AndroidManifest.xml --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span>\n</code></pre>\n<h3>2. iOS分享菜单不显示</h3>\n<p><strong>排查步骤</strong>  ：</p>\n<ol>\n<li>确认在物理设备上测试（模拟器可能有问题）</li>\n<li>检查分享内容不为空</li>\n<li>验证回调函数正确绑定</li>\n</ol>\n<h3>3. 分享结果判断不准确</h3>\n<p><strong>改进方案</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Share</span>.<span class="hljs-title function_">share</span>(options);\n<span class="hljs-keyword">const</span> isShared = <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n  <span class="hljs-attr">ios</span>: <span class="hljs-function">() =&gt;</span> result.<span class="hljs-property">action</span> === <span class="hljs-title class_">Share</span>.<span class="hljs-property">sharedAction</span> &amp;&amp; result.<span class="hljs-property">activityType</span>,\n  <span class="hljs-attr">android</span>: <span class="hljs-function">() =&gt;</span> result.<span class="hljs-property">action</span> === <span class="hljs-title class_">Share</span>.<span class="hljs-property">sharedAction</span>\n})();\n</code></pre>\n<h2>六、最佳实践建议</h2>\n<ol>\n<li><strong>内容格式化</strong>  ：自动截断过长的分享内容</li>\n<li><strong>错误边界</strong>  ：处理用户取消分享的情况</li>\n<li><strong>分析跟踪</strong>  ：记录分享成功率和目标平台</li>\n<li><strong>UI反馈</strong>  ：分享过程中显示加载状态</li>\n</ol>\n<h2>七、调试与测试技巧</h2>\n<h3>1. 分享模拟器</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 开发环境分享模拟</span>\n<span class="hljs-keyword">if</span> (__DEV__) {\n  <span class="hljs-title class_">Share</span>.<span class="hljs-property">mock</span> = <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;模拟分享:&#x27;</span>, content);\n    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({\n      <span class="hljs-attr">action</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.3</span> \n        ? <span class="hljs-title class_">Share</span>.<span class="hljs-property">sharedAction</span> \n        : <span class="hljs-title class_">Share</span>.<span class="hljs-property">dismissedAction</span>,\n      <span class="hljs-attr">activityType</span>: [<span class="hljs-string">&#x27;com.twitter&#x27;</span>, <span class="hljs-string">&#x27;com.facebook&#x27;</span>].<span class="hljs-title function_">random</span>()\n    });\n  };\n}\n</code></pre>\n<h3>2. 自动化测试</h3>\n<pre><code class="language-javascript"><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Share功能&#x27;</span>, <span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-title function_">beforeAll</span>(<span class="hljs-function">() =&gt;</span> {\n    jest.<span class="hljs-title function_">spyOn</span>(<span class="hljs-title class_">Share</span>, <span class="hljs-string">&#x27;share&#x27;</span>).<span class="hljs-title function_">mockResolvedValue</span>({\n      <span class="hljs-attr">action</span>: <span class="hljs-title class_">Share</span>.<span class="hljs-property">sharedAction</span>\n    });\n  });\n\n  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;应成功分享内容&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; {\n    <span class="hljs-keyword">await</span> <span class="hljs-title function_">shareContent</span>(<span class="hljs-string">&#x27;测试&#x27;</span>);\n    <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">Share</span>.<span class="hljs-property">share</span>).<span class="hljs-title function_">toHaveBeenCalled</span>();\n  });\n});\n</code></pre>\n<p>通过深入理解 Share API，开发者可以：</p>\n<ol>\n<li>实现原生级的分享体验</li>\n<li>精确控制分享内容和目标</li>\n<li>处理各平台的特殊需求</li>\n<li>构建社交友好的应用功能</li>\n</ol>\n<p>建议将分享功能封装成服务模块，便于统一管理和业务解耦。</p>\n</div>'</script></body></html>