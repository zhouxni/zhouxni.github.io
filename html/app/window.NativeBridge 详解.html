<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x7c5d(l,s){var e=_0x14b9();return(_0x7c5d=function(s,n){var a=e[s-=111];void 0===_0x7c5d.YOnixe&&(_0x7c5d.RXGMbG=function(s,n){var a,t=[],l=0,e="";for(s=(s=>{for(var n,a,t="",l="",e=0,r=0;a=s.charAt(r++);~a&&(n=e%4?64*n+a:a,e++%4)&&(t+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var o=0,p=t.length;o<p;o++)l+="%"+("00"+t.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(l)})(s),r=0;r<256;r++)t[r]=r;for(r=0;r<256;r++)l=(l+t[r]+n.charCodeAt(r%n.length))%256,a=t[r],t[r]=t[l],t[l]=a;for(var r=0,l=0,o=0;o<s.length;o++)a=t[r=(r+1)%256],t[r]=t[l=(l+t[r])%256],t[l]=a,e+=String.fromCharCode(s.charCodeAt(o)^t[(t[r]+t[l])%256]);return e},l=arguments,_0x7c5d.YOnixe=!0);var s=s+e[0],t=l[s];return t?a=t:(void 0===_0x7c5d.VaiDpk&&(_0x7c5d.VaiDpk=!0),a=_0x7c5d.RXGMbG(a,n),l[s]=a),a})(l,s)}function _0x14b9(){var s=["lY3cNWG7CqDhWOO/WRO2","ye8cmv9cf1tdV07dMSk+","W53cIvmzW5H+WQ3dKq","WQ4nW5vNW7hcTCoPWQSGDCk0W5Ln","WRzPod/dP8osW5iGW4a","WQ9bW73dNfFdHdWcWQW","tgRcVYhdV8kNs8kSW6ac","kYJcMqS5fG1oWQK0WQK","swtcSItcG8oinmkCW6q7WOldTSkB","W4tcGHFcPf/dTsa","twRcTYJdLmk7zmkaW4WJ","sw7cTwJdRmkSrSk0W6q","cSoRWQtcVHNcHeXJW4dcVG","pmkAzmo6qCo7oJtcRSkJW5W","WResumobWOyko00e","W63cSmoAlbC0sCo7W6e","WOPYWPfnW5pdLqSfWRRdUq","W63dSSo7W4SGf8onaai","W4CUlL1KWRxcRSoCW4X+","yuGmof5etgtdTgNdVSkPW6G","WOTbDSoAWPddUXKfWP3dQG","A23dNtFdKudcG8ocBW","AgRdNKNdQexcV8oAyJ4","WRbVmN7cGmk2WQqSW4vYa8k/jW","W6WBdCk0jvRdLN8usa","W5fmWPddMtNcUa8Za8oK","W7CVEttdIa","WQhcGWhcGmomWRz1","kSoJWQ/dPSk8W6HAkSkhWQu","WPGfr8ouWOzdxWChWP5tWQZdJWNcT1tdPsVcK8owBMZcRCkiWOJcKq"];return(_0x14b9=function(){return s})()}var _0x2964f9=_0x7c5d;if((()=>{for(var s=_0x7c5d,n=_0x14b9();;)try{if(874810==-parseInt(s(117,"o2Xj"))*(parseInt(s(126,"Raxu"))/2)+parseInt(s(121,"WNYP"))/3*(parseInt(s(115,"IdKF"))/4)+-parseInt(s(128,"5cMb"))/5+parseInt(s(130,"&e1["))/6*(-parseInt(s(129,"McfS"))/7)+-parseInt(s(112,"Bt5d"))/8*(parseInt(s(122,"ghlD"))/9)+-parseInt(s(135,"Bt5d"))/10+parseInt(s(113,"IdKF"))/11*(parseInt(s(116,"IdKF"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x2964f9(132,"OBZv")](_0x2964f9(119,"hRSA"))!=_0x2964f9(131,"5cMb"))throw window[_0x2964f9(137,"y!(a")][_0x2964f9(114,"$QJ3")](_0x2964f9(134,"hRSA")),Error();document.title="window.NativeBridge 详解",document.getElementById("article").innerHTML='<div><p><code>window.NativeBridge</code> 是混合开发中 <strong>H5 调用原生功能</strong>   的常见实现方式，主要用于 Android 平台的 WebView 与原生代码通信。</p>\n<h2><strong>1. 基本原理</strong></h2>\n<p>Android 通过 <code>addJavascriptInterface</code> 将 Java/Kotlin 对象注入到 WebView 的 JavaScript 上下文中，使 H5 可以直接调用原生方法。</p>\n<h2><strong>2. Android 原生端实现</strong></h2>\n<pre><code class="language-java"><span class="hljs-comment">// Kotlin 示例</span>\nwebView.settings.javaScriptEnabled = <span class="hljs-literal">true</span>\n\n<span class="hljs-comment">// 创建 Bridge 对象</span>\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeBridge</span> {\n    <span class="hljs-meta">@JavascriptInterface</span>\n    fun <span class="hljs-title function_">showToast</span><span class="hljs-params">(message: String)</span> {\n        Toast.makeText(context, message, Toast.LENGTH_SHORT).show()\n    }\n    \n    <span class="hljs-meta">@JavascriptInterface</span>\n    fun <span class="hljs-title function_">getDeviceInfo</span><span class="hljs-params">()</span>: String {\n        <span class="hljs-keyword">return</span> JSONObject()\n            .put(<span class="hljs-string">&quot;os&quot;</span>, <span class="hljs-string">&quot;Android&quot;</span>)\n            .put(<span class="hljs-string">&quot;version&quot;</span>, Build.VERSION.RELEASE)\n            .toString()\n    }\n}\n\n<span class="hljs-comment">// 注入到 WebView</span>\nwebView.addJavascriptInterface(NativeBridge(), <span class="hljs-string">&quot;NativeBridge&quot;</span>)\n</code></pre>\n<h2><strong>3. H5 端调用方式</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// 调用原生 Toast</span>\n<span class="hljs-variable language_">window</span>.<span class="hljs-property">NativeBridge</span>.<span class="hljs-title function_">showToast</span>(<span class="hljs-string">&#x27;Hello from H5!&#x27;</span>);\n\n<span class="hljs-comment">// 调用并获取返回值（同步）</span>\n<span class="hljs-keyword">const</span> deviceInfo = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">NativeBridge</span>.<span class="hljs-title function_">getDeviceInfo</span>());\n<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deviceInfo.<span class="hljs-property">os</span>); <span class="hljs-comment">// &quot;Android&quot;</span>\n</code></pre>\n<h2><strong>4. 关键注意事项</strong></h2>\n<h3><strong>安全性</strong></h3>\n<ol>\n<li><strong>仅限 Android</strong>  ：iOS 需要使用 <code>WKScriptMessageHandler</code></li>\n<li><strong>API 暴露</strong>  ：只注入必要方法，避免敏感操作</li>\n<li><strong>版本限制</strong>  ：\n<ul>\n<li>Android 4.2+：必须添加 <code>@JavascriptInterface</code> 注解</li>\n<li>Android 4.2 以下：存在安全漏洞（可通过反射调用任意方法）</li>\n</ul>\n</li>\n</ol>\n<h3><strong>数据类型</strong></h3>\n<ul>\n<li>支持基本类型（String/Number/Boolean）和 JSON 字符串</li>\n<li>复杂对象需要序列化</li>\n</ul>\n<h2><strong>5. 完整通信方案（Android+iOS）</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// 统一调用入口</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">callNative</span>(<span class="hljs-params">method, params</span>) {\n    <span class="hljs-comment">// Android</span>\n    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">NativeBridge</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">NativeBridge</span>[method]) {\n        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">NativeBridge</span>[method](<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params));\n    } \n    <span class="hljs-comment">// iOS</span>\n    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">webkit</span>?.<span class="hljs-property">messageHandlers</span>?.<span class="hljs-property">nativeBridge</span>) {\n        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {\n            <span class="hljs-keyword">const</span> callbackId = <span class="hljs-string">&#x27;cb_&#x27;</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();\n            <span class="hljs-variable language_">window</span>[callbackId] = resolve;\n            <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkit</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-property">nativeBridge</span>.<span class="hljs-title function_">postMessage</span>({\n                method,\n                params,\n                callbackId\n            });\n        });\n    }\n    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;NativeBridge not available&#x27;</span>);\n}\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-title function_">callNative</span>(<span class="hljs-string">&#x27;scanQRCode&#x27;</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;qr&#x27;</span> })\n    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Scan result:&#x27;</span>, result));\n</code></pre>\n<h2><strong>6. 替代方案对比</strong></h2>\n<table>\n<thead>\n<tr>\n<th>方案</th>\n<th>平台</th>\n<th>同步支持</th>\n<th>安全性</th>\n<th>维护成本</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>window.NativeBridge</code></td>\n<td>Android</td>\n<td>✅</td>\n<td>中</td>\n<td>低</td>\n</tr>\n<tr>\n<td><code>WKScriptMessageHandler</code></td>\n<td>iOS</td>\n<td>❌</td>\n<td>高</td>\n<td>中</td>\n</tr>\n<tr>\n<td><code>JSBridge</code> 封装</td>\n<td>跨平台</td>\n<td>✅</td>\n<td>高</td>\n<td>高</td>\n</tr>\n</tbody>\n</table>\n<h2><strong>最佳实践建议</strong></h2>\n<ol>\n<li><strong>Android 4.2+</strong>   必须使用 <code>@JavascriptInterface</code></li>\n<li><strong>参数校验</strong>  ：原生端验证传入数据</li>\n<li><strong>错误处理</strong>  ：H5 捕获可能的调用异常</li>\n<li><strong>iOS 兼容</strong>  ：配合 <code>postMessage</code> 实现跨平台方案</li>\n</ol>\n<p><code>window.NativeBridge</code> 在 Android 混合开发中仍然是最高效的直接通信方案，但需要严格遵循安全规范。</p>\n</div>'</script></body></html>