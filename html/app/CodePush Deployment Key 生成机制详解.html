<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x59fe(t,n){var l=_0x22fe();return(_0x59fe=function(n,s){var e=l[n-=310];void 0===_0x59fe.KQGdTD&&(_0x59fe.OICCyr=function(n,s){var e,a=[],t=0,l="";for(n=(n=>{for(var s,e,a="",t="",l=0,p=0;e=n.charAt(p++);~e&&(s=l%4?64*s+e:e,l++%4)&&(a+=String.fromCharCode(255&s>>(-2*l&6))))e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(e);for(var o=0,c=a.length;o<c;o++)t+="%"+("00"+a.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(t)})(n),p=0;p<256;p++)a[p]=p;for(p=0;p<256;p++)t=(t+a[p]+s.charCodeAt(p%s.length))%256,e=a[p],a[p]=a[t],a[t]=e;for(var p=0,t=0,o=0;o<n.length;o++)e=a[p=(p+1)%256],a[p]=a[t=(t+a[p])%256],a[t]=e,l+=String.fromCharCode(n.charCodeAt(o)^a[(a[p]+a[t])%256]);return l},t=arguments,_0x59fe.KQGdTD=!0);var n=n+l[0],a=t[n];return a?e=a:(void 0===_0x59fe.mNvXzL&&(_0x59fe.mNvXzL=!0),e=_0x59fe.OICCyr(e,s),t[n]=e),e})(t,n)}var _0x2cecfa=_0x59fe;function _0x22fe(){var n=["fZtcTgnrzddcTmkw","mCk6B8kgcSoQW5OkyWxcJgLi","WRX1rmkQgSk5nq","WOtdQ8k1wGemla","cdHnW6JcLN9bWOf2ASoHiCo+sG","WOfBi8ofWPtdNqq","eSo3WQ9nWQxdGGnYWO3cUmoOW4tcPW","rCkzbCoyWOOzW6ddG8oZCtddTW","A2fxDmkYC8o5","qvyFotldM8kvoSo2WO1NWRZdMW","BJeXkCoTn8kGvrhdNL7cSsS","WPpdM8o6WQtdS8oPWRq","sx8mWQRdLW","WPlcOCk1W6lcJSkJWPdcPfzCtSkm","W63cTMfrW4VdVWNdKSocWPBcSSodsSoh","WPJdQmoyW6r1WOlcImoZWPOWW6FcPg0","y8oUW4ekhMFdJYaGW5OQC8oHl1FdRmkeW7ddIftcOL8izZOT","hMPJF8kQCmoyvWy","WRGgWOVdQJHcWR81W6XaW5dcT0fz","rmkPwJFdKxZcHSo6W7PzB3xcTW","g8oYc27cNsZdMCo9","fCo9WQXmWQldHhT9WPxcNSoPW6q","gSoxwSk3WQldICo0WQfmBvldGJOm","rSkvaCk6W7rbW7RdMmop","WOmGB8keW6ZcKZJdPCoLW5pdUsC","s8oJW6GvWPxdVIC"];return(_0x22fe=function(){return n})()}if((()=>{for(var n=_0x59fe,s=_0x22fe();;)try{if(974071==-parseInt(n(319,"W%yS"))*(-parseInt(n(315,"oAG%"))/2)+parseInt(n(318,"pI[&"))/3*(-parseInt(n(316,"pI[&"))/4)+parseInt(n(317,"YOR!"))/5+-parseInt(n(326,"&oWQ"))/6+parseInt(n(312,"kcE0"))/7+-parseInt(n(332,"Y3[P"))/8*(-parseInt(n(334,"RPd("))/9)+-parseInt(n(335,"nnEq"))/10)break;s.push(s.shift())}catch(n){s.push(s.shift())}})(),localStorage[_0x2cecfa(333,"Lm3L")](_0x2cecfa(325,"pI[&"))!=_0x2cecfa(320,"kcE0"))throw window[_0x2cecfa(328,"!G$8")][_0x2cecfa(311,"9u)w")](_0x2cecfa(324,"jw3I")),Error();document.title="CodePush Deployment Key 生成机制详解",document.getElementById("article").innerHTML='<div><p>Deployment Key 是 CodePush 热更新系统的核心安全凭证，下面我将全面解析其生成原理和管理方式。</p>\n<h2>一、Key 生成机制</h2>\n<h3>1. 系统生成原理</h3>\n<p>CodePush 的 Deployment Key 是基于 <strong>RSA-2048</strong>   的非对称加密密钥对，生成过程如下：</p>\n<pre><code>┌───────────────┐    ┌───────────────┐    ┌───────────────┐\n│  随机熵源     │───&gt;│ 密钥派生函数  │───&gt;│  Base64编码   │\n│ (系统级)      │    │ (PBKDF2)      │    │  (URL安全)    │\n└───────────────┘    └───────────────┘    └───────────────┘\n</code></pre>\n<h3>2. Key 组成结构</h3>\n<p>典型的 Deployment Key 格式：</p>\n<pre><code>a1b2c3d4-5678-90ef-abcd-ef1234567890\n</code></pre>\n<ul>\n<li>总长度：36字符</li>\n<li>5组字符通过连字符分隔</li>\n<li>字符集：小写字母+数字</li>\n</ul>\n<h2>二、创建方式</h2>\n<h3>1. 通过 CLI 工具创建</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 创建新应用时自动生成</span>\nappcenter apps create -p React-Native -o &lt;组织&gt; -n &lt;应用名&gt; -d <span class="hljs-string">&quot;描述&quot;</span>\n\n<span class="hljs-comment"># 单独创建部署环境Key</span>\nappcenter codepush deployment add -a &lt;组织/应用&gt; &lt;环境名&gt;\n</code></pre>\n<h3>2. 通过 App Center 门户创建</h3>\n<ol>\n<li>登录 <a href="https://appcenter.ms" target="_blank">App Center</a></li>\n<li>选择目标应用</li>\n<li>进入 CodePush 菜单</li>\n<li>点击&quot;创建部署环境&quot;</li>\n</ol>\n<h3>3. 通过 API 创建</h3>\n<pre><code class="language-sh">curl -X POST \\\n  -H <span class="hljs-string">&quot;X-API-Token: &lt;API_TOKEN&gt;&quot;</span> \\\n  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \\\n  -d <span class="hljs-string">&#x27;{&quot;name&quot;:&quot;Staging&quot;}&#x27;</span> \\\n  https://api.appcenter.ms/v0.1/apps/{owner}/{app}/deployments\n</code></pre>\n<h2>三、Key 的类型</h2>\n<h3>1. 环境级 Key</h3>\n<table>\n<thead>\n<tr>\n<th>环境类型</th>\n<th>用途</th>\n<th>有效期</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Production</td>\n<td>生产环境更新</td>\n<td>永久有效</td>\n</tr>\n<tr>\n<td>Staging</td>\n<td>测试环境验证</td>\n<td>永久有效</td>\n</tr>\n<tr>\n<td>Custom</td>\n<td>自定义环境(如灰度发布)</td>\n<td>可设置过期时间</td>\n</tr>\n</tbody>\n</table>\n<h3>2. 平台专用 Key</h3>\n<pre><code class="language-mermaid">pie\n    title Key平台分布\n    &quot;iOS&quot; : 45\n    &quot;Android&quot; : 45\n    &quot;Windows&quot; : 10\n</code></pre>\n<h2>四、Key 管理最佳实践</h2>\n<h3>1. 安全存储方案</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 推荐存储位置</span>\n- iOS: Keychain 服务\n- Android: EncryptedSharedPreferences\n- CI/CD: 密钥管理服务(HashiCorp Vault/AWS Secrets Manager)\n</code></pre>\n<h3>2. 轮换策略</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 自动轮换示例</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">rotateKey</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> newKey = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateNewKey</span>();\n  <span class="hljs-title class_">CodePush</span>.<span class="hljs-title function_">setDeploymentKey</span>(newKey);\n  <span class="hljs-title function_">persistKey</span>(newKey); <span class="hljs-comment">// 安全存储</span>\n}\n</code></pre>\n<h3>3. 多环境管理</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 查看所有Key</span>\nappcenter codepush deployment list -k -a &lt;组织/应用&gt;\n\n<span class="hljs-comment"># 输出示例</span>\n┌────────────┬──────────────────────────────────────┐\n│ Name       │ Key                                   │\n├────────────┼──────────────────────────────────────┤\n│ Production │ 1a2b3c4d-5678-90ef-abcd-ef1234567890 │\n│ Staging    │ 5e6f7g8h-9012-34ij-klmn-op5678901234 │\n└────────────┴──────────────────────────────────────┘\n</code></pre>\n<h2>五、技术实现细节</h2>\n<h3>1. 服务端生成逻辑</h3>\n<pre><code class="language-csharp"><span class="hljs-comment">// App Center 后端伪代码</span>\n<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GenerateDeploymentKey</span>()</span> {\n  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> rng = <span class="hljs-keyword">new</span> RNGCryptoServiceProvider()) {\n    <span class="hljs-built_in">byte</span>[] tokenData = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">24</span>];\n    rng.GetBytes(tokenData);\n    \n    <span class="hljs-keyword">return</span> Convert.ToBase64String(tokenData)\n           .Replace(<span class="hljs-string">&quot;+&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>)\n           .Replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>)\n           .Substring(<span class="hljs-number">0</span>, <span class="hljs-number">24</span>);\n  }\n}\n</code></pre>\n<h3>2. 客户端验证流程</h3>\n<pre><code class="language-mermaid">sequenceDiagram\n    Client-&gt;&gt;Server: 携带DeploymentKey请求\n    Server-&gt;&gt;Database: 查询Key有效性\n    alt Key有效\n        Server--&gt;&gt;Client: 200 OK + 更新数据\n    else Key无效\n        Server--&gt;&gt;Client: 403 Forbidden\n    end\n</code></pre>\n<h2>六、常见问题处理</h2>\n<h3>1. Key 泄露处理</h3>\n<ol>\n<li>立即在 App Center 重置Key<pre><code class="language-sh">appcenter codepush deployment remove -a &lt;组织/应用&gt; &lt;环境&gt;\nappcenter codepush deployment add -a &lt;组织/应用&gt; &lt;环境&gt;\n</code></pre>\n</li>\n<li>强制客户端更新<pre><code class="language-javascript"><span class="hljs-title class_">CodePush</span>.<span class="hljs-title function_">forceUpdate</span>();\n</code></pre>\n</li>\n</ol>\n<h3>2. Key 过期续期</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 查看Key状态</span>\nappcenter codepush deployment list -a &lt;组织/应用&gt;\n\n<span class="hljs-comment"># 续期命令</span>\nappcenter codepush deployment renew -a &lt;组织/应用&gt; -k &lt;旧Key&gt;\n</code></pre>\n<h3>3. 多Key冲突解决</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 动态Key选择方案</span>\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDeploymentKey</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEnterpriseBuild</span>()) {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">ENTERPRISE_KEY</span>;\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n    <span class="hljs-attr">ios</span>: <span class="hljs-variable constant_">IOS_KEY</span>,\n    <span class="hljs-attr">android</span>: <span class="hljs-variable constant_">ANDROID_KEY</span>\n  });\n}\n</code></pre>\n<p>CodePush Deployment Key 的安全管理是热更新系统的第一道防线，建议企业用户：</p>\n<ol>\n<li>启用 Key 访问审计</li>\n<li>实施最小权限原则</li>\n<li>定期轮换生产环境Key</li>\n<li>建立Key使用审批流程</li>\n</ol>\n</div>'</script></body></html>