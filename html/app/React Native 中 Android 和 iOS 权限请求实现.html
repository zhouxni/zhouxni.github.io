<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x65fb52=_0x3afd;function _0x3afd(p,s){var t=_0x3cc2();return(_0x3afd=function(s,a){var n=t[s-=254];void 0===_0x3afd.qQmDqu&&(_0x3afd.ViRIEt=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var r=0,e=l.length;r<e;r++)p+="%"+("00"+l.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,r=0;r<s.length;r++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(r)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x3afd.qQmDqu=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x3afd.tnJgbe&&(_0x3afd.tnJgbe=!0),n=_0x3afd.ViRIEt(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x3afd,a=_0x3cc2();;)try{if(149846==+parseInt(s(254,"i#9h"))+parseInt(s(269,"9^iv"))/2+parseInt(s(275,"p^j@"))/3+parseInt(s(263,"k!60"))/4+-parseInt(s(255,"v9TQ"))/5+-parseInt(s(259,"o*k@"))/6*(-parseInt(s(266,"xFUp"))/7)+-parseInt(s(261,"Xog2"))/8)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x65fb52(256,"6Iy6")](_0x65fb52(267,"7B$["))!=_0x65fb52(273,"i^4h"))throw window[_0x65fb52(258,"bJ2!")][_0x65fb52(274,"AsFC")](_0x65fb52(268,"o*k@")),Error();function _0x3cc2(){var s=["c8k0W6FcOdSkz8k0x8oOFHLSWQZdLmksWQpdHaJcMSkTWPjWWOHiCa","WOBcNmkaW7XpWRRcMJJcNSo9pa","WORdMgZcOvnQW5NdOLVdQSoDfq","W5pcJ8kjW4bqECk2WO8TW4lcVW","WRn1W4xcQZvzWPFdPaZdHX8","WOnIWOhcTmo3","W6rLWQNdUci4WO4","W4BdMmoOySkofSo3jmkqqYa","WQtcVGG6tCkECCoIyCkNW7u","W6CJmmoRWOtdV8oxkmk+k8kC","fZ8zW7RdJmokda","wqykhmkgW5m5WQ4","W5FdJG47WQe4rSkW","v8o4WQpdO35Aa8obAmoHzq","DfZcSH9fraJcI8kkt8ko","W60vaKdcM1xdIWVdMmoOW6TndW","WR8cDwRcVSkxoCowySo8aG","WQ3cT8k2W6JdTJRdQCkFWPPepHW","ymoiWRhdVmo0Bd8JeZFcUa","DLVcSbfmh3VcLmkREmkNWR7cGG","W4FcJ8kSxSoaWPdcPGe","W4yUWPBdVxbaWPFdMZG"];return(_0x3cc2=function(){return s})()}document.title="React Native 中 Android 和 iOS 权限请求实现",document.getElementById("article").innerHTML='<div><p>在 React Native 中处理 Android 和 iOS 的权限请求有一些重要区别。下面我将详细介绍两个平台的权限请求方法。</p>\n<h2>Android 权限请求</h2>\n<h3>1. 基本权限请求方法</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PermissionsAndroid</span>, <span class="hljs-title class_">Platform</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestCameraPermission</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> !== <span class="hljs-string">&#x27;android&#x27;</span>) <span class="hljs-keyword">return</span>;\n  \n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> granted = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-title function_">request</span>(\n      <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">CAMERA</span>,\n      {\n        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;相机权限请求&#x27;</span>,\n        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;应用需要使用相机功能&#x27;</span>,\n        <span class="hljs-attr">buttonPositive</span>: <span class="hljs-string">&#x27;同意&#x27;</span>,\n        <span class="hljs-attr">buttonNegative</span>: <span class="hljs-string">&#x27;拒绝&#x27;</span>,\n      }\n    );\n    \n    <span class="hljs-keyword">if</span> (granted === <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">RESULTS</span>.<span class="hljs-property">GRANTED</span>) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;相机权限已授予&#x27;</span>);\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;相机权限被拒绝&#x27;</span>);\n    }\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(err);\n  }\n}\n</code></pre>\n<h3>2. 常用 Android 权限</h3>\n<pre><code class="language-javascript"><span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">READ_EXTERNAL_STORAGE</span>\n<span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">WRITE_EXTERNAL_STORAGE</span>\n<span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">CAMERA</span>\n<span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">RECORD_AUDIO</span>\n<span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">ACCESS_FINE_LOCATION</span>\n<span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">ACCESS_COARSE_LOCATION</span>\n</code></pre>\n<h3>3. 检查是否已有权限</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPermission</span>(<span class="hljs-params">permission</span>) {\n  <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-title function_">check</span>(permission);\n  <span class="hljs-keyword">return</span> hasPermission;\n}\n</code></pre>\n<h2>iOS 权限请求</h2>\n<h3>1. 使用 react-native-permissions 库</h3>\n<p>由于 iOS 权限系统复杂，推荐使用 <code>react-native-permissions</code> 库：</p>\n<pre><code class="language-sh">npm install react-native-permissions\n<span class="hljs-comment"># 或</span>\nyarn add react-native-permissions\n\n<span class="hljs-comment"># 对于 RN &gt;= 0.60 自动链接</span>\n<span class="hljs-comment"># 对于 RN &lt; 0.60 需要运行 react-native link</span>\n</code></pre>\n<h3>2. iOS 权限请求示例</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { check, request, <span class="hljs-variable constant_">PERMISSIONS</span>, <span class="hljs-variable constant_">RESULTS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-permissions&#x27;</span>;\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestCameraPermission</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> !== <span class="hljs-string">&#x27;ios&#x27;</span>) <span class="hljs-keyword">return</span>;\n  \n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> status = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(<span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">CAMERA</span>);\n    \n    <span class="hljs-keyword">switch</span> (status) {\n      <span class="hljs-keyword">case</span> <span class="hljs-variable constant_">RESULTS</span>.<span class="hljs-property">GRANTED</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;相机权限已授予&#x27;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-keyword">case</span> <span class="hljs-variable constant_">RESULTS</span>.<span class="hljs-property">DENIED</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;用户拒绝了权限请求&#x27;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-keyword">case</span> <span class="hljs-variable constant_">RESULTS</span>.<span class="hljs-property">BLOCKED</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;用户拒绝了权限请求且不再询问&#x27;</span>);\n        <span class="hljs-keyword">break</span>;\n      <span class="hljs-keyword">case</span> <span class="hljs-variable constant_">RESULTS</span>.<span class="hljs-property">UNAVAILABLE</span>:\n        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;此设备不支持此权限&#x27;</span>);\n        <span class="hljs-keyword">break</span>;\n    }\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(err);\n  }\n}\n</code></pre>\n<h3>3. 常用 iOS 权限</h3>\n<pre><code class="language-javascript"><span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">CAMERA</span>\n<span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">PHOTO_LIBRARY</span>\n<span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">LOCATION_WHEN_IN_USE</span>\n<span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">MICROPHONE</span>\n<span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">CONTACTS</span>\n</code></pre>\n<h2>跨平台权限请求实现</h2>\n<h3>1. 统一权限处理函数</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PermissionsAndroid</span>, <span class="hljs-title class_">Platform</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n<span class="hljs-keyword">import</span> { check, request, <span class="hljs-variable constant_">PERMISSIONS</span>, <span class="hljs-variable constant_">RESULTS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-permissions&#x27;</span>;\n\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestPermission</span>(<span class="hljs-params">permission</span>) {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> granted = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-title function_">request</span>(permission.<span class="hljs-property">android</span>);\n      <span class="hljs-keyword">return</span> granted === <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">RESULTS</span>.<span class="hljs-property">GRANTED</span>;\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(err);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n    }\n  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;ios&#x27;</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> status = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(permission.<span class="hljs-property">ios</span>);\n      <span class="hljs-keyword">return</span> status === <span class="hljs-variable constant_">RESULTS</span>.<span class="hljs-property">GRANTED</span>;\n    } <span class="hljs-keyword">catch</span> (err) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(err);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n    }\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n}\n\n<span class="hljs-comment">// 权限定义</span>\n<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PERMISSIONS_LIST</span> = {\n  <span class="hljs-attr">camera</span>: {\n    <span class="hljs-attr">android</span>: <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">CAMERA</span>,\n    <span class="hljs-attr">ios</span>: <span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">CAMERA</span>,\n  },\n  <span class="hljs-attr">storage</span>: {\n    <span class="hljs-attr">android</span>: <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">WRITE_EXTERNAL_STORAGE</span>,\n    <span class="hljs-attr">ios</span>: <span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">PHOTO_LIBRARY</span>,\n  },\n  <span class="hljs-attr">location</span>: {\n    <span class="hljs-attr">android</span>: <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">ACCESS_FINE_LOCATION</span>,\n    <span class="hljs-attr">ios</span>: <span class="hljs-variable constant_">PERMISSIONS</span>.<span class="hljs-property">IOS</span>.<span class="hljs-property">LOCATION_WHEN_IN_USE</span>,\n  },\n};\n\n<span class="hljs-comment">// 使用示例</span>\n<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">takePhoto</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestPermission</span>(<span class="hljs-variable constant_">PERMISSIONS_LIST</span>.<span class="hljs-property">camera</span>);\n  <span class="hljs-keyword">if</span> (hasPermission) {\n    <span class="hljs-comment">// 拍照逻辑</span>\n  } <span class="hljs-keyword">else</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;权限被拒绝&#x27;</span>);\n  }\n}\n</code></pre>\n<h3>2. 权限请求最佳实践</h3>\n<ol>\n<li><strong>按需请求</strong>  ：在需要使用功能时才请求权限</li>\n<li><strong>解释原因</strong>  ：向用户说明为什么需要权限</li>\n<li><strong>处理拒绝</strong>  ：提供备选方案或引导用户去设置中开启权限</li>\n<li><strong>检查当前状态</strong>  ：请求前先检查是否已有权限</li>\n</ol>\n<h3>3. 引导用户去设置</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Linking</span>, <span class="hljs-title class_">Alert</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">openSettings</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-title class_">Linking</span>.<span class="hljs-title function_">openSettings</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {\n    <span class="hljs-title class_">Alert</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;无法打开设置&#x27;</span>);\n  });\n}\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">showPermissionDeniedAlert</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-title class_">Alert</span>.<span class="hljs-title function_">alert</span>(\n    <span class="hljs-string">&#x27;权限被拒绝&#x27;</span>,\n    <span class="hljs-string">&#x27;需要权限才能使用此功能，是否去设置中开启？&#x27;</span>,\n    [\n      { <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;取消&#x27;</span>, <span class="hljs-attr">style</span>: <span class="hljs-string">&#x27;cancel&#x27;</span> },\n      { <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;去设置&#x27;</span>, <span class="hljs-attr">onPress</span>: openSettings },\n    ]\n  );\n}\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li><strong>Android</strong>  ：\n<ul>\n<li>在 <code>AndroidManifest.xml</code> 中声明需要的权限</li>\n<li>Android 6.0+ 需要运行时请求危险权限</li>\n<li>某些权限被拒绝后会抛出异常</li>\n</ul>\n</li>\n<li><strong>iOS</strong>  ：\n<ul>\n<li>在 <code>Info.plist</code> 中添加权限描述</li>\n<li>需要提供使用权限的原因（会显示给用户）</li>\n<li>某些权限只能请求一次，用户拒绝后需要引导去设置</li>\n</ul>\n</li>\n<li><strong>iOS 权限描述示例</strong>  （Info.plist）：<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSCameraUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>需要相机权限来拍照<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>需要相册权限来保存图片<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSLocationWhenInUseUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>需要位置权限来提供附近服务<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>\n</code></pre>\n</li>\n</ol>\n<p>通过以上方法，你可以在 React Native 应用中正确处理 Android 和 iOS 的权限请求，确保应用功能能够正常使用。</p>\n</div>'</script></body></html>