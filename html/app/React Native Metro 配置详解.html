<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x3ad2(){var s=["nxdcTYu8W7RcLIXy","WR3cJedcJmk4W6hcMeCGFq","rLyyqmkDDbVdHW","u8omW49zW6tcTSkgnYRdU8kedCki","W4JdJJyeW7u1agpdK8kxwmo3W5WTW5XkftpcKmkSBaKoW4/cLaq","W7DSsIXOW6pcV8k+W7iTnalcKW","FWhdL8kyrNxdIhLrAa","eSknWO0FWQS","WO4GeGpcNCkrWOirW6eEcSkpeG","WQnGWQhcT8o6hNXyWQ1uWOZdImkh","W7xdO8okuvaRWRq","WOxdIZHxW7pdQHreESo2WR4o","tSkxcmkTivtdUW","WO3dKX8FW5O5W4z1","mSkDxCkmoSkOW6RdOWNcSXu8aq","iWhdQgKpwHKdjmk7W78","WQaBWPNdLeOnWQ4I","W4POhmoHWPtcN8kDW4FdV8kPW6G8WQ4","W68jgSkFFJBcVSkLrCo4l8oEFG","WPlcHNxcRI7cLSkp","WO4NfG7cMConW5KaW5Kfbq","WOFcSrhcIHunWRy","FMtdQtRcS3meWOK9W6nkqW","W4THs8orBSoyBCkRWOldU2ZdK8o0"];return(_0x3ad2=function(){return s})()}function _0x5b4f(e,s){var r=_0x3ad2();return(_0x5b4f=function(s,n){var t=r[s-=231];void 0===_0x5b4f.QwIvgP&&(_0x5b4f.ewVlDD=function(s,n){var t,a=[],e=0,r="";for(s=(s=>{for(var n,t,a="",e="",r=0,l=0;t=s.charAt(l++);~t&&(n=r%4?64*n+t:t,r++%4)&&(a+=String.fromCharCode(255&n>>(-2*r&6))))t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var o=0,c=a.length;o<c;o++)e+="%"+("00"+a.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(e)})(s),l=0;l<256;l++)a[l]=l;for(l=0;l<256;l++)e=(e+a[l]+n.charCodeAt(l%n.length))%256,t=a[l],a[l]=a[e],a[e]=t;for(var l=0,e=0,o=0;o<s.length;o++)t=a[l=(l+1)%256],a[l]=a[e=(e+a[l])%256],a[e]=t,r+=String.fromCharCode(s.charCodeAt(o)^a[(a[l]+a[e])%256]);return r},e=arguments,_0x5b4f.QwIvgP=!0);var s=s+r[0],a=e[s];return a?t=a:(void 0===_0x5b4f.EpBgut&&(_0x5b4f.EpBgut=!0),t=_0x5b4f.ewVlDD(t,n),e[s]=t),t})(e,s)}var _0x3d62bc=_0x5b4f;if((()=>{for(var s=_0x5b4f,n=_0x3ad2();;)try{if(509285==-parseInt(s(231,"yF#X"))+parseInt(s(240,"[TbE"))/2+parseInt(s(238,"AZ)k"))/3+parseInt(s(252,"[TbE"))/4+-parseInt(s(243,"UdT1"))/5+parseInt(s(236,"VEG)"))/6*(parseInt(s(250,"3*2H"))/7)+parseInt(s(249,"ovsy"))/8*(parseInt(s(241,"prQU"))/9))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x3d62bc(239,"K&E%")](_0x3d62bc(244,"drG2"))!=_0x3d62bc(251,"QhEp"))throw window[_0x3d62bc(233,"VL4S")][_0x3d62bc(254,"6#pl")](_0x3d62bc(248,"@J&%")),Error();document.title="React Native Metro 配置详解",document.getElementById("article").innerHTML='<div><p>Metro 是 React Native 的默认 JavaScript 打包工具，负责代码转换、依赖解析和打包优化。以下是 Metro 配置的全面解析，涵盖核心配置项、高级用法和性能优化技巧。</p>\n<hr>\n<h2><strong>1. Metro 核心概念</strong></h2>\n<h3><strong>(1) 三大核心模块</strong></h3>\n<table>\n<thead>\n<tr>\n<th>模块</th>\n<th>作用</th>\n<th>配置文件对应项</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Transformer</strong></td>\n<td>代码转换（Babel）</td>\n<td><code>transformer</code></td>\n</tr>\n<tr>\n<td><strong>Resolver</strong></td>\n<td>依赖解析（<code>import</code>/<code>require</code>）</td>\n<td><code>resolver</code></td>\n</tr>\n<tr>\n<td><strong>Serializer</strong></td>\n<td>打包输出（Bundle 生成）</td>\n<td><code>serializer</code></td>\n</tr>\n</tbody>\n</table>\n<h3><strong>(2) 配置文件优先级</strong></h3>\n<ol>\n<li>项目根目录的 <code>metro.config.js</code>（优先级最高）</li>\n<li><code>node_modules/metro-config/src/defaults.js</code>（默认配置）</li>\n</ol>\n<hr>\n<h2><strong>2. 基础配置模板</strong></h2>\n<pre><code class="language-javascript"><span class="hljs-comment">// metro.config.js</span>\n<span class="hljs-keyword">const</span> { getDefaultConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;metro-config&#x27;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = (<span class="hljs-title function_">async</span> () =&gt; {\n  <span class="hljs-keyword">const</span> {\n    <span class="hljs-attr">resolver</span>: { sourceExts, assetExts },\n  } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDefaultConfig</span>();\n\n  <span class="hljs-keyword">return</span> {\n    <span class="hljs-attr">transformer</span>: {\n      <span class="hljs-comment">// Babel 转换配置</span>\n      <span class="hljs-attr">babelTransformerPath</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;custom-transformer&#x27;</span>),\n      <span class="hljs-attr">getTransformOptions</span>: <span class="hljs-title function_">async</span> () =&gt; ({\n        <span class="hljs-attr">transform</span>: {\n          <span class="hljs-attr">experimentalImportSupport</span>: <span class="hljs-literal">false</span>,\n          <span class="hljs-attr">inlineRequires</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 关键优化项</span>\n        },\n      }),\n    },\n    <span class="hljs-attr">resolver</span>: {\n      <span class="hljs-comment">// 依赖解析配置</span>\n      <span class="hljs-attr">assetExts</span>: [...assetExts, <span class="hljs-string">&#x27;md&#x27;</span>, <span class="hljs-string">&#x27;txt&#x27;</span>], <span class="hljs-comment">// 扩展静态资源类型</span>\n      <span class="hljs-attr">sourceExts</span>: [...sourceExts, <span class="hljs-string">&#x27;svg&#x27;</span>, <span class="hljs-string">&#x27;cjs&#x27;</span>], <span class="hljs-comment">// 支持更多源码格式</span>\n      <span class="hljs-attr">extraNodeModules</span>: {\n        <span class="hljs-comment">// 路径别名（Alias）</span>\n        <span class="hljs-string">&#x27;@&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src&#x27;</span>),\n      },\n    },\n    <span class="hljs-attr">serializer</span>: {\n      <span class="hljs-comment">// 打包输出配置</span>\n      <span class="hljs-attr">experimentalSerializerHook</span>: <span class="hljs-function">() =&gt;</span> {},\n    },\n  };\n})();\n</code></pre>\n<hr>\n<h2><strong>3. Transformer 配置详解</strong></h2>\n<h3><strong>(1) 核心配置项</strong></h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>类型</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>babelTransformerPath</code></td>\n<td><code>string</code></td>\n<td>自定义 Babel 转换器</td>\n<td><code>require.resolve(\'react-native-svg-transformer\')</code></td>\n</tr>\n<tr>\n<td><code>getTransformOptions</code></td>\n<td><code>function</code></td>\n<td>控制 Babel 转换行为</td>\n<td><code>inlineRequires: true</code></td>\n</tr>\n<tr>\n<td><code>minifierPath</code></td>\n<td><code>string</code></td>\n<td>替换默认代码压缩工具</td>\n<td><code>require.resolve(\'metro-minify-terser\')</code></td>\n</tr>\n</tbody>\n</table>\n<h3><strong>(2) 关键优化：<code>inlineRequires</code></strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">transformer</span>: {\n  <span class="hljs-attr">getTransformOptions</span>: <span class="hljs-title function_">async</span> () =&gt; ({\n    <span class="hljs-attr">transform</span>: {\n      <span class="hljs-attr">inlineRequires</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 将 require() 内联，提升启动速度</span>\n    },\n  }),\n}\n</code></pre>\n<ul>\n<li><strong>效果</strong>  ：Facebook 实测可减少 20% 启动时间</li>\n<li><strong>限制</strong>  ：需确保代码无循环依赖</li>\n</ul>\n<h3><strong>(3) 自定义转换器示例（SVG 支持）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">transformer</span>: {\n  <span class="hljs-attr">babelTransformerPath</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;react-native-svg-transformer&#x27;</span>),\n}\n</code></pre>\n<hr>\n<h2><strong>4. Resolver 配置详解</strong></h2>\n<h3><strong>(1) 核心配置项</strong></h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>类型</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sourceExts</code></td>\n<td><code>string[]</code></td>\n<td>支持的源码扩展名</td>\n<td><code>[\'js\', \'jsx\', \'ts\', \'tsx\']</code></td>\n</tr>\n<tr>\n<td><code>assetExts</code></td>\n<td><code>string[]</code></td>\n<td>静态资源扩展名</td>\n<td><code>[\'png\', \'jpg\', \'ttf\']</code></td>\n</tr>\n<tr>\n<td><code>extraNodeModules</code></td>\n<td><code>object</code></td>\n<td>路径别名（Alias）</td>\n<td><code>{ \'@utils\': \'./src/utils\' }</code></td>\n</tr>\n<tr>\n<td><code>nodeModulesPaths</code></td>\n<td><code>string[]</code></td>\n<td>自定义 <code>node_modules</code> 查找路径</td>\n<td><code>[\'./shared/node_modules\']</code></td>\n</tr>\n</tbody>\n</table>\n<h3><strong>(2) 路径别名（Alias）最佳实践</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">resolver</span>: {\n  <span class="hljs-attr">extraNodeModules</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(\n    {},\n    {\n      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, name</span>) =&gt;</span> path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`src/<span class="hljs-subst">${name}</span>`</span>),\n    }\n  ),\n}\n</code></pre>\n<ul>\n<li><strong>使用方式</strong>  ：<code>import Button from \'@/components/Button\'</code></li>\n</ul>\n<h3><strong>(3) 排除特定文件</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">resolver</span>: {\n  <span class="hljs-attr">blacklistRE</span>: <span class="hljs-regexp">/\\.spec\\.js$/</span>, <span class="hljs-comment">// 忽略测试文件</span>\n  <span class="hljs-attr">blockList</span>: [<span class="hljs-regexp">/node_modules\\/some-package/</span>], <span class="hljs-comment">// 排除特定依赖</span>\n}\n</code></pre>\n<hr>\n<h2><strong>5. Serializer 配置详解</strong></h2>\n<h3><strong>(1) 核心配置项</strong></h3>\n<table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>类型</th>\n<th>作用</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>experimentalSerializerHook</code></td>\n<td><code>function</code></td>\n<td>自定义打包逻辑</td>\n<td>用于 Code Push 差分更新</td>\n</tr>\n<tr>\n<td><code>polyfillModuleNames</code></td>\n<td><code>string[]</code></td>\n<td>强制注入 Polyfill</td>\n<td><code>[\'core-js/stable\']</code></td>\n</tr>\n<tr>\n<td><code>getModulesRunBeforeMainModule</code></td>\n<td><code>string[]</code></td>\n<td>预加载模块</td>\n<td><code>[\'react-native/Libraries/Core/InitializeCore\']</code></td>\n</tr>\n</tbody>\n</table>\n<h3><strong>(2) RAM Bundle 配置（iOS 专属优化）</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">serializer</span>: {\n  <span class="hljs-attr">createModuleIdFactory</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {\n    <span class="hljs-comment">// 自定义模块 ID 生成逻辑</span>\n    <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\\/src\\/(.+)/</span>)?.[<span class="hljs-number">1</span>] || path;\n  },\n}\n</code></pre>\n<ul>\n<li><strong>优势</strong>  ：按需加载模块，减少内存占用</li>\n</ul>\n<hr>\n<h2><strong>6. 高级配置技巧</strong></h2>\n<h3><strong>(1) 多环境配置</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// metro.config.js</span>\n<span class="hljs-keyword">const</span> env = process.<span class="hljs-property">env</span>.<span class="hljs-property">APP_ENV</span> || <span class="hljs-string">&#x27;development&#x27;</span>;\n\n<span class="hljs-keyword">const</span> configs = {\n  <span class="hljs-attr">development</span>: {\n    <span class="hljs-attr">transformer</span>: { <span class="hljs-attr">inlineRequires</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// 开发环境关闭优化</span>\n  },\n  <span class="hljs-attr">production</span>: {\n    <span class="hljs-attr">transformer</span>: { <span class="hljs-attr">inlineRequires</span>: <span class="hljs-literal">true</span> },\n  },\n};\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">mergeConfigs</span>(<span class="hljs-title function_">getDefaultConfig</span>(), configs[env]);\n</code></pre>\n<h3><strong>(2) 自定义缓存策略</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">FileStore</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;metro-cache&#x27;</span>);\n\n<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {\n  <span class="hljs-attr">cacheStores</span>: [\n    <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileStore</span>({\n      <span class="hljs-attr">root</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;metro-cache&#x27;</span>),\n    }),\n  ],\n};\n</code></pre>\n<h3><strong>(3) 集成 Code Push 差分更新</strong></h3>\n<pre><code class="language-javascript"><span class="hljs-attr">serializer</span>: {\n  <span class="hljs-attr">experimentalSerializerHook</span>: <span class="hljs-function">(<span class="hljs-params">entryPoint, preModules, graph, options</span>) =&gt;</span> {\n    <span class="hljs-comment">// 生成差分更新包逻辑</span>\n    <span class="hljs-keyword">return</span> <span class="hljs-title function_">standardSerializer</span>(entryPoint, preModules, graph, options);\n  },\n}\n</code></pre>\n<hr>\n<h2><strong>7. 性能优化指南</strong></h2>\n<table>\n<thead>\n<tr>\n<th>优化方向</th>\n<th>具体措施</th>\n<th>效果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>打包速度</strong></td>\n<td>增加 <code>--max-workers 4</code></td>\n<td>多核并行打包</td>\n</tr>\n<tr>\n<td><strong>启动速度</strong></td>\n<td><code>inlineRequires: true</code></td>\n<td>减少 20% 启动时间</td>\n</tr>\n<tr>\n<td><strong>内存占用</strong></td>\n<td>使用 RAM Bundle（iOS）</td>\n<td>按需加载模块</td>\n</tr>\n<tr>\n<td><strong>开发体验</strong></td>\n<td><code>watchFolders: [path.join(__dirname, \'../shared\')]</code></td>\n<td>支持 monorepo</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2><strong>8. 常见问题解决</strong></h2>\n<h3><strong>(1) <code>Unable to resolve module</code> 错误</strong></h3>\n<p><strong>解决方案</strong>  ：</p>\n<pre><code class="language-javascript"><span class="hljs-attr">resolver</span>: {\n  <span class="hljs-attr">extraNodeModules</span>: {\n    <span class="hljs-string">&#x27;react-native&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;node_modules/react-native&#x27;</span>),\n  },\n}\n</code></pre>\n<h3><strong>(2) HMR 热更新失效</strong></h3>\n<p><strong>修复命令</strong>  ：</p>\n<pre><code class="language-sh">npx react-native start --reset-cache\n</code></pre>\n<h3><strong>(3) 大型项目打包慢</strong></h3>\n<p><strong>优化方案</strong>  ：</p>\n<pre><code class="language-sh">npx react-native bundle --dev <span class="hljs-literal">false</span> --max-workers 8 --reset-cache\n</code></pre>\n<hr>\n<h2><strong>总结</strong></h2>\n<ul>\n<li><strong>核心配置</strong>  ：<code>transformer</code>（转换）、<code>resolver</code>（依赖）、<code>serializer</code>（打包）</li>\n<li><strong>关键优化</strong>  ：<code>inlineRequires</code>、RAM Bundle、路径别名</li>\n<li><strong>进阶技巧</strong>  ：多环境配置、自定义缓存、差分更新集成</li>\n</ul>\n<p>通过合理配置 Metro，可显著提升 React Native 应用的开发效率和运行时性能。建议根据项目规模选择适合的优化组合。</p>\n</div>'</script></body></html>