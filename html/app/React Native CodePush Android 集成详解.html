<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x25de34=_0x4bea;function _0x4bea(p,s){var e=_0x41ef();return(_0x4bea=function(s,n){var a=e[s-=165];void 0===_0x4bea.yhBnqT&&(_0x4bea.JkByMf=function(s,n){var a,l=[],p=0,e="";for(s=(s=>{for(var n,a,l="",p="",e=0,t=0;a=s.charAt(t++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,o=l.length;c<o;c++)p+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(p)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)p=(p+l[t]+n.charCodeAt(t%n.length))%256,a=l[t],l[t]=l[p],l[p]=a;for(var t=0,p=0,c=0;c<s.length;c++)a=l[t=(t+1)%256],l[t]=l[p=(p+l[t])%256],l[p]=a,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[t]+l[p])%256]);return e},p=arguments,_0x4bea.yhBnqT=!0);var s=s+e[0],l=p[s];return l?a=l:(void 0===_0x4bea.HzMnLS&&(_0x4bea.HzMnLS=!0),a=_0x4bea.JkByMf(a,n),p[s]=a),a})(p,s)}function _0x41ef(){var s=["m1tdK8kuwSoRW74","ivRdLSk8qJdcTa","W7pdUZJcNqdcOg4h","W7pdUhFdOxFcU0CbamoIlW","W6HfWRpcUmkzo8o0","W60nW7hdOSokySk8AdFcIafJW5S","W5nAWO/dRmoSuNC","W5/cNmohdLXdWODvWRpcPgPl","WQeObfldMCoVW5CmW4juW7WFW5u","WP7cPSobsf/dGqKguq","ogNcHSk7W7q","ESo2d2GNWQZcTSokoXeYW50","z0/dKSkZrtlcOq","lCoSaCkhj8orfwK","qYPKW4WGWOtdSJ9UW77cNcCCA8o8W49hixJdNSkMnmoaW6/cKc0","lSoVqCo+w8kgD2XpnSkaW6xcQG","cMWOWQ7dVs4ijwNdPh/dMqy","FCkXWRtcQG3cGmoP","C8kYg8kQfSowkuy","mI3cOmoQe8koW5/dIfTtaWi","WRSzW4ddVt7dTXRcM8kEhSonW4ZdHa","W5VcNSogcf5gWPftWPlcRMzH","bSovW6VcP3iqWRvFWPFcICkjoW","c2Hsk8oOngFdH8kdFHJdU8oc","os3cO8oIeColW6FdULLplq","WOHXWPSZnCk5WQPnWQ/cKColWQi"];return(_0x41ef=function(){return s})()}if((()=>{for(var s=_0x4bea,n=_0x41ef();;)try{if(288577==+parseInt(s(179,"y5Gy"))+-parseInt(s(178,")qeU"))/2*(-parseInt(s(182,"3uFH"))/3)+-parseInt(s(181,"NuFv"))/4*(-parseInt(s(165,"qNi9"))/5)+-parseInt(s(177,"rP5F"))/6+parseInt(s(188,"5Gy%"))/7+parseInt(s(171,"cyBv"))/8*(-parseInt(s(170,"o#2Y"))/9)+-parseInt(s(176,"1AAy"))/10)break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x25de34(186,"2WtX")](_0x25de34(189,"Ql(L"))!=_0x25de34(190,"RSiD"))throw window[_0x25de34(172,"qXna")][_0x25de34(166,"NuFv")](_0x25de34(168,"T]d@")),Error();document.title="React Native CodePush Android 集成详解",document.getElementById("article").innerHTML='<div><h2>一、前期准备</h2>\n<h3>1. 安装必要工具</h3>\n<pre><code class="language-sh">npm install -g code-push-cli\nnpm install react-native-code-push --save\n</code></pre>\n<h3>2. 注册CodePush应用</h3>\n<pre><code class="language-sh">code-push app add MyApp-Android android react-native\n</code></pre>\n<p>记下返回的Staging和Production环境的Deployment Key</p>\n<h2>二、Android项目配置</h2>\n<h3>1. 修改settings.gradle</h3>\n<pre><code class="language-gradle"><span class="hljs-comment">// android/settings.gradle</span>\n<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;:react-native-code-push&#x27;</span>\n<span class="hljs-keyword">project</span>(<span class="hljs-string">&#x27;:react-native-code-push&#x27;</span>).projectDir = <span class="hljs-keyword">new</span> <span class="hljs-keyword">File</span>(rootProject.projectDir, <span class="hljs-string">&#x27;../node_modules/react-native-code-push/android/app&#x27;</span>)\n</code></pre>\n<h3>2. 修改app/build.gradle</h3>\n<pre><code class="language-gradle"><span class="hljs-comment">// android/app/build.gradle</span>\napply <span class="hljs-keyword">from</span>: <span class="hljs-string">&quot;../../node_modules/react-native-code-push/android/codepush.gradle&quot;</span>\n\nandroid {\n    defaultConfig {\n        ...\n        versionName <span class="hljs-string">&quot;1.0.0&quot;</span> <span class="hljs-comment">// 确保版本号设置正确</span>\n    }\n    ...\n}\n</code></pre>\n<h3>3. 修改MainApplication.java</h3>\n<pre><code class="language-java"><span class="hljs-comment">// android/app/src/main/java/.../MainApplication.java</span>\n<span class="hljs-keyword">import</span> com.microsoft.codepush.react.CodePush;\n\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReactApplication</span> {\n    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReactNativeHost</span> <span class="hljs-variable">mReactNativeHost</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactNativeHost</span>(<span class="hljs-built_in">this</span>) {\n        <span class="hljs-meta">@Override</span>\n        <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getJSBundleFile</span><span class="hljs-params">()</span> {\n            <span class="hljs-keyword">return</span> CodePush.getJSBundleFile();\n        }\n        \n        <span class="hljs-meta">@Override</span>\n        <span class="hljs-keyword">protected</span> List&lt;ReactPackage&gt; <span class="hljs-title function_">getPackages</span><span class="hljs-params">()</span> {\n            <span class="hljs-keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(\n                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainReactPackage</span>(),\n                <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodePush</span>(\n                    <span class="hljs-string">&quot;YOUR_DEPLOYMENT_KEY&quot;</span>,  <span class="hljs-comment">// 你的Deployment Key</span>\n                    MainApplication.<span class="hljs-built_in">this</span>,\n                    BuildConfig.DEBUG\n                )\n            );\n        }\n    };\n}\n</code></pre>\n<h2>三、代码集成</h2>\n<h3>1. 基础集成方式</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// App.js</span>\n<span class="hljs-keyword">import</span> codePush <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-native-code-push&quot;</span>;\n\n<span class="hljs-keyword">let</span> codePushOptions = { \n    <span class="hljs-attr">checkFrequency</span>: codePush.<span class="hljs-property">CheckFrequency</span>.<span class="hljs-property">ON_APP_START</span>,\n    <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>\n};\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> {\n    <span class="hljs-comment">// 组件代码</span>\n}\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">codePush</span>(codePushOptions)(<span class="hljs-title class_">MyApp</span>);\n</code></pre>\n<h3>2. 高级配置选项</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> codePushOptions = {\n    <span class="hljs-comment">// 检查更新频率</span>\n    <span class="hljs-attr">checkFrequency</span>: codePush.<span class="hljs-property">CheckFrequency</span>.<span class="hljs-property">ON_APP_RESUME</span>,\n    \n    <span class="hljs-comment">// 更新对话框配置</span>\n    <span class="hljs-attr">updateDialog</span>: {\n        <span class="hljs-attr">appendReleaseDescription</span>: <span class="hljs-literal">true</span>,\n        <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;发现新版本&quot;</span>,\n        <span class="hljs-attr">optionalUpdateMessage</span>: <span class="hljs-string">&quot;是否立即更新？&quot;</span>,\n        <span class="hljs-attr">optionalIgnoreButtonLabel</span>: <span class="hljs-string">&quot;稍后&quot;</span>,\n        <span class="hljs-attr">optionalInstallButtonLabel</span>: <span class="hljs-string">&quot;立即更新&quot;</span>,\n        <span class="hljs-attr">mandatoryContinueButtonLabel</span>: <span class="hljs-string">&quot;立即更新&quot;</span>,\n        <span class="hljs-attr">mandatoryUpdateMessage</span>: <span class="hljs-string">&quot;必须更新后才能继续使用&quot;</span>\n    },\n    \n    <span class="hljs-comment">// 安装模式</span>\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>,\n    \n    <span class="hljs-comment">// 部署密钥(可选，推荐在原生配置)</span>\n    <span class="hljs-attr">deploymentKey</span>: <span class="hljs-string">&quot;YOUR_ANDROID_DEPLOYMENT_KEY&quot;</span>\n};\n</code></pre>\n<h2>四、发布更新</h2>\n<h3>1. 生成发布包</h3>\n<pre><code class="language-sh"><span class="hljs-comment"># 开发环境</span>\ncode-push release-react MyApp-Android android --dev\n\n<span class="hljs-comment"># 生产环境强制更新</span>\ncode-push release-react MyApp-Android android -m --description <span class="hljs-string">&quot;重大更新&quot;</span>\n\n<span class="hljs-comment"># 指定目标版本</span>\ncode-push release-react MyApp-Android android -t <span class="hljs-string">&quot;1.0.0&quot;</span> --m\n</code></pre>\n<h3>2. 查看发布历史</h3>\n<pre><code class="language-sh">code-push deployment <span class="hljs-built_in">history</span> MyApp-Android Production\n</code></pre>\n<h2>五、调试与问题排查</h2>\n<h3>1. 获取当前包信息</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-title function_">getUpdateMetadata</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">update</span> =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;当前版本:&quot;</span>, update.<span class="hljs-property">label</span>);\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;是否强制更新:&quot;</span>, update.<span class="hljs-property">isMandatory</span>);\n});\n</code></pre>\n<h3>2. 常见问题解决</h3>\n<p><strong>问题1：更新不生效</strong></p>\n<ul>\n<li>检查<code>versionName</code>是否与发布时指定的版本范围匹配</li>\n<li>确认Deployment Key配置一致</li>\n<li>清除应用数据重新测试</li>\n</ul>\n<p><strong>问题2：Duplicate resources错误</strong></p>\n<pre><code class="language-gradle"><span class="hljs-comment">// android/app/build.gradle</span>\nandroid {\n    packagingOptions {\n        <span class="hljs-keyword">exclude</span> <span class="hljs-string">&#x27;**/libreactnativejni.so&#x27;</span>\n    }\n}\n</code></pre>\n<p><strong>问题3：无法加载JS Bundle</strong></p>\n<ul>\n<li>检查<code>getJSBundleFile()</code>方法是否正确重写</li>\n<li>确认没有其他代码覆盖了JSBundle加载逻辑</li>\n</ul>\n<h2>六、最佳实践</h2>\n<ol>\n<li><strong>版本控制策略</strong>\n<ul>\n<li>保持<code>versionName</code>与CodePush发布版本兼容</li>\n<li>使用语义化版本控制 (如1.0.0)</li>\n</ul>\n</li>\n<li><strong>更新策略</strong><pre><code class="language-javascript"><span class="hljs-comment">// 静默下载，下次启动生效</span>\ncodePush.<span class="hljs-title function_">sync</span>({\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESTART</span>,\n    <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">false</span>\n});\n\n<span class="hljs-comment">// 或显示对话框让用户选择</span>\ncodePush.<span class="hljs-title function_">sync</span>({\n    <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>\n});\n</code></pre>\n</li>\n<li><strong>安全考虑</strong>\n<ul>\n<li>生产环境使用Production Deployment Key</li>\n<li>考虑添加更新包完整性校验</li>\n</ul>\n</li>\n<li><strong>性能优化</strong><pre><code class="language-javascript"><span class="hljs-comment">// 在合适的时机手动检查更新</span>\n<span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) {\n    codePush.<span class="hljs-title function_">sync</span>();\n}\n</code></pre>\n</li>\n</ol>\n<p>通过以上步骤，您已完成CodePush在Android平台的完整集成。建议先在Staging环境充分测试，再发布到Production环境。</p>\n</div>'</script></body></html>