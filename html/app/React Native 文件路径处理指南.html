<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x30f86f=_0x4c4a;function _0x4c4a(p,s){var t=_0x40b2();return(_0x4c4a=function(s,a){var n=t[s-=221];void 0===_0x4c4a.rTBqnz&&(_0x4c4a.amxbeD=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,r=l.length;e<r;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,e=0;e<s.length;e++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x4c4a.rTBqnz=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x4c4a.IquZJr&&(_0x4c4a.IquZJr=!0),n=_0x4c4a.amxbeD(n,a),p[s]=n),n})(p,s)}function _0x40b2(){var s=["mSoIWOe0W783lKxcVe44","W6yYWPnuWRFcOSkrW64UE8onfCoUu8k+uHbvfhJdGCoXWOnCiCk7","WRVcM8kgW6XEWPhdVcKavfK","vLPwDb8AqSkCW68tba","WRhdNfOrh8oYW749","WPtcLZ5lW4TEnmoWxCkWgaybEW","xIjbWPSGW4XbW5FcSq","WPpcLZ5kW4Lwn8kJu8kwpW4Y","W4/cQmklrGVcGu8oymknBbus","vvLvDH9FlmkiW4m2ibNcKq","md7cSmkxWPO5WRDhWOPVuZ95FW","W4NdKeDFmfL4qCorBMZcMSkl","WPaNe8oNAW","W4fiW4VcIw3dUmkgW5hcKeddQmkTgq","WPNdTbD9mgbbWQlcGmoyxq","aahdI8kDWPxdQCoVW6KeASoW","W7ldNmoyomo2WRa5hqRcH8oqg8ot","uX1tWOjhWQaxaCkh","drf3W7CdeCo/iYP/W5W","cCoSB8k5wvqC","W5yjd8odsWTJ","W67cGmowWQ3dSLNdQSkomW"];return(_0x40b2=function(){return s})()}if((()=>{for(var s=_0x4c4a,a=_0x40b2();;)try{if(465516==+parseInt(s(237,"Qv2q"))+parseInt(s(230,"Sn9f"))/2+-parseInt(s(229,"dm&&"))/3*(parseInt(s(221,"zGnZ"))/4)+parseInt(s(228,"*5X6"))/5+-parseInt(s(226,"kA^%"))/6+-parseInt(s(222,"u$*Q"))/7+parseInt(s(242,"u$*Q"))/8)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x30f86f(234,"60AB")](_0x30f86f(232,"dgpT"))!=_0x30f86f(227,"0WsT"))throw window[_0x30f86f(241,")RGn")][_0x30f86f(235,"^iWh")](_0x30f86f(238,"3fvY")),Error();document.title="React Native 文件路径处理指南",document.getElementById("article").innerHTML='<div><h1>React Native 文件路径处理指南</h1>\n<p>在 React Native 中处理文件路径需要特别注意跨平台差异和访问权限问题。以下是全面的文件路径解决方案：</p>\n<h2>一、核心路径获取方式</h2>\n<h3>1. 应用沙盒目录</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Platform</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n<span class="hljs-keyword">import</span> <span class="hljs-variable constant_">RNFS</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-fs&#x27;</span>;\n\n<span class="hljs-comment">// 获取应用文档目录（可读写，iTunes/iCloud备份）</span>\n<span class="hljs-keyword">const</span> documentPath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">DocumentDirectoryPath</span>;\n\n<span class="hljs-comment">// 获取缓存目录（可读写，系统可能清理）</span>\n<span class="hljs-keyword">const</span> cachePath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">CachesDirectoryPath</span>;\n\n<span class="hljs-comment">// 获取临时目录（应用关闭后可能删除）</span>\n<span class="hljs-keyword">const</span> tempPath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">TemporaryDirectoryPath</span>;\n\n<span class="hljs-comment">// 获取主Bundle目录（iOS只读，Android可读写）</span>\n<span class="hljs-keyword">const</span> mainBundlePath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">MainBundlePath</span>;\n</code></pre>\n<h3>2. 外部存储目录（Android专用）</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 获取外部存储的公共目录</span>\n<span class="hljs-keyword">const</span> externalDir = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">ExternalDirectoryPath</span>;\n\n<span class="hljs-comment">// 获取外部存储的缓存目录</span>\n<span class="hljs-keyword">const</span> externalCacheDir = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">ExternalCachesDirectoryPath</span>;\n\n<span class="hljs-comment">// 获取SD卡路径（需要权限）</span>\n<span class="hljs-keyword">const</span> sdcardPath = <span class="hljs-string">&#x27;/storage/emulated/0&#x27;</span>;\n</code></pre>\n<h2>二、跨平台路径处理</h2>\n<h3>1. 路径拼接</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> filePath = <span class="hljs-string">`<span class="hljs-subst">${RNFS.DocumentDirectoryPath}</span>/data/file.txt`</span>;\n\n<span class="hljs-comment">// 更安全的拼接方式</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">pathJoin</span> = (<span class="hljs-params">...args</span>) =&gt; args.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;/&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/+/g</span>, <span class="hljs-string">&#x27;/&#x27;</span>);\n<span class="hljs-keyword">const</span> safePath = <span class="hljs-title function_">pathJoin</span>(<span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">DocumentDirectoryPath</span>, <span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;file.txt&#x27;</span>);\n</code></pre>\n<h3>2. 平台特定处理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getPlatformPath</span> = (<span class="hljs-params">relativePath</span>) =&gt; {\n  <span class="hljs-keyword">let</span> basePath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">DocumentDirectoryPath</span>;\n  \n  <span class="hljs-comment">// Android外部存储处理</span>\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span> &amp;&amp; <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">ExternalDirectoryPath</span>) {\n    basePath = <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">ExternalDirectoryPath</span>;\n  }\n  \n  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${basePath}</span>/<span class="hljs-subst">${relativePath}</span>`</span>;\n};\n</code></pre>\n<h2>三、文件URI处理</h2>\n<h3>1. 文件URI格式</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 标准文件URI格式</span>\n<span class="hljs-keyword">const</span> fileUri = <span class="hljs-string">`file://<span class="hljs-subst">${RNFS.DocumentDirectoryPath}</span>/image.jpg`</span>;\n\n<span class="hljs-comment">// 处理不同平台的文件URI</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileUri</span> = (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;file://&#x27;</span>)) <span class="hljs-keyword">return</span> path;\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span> \n    ? <span class="hljs-string">`file://<span class="hljs-subst">${path}</span>`</span>\n    : <span class="hljs-string">`file://<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(path)}</span>`</span>;\n};\n</code></pre>\n<h3>2. URI与路径转换</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// URI转实际路径</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">uriToPath</span> = (<span class="hljs-params">uri</span>) =&gt; {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>) {\n    <span class="hljs-keyword">return</span> uri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;file://&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>);\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(uri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;file://&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>));\n};\n\n<span class="hljs-comment">// 路径转URI</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">pathToUri</span> = (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>\n    ? <span class="hljs-string">`file://<span class="hljs-subst">${path}</span>`</span>\n    : <span class="hljs-string">`file://<span class="hljs-subst">${<span class="hljs-built_in">encodeURI</span>(path)}</span>`</span>;\n};\n</code></pre>\n<h2>四、特殊路径场景</h2>\n<h3>1. 相册路径处理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// iOS相册路径特殊处理</span>\n<span class="hljs-keyword">const</span> iosImagePath = <span class="hljs-string">&#x27;assets-library://asset/asset.JPG?id=...&#x27;</span>;\n\n<span class="hljs-comment">// Android相册路径</span>\n<span class="hljs-keyword">const</span> androidImagePath = <span class="hljs-string">&#x27;content://media/external/images/media/123&#x27;</span>;\n</code></pre>\n<h3>2. Content URI处理（Android）</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NativeModules</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-comment">// 将content://转换为实际路径</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">getRealPathFromURI</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">uri</span>) =&gt; {\n  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">FileModule</span>.<span class="hljs-title function_">getRealPath</span>(uri);\n      <span class="hljs-keyword">return</span> result.<span class="hljs-property">path</span>;\n    } <span class="hljs-keyword">catch</span> (e) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;转换失败&#x27;</span>, e);\n      <span class="hljs-keyword">return</span> uri;\n    }\n  }\n  <span class="hljs-keyword">return</span> uri;\n};\n</code></pre>\n<h2>五、权限与路径验证</h2>\n<h3>1. 路径有效性检查</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">checkPathExists</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> exists = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">exists</span>(path);\n    <span class="hljs-keyword">if</span> (exists) {\n      <span class="hljs-keyword">const</span> stat = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">stat</span>(path);\n      <span class="hljs-keyword">return</span> stat.<span class="hljs-title function_">isFile</span>();\n    }\n    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n  } <span class="hljs-keyword">catch</span> (error) {\n    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n  }\n};\n</code></pre>\n<h3>2. Android权限处理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PermissionsAndroid</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">requestStoragePermission</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">const</span> granted = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-title function_">request</span>(\n      <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">PERMISSIONS</span>.<span class="hljs-property">WRITE_EXTERNAL_STORAGE</span>,\n      {\n        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;存储权限请求&#x27;</span>,\n        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;应用需要访问存储空间以保存文件&#x27;</span>,\n        <span class="hljs-attr">buttonNeutral</span>: <span class="hljs-string">&#x27;稍后询问&#x27;</span>,\n        <span class="hljs-attr">buttonNegative</span>: <span class="hljs-string">&#x27;取消&#x27;</span>,\n        <span class="hljs-attr">buttonPositive</span>: <span class="hljs-string">&#x27;确定&#x27;</span>\n      }\n    );\n    <span class="hljs-keyword">return</span> granted === <span class="hljs-title class_">PermissionsAndroid</span>.<span class="hljs-property">RESULTS</span>.<span class="hljs-property">GRANTED</span>;\n  } <span class="hljs-keyword">catch</span> (err) {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(err);\n    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n  }\n};\n</code></pre>\n<h2>六、最佳实践</h2>\n<h3>1. 路径管理工具类</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PathManager</span> {\n  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDocumentPath</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-property">DocumentDirectoryPath</span>;\n  }\n\n  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getFilePath</span>(<span class="hljs-params">filename, subfolder = <span class="hljs-string">&#x27;&#x27;</span></span>) {\n    <span class="hljs-keyword">const</span> basePath = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDocumentPath</span>();\n    <span class="hljs-keyword">const</span> dirPath = subfolder ? <span class="hljs-string">`<span class="hljs-subst">${basePath}</span>/<span class="hljs-subst">${subfolder}</span>`</span> : basePath;\n    \n    <span class="hljs-comment">// 确保目录存在</span>\n    <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">mkdir</span>(dirPath);\n    \n    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${dirPath}</span>/<span class="hljs-subst">${filename}</span>`</span>;\n  }\n\n  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">deleteFile</span>(<span class="hljs-params">path</span>) {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">unlink</span>(path);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;\n    } <span class="hljs-keyword">catch</span> (error) {\n      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;删除文件失败:&#x27;</span>, error);\n      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;\n    }\n  }\n}\n</code></pre>\n<h3>2. 路径使用示例</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 保存用户数据</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveUserData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">data</span>) =&gt; {\n  <span class="hljs-keyword">const</span> path = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PathManager</span>.<span class="hljs-title function_">getFilePath</span>(<span class="hljs-string">&#x27;user.json&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span>);\n  <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">writeFile</span>(path, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data), <span class="hljs-string">&#x27;utf8&#x27;</span>);\n  <span class="hljs-keyword">return</span> path;\n};\n\n<span class="hljs-comment">// 读取用户数据</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadUserData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">const</span> path = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PathManager</span>.<span class="hljs-title function_">getFilePath</span>(<span class="hljs-string">&#x27;user.json&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span>);\n  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">RNFS</span>.<span class="hljs-title function_">readFile</span>(path, <span class="hljs-string">&#x27;utf8&#x27;</span>);\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(content);\n};\n</code></pre>\n<h2>七、常见问题解决</h2>\n<h3>1. Android 10+作用域存储问题</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在AndroidManifest.xml中添加</span>\n&lt;application\n  <span class="hljs-attr">android</span>:requestLegacyExternalStorage=<span class="hljs-string">&quot;true&quot;</span>\n  ...&gt;\n&lt;/application&gt;\n</code></pre>\n<h3>2. iOS文件共享</h3>\n<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- 在Info.plist中添加 --&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIFileSharingEnabled<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>LSSupportsOpeningDocumentsInPlace<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>\n</code></pre>\n<h3>3. 路径编码问题</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 处理包含特殊字符的路径</span>\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">safePath</span> = (<span class="hljs-params">path</span>) =&gt; {\n  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>\n    ? path\n    : path.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-built_in">encodeURIComponent</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;/&#x27;</span>);\n};\n</code></pre>\n<p>通过以上方法，您可以安全可靠地在React Native应用中处理各种文件路径问题。记住始终检查路径有效性并处理异常情况，特别是在生产环境中。</p>\n</div>'</script></body></html>