<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x17cb06=_0x238c;function _0x238c(t,s){var e=_0x50f7();return(_0x238c=function(s,n){var a=e[s-=298];void 0===_0x238c.rECFOC&&(_0x238c.quTbFL=function(s,n){var a,l=[],t=0,e="";for(s=(s=>{for(var n,a,l="",t="",e=0,p=0;a=s.charAt(p++);~a&&(n=e%4?64*n+a:a,e++%4)&&(l+=String.fromCharCode(255&n>>(-2*e&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var c=0,r=l.length;c<r;c++)t+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(t)})(s),p=0;p<256;p++)l[p]=p;for(p=0;p<256;p++)t=(t+l[p]+n.charCodeAt(p%n.length))%256,a=l[p],l[p]=l[t],l[t]=a;for(var p=0,t=0,c=0;c<s.length;c++)a=l[p=(p+1)%256],l[p]=l[t=(t+l[p])%256],l[t]=a,e+=String.fromCharCode(s.charCodeAt(c)^l[(l[p]+l[t])%256]);return e},t=arguments,_0x238c.rECFOC=!0);var s=s+e[0],l=t[s];return l?a=l:(void 0===_0x238c.XaEbBo&&(_0x238c.XaEbBo=!0),a=_0x238c.quTbFL(a,n),t[s]=a),a})(t,s)}function _0x50f7(){var s=["BYFcNKuNW5uHWR04yaFcGty","h8kuWOrJWR/dTSoNW7NdHNyOW50","W4bIW7xcLCo2ntVcGSomtSkCAa","W59KbmoDW7VcISk9W4GgwCoKlXO","imoOk8kQE8kgzSod","d8omW5xcPc/cOXGQW682","WQ56WRBcTmku","pSkKa8kPySo8W54fWOLSW7FdQbe","hctdQmkAiWKHisu","W6/dNmkfyCoEWR54W4W","WPeeW63dUh1EWONdNCkGW7C","pSkNa8kRySo/W5uDWRvbW4NdIre","W5FcU8kWW6HDiSozW7PRWRBcV8oy","d8kGW5KIySoUFG","yCkvuLdcM1G4tSkKt0moWPfQrSkdxColxHzTW6zhWQJcOSo1","W5PIqmk1u8k2W7eWW7VcG8koqa","WQjfpSkQbCkKWQ/dRG","WRRdO8kHh8k3jmocjY1nz1O","WRRdO8kGFmoJu8o0mYG","o8ozAMVcJtzzjW","WP44WQldGCk6At/cHq","pCkKdSkGySo5WOGrWQTyW5pdMW","W6W4WOZcJCkzCgldVG","xSozme7cVmkgW40ctaa","WQjfrmk7bCkXWOFdUhG","ewNdLSokm8oJvWz5WQ/cLCkiW40","WP8MlNNdGSkrW4fHWOzE","yGlcSCkLW6y0WPu","iCkUqv86vxfqWPVdMCkhW5qB"];return(_0x50f7=function(){return s})()}if((()=>{for(var s=_0x238c,n=_0x50f7();;)try{if(786180==-parseInt(s(306,"JYC&"))+parseInt(s(317,"!xiT"))/2+-parseInt(s(320,"zlgT"))/3*(-parseInt(s(304,"RCZ1"))/4)+-parseInt(s(311,"v(En"))/5*(-parseInt(s(319,"P8@U"))/6)+-parseInt(s(300,"rf^k"))/7*(-parseInt(s(302,"!xiT"))/8)+parseInt(s(303,"uu8m"))/9*(-parseInt(s(310,"fOQl"))/10)+parseInt(s(299,"%9SF"))/11*(parseInt(s(322,"DJbc"))/12))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x17cb06(308,"M)av")](_0x17cb06(318,")R5z"))!=_0x17cb06(316,"uu8m"))throw window[_0x17cb06(301,"V6Fi")][_0x17cb06(323,"Mq0v")](_0x17cb06(324,"rf^k")),Error();document.title="React Native PanResponder 生命周期事件详解",document.getElementById("article").innerHTML='<div><p>PanResponder 是 React Native 提供的手势响应系统，用于处理触摸交互。以下是 PanResponder 完整的生命周期事件及其触发时机：</p>\n<h2>1. 创建 PanResponder</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PanResponder</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">const</span> panResponder = <span class="hljs-title class_">PanResponder</span>.<span class="hljs-title function_">create</span>({\n  <span class="hljs-comment">// 配置选项</span>\n  <span class="hljs-attr">onStartShouldSetPanResponder</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {...},\n  <span class="hljs-attr">onMoveShouldSetPanResponder</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {...},\n  <span class="hljs-attr">onPanResponderGrant</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {...},\n  <span class="hljs-attr">onPanResponderMove</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {...},\n  <span class="hljs-attr">onPanResponderRelease</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {...},\n  <span class="hljs-comment">// 其他回调...</span>\n});\n</code></pre>\n<h2>2. 完整生命周期事件及触发顺序</h2>\n<h3>2.1 触摸开始阶段</h3>\n<ol>\n<li><strong>onStartShouldSetPanResponder</strong>\n<ul>\n<li>触发时机：触摸开始时（touch down）</li>\n<li>作用：决定是否响应本次触摸事件</li>\n<li>返回 <code>true</code> 表示要响应，<code>false</code> 表示不响应</li>\n</ul>\n</li>\n<li><strong>onMoveShouldSetPanResponder</strong>\n<ul>\n<li>触发时机：触摸移动时（touch move）</li>\n<li>作用：当 <code>onStartShouldSetPanResponder</code> 返回 <code>false</code> 时，决定是否响应移动事件</li>\n<li>可以基于移动距离判断是否响应（如 <code>gestureState.dx &gt; 5</code>）</li>\n</ul>\n</li>\n<li><strong>onPanResponderGrant</strong>\n<ul>\n<li>触发时机：当组件获得响应权时</li>\n<li>作用：表示触摸事件已被该组件捕获</li>\n<li>通常在这里设置初始状态或高亮效果</li>\n</ul>\n</li>\n</ol>\n<h3>2.2 触摸移动阶段</h3>\n<ol start="4">\n<li><strong>onPanResponderMove</strong>\n<ul>\n<li>触发时机：触摸点移动时</li>\n<li>作用：处理移动过程中的逻辑</li>\n<li>可以获取 <code>gestureState</code> 中的位移信息</li>\n</ul>\n</li>\n</ol>\n<h3>2.3 触摸结束阶段</h3>\n<ol start="5">\n<li><strong>onPanResponderRelease</strong>\n<ul>\n<li>触发时机：触摸结束时（touch up）</li>\n<li>作用：处理触摸释放后的逻辑</li>\n<li>通常在这里执行动画或触发操作</li>\n</ul>\n</li>\n<li><strong>onPanResponderTerminate</strong>\n<ul>\n<li>触发时机：当响应被系统或其他手势中断时</li>\n<li>作用：处理中断后的清理工作</li>\n<li>例如：当来电打断当前手势时触发</li>\n</ul>\n</li>\n</ol>\n<h3>2.4 其他事件</h3>\n<ol start="7">\n<li><strong>onPanResponderTerminationRequest</strong>\n<ul>\n<li>触发时机：当其他组件请求获取响应权时</li>\n<li>作用：决定是否允许中断当前响应</li>\n<li>返回 <code>true</code> 允许中断，<code>false</code> 拒绝中断</li>\n</ul>\n</li>\n<li><strong>onPanResponderReject</strong>\n<ul>\n<li>触发时机：当响应请求被拒绝时</li>\n<li>作用：处理被拒绝后的逻辑</li>\n</ul>\n</li>\n</ol>\n<h2>3. gestureState 对象详解</h2>\n<p>所有回调函数都会接收 <code>gestureState</code> 对象，包含以下属性：</p>\n<pre><code class="language-javascript">{\n  <span class="hljs-attr">stateID</span>: number,        <span class="hljs-comment">// 唯一标识符</span>\n  <span class="hljs-attr">moveX</span>: number,          <span class="hljs-comment">// 最近一次移动的屏幕坐标X</span>\n  <span class="hljs-attr">moveY</span>: number,          <span class="hljs-comment">// 最近一次移动的屏幕坐标Y</span>\n  <span class="hljs-attr">x0</span>: number,             <span class="hljs-comment">// 触摸开始的屏幕坐标X</span>\n  <span class="hljs-attr">y0</span>: number,             <span class="hljs-comment">// 触摸开始的屏幕坐标Y</span>\n  <span class="hljs-attr">dx</span>: number,             <span class="hljs-comment">// 从开始到现在的X轴累计位移</span>\n  <span class="hljs-attr">dy</span>: number,             <span class="hljs-comment">// 从开始到现在的Y轴累计位移</span>\n  <span class="hljs-attr">vx</span>: number,             <span class="hljs-comment">// X轴当前速度</span>\n  <span class="hljs-attr">vy</span>: number,             <span class="hljs-comment">// Y轴当前速度</span>\n  <span class="hljs-attr">numberActiveTouches</span>: number <span class="hljs-comment">// 当前活动触摸点数量</span>\n}\n</code></pre>\n<h2>4. 完整示例代码</h2>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">StyleSheet</span>, <span class="hljs-title class_">PanResponder</span>, <span class="hljs-title class_">Animated</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">GestureExample</span> = (<span class="hljs-params"></span>) =&gt; {\n  <span class="hljs-keyword">const</span> pan = <span class="hljs-title function_">useRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animated</span>.<span class="hljs-title class_">ValueXY</span>()).<span class="hljs-property">current</span>;\n\n  <span class="hljs-keyword">const</span> panResponder = <span class="hljs-title function_">useRef</span>(\n    <span class="hljs-title class_">PanResponder</span>.<span class="hljs-title function_">create</span>({\n      <span class="hljs-comment">// 是否在触摸开始时成为响应者</span>\n      <span class="hljs-attr">onStartShouldSetPanResponder</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,\n      \n      <span class="hljs-comment">// 是否在移动时成为响应者</span>\n      <span class="hljs-attr">onMoveShouldSetPanResponder</span>: <span class="hljs-function">(<span class="hljs-params">evt, gestureState</span>) =&gt;</span> {\n        <span class="hljs-comment">// 如果移动距离超过5，则成为响应者</span>\n        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(gestureState.<span class="hljs-property">dx</span>) &gt; <span class="hljs-number">5</span> || <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(gestureState.<span class="hljs-property">dy</span>) &gt; <span class="hljs-number">5</span>;\n      },\n      \n      <span class="hljs-comment">// 成为响应者时调用</span>\n      <span class="hljs-attr">onPanResponderGrant</span>: <span class="hljs-function">() =&gt;</span> {\n        pan.<span class="hljs-title function_">setOffset</span>({\n          <span class="hljs-attr">x</span>: pan.<span class="hljs-property">x</span>.<span class="hljs-property">_value</span>,\n          <span class="hljs-attr">y</span>: pan.<span class="hljs-property">y</span>.<span class="hljs-property">_value</span>\n        });\n      },\n      \n      <span class="hljs-comment">// 移动时调用</span>\n      <span class="hljs-attr">onPanResponderMove</span>: <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">event</span>(\n        [<span class="hljs-literal">null</span>, { <span class="hljs-attr">dx</span>: pan.<span class="hljs-property">x</span>, <span class="hljs-attr">dy</span>: pan.<span class="hljs-property">y</span> }],\n        { <span class="hljs-attr">useNativeDriver</span>: <span class="hljs-literal">false</span> }\n      ),\n      \n      <span class="hljs-comment">// 释放时调用</span>\n      <span class="hljs-attr">onPanResponderRelease</span>: <span class="hljs-function">() =&gt;</span> {\n        pan.<span class="hljs-title function_">flattenOffset</span>();\n      },\n      \n      <span class="hljs-comment">// 响应被中断时调用</span>\n      <span class="hljs-attr">onPanResponderTerminate</span>: <span class="hljs-function">() =&gt;</span> {\n        pan.<span class="hljs-title function_">flattenOffset</span>();\n      },\n      \n      <span class="hljs-comment">// 其他组件请求成为响应者时调用</span>\n      <span class="hljs-attr">onPanResponderTerminationRequest</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>\n    })\n  ).<span class="hljs-property">current</span>;\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Animated.View</span>\n        <span class="hljs-attr">style</span>=<span class="hljs-string">{[styles.box,</span> { <span class="hljs-attr">transform:</span> [{ <span class="hljs-attr">translateX:</span> <span class="hljs-attr">pan.x</span> }, { <span class="hljs-attr">translateY:</span> <span class="hljs-attr">pan.y</span> }] }]}\n        {<span class="hljs-attr">...panResponder.panHandlers</span>}\n      /&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>\n  );\n};\n\n<span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({\n  <span class="hljs-attr">container</span>: {\n    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,\n    <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">&#x27;center&#x27;</span>,\n    <span class="hljs-attr">alignItems</span>: <span class="hljs-string">&#x27;center&#x27;</span>,\n  },\n  <span class="hljs-attr">box</span>: {\n    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,\n    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,\n    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;blue&#x27;</span>,\n    <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">10</span>,\n  },\n});\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GestureExample</span>;\n</code></pre>\n<h2>5. 使用场景建议</h2>\n<ol>\n<li><strong>简单拖拽</strong>  ：使用 <code>onPanResponderMove</code> 跟踪位置变化</li>\n<li><strong>滑动删除</strong>  ：结合 <code>onPanResponderRelease</code> 判断滑动距离</li>\n<li><strong>双击识别</strong>  ：通过记录两次 <code>onPanResponderGrant</code> 的时间差</li>\n<li><strong>手势解锁</strong>  ：跟踪多个触摸点的移动轨迹</li>\n<li><strong>缩放旋转</strong>  ：结合多个触摸点的 <code>gestureState</code> 计算</li>\n</ol>\n<h2>6. 注意事项</h2>\n<ol>\n<li>避免在回调中执行耗时操作，可能导致手势卡顿</li>\n<li>使用 <code>useNativeDriver: true</code> 可以提高动画性能</li>\n<li>多个 PanResponder 可能冲突，需要合理设置响应优先级</li>\n<li>在 Android 上可能需要额外处理返回键中断手势的情况</li>\n</ol>\n<p>通过理解这些生命周期事件，你可以构建各种复杂的手势交互效果。</p>\n</div>'</script></body></html>