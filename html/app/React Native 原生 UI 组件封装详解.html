<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>var _0x3a0691=_0x1344;if((()=>{for(var s=_0x1344,a=_0x56aa();;)try{if(512687==-parseInt(s(215,"4%A1"))*(parseInt(s(230,"ZsWa"))/2)+parseInt(s(222,"Weu6"))/3*(-parseInt(s(206,"ZsWa"))/4)+parseInt(s(220,"ixCU"))/5*(-parseInt(s(226,"V8sv"))/6)+-parseInt(s(209,"(iRe"))/7*(parseInt(s(228,"(iRe"))/8)+parseInt(s(216,"OQNn"))/9+parseInt(s(212,"*JLp"))/10+parseInt(s(205,"ZsWa"))/11)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x3a0691(214,"rhKP")](_0x3a0691(223,"5E$$"))!=_0x3a0691(213,"ZmPB"))throw window[_0x3a0691(229,"0hoH")][_0x3a0691(211,"2dfl")](_0x3a0691(232,"UM$9")),Error();function _0x1344(e,s){var p=_0x56aa();return(_0x1344=function(s,a){var n=p[s-=205];void 0===_0x1344.tPoYWX&&(_0x1344.oslsmX=function(s,a){var n,l=[],e=0,p="";for(s=(s=>{for(var a,n,l="",e="",p=0,t=0;n=s.charAt(t++);~n&&(a=p%4?64*a+n:n,p++%4)&&(l+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=l.length;c<r;c++)e+="%"+("00"+l.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(e)})(s),t=0;t<256;t++)l[t]=t;for(t=0;t<256;t++)e=(e+l[t]+a.charCodeAt(t%a.length))%256,n=l[t],l[t]=l[e],l[e]=n;for(var t=0,e=0,c=0;c<s.length;c++)n=l[t=(t+1)%256],l[t]=l[e=(e+l[t])%256],l[e]=n,p+=String.fromCharCode(s.charCodeAt(c)^l[(l[t]+l[e])%256]);return p},e=arguments,_0x1344.tPoYWX=!0);var s=s+p[0],l=e[s];return l?n=l:(void 0===_0x1344.muMRpC&&(_0x1344.muMRpC=!0),n=_0x1344.oslsmX(n,a),e[s]=n),n})(e,s)}function _0x56aa(){var s=["dCkdW64gWPdcTCox","dfHMWOq+W6LsWQ5Qnua9W6C","rxrwW5xdPx1D","AWtcOLmoWRCPimkW","WPdcT8kcmCoDB8oGAh4OW5q5","FSoWW5RcT8kVWPOil2hcOSkgWQj4","W7ldOJ4fW5hdNMX7WRZdKgldPN4","g1ddSW5nW7fwemkrWOJdQSoNwG","WPpdU3xdIYFdNSkyW7hdJe3dMW","vqaWW5nYWRaiWPq","kmkzW6ZcMmoLl8o0k8kbW5K","FCk2jCooWP9/W7JdPmo4p29PW6G","jNvXbmktWO7dS0Ciy0WcDCoCWR3cHYXzrwpcK8kyW6/dPejj","lmkBW67cMSk4uSkKhCkaW5pdHdTc","kCkEW6NcMCk5umo8jSk7W5hdPIq","CCkRamoyB8oiAq","qHBcIJu/eMhdHLW","WPtdVNdcIv3dRCkRW4ldNG","WQRdSMtdPCk4B8ovWRemWQ3dKG","pKnYcCkzW7FdRG","W7pdQmkbu8kzWOVcQSkTd2hdICkXaa","uqX3jrW","WPPuWQldLupcPce","WQ3dSMtcN8oIFSomWOuP","rblcJKLPvqFdTf/dOcTBuG","hZxcKwmzWQye","WRS3zfG8jfZdHuXi","WQFcU8ogW4ZcQ8kmCmo2BG"];return(_0x56aa=function(){return s})()}document.title="React Native 原生 UI 组件封装详解",document.getElementById("article").innerHTML='<div><p>封装原生 UI 组件可以让 React Native 应用使用平台特有的高性能 UI 元素，或复用已有的原生组件库。以下是完整的原生 UI 组件封装指南。</p>\n<h2>一、封装流程概述</h2>\n<ol>\n<li><strong>设计 JavaScript 接口</strong></li>\n<li><strong>实现 Android 原生组件</strong></li>\n<li><strong>实现 iOS 原生组件</strong></li>\n<li><strong>建立跨平台一致性</strong></li>\n<li><strong>测试与优化</strong></li>\n</ol>\n<h2>二、Android 原生组件封装</h2>\n<h3>1. 创建 ViewManager</h3>\n<pre><code class="language-java"><span class="hljs-comment">// MyCustomViewManager.java</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomViewManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleViewManager</span>&lt;MyCustomView&gt; {\n    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REACT_CLASS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;MyCustomView&quot;</span>;\n    \n    <span class="hljs-meta">@Override</span>\n    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {\n        <span class="hljs-keyword">return</span> REACT_CLASS;\n    }\n\n    <span class="hljs-meta">@Override</span>\n    <span class="hljs-keyword">protected</span> MyCustomView <span class="hljs-title function_">createViewInstance</span><span class="hljs-params">(ThemedReactContext context)</span> {\n        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCustomView</span>(context);\n    }\n}\n</code></pre>\n<h3>2. 注册原生模块</h3>\n<pre><code class="language-java"><span class="hljs-comment">// MyCustomViewPackage.java</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomViewPackage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReactPackage</span> {\n    <span class="hljs-meta">@Override</span>\n    <span class="hljs-keyword">public</span> List&lt;ViewManager&gt; <span class="hljs-title function_">createViewManagers</span><span class="hljs-params">(ReactApplicationContext context)</span> {\n        <span class="hljs-keyword">return</span> Arrays.&lt;ViewManager&gt;asList(\n            <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCustomViewManager</span>()\n        );\n    }\n}\n</code></pre>\n<h3>3. 添加属性支持</h3>\n<pre><code class="language-java"><span class="hljs-comment">// 在 ViewManager 中添加</span>\n<span class="hljs-meta">@ReactProp(name = &quot;text&quot;)</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setText</span><span class="hljs-params">(MyCustomView view, String text)</span> {\n    view.setText(text);\n}\n\n<span class="hljs-meta">@ReactProp(name = &quot;textSize&quot;, defaultInt = 14)</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTextSize</span><span class="hljs-params">(MyCustomView view, <span class="hljs-type">int</span> size)</span> {\n    view.setTextSize(size);\n}\n</code></pre>\n<h2>三、iOS 原生组件封装</h2>\n<h3>1. 创建 UIView 子类</h3>\n<pre><code class="language-objc"><span class="hljs-comment">// MyCustomView.h</span>\n<span class="hljs-meta">#import <span class="hljs-string">&lt;UIKit/UIKit.h&gt;</span></span>\n<span class="hljs-meta">#import <span class="hljs-string">&lt;React/RCTViewManager.h&gt;</span></span>\n\n<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MyCustomView</span> : <span class="hljs-title">UIView</span></span>\n<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *text;\n<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">NSInteger</span> textSize;\n<span class="hljs-keyword">@end</span>\n</code></pre>\n<h3>2. 创建 ViewManager</h3>\n<pre><code class="language-objc"><span class="hljs-comment">// MyCustomViewManager.m</span>\n<span class="hljs-meta">#import <span class="hljs-string">&quot;MyCustomView.h&quot;</span></span>\n\n<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MyCustomViewManager</span> : <span class="hljs-title">RCTViewManager</span></span>\n<span class="hljs-keyword">@end</span>\n\n<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">MyCustomViewManager</span></span>\n\nRCT_EXPORT_MODULE()\n\n- (<span class="hljs-built_in">UIView</span> *)view {\n    <span class="hljs-keyword">return</span> [[MyCustomView alloc] init];\n}\n\nRCT_EXPORT_VIEW_PROPERTY(text, <span class="hljs-built_in">NSString</span>)\nRCT_EXPORT_VIEW_PROPERTY(textSize, <span class="hljs-built_in">NSInteger</span>)\n\n<span class="hljs-keyword">@end</span>\n</code></pre>\n<h2>四、JavaScript 封装层</h2>\n<h3>1. 创建 JavaScript 包装组件</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// MyCustomView.js</span>\n<span class="hljs-keyword">import</span> { requireNativeComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyCustomView</span> = <span class="hljs-title function_">requireNativeComponent</span>(<span class="hljs-string">&#x27;MyCustomView&#x27;</span>);\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyCustomView</span>;\n</code></pre>\n<h3>2. 添加 PropTypes 和默认样式</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 增强版封装</span>\n<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;\n<span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, processColor } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n<span class="hljs-keyword">import</span> { requireNativeComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {\n  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {\n    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NativeMyCustomView</span> {<span class="hljs-attr">...this.props</span>} /&gt;</span></span>;\n  }\n}\n\n<span class="hljs-title class_">MyCustomView</span>.<span class="hljs-property">propTypes</span> = {\n  <span class="hljs-attr">text</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>,\n  <span class="hljs-attr">textSize</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">number</span>,\n  <span class="hljs-comment">// 其他属性...</span>\n};\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">NativeMyCustomView</span> = <span class="hljs-title function_">requireNativeComponent</span>(<span class="hljs-string">&#x27;MyCustomView&#x27;</span>, <span class="hljs-title class_">MyCustomView</span>);\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyCustomView</span>;\n</code></pre>\n<h2>五、事件处理</h2>\n<h3>1. Android 事件处理</h3>\n<pre><code class="language-java"><span class="hljs-comment">// 在 ViewManager 中</span>\n<span class="hljs-meta">@Override</span>\n<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addEventEmitters</span><span class="hljs-params">(ThemedReactContext reactContext, MyCustomView view)</span> {\n    view.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OnClickListener</span>() {\n        <span class="hljs-meta">@Override</span>\n        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {\n            <span class="hljs-type">WritableMap</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> Arguments.createMap();\n            event.putString(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;MyMessage&quot;</span>);\n            reactContext.getJSModule(RCTEventEmitter.class)\n                .receiveEvent(view.getId(), <span class="hljs-string">&quot;topChange&quot;</span>, event);\n        }\n    });\n}\n</code></pre>\n<h3>2. iOS 事件处理</h3>\n<pre><code class="language-objc"><span class="hljs-comment">// 在 MyCustomViewManager.m 中</span>\nRCT_EXPORT_VIEW_PROPERTY(onChange, RCTBubblingEventBlock)\n\n<span class="hljs-comment">// 在 MyCustomView.m 中</span>\n- (<span class="hljs-type">void</span>)setText:(<span class="hljs-built_in">NSString</span> *)text {\n    <span class="hljs-keyword">if</span> (![_text isEqualToString:text]) {\n        _text = text;\n        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.onChange) {\n            <span class="hljs-keyword">self</span>.onChange(@{<span class="hljs-string">@&quot;text&quot;</span>: text});\n        }\n    }\n}\n</code></pre>\n<h3>3. JavaScript 事件处理</h3>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">MyCustomView</span> \n  onChange={<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">text</span>)} \n/&gt;\n</code></pre>\n<h2>六、跨平台一致性处理</h2>\n<h3>1. 统一接口设计</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 平台特定代码</span>\n<span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>({\n  <span class="hljs-attr">ios</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./MyCustomView.ios&#x27;</span>),\n  <span class="hljs-attr">android</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./MyCustomView.android&#x27;</span>),\n})();\n</code></pre>\n<h3>2. 共享 PropTypes</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// MyCustomViewPropTypes.js</span>\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> propTypes = {\n  <span class="hljs-attr">text</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>,\n  <span class="hljs-attr">textSize</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">number</span>,\n  <span class="hljs-comment">// 其他共享属性...</span>\n};\n</code></pre>\n<h2>七、高级功能实现</h2>\n<h3>1. 复杂属性处理 (颜色转换示例)</h3>\n<p>Android:</p>\n<pre><code class="language-java"><span class="hljs-meta">@ReactProp(name = &quot;color&quot;)</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setColor</span><span class="hljs-params">(MyCustomView view, String color)</span> {\n    view.setColor(Color.parseColor(color));\n}\n</code></pre>\n<p>iOS:</p>\n<pre><code class="language-objc">RCT_CUSTOM_VIEW_PROPERTY(color, <span class="hljs-built_in">UIColor</span>, MyCustomView) {\n    view.color = [RCTConvert <span class="hljs-built_in">UIColor</span>:json];\n}\n</code></pre>\n<p>JavaScript:</p>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">MyCustomView</span> color={<span class="hljs-title function_">processColor</span>(<span class="hljs-string">&#x27;blue&#x27;</span>)} /&gt;\n</code></pre>\n<h3>2. 命令式 API</h3>\n<p>Android:</p>\n<pre><code class="language-java"><span class="hljs-meta">@ReactMethod</span>\n<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeText</span><span class="hljs-params">(<span class="hljs-type">int</span> reactTag, String text)</span> {\n    <span class="hljs-type">UIManagerModule</span> <span class="hljs-variable">uiManager</span> <span class="hljs-operator">=</span> getReactApplicationContext().getNativeModule(UIManagerModule.class);\n    uiManager.addUIBlock(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UIBlock</span>() {\n        <span class="hljs-meta">@Override</span>\n        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(NativeViewHierarchyManager nativeViewHierarchyManager)</span> {\n            <span class="hljs-type">MyCustomView</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> (MyCustomView) nativeViewHierarchyManager.resolveView(reactTag);\n            view.setText(text);\n        }\n    });\n}\n</code></pre>\n<p>iOS:</p>\n<pre><code class="language-objc">RCT_EXPORT_METHOD(changeText:(<span class="hljs-keyword">nonnull</span> <span class="hljs-built_in">NSNumber</span> *)reactTag text:(<span class="hljs-built_in">NSString</span> *)text) {\n    [<span class="hljs-keyword">self</span>.bridge.uiManager addUIBlock:^(RCTUIManager *uiManager, <span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSNumber</span> *,<span class="hljs-built_in">UIView</span> *&gt; *viewRegistry) {\n        MyCustomView *view = (MyCustomView *)viewRegistry[reactTag];\n        view.text = text;\n    }];\n}\n</code></pre>\n<p>JavaScript:</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NativeModules</span>, findNodeHandle } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;\n\n<span class="hljs-keyword">const</span> { <span class="hljs-title class_">MyCustomViewManager</span> } = <span class="hljs-title class_">NativeModules</span>;\n\n<span class="hljs-comment">// 使用</span>\n<span class="hljs-keyword">const</span> viewRef = <span class="hljs-title function_">useRef</span>();\n<span class="hljs-title class_">MyCustomViewManager</span>.<span class="hljs-title function_">changeText</span>(<span class="hljs-title function_">findNodeHandle</span>(viewRef.<span class="hljs-property">current</span>), <span class="hljs-string">&#x27;New Text&#x27;</span>);\n</code></pre>\n<h2>八、调试与优化</h2>\n<ol>\n<li><strong>调试工具</strong>  ：\n<ul>\n<li>Android: Layout Inspector</li>\n<li>iOS: Xcode View Hierarchy Debugger</li>\n</ul>\n</li>\n<li><strong>性能优化</strong>  ：\n<ul>\n<li>避免频繁跨界通信</li>\n<li>使用批量属性更新</li>\n<li>实现 shouldComponentUpdate</li>\n</ul>\n</li>\n<li><strong>常见问题排查</strong>  ：\n<ul>\n<li>组件未显示：检查 zIndex 和布局属性</li>\n<li>事件不触发：验证事件名称匹配</li>\n<li>属性不更新：检查 propTypes 定义</li>\n</ul>\n</li>\n</ol>\n<h2>九、最佳实践</h2>\n<ol>\n<li><strong>设计原则</strong>  ：\n<ul>\n<li>保持接口简单</li>\n<li>遵循平台约定</li>\n<li>提供合理的默认值</li>\n</ul>\n</li>\n<li><strong>文档规范</strong>  ：<pre><code class="language-markdown"><span class="hljs-section">## MyCustomView</span>\n\n<span class="hljs-section">### Props</span>\n| 名称 | 类型 | 默认值 | 描述 |\n|------|------|--------|------|\n| text | string | &#x27;&#x27; | 显示文本 |\n</code></pre>\n</li>\n<li><strong>版本兼容</strong>  ：\n<ul>\n<li>考虑 RN 版本差异</li>\n<li>提供降级方案</li>\n<li>明确最低支持版本</li>\n</ul>\n</li>\n</ol>\n<p>通过以上步骤，您可以创建高性能、跨平台一致的原生 UI 组件，为 React Native 应用扩展原生功能。</p>\n</div>'</script></body></html>