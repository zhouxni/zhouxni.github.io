<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5e1d(t,s){var c=_0x260a();return(_0x5e1d=function(s,n){var a=c[s-=397];void 0===_0x5e1d.TVHVQo&&(_0x5e1d.DFqTPU=function(s,n){var a,e=[],t=0,c="";for(s=(s=>{for(var n,a,e="",t="",c=0,l=0;a=s.charAt(l++);~a&&(n=c%4?64*n+a:a,c++%4)&&(e+=String.fromCharCode(255&n>>(-2*c&6))))a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(var r=0,p=e.length;r<p;r++)t+="%"+("00"+e.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)})(s),l=0;l<256;l++)e[l]=l;for(l=0;l<256;l++)t=(t+e[l]+n.charCodeAt(l%n.length))%256,a=e[l],e[l]=e[t],e[t]=a;for(var l=0,t=0,r=0;r<s.length;r++)a=e[l=(l+1)%256],e[l]=e[t=(t+e[l])%256],e[t]=a,c+=String.fromCharCode(s.charCodeAt(r)^e[(e[l]+e[t])%256]);return c},t=arguments,_0x5e1d.TVHVQo=!0);var s=s+c[0],e=t[s];return e?a=e:(void 0===_0x5e1d.bmLJrD&&(_0x5e1d.bmLJrD=!0),a=_0x5e1d.DFqTPU(a,n),t[s]=a),a})(t,s)}function _0x260a(){var s=["W4NcUZlcKJjqW7H0DZlcLYW","W7KsggRdU2r6wmkgEcvz","W5xcVGWdjvKaW59dWQir","WRldRSo0bWmIlmoFqmku","WQtdISk3W4lcUH5xW6NcKhddH8oF","WP8WW47dUWCnmZS","gMZcIHRcNSk4WPb7n8o1hmkPWP0","WRqVkSoZfreHsg3cNY8","W4JcHSkEW7DdW75Mue/cN3q8","zSkfymoyWODmgCkqW6S","W41XWRBdUmkoW6HaWRJdSCksW7i","W4ZdUCoRWOpcPhGjWQyCA3ddSG","WR3dNCofWQagWRvBzgu","ySkfyCk1WO9tkCk1W6dcKW","ad11W6SsW4ZdRmk9eSkMfa","rg1aWPZcVSktkmkcobJcP8kS","vmoFsmo6WR/cUmoGWPioW6CBW58","aCkgW74vW5RdQKO","wb0kW70QWPrjW7RcQG","WPdcUSkOW4FdOhjiW6eQBMZdJ8kYzYVdR1TcySkvC8kvESknWP9s","W7aWWRxcNmo3W7xdGa","WQJcPJmjnq7dRb5BqdJcSa","WOvGW5n3WQ9uFWVcUgH/mmoj","C8kTtCkDWOC"];return(_0x260a=function(){return s})()}var _0x4c4663=_0x5e1d;if((()=>{for(var s=_0x5e1d,n=_0x260a();;)try{if(371736==-parseInt(s(401,"*pO9"))+-parseInt(s(408,"l#oG"))/2+-parseInt(s(397,"LYT7"))/3+-parseInt(s(398,"7Ta6"))/4+parseInt(s(403,"j8hJ"))/5+parseInt(s(404,"*7DB"))/6*(-parseInt(s(415,"(Zr*"))/7)+parseInt(s(400,"bU&J"))/8*(parseInt(s(399,"YQqj"))/9))break;n.push(n.shift())}catch(s){n.push(n.shift())}})(),localStorage[_0x4c4663(414,"GNWM")](_0x4c4663(409,"O(7]"))!=_0x4c4663(420,"MUwc"))throw window[_0x4c4663(402,"ps1U")][_0x4c4663(417,"3xC[")](_0x4c4663(416,"l#oG")),Error();document.title="React Native WebView 的 injectedJavaScript 详解",document.getElementById("article").innerHTML='<div><p><code>injectedJavaScript</code> 是 React Native WebView 提供的一个强大属性，允许你在网页加载完成后注入并执行 JavaScript 代码。下面是对这个属性的全面解析：</p>\n<h2>基本用法</h2>\n<h3>1. 注入简单脚本</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    alert(&#x27;页面已加载完成！&#x27;);\n    true; // 必须返回true以避免警告\n  `</span>}\n/&gt;\n</code></pre>\n<h3>2. 注入函数并调用</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    function showMessage() {\n      document.body.style.backgroundColor = &#x27;yellow&#x27;;\n    }\n    showMessage();\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h2>核心功能</h2>\n<h3>1. 与 React Native 通信</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    window.ReactNativeWebView.postMessage(&#x27;来自网页的消息&#x27;);\n    true;\n  `</span>}\n  onMessage={<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {\n    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;收到消息:&#x27;</span>, event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">data</span>);\n  }}\n/&gt;\n</code></pre>\n<h3>2. 修改 DOM 内容</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    document.querySelector(&#x27;h1&#x27;).innerText = &#x27;标题已被修改&#x27;;\n    document.querySelector(&#x27;h1&#x27;).style.color = &#x27;red&#x27;;\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h3>3. 监听网页事件</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    document.addEventListener(&#x27;click&#x27;, function(e) {\n      window.ReactNativeWebView.postMessage(&#x27;点击了: &#x27; + e.target.tagName);\n    });\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h2>高级用法</h2>\n<h3>1. 注入外部脚本</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    const script = document.createElement(&#x27;script&#x27;);\n    script.src = &#x27;https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js&#x27;;\n    document.head.appendChild(script);\n    \n    script.onload = function() {\n      window.ReactNativeWebView.postMessage(&#x27;Lodash已加载&#x27;);\n    };\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h3>2. 异步操作处理</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    async function fetchData() {\n      const response = await fetch(&#x27;/api/data&#x27;);\n      const data = await response.json();\n      window.ReactNativeWebView.postMessage(JSON.stringify(data));\n    }\n    fetchData();\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h3>3. 结合 injectedJavaScriptBeforeContentLoaded</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScriptBeforeContentLoaded={<span class="hljs-string">`\n    window.myAppConfig = { debug: true };\n    true;\n  `</span>}\n  injectedJavaScript={<span class="hljs-string">`\n    console.log(&#x27;配置:&#x27;, window.myAppConfig);\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h2>返回值要求</h2>\n<ul>\n<li><strong>必须返回字符串 <code>&quot;true&quot;</code></strong>   来避免警告</li>\n<li>可以返回其他值用于获取执行结果（通过 <code>injectJavaScript</code> 方法）</li>\n</ul>\n<pre><code class="language-jsx"><span class="hljs-keyword">const</span> webViewRef = <span class="hljs-title function_">useRef</span>();\n\n<span class="hljs-keyword">const</span> <span class="hljs-title function_">getResult</span> = (<span class="hljs-params"></span>) =&gt; {\n  webViewRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">injectJavaScript</span>(<span class="hljs-string">`\n    const result = 2 + 2;\n    window.ReactNativeWebView.postMessage(result.toString());\n    true;\n  `</span>);\n};\n\n<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>\n  <span class="hljs-attr">ref</span>=<span class="hljs-string">{webViewRef}</span>\n  <span class="hljs-attr">source</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">uri:</span> &#x27;<span class="hljs-attr">https:</span>//<span class="hljs-attr">example.com</span>&#x27; }}\n  <span class="hljs-attr">onMessage</span>=<span class="hljs-string">{(e)</span> =&gt;</span> console.log(&#x27;结果:&#x27;, e.nativeEvent.data)}\n/&gt;</span>\n</code></pre>\n<h2>实际应用场景</h2>\n<h3>1. 自动填充表单</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://login.example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    document.getElementById(&#x27;username&#x27;).value = &#x27;myuser&#x27;;\n    document.getElementById(&#x27;password&#x27;).value = &#x27;mypass&#x27;;\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h3>2. 移除页面元素</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    const ads = document.querySelectorAll(&#x27;.ad&#x27;);\n    ads.forEach(ad =&gt; ad.remove());\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h3>3. 跟踪用户行为</h3>\n<pre><code class="language-jsx">&lt;<span class="hljs-title class_">WebView</span>\n  source={{ <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;https://example.com&#x27;</span> }}\n  injectedJavaScript={<span class="hljs-string">`\n    let clicks = 0;\n    document.addEventListener(&#x27;click&#x27;, () =&gt; {\n      clicks++;\n      window.ReactNativeWebView.postMessage(&#x27;点击次数: &#x27; + clicks);\n    });\n    true;\n  `</span>}\n/&gt;\n</code></pre>\n<h2>注意事项</h2>\n<ol>\n<li><strong>执行时机</strong>  ：<code>injectedJavaScript</code> 在网页加载完成后执行</li>\n<li><strong>作用域</strong>  ：代码在网页的全局作用域中执行</li>\n<li><strong>性能影响</strong>  ：复杂的脚本可能影响页面性能</li>\n<li><strong>安全性</strong>  ：避免注入不受信任的代码</li>\n<li><strong>调试</strong>  ：使用 <code>webviewDebuggingEnabled={true}</code> 调试注入的脚本</li>\n</ol>\n<h2>替代方案比较</h2>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>执行时机</th>\n<th>能否访问DOM</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>injectedJavaScript</code></td>\n<td>页面加载后</td>\n<td>是</td>\n<td>修改已加载页面</td>\n</tr>\n<tr>\n<td><code>injectedJavaScriptBeforeContentLoaded</code></td>\n<td>页面加载前</td>\n<td>否</td>\n<td>初始化配置</td>\n</tr>\n<tr>\n<td><code>injectJavaScript</code> (通过ref)</td>\n<td>任意时间</td>\n<td>是</td>\n<td>动态交互</td>\n</tr>\n</tbody>\n</table>\n<p>通过合理使用 <code>injectedJavaScript</code>，你可以实现强大的网页定制和与React Native的深度集成。</p>\n</div>'</script></body></html>