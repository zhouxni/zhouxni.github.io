<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x5533(){var s=["WPGbW6JcTHBdOqbrjstdJJGW","WPHdfZPgWRdcTg10DsKM","W6SqWO4/WRhdNN3dMG","e8o7W4fSW7BcSNi","beb1WPNdOIxcOq/cT8kkW7C","WPZcOd5dW7e","E8kBWRhcQSoGfCobWRfsEhtdSa","bMRdHdNcR8oBWPdcNuOkW4FdHW","WP9GW5BdHmoXqmoifrxdTcbpWOm","WRRdGmkOWO/dRgjJ","WPLdhJbgWRVdPePXDd4HrG","WPLHW5JdGmkxmCkuprJdIW","qSoqW5zrxNK5F38Sr08H","fK/dUNZdGMbnW78","WQHfWR8GWRtdKgO","W7TUW4WzwZXfjmkdyYy","vmonqwf1z1/cGHldGq","WRidv8oWWQuSdmkVF29rW6u8","WR7dHMhcPSovcSovw8owW5pdSaZdSG","W455c28iwCogWP0pEmkSW7BcKq","ENCJse8bWPGTW4NcMSkgW60","mmkfWOqmfdjdswO","jLRdL23cH8kdCmopWOPAW73dIZa","WOhdO8kUhXm1W5DfW4XvW5b4WRxcMvtcP8oMWOPkWQD8W5LzW7OaWQW","tmolsrBcN8oTzcm"];return(_0x5533=function(){return s})()}var _0x496ef3=_0x3c1f;function _0x3c1f(p,s){var t=_0x5533();return(_0x3c1f=function(s,a){var n=t[s-=143];void 0===_0x3c1f.gcyUuZ&&(_0x3c1f.EmAgQo=function(s,a){var n,l=[],p=0,t="";for(s=(s=>{for(var a,n,l="",p="",t=0,c=0;n=s.charAt(c++);~n&&(a=t%4?64*a+n:n,t++%4)&&(l+=String.fromCharCode(255&a>>(-2*t&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var e=0,o=l.length;e<o;e++)p+="%"+("00"+l.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(p)})(s),c=0;c<256;c++)l[c]=c;for(c=0;c<256;c++)p=(p+l[c]+a.charCodeAt(c%a.length))%256,n=l[c],l[c]=l[p],l[p]=n;for(var c=0,p=0,e=0;e<s.length;e++)n=l[c=(c+1)%256],l[c]=l[p=(p+l[c])%256],l[p]=n,t+=String.fromCharCode(s.charCodeAt(e)^l[(l[c]+l[p])%256]);return t},p=arguments,_0x3c1f.gcyUuZ=!0);var s=s+t[0],l=p[s];return l?n=l:(void 0===_0x3c1f.JxZrYx&&(_0x3c1f.JxZrYx=!0),n=_0x3c1f.EmAgQo(n,a),p[s]=n),n})(p,s)}if((()=>{for(var s=_0x3c1f,a=_0x5533();;)try{if(640346==-parseInt(s(161,"O1R3"))+-parseInt(s(148,"%T*d"))/2+parseInt(s(166,"ECC$"))/3+-parseInt(s(151,"kiT7"))/4+-parseInt(s(145,"(@2X"))/5*(-parseInt(s(152,"ga!i"))/6)+parseInt(s(144,"1F)D"))/7*(parseInt(s(159,"R1aC"))/8)+parseInt(s(158,"rWH3"))/9*(-parseInt(s(154,"qo2d"))/10))break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x496ef3(150,"Fom[")](_0x496ef3(162,"aiEl"))!=_0x496ef3(146,"JRAH"))throw window[_0x496ef3(165,"8iZO")][_0x496ef3(155,"Hgp%")](_0x496ef3(164,"8dr2")),Error();document.title="CodePush 的属性和方法详解",document.getElementById("article").innerHTML='<div><h2>一、核心配置属性</h2>\n<h3>1. 主要配置选项</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> codePushOptions = {\n  <span class="hljs-comment">// 检查更新频率</span>\n  <span class="hljs-attr">checkFrequency</span>: codePush.<span class="hljs-property">CheckFrequency</span>.<span class="hljs-property">ON_APP_START</span>,\n  \n  <span class="hljs-comment">// 安装模式</span>\n  <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESTART</span>,\n  \n  <span class="hljs-comment">// 强制更新的安装模式</span>\n  <span class="hljs-attr">mandatoryInstallMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">IMMEDIATE</span>,\n  \n  <span class="hljs-comment">// 更新对话框配置</span>\n  <span class="hljs-attr">updateDialog</span>: {\n    <span class="hljs-attr">appendReleaseDescription</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;更新可用&quot;</span>,\n    <span class="hljs-attr">optionalUpdateMessage</span>: <span class="hljs-string">&quot;新版本已准备好安装&quot;</span>,\n    <span class="hljs-attr">mandatoryUpdateMessage</span>: <span class="hljs-string">&quot;必须更新才能继续使用&quot;</span>,\n    <span class="hljs-attr">optionalIgnoreButtonLabel</span>: <span class="hljs-string">&quot;稍后&quot;</span>,\n    <span class="hljs-attr">optionalInstallButtonLabel</span>: <span class="hljs-string">&quot;立即安装&quot;</span>,\n    <span class="hljs-attr">mandatoryContinueButtonLabel</span>: <span class="hljs-string">&quot;立即更新&quot;</span>\n  },\n  \n  <span class="hljs-comment">// 部署密钥（可选）</span>\n  <span class="hljs-attr">deploymentKey</span>: <span class="hljs-string">&quot;YOUR_DEPLOYMENT_KEY&quot;</span>\n};\n</code></pre>\n<h2>二、常用静态方法</h2>\n<h3>1. 更新检查与控制</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 手动同步更新</span>\ncodePush.<span class="hljs-title function_">sync</span>(options?: <span class="hljs-title class_">SyncOptions</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">SyncStatus</span>&gt;;\n\n<span class="hljs-comment">// 检查更新</span>\ncodePush.<span class="hljs-title function_">checkForUpdate</span>(deploymentKey?: string): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">RemotePackage</span>&gt;;\n\n<span class="hljs-comment">// 通知应用准备就绪（必须调用）</span>\ncodePush.<span class="hljs-title function_">notifyAppReady</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;;\n\n<span class="hljs-comment">// 获取当前包信息</span>\ncodePush.<span class="hljs-title function_">getCurrentPackage</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LocalPackage</span>&gt;;\n\n<span class="hljs-comment">// 获取更新元数据</span>\ncodePush.<span class="hljs-title function_">getUpdateMetadata</span>(updateState?: <span class="hljs-title class_">UpdateState</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LocalPackage</span>&gt;;\n</code></pre>\n<h3>2. 安装控制</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 立即重启应用应用更新</span>\ncodePush.<span class="hljs-title function_">restartApp</span>(onlyIfUpdateIsPending?: boolean): <span class="hljs-keyword">void</span>;\n\n<span class="hljs-comment">// 允许重启应用</span>\ncodePush.<span class="hljs-title function_">allowRestart</span>(): <span class="hljs-keyword">void</span>;\n\n<span class="hljs-comment">// 禁止重启应用</span>\ncodePush.<span class="hljs-title function_">disallowRestart</span>(): <span class="hljs-keyword">void</span>;\n</code></pre>\n<h3>3. 版本管理</h3>\n<pre><code class="language-javascript"><span class="hljs-comment">// 获取本地包版本</span>\ncodePush.<span class="hljs-title function_">getAppVersion</span>(): <span class="hljs-title class_">Promise</span>&lt;string&gt;;\n\n<span class="hljs-comment">// 获取二进制版本（商店版本）</span>\ncodePush.<span class="hljs-title function_">getBinaryVersion</span>(): <span class="hljs-title class_">Promise</span>&lt;string&gt;;\n</code></pre>\n<h2>三、枚举类型</h2>\n<h3>1. 检查频率 (<code>CheckFrequency</code>)</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-property">CheckFrequency</span> = {\n  <span class="hljs-attr">MANUAL</span>: <span class="hljs-number">0</span>,         <span class="hljs-comment">// 完全手动控制</span>\n  <span class="hljs-attr">ON_APP_START</span>: <span class="hljs-number">1</span>,   <span class="hljs-comment">// 应用启动时检查（默认）</span>\n  <span class="hljs-attr">ON_APP_RESUME</span>: <span class="hljs-number">2</span>   <span class="hljs-comment">// 应用恢复时检查</span>\n};\n</code></pre>\n<h3>2. 安装模式 (<code>InstallMode</code>)</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-property">InstallMode</span> = {\n  <span class="hljs-attr">IMMEDIATE</span>: <span class="hljs-number">0</span>,      <span class="hljs-comment">// 立即安装并重启</span>\n  <span class="hljs-attr">ON_NEXT_RESTART</span>: <span class="hljs-number">1</span>,<span class="hljs-comment">// 下次启动时安装</span>\n  <span class="hljs-attr">ON_NEXT_RESUME</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 应用从后台恢复时安装</span>\n  <span class="hljs-attr">ON_NEXT_SUSPEND</span>: <span class="hljs-number">3</span> <span class="hljs-comment">// 应用进入后台时安装</span>\n};\n</code></pre>\n<h3>3. 同步状态 (<code>SyncStatus</code>)</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-property">SyncStatus</span> = {\n  <span class="hljs-attr">UP_TO_DATE</span>: <span class="hljs-number">0</span>,     <span class="hljs-comment">// 已是最新</span>\n  <span class="hljs-attr">UPDATE_INSTALLED</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 更新已安装</span>\n  <span class="hljs-attr">UPDATE_IGNORED</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 用户忽略更新</span>\n  <span class="hljs-attr">ERROR</span>: <span class="hljs-number">3</span>,          <span class="hljs-comment">// 更新错误</span>\n  <span class="hljs-attr">IN_PROGRESS</span>: <span class="hljs-number">4</span>,    <span class="hljs-comment">// 正在检查/安装</span>\n  <span class="hljs-attr">CHECKING_FOR_UPDATE</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 正在检查更新</span>\n  <span class="hljs-attr">AWAITING_USER_ACTION</span>: <span class="hljs-number">6</span>, <span class="hljs-comment">// 等待用户操作</span>\n  <span class="hljs-attr">DOWNLOADING_PACKAGE</span>: <span class="hljs-number">7</span>, <span class="hljs-comment">// 正在下载</span>\n  <span class="hljs-attr">INSTALLING_UPDATE</span>: <span class="hljs-number">8</span> <span class="hljs-comment">// 正在安装</span>\n};\n</code></pre>\n<h2>四、对象类型</h2>\n<h3>1. <code>LocalPackage</code> 对象</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">LocalPackage</span> {\n  <span class="hljs-attr">appVersion</span>: <span class="hljs-built_in">string</span>;       <span class="hljs-comment">// 应用版本</span>\n  <span class="hljs-attr">deploymentKey</span>: <span class="hljs-built_in">string</span>;   <span class="hljs-comment">// 部署密钥</span>\n  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;     <span class="hljs-comment">// 更新描述</span>\n  <span class="hljs-attr">failedInstall</span>: <span class="hljs-built_in">boolean</span>;  <span class="hljs-comment">// 是否安装失败</span>\n  <span class="hljs-attr">isFirstRun</span>: <span class="hljs-built_in">boolean</span>;      <span class="hljs-comment">// 是否首次运行此版本</span>\n  <span class="hljs-attr">isMandatory</span>: <span class="hljs-built_in">boolean</span>;     <span class="hljs-comment">// 是否强制更新</span>\n  <span class="hljs-attr">isPending</span>: <span class="hljs-built_in">boolean</span>;      <span class="hljs-comment">// 是否等待安装</span>\n  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>;            <span class="hljs-comment">// 版本标签</span>\n  <span class="hljs-attr">packageHash</span>: <span class="hljs-built_in">string</span>;      <span class="hljs-comment">// 包哈希值</span>\n  <span class="hljs-attr">packageSize</span>: <span class="hljs-built_in">number</span>;      <span class="hljs-comment">// 包大小(字节)</span>\n  <span class="hljs-attr">localPath</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 本地存储路径</span>\n};\n</code></pre>\n<h3>2. <code>RemotePackage</code> 对象</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RemotePackage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LocalPackage</span> {\n  <span class="hljs-attr">downloadUrl</span>: <span class="hljs-built_in">string</span>;      <span class="hljs-comment">// 下载URL</span>\n  <span class="hljs-attr">download</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">progressCallback</span>?: (progress: DownloadProgress) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LocalPackage</span>&gt;;\n};\n</code></pre>\n<h3>3. <code>DownloadProgress</code> 对象</h3>\n<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">DownloadProgress</span> {\n  <span class="hljs-attr">totalBytes</span>: <span class="hljs-built_in">number</span>;       <span class="hljs-comment">// 总字节数</span>\n  <span class="hljs-attr">receivedBytes</span>: <span class="hljs-built_in">number</span>;    <span class="hljs-comment">// 已接收字节数</span>\n};\n</code></pre>\n<h2>五、高级使用方法</h2>\n<h3>1. 自定义更新策略</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customSync</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">const</span> remotePackage = <span class="hljs-keyword">await</span> codePush.<span class="hljs-title function_">checkForUpdate</span>();\n  \n  <span class="hljs-keyword">if</span> (remotePackage) {\n    <span class="hljs-keyword">if</span> (remotePackage.<span class="hljs-property">isMandatory</span>) {\n      <span class="hljs-comment">// 强制更新立即下载安装</span>\n      <span class="hljs-keyword">const</span> localPackage = <span class="hljs-keyword">await</span> remotePackage.<span class="hljs-title function_">download</span>();\n      codePush.<span class="hljs-title function_">notifyAppReady</span>();\n      codePush.<span class="hljs-title function_">restartApp</span>();\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-comment">// 非强制更新提示用户</span>\n      <span class="hljs-title class_">Alert</span>.<span class="hljs-title function_">alert</span>(\n        <span class="hljs-string">&#x27;更新可用&#x27;</span>,\n        remotePackage.<span class="hljs-property">description</span>,\n        [\n          {<span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;忽略&#x27;</span>, <span class="hljs-attr">onPress</span>: <span class="hljs-function">() =&gt;</span> codePush.<span class="hljs-title function_">notifyAppReady</span>()},\n          {<span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;安装&#x27;</span>, <span class="hljs-attr">onPress</span>: <span class="hljs-title function_">async</span> () =&gt; {\n            <span class="hljs-keyword">await</span> remotePackage.<span class="hljs-title function_">download</span>();\n            codePush.<span class="hljs-title function_">notifyAppReady</span>();\n            codePush.<span class="hljs-title function_">restartApp</span>();\n          }}\n        ]\n      );\n    }\n  } <span class="hljs-keyword">else</span> {\n    codePush.<span class="hljs-title function_">notifyAppReady</span>();\n  }\n}\n</code></pre>\n<h3>2. 差量更新控制</h3>\n<pre><code class="language-javascript">codePush.<span class="hljs-title function_">sync</span>({\n  <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESTART</span>,\n  <span class="hljs-attr">rollbackRetryOptions</span>: {\n    <span class="hljs-attr">delayInHours</span>: <span class="hljs-number">1</span>,       <span class="hljs-comment">// 重试延迟(小时)</span>\n    <span class="hljs-attr">maxRetryAttempts</span>: <span class="hljs-number">3</span>    <span class="hljs-comment">// 最大重试次数</span>\n  }\n});\n</code></pre>\n<h3>3. 多部署环境管理</h3>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STAGING_KEY</span> = <span class="hljs-string">&quot;YOUR_STAGING_KEY&quot;</span>;\n<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRODUCTION_KEY</span> = <span class="hljs-string">&quot;YOUR_PRODUCTION_KEY&quot;</span>;\n\n<span class="hljs-keyword">const</span> deploymentKey = __DEV__ ? <span class="hljs-variable constant_">STAGING_KEY</span> : <span class="hljs-variable constant_">PRODUCTION_KEY</span>;\n\ncodePush.<span class="hljs-title function_">sync</span>({\n  deploymentKey,\n  <span class="hljs-attr">updateDialog</span>: <span class="hljs-literal">true</span>,\n  <span class="hljs-attr">installMode</span>: codePush.<span class="hljs-property">InstallMode</span>.<span class="hljs-property">ON_NEXT_RESTART</span>\n});\n</code></pre>\n<h2>六、注意事项</h2>\n<ol>\n<li><strong>必须调用</strong>   <code>notifyAppReady()</code>，否则CodePush会认为更新失败</li>\n<li><strong>测试环境</strong>  建议使用<code>InstallMode.ON_NEXT_RESTART</code></li>\n<li><strong>生产环境</strong>  强制更新应使用<code>InstallMode.IMMEDIATE</code></li>\n<li><strong>版本兼容</strong>  ：热更新版本号必须与二进制版本号匹配</li>\n<li><strong>回滚机制</strong>  ：更新失败会自动回滚到上一个版本</li>\n</ol>\n<p>通过合理使用这些属性和方法，可以实现灵活的热更新策略，满足不同业务场景的需求。</p>\n</div>'</script></body></html>