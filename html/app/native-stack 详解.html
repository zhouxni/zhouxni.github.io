<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../../css/github-markdown.min.css"><link rel="stylesheet" href="../../css/github.min.css"><style>body,html{margin:0;padding:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto!important;padding:45px 15px}.markdown-body pre{border:1px solid #e5e5e5!important;margin-top:var(--base-size-16)!important}</style></head><body><article id="article" class="markdown-body"></article><script>function _0x223b(){var s=["iwhdJevECCkyxSkPaZbIaCkLW7VcJ17cH09XW6VcT8kVa3mQ","W7RdON4sW4xdSgBdGKxdS0JcSW","W5q/WR3cVIXxomkgW4ZcLhr+W4O","wx3dMmo+WP/dTalcGSkMiq","WPiGFmkiACkFWRLIhq","zmk+aCkCfCo+WQz7BhLKlW","jmoZWRpdHL/dUxBcMCojW5v7W4y","j21qWOL3tNJdM8kkWQpcKee3","c8k1W5JdK8oDs8oFemkekq","rIRdHwxdRmo7ib0","W77dRNKtW43dSLxdR0xdVeFcUG","EYdcIqyvFmkboSk7gc5TkG","i8kYx3HFycddRMVcPsSeBJ0","dmkQpqD6W6BcLhe","W57dIHVdPIxdPaDcB0JdMwG","o8k7mCoJW4RcJSkoW7GukSodW6O","bmkvW5ShW5VcUCoqWR7dMx4rWPRcRbi","hL9KWO/dPa","rSkNqaOYWPNdPq","WOncobPGrH0l","CCkIW7hcVHJcQha","cmk4W5RdLCk0dSkUlCkMkmoFWOi6"];return(_0x223b=function(){return s})()}var _0x1f092d=_0x3be6;function _0x3be6(l,s){var p=_0x223b();return(_0x3be6=function(s,a){var n=p[s-=409];void 0===_0x3be6.VQDgGX&&(_0x3be6.EKuGoa=function(s,a){var n,t=[],l=0,p="";for(s=(s=>{for(var a,n,t="",l="",p=0,e=0;n=s.charAt(e++);~n&&(a=p%4?64*a+n:n,p++%4)&&(t+=String.fromCharCode(255&a>>(-2*p&6))))n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(var c=0,r=t.length;c<r;c++)l+="%"+("00"+t.charCodeAt(c).toString(16)).slice(-2);return decodeURIComponent(l)})(s),e=0;e<256;e++)t[e]=e;for(e=0;e<256;e++)l=(l+t[e]+a.charCodeAt(e%a.length))%256,n=t[e],t[e]=t[l],t[l]=n;for(var e=0,l=0,c=0;c<s.length;c++)n=t[e=(e+1)%256],t[e]=t[l=(l+t[e])%256],t[l]=n,p+=String.fromCharCode(s.charCodeAt(c)^t[(t[e]+t[l])%256]);return p},l=arguments,_0x3be6.VQDgGX=!0);var s=s+p[0],t=l[s];return t?n=t:(void 0===_0x3be6.RYirdY&&(_0x3be6.RYirdY=!0),n=_0x3be6.EKuGoa(n,a),l[s]=n),n})(l,s)}if((()=>{for(var s=_0x3be6,a=_0x223b();;)try{if(373997==-parseInt(s(416,"z#xJ"))+parseInt(s(425,"z#xJ"))/2+-parseInt(s(422,"bnHW"))/3+-parseInt(s(426,"CO#*"))/4+parseInt(s(418,"Noar"))/5*(parseInt(s(412,"ARV6"))/6)+parseInt(s(421,"GnYk"))/7+parseInt(s(409,"EbbP"))/8)break;a.push(a.shift())}catch(s){a.push(a.shift())}})(),localStorage[_0x1f092d(413,"GnYk")](_0x1f092d(419,"nO95"))!=_0x1f092d(410,"w$%G"))throw window[_0x1f092d(424,"G!&m")][_0x1f092d(411,"yTRW")](_0x1f092d(415,"CO#*")),Error();document.title="native-stack 详解",document.getElementById("article").innerHTML='<div><p>以下是关于 <code>@react-navigation/native-stack</code> 的深度解析，涵盖核心特性、配置细节和性能优化策略：</p>\n<hr>\n<h3>一、核心优势</h3>\n<p><code>@react-navigation/native-stack</code> 是基于原生导航组件（iOS的<code>UINavigationController</code>/Android的<code>Fragment</code>）实现的栈导航器，相比纯JS实现的<code>@react-navigation/stack</code>具有：</p>\n<ul>\n<li><strong>60fps原生级动画</strong></li>\n<li><strong>更低的内存占用</strong></li>\n<li><strong>完美的平台原生行为</strong>  （如iOS边缘返回手势）</li>\n<li><strong>更快的启动速度</strong></li>\n</ul>\n<hr>\n<h3>二、基础配置</h3>\n<h4>1. 安装依赖</h4>\n<pre><code class="language-sh">yarn add @react-navigation/native-stack react-native-screens\n<span class="hljs-comment"># iOS需要pod install</span>\n<span class="hljs-built_in">cd</span> ios &amp;&amp; pod install\n</code></pre>\n<h4>2. 基本使用</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createNativeStackNavigator } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@react-navigation/native-stack&#x27;</span>;\n\n<span class="hljs-keyword">const</span> <span class="hljs-title class_">NativeStack</span> = <span class="hljs-title function_">createNativeStackNavigator</span>();\n\n<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavigationContainer</span>&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Navigator</span>\n        <span class="hljs-attr">initialRouteName</span>=<span class="hljs-string">&quot;Home&quot;</span>\n        <span class="hljs-attr">screenOptions</span>=<span class="hljs-string">{{</span>\n          <span class="hljs-attr">headerLargeTitle:</span> <span class="hljs-attr">true</span>, // <span class="hljs-attr">iOS大标题</span>\n          <span class="hljs-attr">headerTransparent:</span> <span class="hljs-attr">true</span>, // <span class="hljs-attr">透明标题栏</span>\n        }}\n      &gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Screen</span> \n          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Home&quot;</span> \n          <span class="hljs-attr">component</span>=<span class="hljs-string">{HomeScreen}</span>\n          <span class="hljs-attr">options</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">title:</span> &#x27;<span class="hljs-attr">首页</span>&#x27; }}\n        /&gt;</span>\n        <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Screen</span> \n          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Details&quot;</span> \n          <span class="hljs-attr">component</span>=<span class="hljs-string">{DetailsScreen}</span>\n          <span class="hljs-attr">options</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">route</span> }) =&gt;</span> ({ \n            title: route.params?.title || &#x27;详情&#x27;,\n            headerBackTitle: &#x27;返回&#x27;, // iOS专属\n          })}\n        /&gt;\n      <span class="hljs-tag">&lt;/<span class="hljs-name">NativeStack.Navigator</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">NavigationContainer</span>&gt;</span></span>\n  );\n}\n</code></pre>\n<hr>\n<h3>三、平台专属特性配置</h3>\n<h4>1. iOS专属配置</h4>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Screen</span>\n  name=<span class="hljs-string">&quot;Profile&quot;</span>\n  component={<span class="hljs-title class_">ProfileScreen</span>}\n  options={{\n    <span class="hljs-comment">// 大标题配置</span>\n    <span class="hljs-attr">headerLargeTitle</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">headerLargeTitleShadowVisible</span>: <span class="hljs-literal">false</span>,\n    <span class="hljs-comment">// 搜索栏集成</span>\n    <span class="hljs-attr">headerSearchBarOptions</span>: {\n      <span class="hljs-attr">placeholder</span>: <span class="hljs-string">&quot;搜索用户&quot;</span>,\n      <span class="hljs-attr">onChangeText</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">text</span>),\n    },\n    <span class="hljs-comment">// 导航栏外观</span>\n    <span class="hljs-attr">headerBlurEffect</span>: <span class="hljs-string">&#x27;systemUltraThinMaterial&#x27;</span>, <span class="hljs-comment">// 毛玻璃效果</span>\n  }}\n/&gt;\n</code></pre>\n<h4>2. Android专属配置</h4>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Screen</span>\n  name=<span class="hljs-string">&quot;Settings&quot;</span>\n  component={<span class="hljs-title class_">SettingsScreen</span>}\n  options={{\n    <span class="hljs-comment">// 标题栏样式</span>\n    <span class="hljs-attr">headerTitleStyle</span>: {\n      <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">&#x27;Roboto-Medium&#x27;</span>,\n    },\n    <span class="hljs-comment">// 返回按钮行为</span>\n    <span class="hljs-attr">headerBackButtonMenuEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 显示最近页面列表</span>\n    <span class="hljs-comment">// 过渡动画</span>\n    <span class="hljs-attr">animation</span>: <span class="hljs-string">&#x27;slide_from_right&#x27;</span>, <span class="hljs-comment">// 可选: fade / slide_from_bottom</span>\n  }}\n/&gt;\n</code></pre>\n<hr>\n<h3>四、性能优化实践</h3>\n<h4>1. 强制启用原生驱动</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在应用入口处</span>\n<span class="hljs-keyword">import</span> { enableScreens } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-screens&#x27;</span>;\n<span class="hljs-title function_">enableScreens</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 必须调用！</span>\n</code></pre>\n<h4>2. 内存管理策略</h4>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Navigator</span>\n  screenOptions={{\n    <span class="hljs-comment">// 离开屏幕时自动释放资源</span>\n    <span class="hljs-attr">detachPreviousScreen</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-comment">// 冻结非活动屏幕（保留状态但停止渲染）</span>\n    <span class="hljs-attr">freezeOnBlur</span>: <span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span>,\n  }}\n&gt;\n&lt;/<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Navigator</span>&gt;\n</code></pre>\n<h4>3. 预加载关键路由</h4>\n<pre><code class="language-javascript"><span class="hljs-comment">// 在用户可能访问的路径提前渲染</span>\n<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  navigation.<span class="hljs-title function_">dispatch</span>(\n    <span class="hljs-title class_">StackActions</span>.<span class="hljs-title function_">preload</span>(<span class="hljs-string">&#x27;Details&#x27;</span>, { <span class="hljs-attr">preloadData</span>: <span class="hljs-string">&#x27;example&#x27;</span> })\n  );\n}, []);\n</code></pre>\n<hr>\n<h3>五、高级交互模式</h3>\n<h4>1. 自定义返回按钮行为</h4>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Screen</span>\n  name=<span class="hljs-string">&quot;Checkout&quot;</span>\n  component={<span class="hljs-title class_">CheckoutScreen</span>}\n  options={{\n    <span class="hljs-comment">// 阻止物理返回键</span>\n    <span class="hljs-attr">customAnimationOnGesture</span>: <span class="hljs-literal">false</span>,\n    <span class="hljs-comment">// 自定义返回确认</span>\n    <span class="hljs-attr">headerLeft</span>: <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> (\n      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TouchableOpacity</span> \n        <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> \n          Alert.alert(&#x27;确定离开？&#x27;, &#x27;未保存的数据将丢失&#x27;, [\n            { text: &#x27;取消&#x27; },\n            { text: &#x27;确定&#x27;, onPress: props.onPress }\n          ])\n        }\n      &gt;\n        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>返回<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>\n      <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableOpacity</span>&gt;</span></span>\n    ),\n  }}\n/&gt;\n</code></pre>\n<h4>2. 全屏模态窗口</h4>\n<pre><code class="language-javascript">&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Navigator</span>&gt;\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Group</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Screen</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Main&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{MainScreen}</span> /&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">NativeStack.Group</span>&gt;</span></span>\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Group</span>\n    <span class="hljs-attr">screenOptions</span>=<span class="hljs-string">{{</span>\n      <span class="hljs-attr">presentation:</span> &#x27;<span class="hljs-attr">modal</span>&#x27;, // <span class="hljs-attr">模态显示</span>\n      <span class="hljs-attr">gestureEnabled:</span> <span class="hljs-attr">true</span>,\n      <span class="hljs-attr">animation:</span> &#x27;<span class="hljs-attr">slide_from_bottom</span>&#x27;, // <span class="hljs-attr">上滑动画</span>\n    }}\n  &gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Screen</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Player&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{VideoPlayer}</span> /&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">NativeStack.Group</span>&gt;</span></span>\n&lt;/<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Navigator</span>&gt;\n</code></pre>\n<hr>\n<h3>六、与普通Stack的差异对比</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th><code>native-stack</code></th>\n<th><code>stack</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>动画性能</strong></td>\n<td>60fps原生动画</td>\n<td>JS驱动动画（约30fps）</td>\n</tr>\n<tr>\n<td><strong>内存占用</strong></td>\n<td>原生组件自动管理</td>\n<td>依赖JS回收机制</td>\n</tr>\n<tr>\n<td><strong>平台一致性</strong></td>\n<td>完美匹配各平台原生行为</td>\n<td>统一跨平台行为</td>\n</tr>\n<tr>\n<td><strong>配置灵活性</strong></td>\n<td>受限于原生能力</td>\n<td>完全可定制</td>\n</tr>\n<tr>\n<td><strong>启动速度</strong></td>\n<td>更快（无需JS初始化）</td>\n<td>较慢</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>七、调试技巧</h3>\n<h4>1. 检查原生组件树</h4>\n<pre><code class="language-sh"><span class="hljs-comment"># Android</span>\nadb shell dumpsys activity top\n\n<span class="hljs-comment"># iOS</span>\npo [[UIWindow keyWindow] recursiveDescription]\n</code></pre>\n<h4>2. 常见问题解决</h4>\n<table>\n<thead>\n<tr>\n<th>问题现象</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>标题栏不显示</td>\n<td>检查<code>headerShown: true</code>，确保未在<code>screenOptions</code>中全局覆盖</td>\n</tr>\n<tr>\n<td>iOS返回手势失效</td>\n<td>确认未禁用<code>gestureEnabled</code>，且未嵌套多个导航器</td>\n</tr>\n<tr>\n<td>Android页面跳转黑屏</td>\n<td>升级<code>react-native-screens</code>到最新版</td>\n</tr>\n<tr>\n<td>深层链接打开错误页面</td>\n<td>使用<code>linking</code>配置验证路径匹配：<code>npx uri-scheme verify myapp://home/123</code></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3>八、企业级最佳实践</h3>\n<h4>1. 动态导航栏配置</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DynamicHeader</span>(<span class="hljs-params">{ route }</span>) {\n  <span class="hljs-keyword">const</span> scrollY = <span class="hljs-title function_">useRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animated</span>.<span class="hljs-title class_">Value</span>(<span class="hljs-number">0</span>)).<span class="hljs-property">current</span>;\n\n  <span class="hljs-keyword">return</span> (\n    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Animated.View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>\n      <span class="hljs-attr">opacity:</span> <span class="hljs-attr">scrollY.interpolate</span>({\n        <span class="hljs-attr">inputRange:</span> [<span class="hljs-attr">0</span>, <span class="hljs-attr">50</span>],\n        <span class="hljs-attr">outputRange:</span> [<span class="hljs-attr">1</span>, <span class="hljs-attr">0</span>],\n      }),\n    }}&gt;</span>\n      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{route.params?.title}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>\n    <span class="hljs-tag">&lt;/<span class="hljs-name">Animated.View</span>&gt;</span></span>\n  );\n}\n\n<span class="hljs-comment">// 在屏幕中使用</span>\n&lt;<span class="hljs-title class_">NativeStack</span>.<span class="hljs-property">Screen</span>\n  name=<span class="hljs-string">&quot;Feed&quot;</span>\n  component={<span class="hljs-title class_">FeedScreen</span>}\n  options={{\n    <span class="hljs-attr">header</span>: <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DynamicHeader</span> {<span class="hljs-attr">...props</span>} /&gt;</span></span>,\n  }}\n/&gt;\n</code></pre>\n<h4>2. 导航状态持久化</h4>\n<pre><code class="language-javascript"><span class="hljs-keyword">const</span> [isReady, setIsReady] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);\n<span class="hljs-keyword">const</span> [initialState, setInitialState] = <span class="hljs-title function_">useState</span>();\n\n<span class="hljs-comment">// 恢复状态</span>\n<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {\n  <span class="hljs-keyword">const</span> <span class="hljs-title function_">restoreState</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {\n    <span class="hljs-keyword">try</span> {\n      <span class="hljs-keyword">const</span> savedState = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;NAV_STATE&#x27;</span>);\n      <span class="hljs-keyword">if</span> (savedState) <span class="hljs-title function_">setInitialState</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(savedState));\n    } <span class="hljs-keyword">finally</span> {\n      <span class="hljs-title function_">setIsReady</span>(<span class="hljs-literal">true</span>);\n    }\n  };\n  <span class="hljs-title function_">restoreState</span>();\n}, []);\n\n<span class="hljs-keyword">if</span> (!isReady) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoadingScreen</span> /&gt;</span></span>;\n\n<span class="hljs-keyword">return</span> (\n  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavigationContainer</span>\n    <span class="hljs-attr">initialState</span>=<span class="hljs-string">{initialState}</span>\n    <span class="hljs-attr">onStateChange</span>=<span class="hljs-string">{(state)</span> =&gt;</span> \n      AsyncStorage.setItem(&#x27;NAV_STATE&#x27;, JSON.stringify(state))\n    }\n  &gt;\n    <span class="hljs-tag">&lt;<span class="hljs-name">NativeStack.Navigator</span>&gt;</span>{/*...*/}<span class="hljs-tag">&lt;/<span class="hljs-name">NativeStack.Navigator</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">NavigationContainer</span>&gt;</span></span>\n);\n</code></pre>\n<hr>\n<p>通过合理配置 <code>@react-navigation/native-stack</code>，可以显著提升应用导航体验，建议在新项目中优先选择此方案，特别是在性能敏感场景下。对于需要高度自定义动画的页面，可局部结合 <code>@react-navigation/stack</code> 使用。</p>\n</div>'</script></body></html>